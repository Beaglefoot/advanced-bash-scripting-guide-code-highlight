<!DOCTYPE html><html><head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.7.28">
  <title>Complex Functions and Function Complexities</title>
  <meta name="GENERATOR" content="Modular DocBook HTML Stylesheet Version 1.7">
  <link rel="HOME" title="Advanced Bash-Scripting Guide" href="index.html">
  <link rel="UP" title="Functions" href="functions.html">
  <link rel="PREVIOUS" title="Functions" href="functions.html">
  <link rel="NEXT" title="Local Variables" href="localvar.html">
<link rel="stylesheet" href="styles/custom.css"><link rel="stylesheet" href="styles/atom-one-dark.css"></head>
<body class="SECT1" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#840084" alink="#0000FF">
  <div class="NAVHEADER">
    <table summary="Header navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tbody><tr>
        <th colspan="3" align="center">Advanced Bash-Scripting Guide:</th>
      </tr>
      <tr>
        <td width="10%" align="left" valign="bottom"><a href="functions.html" accesskey="P">Prev</a></td>
        <td width="80%" align="center" valign="bottom">Chapter 24. Functions</td>
        <td width="10%" align="right" valign="bottom"><a href="localvar.html" accesskey="N">Next</a></td>
      </tr>
    </tbody></table>
    <hr align="left" width="100%">
  </div>
  <div class="SECT1">
    <h1 class="SECT1"><a name="COMPLEXFUNCT" id="COMPLEXFUNCT"></a>24.1. Complex Functions and Function Complexities</h1>
    <p>Functions may process arguments passed to them and return an <a href="exit-status.html#EXITSTATUSREF">exit status</a> to the script for further processing.</p>
    <table border="0" bgcolor="#E0E0E0" width="100%">
      <tbody><tr>
        <td>
          <pre class="PROGRAMLISTING hljs">function_name <span class="hljs-variable">$arg1</span> <span class="hljs-variable">$arg2</span></pre>
        </td>
      </tr>
    </tbody></table>
    <p><a name="PASSEDARGS" id="PASSEDARGS"></a></p>
    <p>The function refers to the passed arguments by position (as if they were <a href="internalvariables.html#POSPARAMREF">positional parameters</a>), that is, <tt class="VARNAME">$1</tt>, <tt class="VARNAME">$2</tt>, and so forth.</p>
    <div class="EXAMPLE">
      <a name="EX60" id="EX60"></a>
      <p><b>Example 24-2. Function Taking Parameters</b></p>
      <table border="0" bgcolor="#E0E0E0" width="100%">
        <tbody><tr>
          <td>
            <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># Functions and parameters</span>

DEFAULT=default                             <span class="hljs-comment"># Default param value.</span>

<span class="hljs-function"><span class="hljs-title">func2</span></span> () {
   <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]                           <span class="hljs-comment"># Is parameter #1 zero length?</span>
   <span class="hljs-keyword">then</span>
     <span class="hljs-built_in">echo</span> <span class="hljs-string">"-Parameter #1 is zero length.-"</span>  <span class="hljs-comment"># Or no parameter passed.</span>
   <span class="hljs-keyword">else</span>
     <span class="hljs-built_in">echo</span> <span class="hljs-string">"-Parameter #1 is \"<span class="hljs-variable">$1</span>\".-"</span>
   <span class="hljs-keyword">fi</span>

   variable=<span class="hljs-variable">${1-$DEFAULT}</span>                   <span class="hljs-comment">#  What does</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"variable = <span class="hljs-variable">$variable</span>"</span>              <span class="hljs-comment">#+ parameter substitution show?</span>
                                            <span class="hljs-comment">#  ---------------------------</span>
                                            <span class="hljs-comment">#  It distinguishes between</span>
                                            <span class="hljs-comment">#+ no param and a null param.</span>

   <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ]
   <span class="hljs-keyword">then</span>
     <span class="hljs-built_in">echo</span> <span class="hljs-string">"-Parameter #2 is \"<span class="hljs-variable">$2</span>\".-"</span>
   <span class="hljs-keyword">fi</span>

   <span class="hljs-built_in">return</span> 0
}

<span class="hljs-built_in">echo</span>
   
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Nothing passed."</span>   
func2                          <span class="hljs-comment"># Called with no params</span>
<span class="hljs-built_in">echo</span>


<span class="hljs-built_in">echo</span> <span class="hljs-string">"Zero-length parameter passed."</span>
func2 <span class="hljs-string">""</span>                       <span class="hljs-comment"># Called with zero-length param</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Null parameter passed."</span>
func2 <span class="hljs-string">"<span class="hljs-variable">$uninitialized_param</span>"</span>   <span class="hljs-comment"># Called with uninitialized param</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"One parameter passed."</span>   
func2 first           <span class="hljs-comment"># Called with one param</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Two parameters passed."</span>   
func2 first second    <span class="hljs-comment"># Called with two params</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"\"\" \"second\" passed."</span>
func2 <span class="hljs-string">""</span> second       <span class="hljs-comment"># Called with zero-length first parameter</span>
<span class="hljs-built_in">echo</span>                  <span class="hljs-comment"># and ASCII string as a second one.</span>

<span class="hljs-built_in">exit</span> 0</pre>
          </td>
        </tr>
      </tbody></table>
    </div>
    <p><a name="FSHIFTREF" id="FSHIFTREF"></a></p>
    <div class="IMPORTANT">
      <table class="IMPORTANT" width="100%" border="0">
        <tbody><tr>
          <td width="25" align="center" valign="top"><img src="images/important.gif" hspace="5" alt="Important"></td>
          <td align="left" valign="top">
            <p>The <a href="othertypesv.html#SHIFTREF">shift</a> command works on arguments passed to functions (see <a href="assortedtips.html#MULTIPLICATION">Example 36-18</a>).</p>
          </td>
        </tr>
      </tbody></table>
    </div>
    <p>But, what about command-line arguments passed to the script? Does a function see them? Well, let's clear up the confusion.</p>
    <div class="EXAMPLE">
      <a name="FUNCCMDLINEARG" id="FUNCCMDLINEARG"></a>
      <p><b>Example 24-3. Functions and command-line args passed to the script</b></p>
      <table border="0" bgcolor="#E0E0E0" width="100%">
        <tbody><tr>
          <td>
            <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># func-cmdlinearg.sh</span>
<span class="hljs-comment">#  Call this script with a command-line argument,</span>
<span class="hljs-comment">#+ something like $0 arg1.</span>


<span class="hljs-function"><span class="hljs-title">func</span></span> ()

{
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>   <span class="hljs-comment"># Echoes first arg passed to the function.</span>
}           <span class="hljs-comment"># Does a command-line arg qualify?</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"First call to function: no arg passed."</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"See if command-line arg is seen."</span>
func
<span class="hljs-comment"># No! Command-line arg not seen.</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"============================================================"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Second call to function: command-line arg passed explicitly."</span>
func <span class="hljs-variable">$1</span>
<span class="hljs-comment"># Now it's seen!</span>

<span class="hljs-built_in">exit</span> 0</pre>
          </td>
        </tr>
      </tbody></table>
    </div>
    <p>In contrast to certain other programming languages, shell scripts normally pass only value parameters to functions. Variable names (which are actually <i class="FIRSTTERM">pointers</i>), if passed as parameters to functions, will be treated as string literals. <em>Functions interpret their arguments literally.</em></p>
    <p><a name="FUNCPOINTERS" id="FUNCPOINTERS"></a></p>
    <p><a href="ivr.html#IVRREF">Indirect variable references</a> (see <a href="bashver2.html#EX78">Example 37-2</a>) provide a clumsy sort of mechanism for passing variable pointers to functions.</p>
    <div class="EXAMPLE">
      <a name="INDFUNC" id="INDFUNC"></a>
      <p><b>Example 24-4. Passing an indirect reference to a function</b></p>
      <table border="0" bgcolor="#E0E0E0" width="100%">
        <tbody><tr>
          <td>
            <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># ind-func.sh: Passing an indirect reference to a function.</span>

<span class="hljs-function"><span class="hljs-title">echo_var</span></span> ()
{
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
}

message=Hello
Hello=Goodbye

echo_var <span class="hljs-string">"<span class="hljs-variable">$message</span>"</span>        <span class="hljs-comment"># Hello</span>
<span class="hljs-comment"># Now, let's pass an indirect reference to the function.</span>
echo_var <span class="hljs-string">"<span class="hljs-variable">${!message}</span>"</span>     <span class="hljs-comment"># Goodbye</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"-------------"</span>

<span class="hljs-comment"># What happens if we change the contents of "hello" variable?</span>
Hello=<span class="hljs-string">"Hello, again!"</span>
echo_var <span class="hljs-string">"<span class="hljs-variable">$message</span>"</span>        <span class="hljs-comment"># Hello</span>
echo_var <span class="hljs-string">"<span class="hljs-variable">${!message}</span>"</span>     <span class="hljs-comment"># Hello, again!</span>

<span class="hljs-built_in">exit</span> 0</pre>
          </td>
        </tr>
      </tbody></table>
    </div>
    <p>The next logical question is whether parameters can be dereferenced <em>after</em> being passed to a function.</p>
    <div class="EXAMPLE">
      <a name="DEREFERENCECL" id="DEREFERENCECL"></a>
      <p><b>Example 24-5. Dereferencing a parameter passed to a function</b></p>
      <table border="0" bgcolor="#E0E0E0" width="100%">
        <tbody><tr>
          <td>
            <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># dereference.sh</span>
<span class="hljs-comment"># Dereferencing parameter passed to a function.</span>
<span class="hljs-comment"># Script by Bruce W. Clare.</span>

<span class="hljs-function"><span class="hljs-title">dereference</span></span> ()
{
     y=\$<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>   <span class="hljs-comment"># Name of variable (not value!).</span>
     <span class="hljs-built_in">echo</span> <span class="hljs-variable">$y</span>    <span class="hljs-comment"># $Junk</span>

     x=`<span class="hljs-built_in">eval</span> <span class="hljs-string">"expr \"<span class="hljs-variable">$y</span>\" "</span>`
     <span class="hljs-built_in">echo</span> <span class="hljs-variable">$1</span>=<span class="hljs-variable">$x</span>
     <span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>=\"Some Different Text \""</span>  <span class="hljs-comment"># Assign new value.</span>
}

Junk=<span class="hljs-string">"Some Text"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$Junk</span> <span class="hljs-string">"before"</span>    <span class="hljs-comment"># Some Text before</span>

dereference Junk
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$Junk</span> <span class="hljs-string">"after"</span>     <span class="hljs-comment"># Some Different Text after</span>

<span class="hljs-built_in">exit</span> 0</pre>
          </td>
        </tr>
      </tbody></table>
    </div>
    <div class="EXAMPLE">
      <a name="REFPARAMS" id="REFPARAMS"></a>
      <p><b>Example 24-6. Again, dereferencing a parameter passed to a function</b></p>
      <table border="0" bgcolor="#E0E0E0" width="100%">
        <tbody><tr>
          <td>
            <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># ref-params.sh: Dereferencing a parameter passed to a function.</span>
<span class="hljs-comment">#                (Complex Example)</span>

ITERATIONS=3  <span class="hljs-comment"># How many times to get input.</span>
icount=1

<span class="hljs-function"><span class="hljs-title">my_read</span></span> () {
  <span class="hljs-comment">#  Called with my_read varname,</span>
  <span class="hljs-comment">#+ outputs the previous value between brackets as the default value,</span>
  <span class="hljs-comment">#+ then asks for a new value.</span>

  <span class="hljs-built_in">local</span> local_var

  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Enter a value "</span>
  <span class="hljs-built_in">eval</span> <span class="hljs-string">'echo -n "[$'</span><span class="hljs-variable">$1</span><span class="hljs-string">'] "'</span>  <span class="hljs-comment">#  Previous value.</span>
<span class="hljs-comment"># eval echo -n "[\$$1] "     #  Easier to understand,</span>
                             <span class="hljs-comment">#+ but loses trailing space in user prompt.</span>
  <span class="hljs-built_in">read</span> local_var
  [ -n <span class="hljs-string">"<span class="hljs-variable">$local_var</span>"</span> ] &amp;&amp; <span class="hljs-built_in">eval</span> <span class="hljs-variable">$1</span>=\<span class="hljs-variable">$local_var</span>

  <span class="hljs-comment"># "And-list": if "local_var" then set "$1" to its value.</span>
}

<span class="hljs-built_in">echo</span>

<span class="hljs-keyword">while</span> [ <span class="hljs-string">"<span class="hljs-variable">$icount</span>"</span> -le <span class="hljs-string">"<span class="hljs-variable">$ITERATIONS</span>"</span> ]
<span class="hljs-keyword">do</span>
  my_read var
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Entry #<span class="hljs-variable">$icount</span> = <span class="hljs-variable">$var</span>"</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"icount += 1"</span>
  <span class="hljs-built_in">echo</span>
<span class="hljs-keyword">done</span>  


<span class="hljs-comment"># Thanks to Stephane Chazelas for providing this instructive example.</span>

<span class="hljs-built_in">exit</span> 0</pre>
          </td>
        </tr>
      </tbody></table>
    </div>
    <div class="VARIABLELIST">
      <p><b><a name="EXITRETURN1" id="EXITRETURN1"></a>Exit and Return</b></p>
      <dl>
        <dt><b class="COMMAND">exit status</b></dt>
        <dd>
          <p>Functions return a value, called an <i class="FIRSTTERM">exit status</i>. This is analogous to the <a href="exit-status.html#EXITSTATUSREF">exit status</a> returned by a command. The exit status may be explicitly specified by a <b class="COMMAND">return</b> statement, otherwise it is the exit status of the last command in the function (<span class="RETURNVALUE">0</span> if successful, and a non-zero error code if not). This <a href="exit-status.html#EXITSTATUSREF">exit status</a> may be used in the script by referencing it as <a href="internalvariables.html#XSTATVARREF">$?</a>. This mechanism effectively permits script functions to have a <span class="QUOTE">"return value"</span> similar to C functions.</p>
        </dd>
        <dt><b class="COMMAND">return</b></dt>
        <dd>
          <p><a name="RETURNREF" id="RETURNREF"></a></p>
          <p>Terminates a function. A <b class="COMMAND">return</b> command <a name="AEN18474" href="#FTN.AEN18474" id="AEN18474"><span class="footnote">[1]</span></a> optionally takes an <i class="FIRSTTERM">integer</i> argument, which is returned to the calling script as the <span class="QUOTE">"exit status"</span> of the function, and this exit status is assigned to the variable <a href="internalvariables.html#XSTATVARREF">$?</a>.</p>
          <div class="EXAMPLE">
            <a name="MAX" id="MAX"></a>
            <p><b>Example 24-7. Maximum of two numbers</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># max.sh: Maximum of two integers.</span>

E_PARAM_ERR=250    <span class="hljs-comment"># If less than 2 params passed to function.</span>
EQUAL=251          <span class="hljs-comment"># Return value if both params equal.</span>
<span class="hljs-comment">#  Error values out of range of any</span>
<span class="hljs-comment">#+ params that might be fed to the function.</span>

max2 ()             <span class="hljs-comment"># Returns larger of two numbers.</span>
{                   <span class="hljs-comment"># Note: numbers compared must be less than 250.</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$E_PARAM_ERR</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$EQUAL</span>
<span class="hljs-keyword">else</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> -gt <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$1</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$2</span>
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>
}

max2 33 34
return_val=$?

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$return_val</span>"</span> -eq <span class="hljs-variable">$E_PARAM_ERR</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Need to pass two parameters to the function."</span>
<span class="hljs-keyword">elif</span> [ <span class="hljs-string">"<span class="hljs-variable">$return_val</span>"</span> -eq <span class="hljs-variable">$EQUAL</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"The two numbers are equal."</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"The larger of the two numbers is <span class="hljs-variable">$return_val</span>."</span>
<span class="hljs-keyword">fi</span>  

  
<span class="hljs-built_in">exit</span> 0

<span class="hljs-comment">#  Exercise (easy):</span>
<span class="hljs-comment">#  ---------------</span>
<span class="hljs-comment">#  Convert this to an interactive script,</span>
<span class="hljs-comment">#+ that is, have the script ask for input (two numbers).</span></pre>
                </td>
              </tr>
            </tbody></table>
          </div>
          <div class="TIP">
            <table class="TIP" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/tip.gif" hspace="5" alt="Tip"></td>
                <td align="left" valign="top">
                  <p>For a function to return a string or array, use a dedicated variable.</p>
                  <table border="0" bgcolor="#E0E0E0" width="90%">
                    <tbody><tr>
                      <td>
                        <pre class="PROGRAMLISTING hljs"><span class="hljs-function"><span class="hljs-title">count_lines_in_etc_passwd</span></span>()
{
  [[ -r /etc/passwd ]] &amp;&amp; REPLY=$(<span class="hljs-built_in">echo</span> $(wc -l &lt; /etc/passwd))
  <span class="hljs-comment">#  If /etc/passwd is readable, set REPLY to line count.</span>
  <span class="hljs-comment">#  Returns both a parameter value and status information.</span>
  <span class="hljs-comment">#  The 'echo' seems unnecessary, but . . .</span>
  <span class="hljs-comment">#+ it removes excess whitespace from the output.</span>
}

<span class="hljs-keyword">if</span> count_lines_in_etc_passwd
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"There are <span class="hljs-variable">$REPLY</span> lines in /etc/passwd."</span>
<span class="hljs-keyword">else</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Cannot count lines in /etc/passwd."</span>
<span class="hljs-keyword">fi</span>  

<span class="hljs-comment"># Thanks, S.C.</span></pre>
                      </td>
                    </tr>
                  </tbody></table>
                </td>
              </tr>
            </tbody></table>
          </div>
          <div class="EXAMPLE">
            <a name="EX61" id="EX61"></a>
            <p><b>Example 24-8. Converting numbers to Roman numerals</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># Arabic number to Roman numeral conversion</span>
<span class="hljs-comment"># Range: 0 - 200</span>
<span class="hljs-comment"># It's crude, but it works.</span>

<span class="hljs-comment"># Extending the range and otherwise improving the script is left as an exercise.</span>

<span class="hljs-comment"># Usage: roman number-to-convert</span>

LIMIT=200
E_ARG_ERR=65
E_OUT_OF_RANGE=66

<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` number-to-convert"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_ARG_ERR</span>
<span class="hljs-keyword">fi</span>  

num=<span class="hljs-variable">$1</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$num</span>"</span> -gt <span class="hljs-variable">$LIMIT</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Out of range!"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_OUT_OF_RANGE</span>
<span class="hljs-keyword">fi</span>  

to_roman ()   <span class="hljs-comment"># Must declare function before first call to it.</span>
{
number=<span class="hljs-variable">$1</span>
factor=<span class="hljs-variable">$2</span>
rchar=<span class="hljs-variable">$3</span>
<span class="hljs-built_in">let</span> <span class="hljs-string">"remainder = number - factor"</span>
<span class="hljs-keyword">while</span> [ <span class="hljs-string">"<span class="hljs-variable">$remainder</span>"</span> -ge 0 ]
<span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-variable">$rchar</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"number -= factor"</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"remainder = number - factor"</span>
<span class="hljs-keyword">done</span>  

<span class="hljs-built_in">return</span> <span class="hljs-variable">$number</span>
       <span class="hljs-comment"># Exercises:</span>
       <span class="hljs-comment"># ---------</span>
       <span class="hljs-comment"># 1) Explain how this function works.</span>
       <span class="hljs-comment">#    Hint: division by successive subtraction.</span>
       <span class="hljs-comment"># 2) Extend to range of the function.</span>
       <span class="hljs-comment">#    Hint: use "echo" and command-substitution capture.</span>
}
   

to_roman <span class="hljs-variable">$num</span> 100 C
num=$?
to_roman <span class="hljs-variable">$num</span> 90 LXXXX
num=$?
to_roman <span class="hljs-variable">$num</span> 50 L
num=$?
to_roman <span class="hljs-variable">$num</span> 40 XL
num=$?
to_roman <span class="hljs-variable">$num</span> 10 X
num=$?
to_roman <span class="hljs-variable">$num</span> 9 IX
num=$?
to_roman <span class="hljs-variable">$num</span> 5 V
num=$?
to_roman <span class="hljs-variable">$num</span> 4 IV
num=$?
to_roman <span class="hljs-variable">$num</span> 1 I
<span class="hljs-comment"># Successive calls to conversion function!</span>
<span class="hljs-comment"># Is this really necessary??? Can it be simplified?</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">exit</span></pre>
                </td>
              </tr>
            </tbody></table>
          </div>
          <p>See also <a href="testbranch.html#ISALPHA">Example 11-29</a>.</p>
          <div class="IMPORTANT">
            <table class="IMPORTANT" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/important.gif" hspace="5" alt="Important"></td>
                <td align="left" valign="top">
                  <p>The largest positive integer a function can return is 255. The <b class="COMMAND">return</b> command is closely tied to the concept of <a href="exit-status.html#EXITSTATUSREF">exit status</a>, which accounts for this particular limitation. Fortunately, there are various <a href="assortedtips.html#RVT">workarounds</a> for those situations requiring a large integer return value from a function.</p>
                  <div class="EXAMPLE">
                    <a name="RETURNTEST" id="RETURNTEST"></a>
                    <p><b>Example 24-9. Testing large return values in a function</b></p>
                    <table border="0" bgcolor="#E0E0E0" width="90%">
                      <tbody><tr>
                        <td>
                          <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># return-test.sh</span>

<span class="hljs-comment"># The largest positive value a function can return is 255.</span>

return_test ()         <span class="hljs-comment"># Returns whatever passed to it.</span>
{
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$1</span>
}

return_test 27         <span class="hljs-comment"># o.k.</span>
<span class="hljs-built_in">echo</span> $?                <span class="hljs-comment"># Returns 27.</span>
  
return_test 255        <span class="hljs-comment"># Still o.k.</span>
<span class="hljs-built_in">echo</span> $?                <span class="hljs-comment"># Returns 255.</span>

return_test 257        <span class="hljs-comment"># Error!</span>
<span class="hljs-built_in">echo</span> $?                <span class="hljs-comment"># Returns 1 (return code for miscellaneous error).</span>

<span class="hljs-comment"># =========================================================</span>
return_test -151896    <span class="hljs-comment"># Do large negative numbers work?</span>
<span class="hljs-built_in">echo</span> $?                <span class="hljs-comment"># Will this return -151896?</span>
                       <span class="hljs-comment"># No! It returns 168.</span>
<span class="hljs-comment">#  Version of Bash before 2.05b permitted</span>
<span class="hljs-comment">#+ large negative integer return values.</span>
<span class="hljs-comment">#  It happened to be a useful feature.</span>
<span class="hljs-comment">#  Newer versions of Bash unfortunately plug this loophole.</span>
<span class="hljs-comment">#  This may break older scripts.</span>
<span class="hljs-comment">#  Caution!</span>
<span class="hljs-comment"># =========================================================</span>

<span class="hljs-built_in">exit</span> 0</pre>
                        </td>
                      </tr>
                    </tbody></table>
                  </div>
                  <p>A workaround for obtaining large integer <span class="QUOTE">"return values"</span> is to simply assign the <span class="QUOTE">"return value"</span> to a global variable.</p>
                  <table border="0" bgcolor="#E0E0E0" width="90%">
                    <tbody><tr>
                      <td>
                        <pre class="PROGRAMLISTING hljs">Return_Val=   <span class="hljs-comment"># Global variable to hold oversize return value of function.</span>

<span class="hljs-function"><span class="hljs-title">alt_return_test</span></span> ()
{
  fvar=<span class="hljs-variable">$1</span>
  Return_Val=<span class="hljs-variable">$fvar</span>
  <span class="hljs-built_in">return</span>   <span class="hljs-comment"># Returns 0 (success).</span>
}

alt_return_test 1
<span class="hljs-built_in">echo</span> $?                              <span class="hljs-comment"># 0</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"return value = <span class="hljs-variable">$Return_Val</span>"</span>    <span class="hljs-comment"># 1</span>

alt_return_test 256
<span class="hljs-built_in">echo</span> <span class="hljs-string">"return value = <span class="hljs-variable">$Return_Val</span>"</span>    <span class="hljs-comment"># 256</span>

alt_return_test 257
<span class="hljs-built_in">echo</span> <span class="hljs-string">"return value = <span class="hljs-variable">$Return_Val</span>"</span>    <span class="hljs-comment"># 257</span>

alt_return_test 25701
<span class="hljs-built_in">echo</span> <span class="hljs-string">"return value = <span class="hljs-variable">$Return_Val</span>"</span>    <span class="hljs-comment">#25701</span></pre>
                      </td>
                    </tr>
                  </tbody></table>
                  <p><a name="CAPTURERETVAL" id="CAPTURERETVAL"></a></p>
                  <p>A more elegant method is to have the function <b class="COMMAND">echo</b> its <span class="QUOTE">"return value to <tt class="FILENAME">stdout</tt>,"</span> and then capture it by <a href="commandsub.html#COMMANDSUBREF">command substitution</a>. See the <a href="assortedtips.html#RVT">discussion of this</a> in <a href="assortedtips.html">Section 36.7</a>.</p>
                  <div class="EXAMPLE">
                    <a name="MAX2" id="MAX2"></a>
                    <p><b>Example 24-10. Comparing two large integers</b></p>
                    <table border="0" bgcolor="#E0E0E0" width="90%">
                      <tbody><tr>
                        <td>
                          <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># max2.sh: Maximum of two LARGE integers.</span>

<span class="hljs-comment">#  This is the previous "max.sh" example,</span>
<span class="hljs-comment">#+ modified to permit comparing large integers.</span>

EQUAL=0             <span class="hljs-comment"># Return value if both params equal.</span>
E_PARAM_ERR=-99999  <span class="hljs-comment"># Not enough params passed to function.</span>
<span class="hljs-comment">#           ^^^^^^    Out of range of any params that might be passed.</span>

max2 ()             <span class="hljs-comment"># "Returns" larger of two numbers.</span>
{
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$E_PARAM_ERR</span>
  <span class="hljs-built_in">return</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$EQUAL</span>
  <span class="hljs-built_in">return</span>
<span class="hljs-keyword">else</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> -gt <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ]
  <span class="hljs-keyword">then</span>
    retval=<span class="hljs-variable">$1</span>
  <span class="hljs-keyword">else</span>
    retval=<span class="hljs-variable">$2</span>
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-variable">$retval</span>        <span class="hljs-comment"># Echoes (to stdout), rather than returning value.</span>
                    <span class="hljs-comment"># Why?</span>
}


return_val=$(max2 33001 33997)
<span class="hljs-comment">#            ^^^^             Function name</span>
<span class="hljs-comment">#                 ^^^^^ ^^^^^ Params passed</span>
<span class="hljs-comment">#  This is actually a form of command substitution:</span>
<span class="hljs-comment">#+ treating a function as if it were a command,</span>
<span class="hljs-comment">#+ and assigning the stdout of the function to the variable "return_val."</span>


<span class="hljs-comment"># ========================= OUTPUT ========================</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$return_val</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$E_PARAM_ERR</span>"</span> ]
  <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error in parameters passed to comparison function!"</span>
<span class="hljs-keyword">elif</span> [ <span class="hljs-string">"<span class="hljs-variable">$return_val</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$EQUAL</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"The two numbers are equal."</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"The larger of the two numbers is <span class="hljs-variable">$return_val</span>."</span>
<span class="hljs-keyword">fi</span>
<span class="hljs-comment"># =========================================================</span>
  
<span class="hljs-built_in">exit</span> 0

<span class="hljs-comment">#  Exercises:</span>
<span class="hljs-comment">#  ---------</span>
<span class="hljs-comment">#  1) Find a more elegant way of testing</span>
<span class="hljs-comment">#+    the parameters passed to the function.</span>
<span class="hljs-comment">#  2) Simplify the if/then structure at "OUTPUT."</span>
<span class="hljs-comment">#  3) Rewrite the script to take input from command-line parameters.</span></pre>
                        </td>
                      </tr>
                    </tbody></table>
                  </div>
                  <p>Here is another example of capturing a function <span class="QUOTE">"return value."</span> Understanding it requires some knowledge of <a href="awk.html#AWKREF">awk</a>.</p>
                  <table border="0" bgcolor="#E0E0E0" width="90%">
                    <tbody><tr>
                      <td>
                        <pre class="PROGRAMLISTING hljs">month_length ()  <span class="hljs-comment"># Takes month number as an argument.</span>
{                <span class="hljs-comment"># Returns number of days in month.</span>
monthD=<span class="hljs-string">"31 28 31 30 31 30 31 31 30 31 30 31"</span>  <span class="hljs-comment"># Declare as local?</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$monthD</span>"</span> | awk <span class="hljs-string">'{ print $'</span><span class="hljs-string">"<span class="hljs-variable">${1}</span>"</span><span class="hljs-string">' }'</span>    <span class="hljs-comment"># Tricky.</span>
<span class="hljs-comment">#                             ^^^^^^^^^</span>
<span class="hljs-comment"># Parameter passed to function  ($1 -- month number), then to awk.</span>
<span class="hljs-comment"># Awk sees this as "print $1 . . . print $12" (depending on month number)</span>
<span class="hljs-comment"># Template for passing a parameter to embedded awk script:</span>
<span class="hljs-comment">#                                 $'"${script_parameter}"'</span>

<span class="hljs-comment">#    Here's a slightly simpler awk construct:</span>
<span class="hljs-comment">#    echo $monthD | awk -v month=$1 '{print $(month)}'</span>
<span class="hljs-comment">#    Uses the -v awk option, which assigns a variable value</span>
<span class="hljs-comment">#+   prior to execution of the awk program block.</span>
<span class="hljs-comment">#    Thank you, Rich.</span>

<span class="hljs-comment">#  Needs error checking for correct parameter range (1-12)</span>
<span class="hljs-comment">#+ and for February in leap year.</span>
}

<span class="hljs-comment"># ----------------------------------------------</span>
<span class="hljs-comment"># Usage example:</span>
month=4        <span class="hljs-comment"># April, for example (4th month).</span>
days_in=$(month_length <span class="hljs-variable">$month</span>)
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$days_in</span>  <span class="hljs-comment"># 30</span>
<span class="hljs-comment"># ----------------------------------------------</span></pre>
                      </td>
                    </tr>
                  </tbody></table>
                  <p>See also <a href="contributed-scripts.html#DAYSBETWEEN">Example A-7</a> and <a href="contributed-scripts.html#STDDEV">Example A-37</a>.</p>
                  <p><tt class="USERINPUT"><b>Exercise:</b></tt> Using what we have just learned, extend the previous <a href="complexfunct.html#EX61">Roman numerals example</a> to accept arbitrarily large input.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
      </dl>
    </div>
    <div class="VARIABLELIST">
      <p><b><a name="REDSTDINFUNC1" id="REDSTDINFUNC1"></a>Redirection</b></p>
      <dl>
        <dt><tt class="REPLACEABLE"><i>Redirecting the stdin of a function</i></tt></dt>
        <dd>
          <p>A function is essentially a <a href="special-chars.html#CODEBLOCKREF">code block</a>, which means its <tt class="FILENAME">stdin</tt> can be redirected (as in <a href="special-chars.html#EX8">Example 3-1</a>).</p>
          <div class="EXAMPLE">
            <a name="REALNAME" id="REALNAME"></a>
            <p><b>Example 24-11. Real name from username</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># realname.sh</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># From username, gets "real name" from /etc/passwd.</span>


ARGCOUNT=1       <span class="hljs-comment"># Expect one arg.</span>
E_WRONGARGS=85

file=/etc/passwd
pattern=<span class="hljs-variable">$1</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ne <span class="hljs-string">"<span class="hljs-variable">$ARGCOUNT</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` USERNAME"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_WRONGARGS</span>
<span class="hljs-keyword">fi</span>  

file_excerpt ()    <span class="hljs-comment">#  Scan file for pattern,</span>
{                  <span class="hljs-comment">#+ then print relevant portion of line.</span>
  <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line  <span class="hljs-comment"># "while" does not necessarily need [ condition ]</span>
  <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> | grep <span class="hljs-variable">$1</span> | awk -F<span class="hljs-string">":"</span> <span class="hljs-string">'{ print $5 }'</span>
    <span class="hljs-comment"># Have awk use ":" delimiter.</span>
  <span class="hljs-keyword">done</span>
} &lt;<span class="hljs-variable">$file</span>  <span class="hljs-comment"># Redirect into function's stdin.</span>

file_excerpt <span class="hljs-variable">$pattern</span>

<span class="hljs-comment"># Yes, this entire script could be reduced to</span>
<span class="hljs-comment">#       grep PATTERN /etc/passwd | awk -F":" '{ print $5 }'</span>
<span class="hljs-comment"># or</span>
<span class="hljs-comment">#       awk -F: '/PATTERN/ {print $5}'</span>
<span class="hljs-comment"># or</span>
<span class="hljs-comment">#       awk -F: '($1 == "username") { print $5 }' # real name from username</span>
<span class="hljs-comment"># However, it might not be as instructive.</span>

<span class="hljs-built_in">exit</span> 0</pre>
                </td>
              </tr>
            </tbody></table>
          </div>
          <p>There is an alternate, and perhaps less confusing method of redirecting a function's <tt class="FILENAME">stdin</tt>. This involves redirecting the <tt class="FILENAME">stdin</tt> to an embedded bracketed code block within the function.</p>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs"><span class="hljs-comment"># Instead of:</span>
<span class="hljs-function"><span class="hljs-title">Function</span></span> ()
{
 ...
 } &lt; file

<span class="hljs-comment"># Try this:</span>
<span class="hljs-function"><span class="hljs-title">Function</span></span> ()
{
  {
    ...
   } &lt; file
}

<span class="hljs-comment"># Similarly,</span>

Function ()  <span class="hljs-comment"># This works.</span>
{
  {
   <span class="hljs-built_in">echo</span> $*
  } | tr a b
}

Function ()  <span class="hljs-comment"># This doesn't work.</span>
{
  <span class="hljs-built_in">echo</span> $*
} | tr a b   <span class="hljs-comment"># A nested code block is mandatory here.</span>


<span class="hljs-comment"># Thanks, S.C.</span></pre>
              </td>
            </tr>
          </tbody></table>
          <div class="NOTE">
            <table class="NOTE" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/note.gif" hspace="5" alt="Note"></td>
                <td align="left" valign="top">
                  <p>Emmanuel Rouat's <a href="sample-bashrc.html">sample <tt class="FILENAME">bashrc</tt> file</a> contains some instructive examples of functions.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
      </dl>
    </div>
  </div>
  <h3 class="FOOTNOTES">Notes</h3>
  <table border="0" class="FOOTNOTES" width="100%">
    <tbody><tr>
      <td align="left" valign="top" width="5%"><a name="FTN.AEN18474" href="complexfunct.html#AEN18474" id="FTN.AEN18474"><span class="footnote">[1]</span></a></td>
      <td align="left" valign="top" width="95%">
        <p>The <b class="COMMAND">return</b> command is a Bash <a href="internal.html#BUILTINREF">builtin</a>.</p>
      </td>
    </tr>
  </tbody></table>
  <div class="NAVFOOTER">
    <hr align="left" width="100%">
    <table summary="Footer navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tbody><tr>
        <td width="33%" align="left" valign="top"><a href="functions.html" accesskey="P">Prev</a></td>
        <td width="34%" align="center" valign="top"><a href="index.html" accesskey="H">Home</a></td>
        <td width="33%" align="right" valign="top"><a href="localvar.html" accesskey="N">Next</a></td>
      </tr>
      <tr>
        <td width="33%" align="left" valign="top">Functions</td>
        <td width="34%" align="center" valign="top"><a href="functions.html" accesskey="U">Up</a></td>
        <td width="33%" align="right" valign="top">Local Variables</td>
      </tr>
    </tbody></table>
  </div>


</body></html>
