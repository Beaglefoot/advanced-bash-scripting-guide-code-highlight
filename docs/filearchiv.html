<!DOCTYPE html><html><head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.7.28">
  <title>File and Archiving Commands</title>
  <meta name="GENERATOR" content="Modular DocBook HTML Stylesheet Version 1.7">
  <link rel="HOME" title="Advanced Bash-Scripting Guide" href="index.html">
  <link rel="UP" title="External Filters, Programs and Commands" href="external.html">
  <link rel="PREVIOUS" title="Text Processing Commands" href="textproc.html">
  <link rel="NEXT" title="Communications Commands" href="communications.html">
<link rel="stylesheet" href="styles/custom.css"><link rel="stylesheet" href="styles/atom-one-dark.css"></head>
<body class="SECT1" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#840084" alink="#0000FF">
  <div class="NAVHEADER">
    <table summary="Header navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tbody><tr>
        <th colspan="3" align="center">Advanced Bash-Scripting Guide:</th>
      </tr>
      <tr>
        <td width="10%" align="left" valign="bottom"><a href="textproc.html" accesskey="P">Prev</a></td>
        <td width="80%" align="center" valign="bottom">Chapter 16. External Filters, Programs and Commands</td>
        <td width="10%" align="right" valign="bottom"><a href="communications.html" accesskey="N">Next</a></td>
      </tr>
    </tbody></table>
    <hr align="left" width="100%">
  </div>
  <div class="SECT1">
    <h1 class="SECT1"><a name="FILEARCHIV" id="FILEARCHIV"></a>16.5. File and Archiving Commands</h1>
    <div class="VARIABLELIST">
      <p><b><a name="FAARCHIVING1" id="FAARCHIVING1"></a>Archiving</b></p>
      <dl>
        <dt><a name="TARREF" id="TARREF"></a><b class="COMMAND">tar</b></dt>
        <dd>
          <p>The standard UNIX archiving utility. <a name="AEN11885" href="#FTN.AEN11885" id="AEN11885"><span class="footnote">[1]</span></a> Originally a <i class="WORDASWORD">Tape ARchiving</i> program, it has developed into a general purpose package that can handle all manner of archiving with all types of destination devices, ranging from tape drives to regular files to even <tt class="FILENAME">stdout</tt> (see <a href="special-chars.html#EX58">Example 3-4</a>). GNU <i class="FIRSTTERM">tar</i> has been patched to accept various compression filters, for example: <b class="COMMAND">tar czvf archive_name.tar.gz *</b>, which recursively archives and <a href="filearchiv.html#GZIPREF">gzips</a> all files in a directory tree except <a href="basic.html#DOTFILESREF">dotfiles</a> in the current working directory (<a href="internalvariables.html#PWDREF">$PWD</a>). <a name="AEN11896" href="#FTN.AEN11896" id="AEN11896"><span class="footnote">[2]</span></a></p>
          <p>Some useful <b class="COMMAND">tar</b> options:</p>
          <ol type="1">
            <li>
              <p><tt class="OPTION">-c</tt> create (a new archive)</p>
            </li>
            <li>
              <p><tt class="OPTION">-x</tt> extract (files from existing archive)</p>
            </li>
            <li>
              <p><tt class="OPTION">--delete</tt> delete (files from existing archive)</p>
              <div class="CAUTION">
                <table class="CAUTION" width="90%" border="0">
                  <tbody><tr>
                    <td width="25" align="center" valign="top"><img src="images/caution.gif" hspace="5" alt="Caution"></td>
                    <td align="left" valign="top">
                      <p>This option will not work on magnetic tape devices.</p>
                    </td>
                  </tr>
                </tbody></table>
              </div>
            </li>
            <li>
              <p><tt class="OPTION">-r</tt> append (files to existing archive)</p>
            </li>
            <li>
              <p><tt class="OPTION">-A</tt> append (<i class="FIRSTTERM">tar</i> files to existing archive)</p>
            </li>
            <li>
              <p><tt class="OPTION">-t</tt> list (contents of existing archive)</p>
            </li>
            <li>
              <p><tt class="OPTION">-u</tt> update archive</p>
            </li>
            <li>
              <p><tt class="OPTION">-d</tt> compare archive with specified filesystem</p>
            </li>
            <li>
              <p><tt class="OPTION">--after-date</tt> only process files with a date stamp <em>after</em> specified date</p>
            </li>
            <li>
              <p><tt class="OPTION">-z</tt> <a href="filearchiv.html#GZIPREF">gzip</a> the archive</p>
              <p>(compress or uncompress, depending on whether combined with the <tt class="OPTION">-c</tt> or <tt class="OPTION">-x</tt>) option</p>
            </li>
            <li>
              <p><tt class="OPTION">-j</tt> <a href="filearchiv.html#BZIPREF">bzip2</a> the archive</p>
            </li>
          </ol>
          <div class="CAUTION">
            <table class="CAUTION" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/caution.gif" hspace="5" alt="Caution"></td>
                <td align="left" valign="top">
                  <p>It may be difficult to recover data from a corrupted <i class="FIRSTTERM">gzipped</i> tar archive. When archiving important files, make multiple backups.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
        <dt><a name="SHARREF" id="SHARREF"></a><b class="COMMAND">shar</b></dt>
        <dd>
          <p><i class="FIRSTTERM">Shell archiving</i> utility. The text and/or binary files in a shell archive are concatenated without compression, and the resultant archive is essentially a shell script, complete with <span class="TOKEN">#!/bin/sh</span> header, containing all the necessary unarchiving commands, as well as the files themselves. Unprintable binary characters in the target file(s) are converted to printable ASCII characters in the output <i class="FIRSTTERM">shar</i> file. <i class="FIRSTTERM">Shar archives</i> still show up in Usenet newsgroups, but otherwise <b class="COMMAND">shar</b> has been replaced by <b class="COMMAND">tar</b>/<b class="COMMAND">gzip</b>. The <b class="COMMAND">unshar</b> command unpacks <i class="FIRSTTERM">shar</i> archives.</p>
          <p>The <b class="COMMAND">mailshar</b> command is a Bash script that uses <b class="COMMAND">shar</b> to concatenate multiple files into a single one for e-mailing. This script supports compression and <a href="filearchiv.html#UUENCODEREF">uuencoding</a>.</p>
        </dd>
        <dt><a name="ARREF" id="ARREF"></a><b class="COMMAND">ar</b></dt>
        <dd>
          <p>Creation and manipulation utility for archives, mainly used for binary object file libraries.</p>
        </dd>
        <dt><a name="RPMREF" id="RPMREF"></a><b class="COMMAND">rpm</b></dt>
        <dd>
          <p>The <i class="FIRSTTERM">Red Hat Package Manager</i>, or <b class="COMMAND">rpm</b> utility provides a wrapper for source or binary archives. It includes commands for installing and checking the integrity of packages, among other things.</p>
          <p>A simple <b class="COMMAND">rpm -i package_name.rpm</b> usually suffices to install a package, though there are many more options available.</p>
          <div class="TIP">
            <table class="TIP no-border" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/tip.gif" hspace="5" alt="Tip"></td>
                <td align="left" valign="top">
                  <p><tt class="USERINPUT"><b>rpm -qf</b></tt> identifies which package a file originates from.</p>
                  <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
                    <tbody><tr>
                      <td>
                        <pre class="SCREEN hljs"><span class="hljs-meta">bash$</span><span class="bash"> rpm -qf /bin/ls</span>
coreutils-5.2.1-31
              </pre>
                      </td>
                    </tr>
                  </tbody></table>
                </td>
              </tr>
            </tbody></table>
          </div>
          <div class="TIP">
            <table class="TIP no-border" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/tip.gif" hspace="5" alt="Tip"></td>
                <td align="left" valign="top">
                  <p><tt class="USERINPUT"><b>rpm -qa</b></tt> gives a complete list of all installed <i class="FIRSTTERM">rpm</i> packages on a given system. An <tt class="USERINPUT"><b>rpm -qa package_name</b></tt> lists only the package(s) corresponding to <tt class="FILENAME">package_name</tt>.</p>
                  <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
                    <tbody><tr>
                      <td>
                        <pre class="SCREEN hljs"><span class="hljs-meta">bash$</span><span class="bash"> rpm -qa</span>
redhat-logos-1.1.3-1
 glibc-2.2.4-13
 cracklib-2.7-12
 dosfstools-2.7-1
 gdbm-1.8.0-10
 ksymoops-2.4.1-1
 mktemp-1.5-11
 perl-5.6.0-17
 reiserfs-utils-3.x.0j-2
 ...
<span class="hljs-meta">

bash$</span><span class="bash"> rpm -qa docbook-utils</span>
docbook-utils-0.6.9-2
<span class="hljs-meta">

bash$</span><span class="bash"> rpm -qa docbook | grep docbook</span>
docbook-dtd31-sgml-1.0-10
 docbook-style-dsssl-1.64-3
 docbook-dtd30-sgml-1.0-10
 docbook-dtd40-sgml-1.0-11
 docbook-utils-pdf-0.6.9-2
 docbook-dtd41-sgml-1.0-10
 docbook-utils-0.6.9-2
              </pre>
                      </td>
                    </tr>
                  </tbody></table>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
        <dt><a name="CPIOREF" id="CPIOREF"></a><b class="COMMAND">cpio</b></dt>
        <dd>
          <p>This specialized archiving copy command (<b class="COMMAND">c</b>o<b class="COMMAND">p</b>y <b class="COMMAND">i</b>nput and <b class="COMMAND">o</b>utput) is rarely seen any more, having been supplanted by <b class="COMMAND">tar</b>/<b class="COMMAND">gzip</b>. It still has its uses, such as moving a directory tree. With an appropriate block size (for copying) specified, it can be appreciably faster than <b class="COMMAND">tar</b>.</p>
          <div class="EXAMPLE">
            <a name="EX48" id="EX48"></a>
            <p><b>Example 16-30. Using <i class="FIRSTTERM">cpio</i> to move a directory tree</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># Copying a directory tree using cpio.</span>

<span class="hljs-comment"># Advantages of using 'cpio':</span>
<span class="hljs-comment">#   Speed of copying. It's faster than 'tar' with pipes.</span>
<span class="hljs-comment">#   Well suited for copying special files (named pipes, etc.)</span>
<span class="hljs-comment">#+  that 'cp' may choke on.</span>

ARGS=2
E_BADARGS=65

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ne <span class="hljs-string">"<span class="hljs-variable">$ARGS</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` source destination"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BADARGS</span>
<span class="hljs-keyword">fi</span>  

<span class="hljs-built_in">source</span>=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
destination=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>

<span class="hljs-comment">###################################################################</span>
find <span class="hljs-string">"<span class="hljs-variable">$source</span>"</span> -depth | cpio -admvp <span class="hljs-string">"<span class="hljs-variable">$destination</span>"</span>
<span class="hljs-comment">#               ^^^^^         ^^^^^</span>
<span class="hljs-comment">#  Read the 'find' and 'cpio' info pages to decipher these options.</span>
<span class="hljs-comment">#  The above works only relative to $PWD (current directory) . . .</span>
<span class="hljs-comment">#+ full pathnames are specified.</span>
<span class="hljs-comment">###################################################################</span>


<span class="hljs-comment"># Exercise:</span>
<span class="hljs-comment"># --------</span>

<span class="hljs-comment">#  Add code to check the exit status ($?) of the 'find | cpio' pipe</span>
<span class="hljs-comment">#+ and output appropriate error messages if anything went wrong.</span>

<span class="hljs-built_in">exit</span> $?</pre>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
        <dt><a name="RPM2CPIOREF" id="RPM2CPIOREF"></a><b class="COMMAND">rpm2cpio</b></dt>
        <dd>
          <p>This command extracts a <b class="COMMAND">cpio</b> archive from an <a href="filearchiv.html#RPMREF">rpm</a> one.</p>
          <div class="EXAMPLE">
            <a name="DERPM" id="DERPM"></a>
            <p><b>Example 16-31. Unpacking an <i class="FIRSTTERM">rpm</i> archive</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># de-rpm.sh: Unpack an 'rpm' archive</span>

: <span class="hljs-variable">${1?"Usage: `basename $0` target-file"}</span>
<span class="hljs-comment"># Must specify 'rpm' archive name as an argument.</span>


TEMPFILE=$$.cpio                         <span class="hljs-comment">#  Tempfile with "unique" name.</span>
                                         <span class="hljs-comment">#  $$ is process ID of script.</span>

rpm2cpio &lt; <span class="hljs-variable">$1</span> &gt; <span class="hljs-variable">$TEMPFILE</span>                <span class="hljs-comment">#  Converts rpm archive into</span>
                                         <span class="hljs-comment">#+ cpio archive.</span>
cpio --make-directories -F <span class="hljs-variable">$TEMPFILE</span> -i  <span class="hljs-comment">#  Unpacks cpio archive.</span>
rm -f <span class="hljs-variable">$TEMPFILE</span>                          <span class="hljs-comment">#  Deletes cpio archive.</span>

<span class="hljs-built_in">exit</span> 0

<span class="hljs-comment">#  Exercise:</span>
<span class="hljs-comment">#  Add check for whether 1) "target-file" exists and</span>
<span class="hljs-comment">#+                       2) it is an rpm archive.</span>
<span class="hljs-comment">#  Hint:                    Parse output of 'file' command.</span></pre>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
        <dt><a name="PAXREF" id="PAXREF"></a><b class="COMMAND">pax</b></dt>
        <dd>
          <p>The <i class="FIRSTTERM">pax</i> <b class="COMMAND">p</b>ortable <b class="COMMAND">a</b>rchive e<b class="COMMAND">x</b>change toolkit facilitates periodic file backups and is designed to be cross-compatible between various flavors of UNIX. It was designed to replace <a href="filearchiv.html#TARREF">tar</a> and <a href="filearchiv.html#CPIOREF">cpio</a>.</p>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs">pax -wf daily_backup.pax ~/linux-server/files 
<span class="hljs-comment">#  Creates a tar archive of all files in the target directory.</span>
<span class="hljs-comment">#  Note that the options to pax must be in the correct order --</span>
<span class="hljs-comment">#+ pax -fw     has an entirely different effect.</span>

pax -f daily_backup.pax
<span class="hljs-comment">#  Lists the files in the archive.</span>

pax -rf daily_backup.pax ~/bsd-server/files
<span class="hljs-comment">#  Restores the backed-up files from the Linux machine</span>
<span class="hljs-comment">#+ onto a BSD one.</span></pre>
              </td>
            </tr>
          </tbody></table>
          <p>Note that <i class="FIRSTTERM">pax</i> handles many of the standard archiving and compression commands.</p>
        </dd>
      </dl>
    </div>
    <div class="VARIABLELIST">
      <p><b><a name="FACOMPRESSION1" id="FACOMPRESSION1"></a>Compression</b></p>
      <dl>
        <dt><a name="GZIPREF" id="GZIPREF"></a><b class="COMMAND">gzip</b></dt>
        <dd>
          <p>The standard GNU/UNIX compression utility, replacing the inferior and proprietary <b class="COMMAND">compress</b>. The corresponding decompression command is <b class="COMMAND">gunzip</b>, which is the equivalent of <b class="COMMAND">gzip -d</b>.</p>
          <div class="NOTE">
            <table class="NOTE" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/note.gif" hspace="5" alt="Note"></td>
                <td align="left" valign="top">
                  <p>The <tt class="OPTION">-c</tt> option sends the output of <b class="COMMAND">gzip</b> to <tt class="FILENAME">stdout</tt>. This is useful when <a href="special-chars.html#PIPEREF">piping</a> to other commands.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
          <p><a name="ZCATREF" id="ZCATREF"></a></p>
          <p>The <b class="COMMAND">zcat</b> filter decompresses a <i class="FIRSTTERM">gzipped</i> file to <tt class="FILENAME">stdout</tt>, as possible input to a pipe or redirection. This is, in effect, a <b class="COMMAND">cat</b> command that works on compressed files (including files processed with the older <a href="filearchiv.html#COMPRESSREF">compress</a> utility). The <b class="COMMAND">zcat</b> command is equivalent to <b class="COMMAND">gzip -dc</b>.</p>
          <div class="CAUTION">
            <table class="CAUTION" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/caution.gif" hspace="5" alt="Caution"></td>
                <td align="left" valign="top">
                  <p>On some commercial UNIX systems, <b class="COMMAND">zcat</b> is a synonym for <b class="COMMAND">uncompress -c</b>, and will not work on <i class="FIRSTTERM">gzipped</i> files.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
          <p>See also <a href="comparison-ops.html#EX14">Example 7-7</a>.</p>
        </dd>
        <dt><a name="BZIPREF" id="BZIPREF"></a><b class="COMMAND">bzip2</b></dt>
        <dd>
          <p>An alternate compression utility, usually more efficient (but slower) than <b class="COMMAND">gzip</b>, especially on large files. The corresponding decompression command is <b class="COMMAND">bunzip2</b>.</p>
          <p>Similar to the <b class="COMMAND">zcat</b> command, <b class="COMMAND">bzcat</b> decompresses a <i class="FIRSTTERM">bzipped2-ed</i> file to <tt class="FILENAME">stdout</tt>.</p>
          <div class="NOTE">
            <table class="NOTE" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/note.gif" hspace="5" alt="Note"></td>
                <td align="left" valign="top">
                  <p>Newer versions of <a href="filearchiv.html#TARREF">tar</a> have been patched with <b class="COMMAND">bzip2</b> support.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
        <dt><a name="COMPRESSREF" id="COMPRESSREF"></a><b class="COMMAND">compress</b>, <a name="UNCOMPRESSREF" id="UNCOMPRESSREF"></a><b class="COMMAND">uncompress</b></dt>
        <dd>
          <p>This is an older, proprietary compression utility found in commercial UNIX distributions. The more efficient <b class="COMMAND">gzip</b> has largely replaced it. Linux distributions generally include a <b class="COMMAND">compress</b> workalike for compatibility, although <b class="COMMAND">gunzip</b> can unarchive files treated with <b class="COMMAND">compress</b>.</p>
          <div class="TIP">
            <table class="TIP" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/tip.gif" hspace="5" alt="Tip"></td>
                <td align="left" valign="top">
                  <p>The <b class="COMMAND">znew</b> command transforms <i class="FIRSTTERM">compressed</i> files into <i class="FIRSTTERM">gzipped</i> ones.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
        <dt><a name="SQREF" id="SQREF"></a><b class="COMMAND">sq</b></dt>
        <dd>
          <p>Yet another compression (<b class="COMMAND">sq</b>ueeze) utility, a filter that works only on sorted <a href="special-chars.html#ASCIIDEF">ASCII</a> word lists. It uses the standard invocation syntax for a filter, <b class="COMMAND">sq &lt; input-file &gt; output-file</b>. Fast, but not nearly as efficient as <a href="filearchiv.html#GZIPREF">gzip</a>. The corresponding uncompression filter is <b class="COMMAND">unsq</b>, invoked like <b class="COMMAND">sq</b>.</p>
          <div class="TIP">
            <table class="TIP" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/tip.gif" hspace="5" alt="Tip"></td>
                <td align="left" valign="top">
                  <p>The output of <b class="COMMAND">sq</b> may be piped to <b class="COMMAND">gzip</b> for further compression.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
        <dt><a name="ZIPREF" id="ZIPREF"></a><b class="COMMAND">zip</b>, <b class="COMMAND">unzip</b></dt>
        <dd>
          <p>Cross-platform file archiving and compression utility compatible with DOS <i class="FIRSTTERM">pkzip.exe</i>. <span class="QUOTE">"Zipped"</span> archives seem to be a more common medium of file exchange on the Internet than <span class="QUOTE">"tarballs."</span></p>
        </dd>
        <dt><a name="UNARCREF" id="UNARCREF"></a><b class="COMMAND">unarc</b>, <b class="COMMAND">unarj</b>, <b class="COMMAND">unrar</b></dt>
        <dd>
          <p>These Linux utilities permit unpacking archives compressed with the DOS <i class="FIRSTTERM">arc.exe</i>, <i class="FIRSTTERM">arj.exe</i>, and <i class="FIRSTTERM">rar.exe</i> programs.</p>
        </dd>
        <dt><a name="LZMAREF" id="LZMAREF"></a><b class="COMMAND">lzma</b>, <b class="COMMAND">unlzma</b>, <b class="COMMAND">lzcat</b></dt>
        <dd>
          <p>Highly efficient Lempel-Ziv-Markov compression. The syntax of <i class="FIRSTTERM">lzma</i> is similar to that of <i class="FIRSTTERM">gzip</i>. The <a href="http://www.7-zip.org/sdk.html" target="_top">7-zip Website</a> has more information.</p>
        </dd>
        <dt><a name="XZREF" id="XZREF"></a><b class="COMMAND">xz</b>, <b class="COMMAND">unxz</b>, <b class="COMMAND">xzcat</b></dt>
        <dd>
          <p>A new high-efficiency compression tool, backward compatible with <i class="FIRSTTERM">lzma</i>, and with an invocation syntax similar to <i class="FIRSTTERM">gzip</i>. For more information, see the <a href="http://en.wikipedia.org/wiki/Xz" target="_top">Wikipedia entry</a>.</p>
        </dd>
      </dl>
    </div>
    <div class="VARIABLELIST">
      <p><b><a name="FAINFORMATION1" id="FAINFORMATION1"></a>File Information</b></p>
      <dl>
        <dt><a name="FILEREF" id="FILEREF"></a><b class="COMMAND">file</b></dt>
        <dd>
          <p>A utility for identifying file types. The command <tt class="USERINPUT"><b>file file-name</b></tt> will return a file specification for <tt class="FILENAME">file-name</tt>, such as <tt class="COMPUTEROUTPUT">ascii text</tt> or <tt class="COMPUTEROUTPUT">data</tt>. It references the <a href="sha-bang.html#MAGNUMREF">magic numbers</a> found in <tt class="FILENAME">/usr/share/magic</tt>, <tt class="FILENAME">/etc/magic</tt>, or <tt class="FILENAME">/usr/lib/magic</tt>, depending on the Linux/UNIX distribution.</p>
          <p>The <tt class="OPTION">-f</tt> option causes <b class="COMMAND">file</b> to run in <a href="timedate.html#BATCHPROCREF">batch</a> mode, to read from a designated file a list of filenames to analyze. The <tt class="OPTION">-z</tt> option, when used on a compressed target file, forces an attempt to analyze the uncompressed file type.</p>
          <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
            <tbody><tr>
              <td>
                <pre class="SCREEN hljs"><span class="hljs-meta">bash$</span><span class="bash"> file test.tar.gz</span>
test.tar.gz: gzip compressed data, deflated,
 last modified: Sun Sep 16 13:34:51 2001, os: Unix

bash file -z test.tar.gz
test.tar.gz: GNU tar archive (gzip compressed data, deflated,
 last modified: Sun Sep 16 13:34:51 2001, os: Unix)
              </pre>
              </td>
            </tr>
          </tbody></table>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs"><span class="hljs-comment"># Find sh and Bash scripts in a given directory:</span>

DIRECTORY=/usr/<span class="hljs-built_in">local</span>/bin
KEYWORD=Bourne
<span class="hljs-comment"># Bourne and Bourne-Again shell scripts</span>

file <span class="hljs-variable">$DIRECTORY</span>/* | fgrep <span class="hljs-variable">$KEYWORD</span>

<span class="hljs-comment"># Output:</span>

<span class="hljs-comment"># /usr/local/bin/burn-cd:          Bourne-Again shell script text executable</span>
<span class="hljs-comment"># /usr/local/bin/burnit:           Bourne-Again shell script text executable</span>
<span class="hljs-comment"># /usr/local/bin/cassette.sh:      Bourne shell script text executable</span>
<span class="hljs-comment"># /usr/local/bin/copy-cd:          Bourne-Again shell script text executable</span>
<span class="hljs-comment"># . . .</span></pre>
              </td>
            </tr>
          </tbody></table>
          <div class="EXAMPLE">
            <a name="STRIPC" id="STRIPC"></a>
            <p><b>Example 16-32. Stripping comments from C program files</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># strip-comment.sh: Strips out the comments (/* COMMENT */) in a C program.</span>

E_NOARGS=0
E_ARGERROR=66
E_WRONG_FILE_TYPE=67

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -eq <span class="hljs-string">"<span class="hljs-variable">$E_NOARGS</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` C-program-file"</span> &gt;&amp;2 <span class="hljs-comment"># Error message to stderr.</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_ARGERROR</span>
<span class="hljs-keyword">fi</span>  

<span class="hljs-comment"># Test for correct file type.</span>
<span class="hljs-built_in">type</span>=`file <span class="hljs-variable">$1</span> | awk <span class="hljs-string">'{ print $2, $3, $4, $5 }'</span>`
<span class="hljs-comment"># "file $1" echoes file type . . .</span>
<span class="hljs-comment"># Then awk removes the first field, the filename . . .</span>
<span class="hljs-comment"># Then the result is fed into the variable "type."</span>
correct_type=<span class="hljs-string">"ASCII C program text"</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$type</span>"</span> != <span class="hljs-string">"<span class="hljs-variable">$correct_type</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"This script works on C program files only."</span>
  <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_WRONG_FILE_TYPE</span>
<span class="hljs-keyword">fi</span>  


<span class="hljs-comment"># Rather cryptic sed script:</span>
<span class="hljs-comment">#--------</span>
sed <span class="hljs-string">'
/^\/\*/d
/.*\*\//d
'</span> <span class="hljs-variable">$1</span>
<span class="hljs-comment">#--------</span>
<span class="hljs-comment"># Easy to understand if you take several hours to learn sed fundamentals.</span>


<span class="hljs-comment">#  Need to add one more line to the sed script to deal with</span>
<span class="hljs-comment">#+ case where line of code has a comment following it on same line.</span>
<span class="hljs-comment">#  This is left as a non-trivial exercise.</span>

<span class="hljs-comment">#  Also, the above code deletes non-comment lines with a "*/" . . .</span>
<span class="hljs-comment">#+ not a desirable result.</span>

<span class="hljs-built_in">exit</span> 0


<span class="hljs-comment"># ----------------------------------------------------------------</span>
<span class="hljs-comment"># Code below this line will not execute because of 'exit 0' above.</span>

<span class="hljs-comment"># Stephane Chazelas suggests the following alternative:</span>

<span class="hljs-function"><span class="hljs-title">usage</span></span>() {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` C-program-file"</span> &gt;&amp;2
  <span class="hljs-built_in">exit</span> 1
}

WEIRD=`<span class="hljs-built_in">echo</span> -n -e <span class="hljs-string">'\377'</span>`   <span class="hljs-comment"># or WEIRD=$'\377'</span>
[[ <span class="hljs-variable">$#</span> -eq 1 ]] || usage
<span class="hljs-keyword">case</span> `file <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>` <span class="hljs-keyword">in</span>
  *<span class="hljs-string">"C program text"</span>*) sed -e <span class="hljs-string">"s%/\*%<span class="hljs-variable">${WEIRD}</span>%g;s%\*/%<span class="hljs-variable">${WEIRD}</span>%g"</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> \
     | tr <span class="hljs-string">'\377\n'</span> <span class="hljs-string">'\n\377'</span> \
     | sed -ne <span class="hljs-string">'p;n'</span> \
     | tr -d <span class="hljs-string">'\n'</span> | tr <span class="hljs-string">'\377'</span> <span class="hljs-string">'\n'</span>;;
  *) usage;;
<span class="hljs-keyword">esac</span>

<span class="hljs-comment">#  This is still fooled by things like:</span>
<span class="hljs-comment">#  printf("/*");</span>
<span class="hljs-comment">#  or</span>
<span class="hljs-comment">#  /*  /* buggy embedded comment */</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  To handle all special cases (comments in strings, comments in string</span>
<span class="hljs-comment">#+ where there is a \", \\" ...),</span>
<span class="hljs-comment">#+ the only way is to write a C parser (using lex or yacc perhaps?).</span>

<span class="hljs-built_in">exit</span> 0</pre>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
        <dt><a name="WHICHREF" id="WHICHREF"></a><b class="COMMAND">which</b></dt>
        <dd>
          <p><b class="COMMAND">which command</b> gives the full path to <span class="QUOTE">"command."</span> This is useful for finding out whether a particular command or utility is installed on the system.</p>
          <p><tt class="USERINPUT"><b>$bash which rm</b></tt></p>
          <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
            <tbody><tr>
              <td>
                <pre class="SCREEN hljs">/usr/bin/rm</pre>
              </td>
            </tr>
          </tbody></table>
          <p>For an interesting use of this command, see <a href="colorizing.html#HORSERACE">Example 36-16</a>.</p>
        </dd>
        <dt><a name="WHEREISREF" id="WHEREISREF"></a><b class="COMMAND">whereis</b></dt>
        <dd>
          <p>Similar to <b class="COMMAND">which</b>, above, <b class="COMMAND">whereis command</b> gives the full path to <span class="QUOTE">"command,"</span> but also to its <a href="basic.html#MANREF">manpage</a>.</p>
          <p><tt class="USERINPUT"><b>$bash whereis rm</b></tt></p>
          <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
            <tbody><tr>
              <td>
                <pre class="SCREEN hljs">rm: /bin/rm /usr/share/man/man1/rm.1.bz2</pre>
              </td>
            </tr>
          </tbody></table>
        </dd>
        <dt><a name="WHATISREF" id="WHATISREF"></a><b class="COMMAND">whatis</b></dt>
        <dd>
          <p><b class="COMMAND">whatis command</b> looks up <span class="QUOTE">"command"</span> in the <tt class="REPLACEABLE"><i>whatis</i></tt> database. This is useful for identifying system commands and important configuration files. Consider it a simplified <b class="COMMAND">man</b> command.</p>
          <p><tt class="USERINPUT"><b>$bash whatis whatis</b></tt></p>
          <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
            <tbody><tr>
              <td>
                <pre class="SCREEN hljs">whatis               (1)  - search the whatis database for complete words</pre>
              </td>
            </tr>
          </tbody></table>
          <div class="EXAMPLE">
            <a name="WHAT" id="WHAT"></a>
            <p><b>Example 16-33. Exploring <tt class="FILENAME">/usr/X11R6/bin</tt></b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># What are all those mysterious binaries in /usr/X11R6/bin?</span>

DIRECTORY=<span class="hljs-string">"/usr/X11R6/bin"</span>
<span class="hljs-comment"># Try also "/bin", "/usr/bin", "/usr/local/bin", etc.</span>

<span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> <span class="hljs-variable">$DIRECTORY</span>/*
<span class="hljs-keyword">do</span>
  whatis `basename <span class="hljs-variable">$file</span>`   <span class="hljs-comment"># Echoes info about the binary.</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">exit</span> 0

<span class="hljs-comment">#  Note: For this to work, you must create a "whatis" database</span>
<span class="hljs-comment">#+ with /usr/sbin/makewhatis.</span>
<span class="hljs-comment">#  You may wish to redirect output of this script, like so:</span>
<span class="hljs-comment">#    ./what.sh &gt;&gt;whatis.db</span>
<span class="hljs-comment">#  or view it a page at a time on stdout,</span>
<span class="hljs-comment">#    ./what.sh | less</span></pre>
                </td>
              </tr>
            </tbody></table>
          </div>
          <p>See also <a href="loops1.html#FILEINFO">Example 11-3</a>.</p>
        </dd>
        <dt><a name="VDIRREF" id="VDIRREF"></a><b class="COMMAND">vdir</b></dt>
        <dd>
          <p>Show a detailed directory listing. The effect is similar to <a href="basic.html#LSREF">ls -lb</a>.</p>
          <p>This is one of the GNU <i class="FIRSTTERM">fileutils</i>.</p>
          <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
            <tbody><tr>
              <td>
                <pre class="SCREEN hljs"><span class="hljs-meta">bash$</span><span class="bash"> vdir</span>
total 10
 -rw-r--r--    1 bozo  bozo      4034 Jul 18 22:04 data1.xrolo
 -rw-r--r--    1 bozo  bozo      4602 May 25 13:58 data1.xrolo.bak
 -rw-r--r--    1 bozo  bozo       877 Dec 17  2000 employment.xrolo

bash ls -l
total 10
 -rw-r--r--    1 bozo  bozo      4034 Jul 18 22:04 data1.xrolo
 -rw-r--r--    1 bozo  bozo      4602 May 25 13:58 data1.xrolo.bak
 -rw-r--r--    1 bozo  bozo       877 Dec 17  2000 employment.xrolo
              </pre>
              </td>
            </tr>
          </tbody></table>
        </dd>
        <dt><a name="LOCATEREF" id="LOCATEREF"></a><b class="COMMAND">locate</b>, <a name="SLOCATEREF" id="SLOCATEREF"></a><b class="COMMAND">slocate</b></dt>
        <dd>
          <p>The <b class="COMMAND">locate</b> command searches for files using a database stored for just that purpose. The <b class="COMMAND">slocate</b> command is the secure version of <b class="COMMAND">locate</b> (which may be aliased to <b class="COMMAND">slocate</b>).</p>
          <p><tt class="USERINPUT"><b>$bash locate hickson</b></tt></p>
          <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
            <tbody><tr>
              <td>
                <pre class="SCREEN hljs">/usr/lib/xephem/catalogs/hickson.edb</pre>
              </td>
            </tr>
          </tbody></table>
        </dd>
        <dt><a name="GETFACLREF" id="GETFACLREF"></a><b class="COMMAND">getfacl</b>, <a name="SETFACLREF" id="SETFACLREF"></a><b class="COMMAND">setfacl</b></dt>
        <dd>
          <p>These commands <i class="FIRSTTERM">retrieve</i> or <i class="FIRSTTERM">set</i> the <b class="COMMAND">f</b>ile <b class="COMMAND">a</b>ccess <b class="COMMAND">c</b>ontrol <b class="COMMAND">l</b>ist -- the <i class="FIRSTTERM">owner</i>, <i class="FIRSTTERM">group</i>, and file permissions.</p>
          <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
            <tbody><tr>
              <td>
                <pre class="SCREEN hljs"><span class="hljs-meta">bash$</span><span class="bash"> getfacl *</span>
<span class="hljs-meta">#</span><span class="bash"> file: test1.txt</span>
<span class="hljs-meta"> #</span><span class="bash"> owner: bozo</span>
<span class="hljs-meta"> #</span><span class="bash"> group: bozgrp</span>
 user::rw-
 group::rw-
 other::r--
<span class="hljs-meta">
 #</span><span class="bash"> file: test2.txt</span>
<span class="hljs-meta"> #</span><span class="bash"> owner: bozo</span>
<span class="hljs-meta"> #</span><span class="bash"> group: bozgrp</span>
 user::rw-
 group::rw-
 other::r--
 
<span class="hljs-meta">
 
bash$</span><span class="bash"> setfacl -m u:bozo:rw yearly_budget.csv</span>
<span class="hljs-meta">bash$</span><span class="bash"> getfacl yearly_budget.csv</span>
<span class="hljs-meta">#</span><span class="bash"> file: yearly_budget.csv</span>
<span class="hljs-meta"> #</span><span class="bash"> owner: accountant</span>
<span class="hljs-meta"> #</span><span class="bash"> group: budgetgrp</span>
 user::rw-
 user:bozo:rw-
 user:accountant:rw-
 group::rw-
 mask::rw-
 other::r--
              </pre>
              </td>
            </tr>
          </tbody></table>
        </dd>
        <dt><a name="READLINKREF" id="READLINKREF"></a><b class="COMMAND">readlink</b></dt>
        <dd>
          <p>Disclose the file that a symbolic link points to.</p>
          <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
            <tbody><tr>
              <td>
                <pre class="SCREEN hljs"><span class="hljs-meta">bash$</span><span class="bash"> readlink /usr/bin/awk</span>
../../bin/gawk
              </pre>
              </td>
            </tr>
          </tbody></table>
        </dd>
        <dt><a name="STRINGSREF" id="STRINGSREF"></a><b class="COMMAND">strings</b></dt>
        <dd>
          <p>Use the <b class="COMMAND">strings</b> command to find printable strings in a binary or data file. It will list sequences of printable characters found in the target file. This might be handy for a quick 'n dirty examination of a core dump or for looking at an unknown graphic image file (<tt class="USERINPUT"><b>strings image-file | more</b></tt> might show something like <i class="FIRSTTERM">JFIF</i>, which would identify the file as a <i class="FIRSTTERM">jpeg</i> graphic). In a script, you would probably parse the output of <b class="COMMAND">strings</b> with <a href="textproc.html#GREPREF">grep</a> or <a href="sedawk.html#SEDREF">sed</a>. See <a href="loops1.html#BINGREP">Example 11-8</a> and <a href="loops1.html#FINDSTRING">Example 11-10</a>.</p>
          <div class="EXAMPLE">
            <a name="WSTRINGS" id="WSTRINGS"></a>
            <p><b>Example 16-34. An <span class="QUOTE">"improved"</span> <i class="FIRSTTERM">strings</i> command</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># wstrings.sh: "word-strings" (enhanced "strings" command)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  This script filters the output of "strings" by checking it</span>
<span class="hljs-comment">#+ against a standard word list file.</span>
<span class="hljs-comment">#  This effectively eliminates gibberish and noise,</span>
<span class="hljs-comment">#+ and outputs only recognized words.</span>

<span class="hljs-comment"># ===========================================================</span>
<span class="hljs-comment">#                 Standard Check for Script Argument(s)</span>
ARGS=1
E_BADARGS=85
E_NOFILE=86

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ne <span class="hljs-variable">$ARGS</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` filename"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BADARGS</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]                      <span class="hljs-comment"># Check if file exists.</span>
<span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"File \"<span class="hljs-variable">$1</span>\" does not exist."</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOFILE</span>
<span class="hljs-keyword">fi</span>
<span class="hljs-comment"># ===========================================================</span>


MINSTRLEN=3                           <span class="hljs-comment">#  Minimum string length.</span>
WORDFILE=/usr/share/dict/linux.words  <span class="hljs-comment">#  Dictionary file.</span>
<span class="hljs-comment">#  May specify a different word list file</span>
<span class="hljs-comment">#+ of one-word-per-line format.</span>
<span class="hljs-comment">#  For example, the "yawl" word-list package,</span>
<span class="hljs-comment">#  http://bash.deta.in/yawl-0.3.2.tar.gz</span>


wlist=`strings <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> | tr A-Z a-z | tr <span class="hljs-string">'[:space:]'</span> Z | \
       tr -cs <span class="hljs-string">'[:alpha:]'</span> Z | tr -s <span class="hljs-string">'\173-\377'</span> Z | tr Z <span class="hljs-string">' '</span>`

<span class="hljs-comment"># Translate output of 'strings' command with multiple passes of 'tr'.</span>
<span class="hljs-comment">#  "tr A-Z a-z"  converts to lowercase.</span>
<span class="hljs-comment">#  "tr '[:space:]'"  converts whitespace characters to Z's.</span>
<span class="hljs-comment">#  "tr -cs '[:alpha:]' Z"  converts non-alphabetic characters to Z's,</span>
<span class="hljs-comment">#+ and squeezes multiple consecutive Z's.</span>
<span class="hljs-comment">#  "tr -s '\173-\377' Z"  converts all characters past 'z' to Z's</span>
<span class="hljs-comment">#+ and squeezes multiple consecutive Z's,</span>
<span class="hljs-comment">#+ which gets rid of all the weird characters that the previous</span>
<span class="hljs-comment">#+ translation failed to deal with.</span>
<span class="hljs-comment">#  Finally, "tr Z ' '" converts all those Z's to whitespace,</span>
<span class="hljs-comment">#+ which will be seen as word separators in the loop below.</span>

<span class="hljs-comment">#  ***********************************************************************</span>
<span class="hljs-comment">#  Note the technique of feeding/piping the output of 'tr' back to itself,</span>
<span class="hljs-comment">#+ but with different arguments and/or options on each successive pass.</span>
<span class="hljs-comment">#  ***********************************************************************</span>


<span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> <span class="hljs-variable">$wlist</span>                    <span class="hljs-comment">#  Important:</span>
                                      <span class="hljs-comment">#  $wlist must not be quoted here.</span>
                                      <span class="hljs-comment"># "$wlist" does not work.</span>
                                      <span class="hljs-comment">#  Why not?</span>
<span class="hljs-keyword">do</span>
  strlen=<span class="hljs-variable">${#word}</span>                     <span class="hljs-comment">#  String length.</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$strlen</span>"</span> -lt <span class="hljs-string">"<span class="hljs-variable">$MINSTRLEN</span>"</span> ]   <span class="hljs-comment">#  Skip over short strings.</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">continue</span>
  <span class="hljs-keyword">fi</span>

  grep -Fw <span class="hljs-variable">$word</span> <span class="hljs-string">"<span class="hljs-variable">$WORDFILE</span>"</span>          <span class="hljs-comment">#   Match whole words only.</span>
<span class="hljs-comment">#      ^^^                            #  "Fixed strings" and</span>
                                      <span class="hljs-comment">#+ "whole words" options. </span>
<span class="hljs-keyword">done</span>  

<span class="hljs-built_in">exit</span> $?</pre>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
      </dl>
    </div>
    <div class="VARIABLELIST">
      <p><b><a name="COMPARISONN1" id="COMPARISONN1"></a>Comparison</b></p>
      <dl>
        <dt><a name="DIFFREF" id="DIFFREF"></a><b class="COMMAND">diff</b>, <b class="COMMAND">patch</b></dt>
        <dd>
          <p><b class="COMMAND">diff</b>: flexible file comparison utility. It compares the target files line-by-line sequentially. In some applications, such as comparing word dictionaries, it may be helpful to filter the files through <a href="textproc.html#SORTREF">sort</a> and <b class="COMMAND">uniq</b> before piping them to <b class="COMMAND">diff</b>. <tt class="USERINPUT"><b>diff file-1 file-2</b></tt> outputs the lines in the files that differ, with carets showing which file each particular line belongs to.</p>
          <p>The <tt class="OPTION">--side-by-side</tt> option to <b class="COMMAND">diff</b> outputs each compared file, line by line, in separate columns, with non-matching lines marked. The <tt class="OPTION">-c</tt> and <tt class="OPTION">-u</tt> options likewise make the output of the command easier to interpret.</p>
          <p>There are available various fancy frontends for <b class="COMMAND">diff</b>, such as <b class="COMMAND">sdiff</b>, <b class="COMMAND">wdiff</b>, <b class="COMMAND">xdiff</b>, and <b class="COMMAND">mgdiff</b>.</p>
          <div class="TIP">
            <table class="TIP" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/tip.gif" hspace="5" alt="Tip"></td>
                <td align="left" valign="top">
                  <p><a name="DIFFERR2" id="DIFFERR2"></a>The <b class="COMMAND">diff</b> command returns an exit status of <span class="ERRORCODE">0</span> if the compared files are identical, and <span class="ERRORCODE">1</span> if they differ (or <span class="ERRORCODE">2</span> when <i class="FIRSTTERM">binary</i> files are being compared). This permits use of <b class="COMMAND">diff</b> in a test construct within a shell script (see below).</p>
                </td>
              </tr>
            </tbody></table>
          </div>
          <p>A common use for <b class="COMMAND">diff</b> is generating difference files to be used with <b class="COMMAND">patch</b> The <tt class="OPTION">-e</tt> option outputs files suitable for <b class="COMMAND">ed</b> or <b class="COMMAND">ex</b> scripts.</p>
          <p><a name="PATCHREF" id="PATCHREF"></a></p>
          <p><b class="COMMAND">patch</b>: flexible versioning utility. Given a difference file generated by <b class="COMMAND">diff</b>, <b class="COMMAND">patch</b> can upgrade a previous version of a package to a newer version. It is much more convenient to distribute a relatively small <span class="QUOTE">"diff"</span> file than the entire body of a newly revised package. Kernel <span class="QUOTE">"patches"</span> have become the preferred method of distributing the frequent releases of the Linux kernel.</p>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs">patch -p1 &lt;patch-file
<span class="hljs-comment"># Takes all the changes listed in 'patch-file'</span>
<span class="hljs-comment"># and applies them to the files referenced therein.</span>
<span class="hljs-comment"># This upgrades to a newer version of the package.</span></pre>
              </td>
            </tr>
          </tbody></table>
          <p>Patching the kernel:</p>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs"><span class="hljs-built_in">cd</span> /usr/src
gzip -<span class="hljs-built_in">cd</span> patchXX.gz | patch -p0
<span class="hljs-comment"># Upgrading kernel source using 'patch'.</span>
<span class="hljs-comment"># From the Linux kernel docs "README",</span>
<span class="hljs-comment"># by anonymous author (Alan Cox?).</span></pre>
              </td>
            </tr>
          </tbody></table>
          <div class="NOTE">
            <table class="NOTE no-border" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/note.gif" hspace="5" alt="Note"></td>
                <td align="left" valign="top">
                  <p>The <b class="COMMAND">diff</b> command can also recursively compare directories (for the filenames present).</p>
                  <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
                    <tbody><tr>
                      <td>
                        <pre class="SCREEN hljs"><span class="hljs-meta">bash$</span><span class="bash"> diff -r ~/notes1 ~/notes2</span>
Only in /home/bozo/notes1: file02
 Only in /home/bozo/notes1: file03
 Only in /home/bozo/notes2: file04
              </pre>
                      </td>
                    </tr>
                  </tbody></table>
                </td>
              </tr>
            </tbody></table>
          </div>
          <div class="TIP">
            <table class="TIP" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/tip.gif" hspace="5" alt="Tip"></td>
                <td align="left" valign="top">
                  <p><a name="ZDIFFREF" id="ZDIFFREF"></a></p>
                  <p>Use <b class="COMMAND">zdiff</b> to compare <i class="FIRSTTERM">gzipped</i> files.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
          <div class="TIP">
            <table class="TIP" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/tip.gif" hspace="5" alt="Tip"></td>
                <td align="left" valign="top">
                  <p><a name="DIFFSTATREF" id="DIFFSTATREF"></a></p>
                  <p>Use <b class="COMMAND">diffstat</b> to create a histogram (point-distribution graph) of output from <b class="COMMAND">diff</b>.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
        <dt><a name="DIFF3REF" id="DIFF3REF"></a><b class="COMMAND">diff3</b>, <b class="COMMAND">merge</b></dt>
        <dd>
          <p>An extended version of <b class="COMMAND">diff</b> that compares three files at a time. This command returns an exit value of 0 upon successful execution, but unfortunately this gives no information about the results of the comparison.</p>
          <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
            <tbody><tr>
              <td>
                <pre class="SCREEN hljs"><span class="hljs-meta">bash$</span><span class="bash"> diff3 file-1 file-2 file-3</span>
====
 1:1c
   This is line 1 of "file-1".
 2:1c
   This is line 1 of "file-2".
 3:1c
   This is line 1 of "file-3"
              </pre>
              </td>
            </tr>
          </tbody></table>
          <p><a name="MERGEREF" id="MERGEREF"></a>The <b class="COMMAND">merge</b> (3-way file merge) command is an interesting adjunct to <i class="FIRSTTERM">diff3</i>. Its syntax is <tt class="USERINPUT"><b>merge Mergefile file1 file2</b></tt>. The result is to output to <tt class="FILENAME">Mergefile</tt> the changes that lead from <tt class="FILENAME">file1</tt> to <tt class="FILENAME">file2</tt>. Consider this command a stripped-down version of <i class="FIRSTTERM">patch</i>.</p>
        </dd>
        <dt><a name="SDIFFREF" id="SDIFFREF"></a><b class="COMMAND">sdiff</b></dt>
        <dd>
          <p>Compare and/or edit two files in order to merge them into an output file. Because of its interactive nature, this command would find little use in a script.</p>
        </dd>
        <dt><a name="CMPREF" id="CMPREF"></a><b class="COMMAND">cmp</b></dt>
        <dd>
          <p>The <b class="COMMAND">cmp</b> command is a simpler version of <b class="COMMAND">diff</b>, above. Whereas <b class="COMMAND">diff</b> reports the differences between two files, <b class="COMMAND">cmp</b> merely shows at what point they differ.</p>
          <div class="NOTE">
            <table class="NOTE" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/note.gif" hspace="5" alt="Note"></td>
                <td align="left" valign="top">
                  <p>Like <b class="COMMAND">diff</b>, <b class="COMMAND">cmp</b> returns an exit status of 0 if the compared files are identical, and 1 if they differ. This permits use in a test construct within a shell script.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
          <div class="EXAMPLE">
            <a name="FILECOMP" id="FILECOMP"></a>
            <p><b>Example 16-35. Using <i class="FIRSTTERM">cmp</i> to compare two files within a script.</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># file-comparison.sh</span>

ARGS=2  <span class="hljs-comment"># Two args to script expected.</span>
E_BADARGS=85
E_UNREADABLE=86

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ne <span class="hljs-string">"<span class="hljs-variable">$ARGS</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` file1 file2"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BADARGS</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [[ ! -r <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> || ! -r <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ]]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Both files to be compared must exist and be readable."</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_UNREADABLE</span>
<span class="hljs-keyword">fi</span>

cmp <span class="hljs-variable">$1</span> <span class="hljs-variable">$2</span> &amp;&gt; /dev/null
<span class="hljs-comment">#   Redirection to /dev/null buries the output of the "cmp" command.</span>
<span class="hljs-comment">#   cmp -s $1 $2  has same result ("-s" silent flag to "cmp")</span>
<span class="hljs-comment">#   Thank you  Anders Gustavsson for pointing this out.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  Also works with 'diff', i.e.,</span>
<span class="hljs-comment">#+ diff $1 $2 &amp;&gt; /dev/null</span>

<span class="hljs-keyword">if</span> [ $? -eq 0 ]         <span class="hljs-comment"># Test exit status of "cmp" command.</span>
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"File \"<span class="hljs-variable">$1</span>\" is identical to file \"<span class="hljs-variable">$2</span>\"."</span>
<span class="hljs-keyword">else</span>  
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"File \"<span class="hljs-variable">$1</span>\" differs from file \"<span class="hljs-variable">$2</span>\"."</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">exit</span> 0</pre>
                </td>
              </tr>
            </tbody></table>
          </div>
          <div class="TIP">
            <table class="TIP" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/tip.gif" hspace="5" alt="Tip"></td>
                <td align="left" valign="top">
                  <p>Use <b class="COMMAND">zcmp</b> on <i class="FIRSTTERM">gzipped</i> files.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
        <dt><a name="COMMREF" id="COMMREF"></a><b class="COMMAND">comm</b></dt>
        <dd>
          <p>Versatile file comparison utility. The files must be sorted for this to be useful.</p>
          <p><b class="COMMAND">comm <tt class="REPLACEABLE"><i>-options</i></tt> <tt class="REPLACEABLE"><i>first-file</i></tt> <tt class="REPLACEABLE"><i>second-file</i></tt></b></p>
          <p><tt class="USERINPUT"><b>comm file-1 file-2</b></tt> outputs three columns:</p>
          <ul>
            <li>
              <p>column 1 = lines unique to <tt class="FILENAME">file-1</tt></p>
            </li>
            <li>
              <p>column 2 = lines unique to <tt class="FILENAME">file-2</tt></p>
            </li>
            <li>
              <p>column 3 = lines common to both.</p>
            </li>
          </ul>
          <p>The options allow suppressing output of one or more columns.</p>
          <ul>
            <li>
              <p><tt class="OPTION">-1</tt> suppresses column <tt class="LITERAL">1</tt></p>
            </li>
            <li>
              <p><tt class="OPTION">-2</tt> suppresses column <tt class="LITERAL">2</tt></p>
            </li>
            <li>
              <p><tt class="OPTION">-3</tt> suppresses column <tt class="LITERAL">3</tt></p>
            </li>
            <li>
              <p><tt class="OPTION">-12</tt> suppresses both columns <tt class="LITERAL">1</tt> and <tt class="LITERAL">2</tt>, etc.</p>
            </li>
          </ul>
          <p>This command is useful for comparing <span class="QUOTE">"dictionaries"</span> or <i class="FIRSTTERM">word lists</i> -- sorted text files with one word per line.</p>
        </dd>
      </dl>
    </div>
    <div class="VARIABLELIST">
      <p><b><a name="FAUTILS1" id="FAUTILS1"></a>Utilities</b></p>
      <dl>
        <dt><a name="BASENAMEREF" id="BASENAMEREF"></a><b class="COMMAND">basename</b></dt>
        <dd>
          <p>Strips the path information from a file name, printing only the file name. The construction <tt class="USERINPUT"><b>basename $0</b></tt> lets the script know its name, that is, the name it was invoked by. This can be used for <span class="QUOTE">"usage"</span> messages if, for example a script is called with missing arguments:</p>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs"><span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` arg1 arg2 ... argn"</span></pre>
              </td>
            </tr>
          </tbody></table>
        </dd>
        <dt><a name="DIRNAMEREF" id="DIRNAMEREF"></a><b class="COMMAND">dirname</b></dt>
        <dd>
          <p>Strips the <b class="COMMAND">basename</b> from a filename, printing only the path information.</p>
          <div class="NOTE">
            <table class="NOTE" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/note.gif" hspace="5" alt="Note"></td>
                <td align="left" valign="top">
                  <p><b class="COMMAND">basename</b> and <b class="COMMAND">dirname</b> can operate on any arbitrary string. The argument does not need to refer to an existing file, or even be a filename for that matter (see <a href="contributed-scripts.html#DAYSBETWEEN">Example A-7</a>).</p>
                </td>
              </tr>
            </tbody></table>
          </div>
          <div class="EXAMPLE">
            <a name="EX35" id="EX35"></a>
            <p><b>Example 16-36. <i class="FIRSTTERM">basename</i> and <i class="FIRSTTERM">dirname</i></b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>

address=/home/bozo/daily-journal.txt

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Basename of /home/bozo/daily-journal.txt = `basename <span class="hljs-variable">$address</span>`"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Dirname of /home/bozo/daily-journal.txt = `dirname <span class="hljs-variable">$address</span>`"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"My own home is `basename ~/`."</span>         <span class="hljs-comment"># `basename ~` also works.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"The home of my home is `dirname ~/`."</span>  <span class="hljs-comment"># `dirname ~`  also works.</span>

<span class="hljs-built_in">exit</span> 0</pre>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
        <dt><a name="SPLITREF" id="SPLITREF"></a><b class="COMMAND">split</b>, <a name="CSPLITREF" id="CSPLITREF"></a><b class="COMMAND">csplit</b></dt>
        <dd>
          <p>These are utilities for splitting a file into smaller chunks. Their usual use is for splitting up large files in order to back them up on floppies or preparatory to e-mailing or uploading them.</p>
          <p>The <b class="COMMAND">csplit</b> command splits a file according to <i class="FIRSTTERM">context</i>, the split occuring where patterns are matched.</p>
          <div class="EXAMPLE">
            <a name="SPLITCOPY" id="SPLITCOPY"></a>
            <p><b>Example 16-37. A script that copies itself in sections</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># splitcopy.sh</span>

<span class="hljs-comment">#  A script that splits itself into chunks,</span>
<span class="hljs-comment">#+ then reassembles the chunks into an exact copy</span>
<span class="hljs-comment">#+ of the original script.</span>

CHUNKSIZE=4    <span class="hljs-comment">#  Size of first chunk of split files.</span>
OUTPREFIX=xx   <span class="hljs-comment">#  csplit prefixes, by default,</span>
               <span class="hljs-comment">#+ files with "xx" ...</span>

csplit <span class="hljs-string">"<span class="hljs-variable">$0</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$CHUNKSIZE</span>"</span>

<span class="hljs-comment"># Some comment lines for padding . . .</span>
<span class="hljs-comment"># Line 15</span>
<span class="hljs-comment"># Line 16</span>
<span class="hljs-comment"># Line 17</span>
<span class="hljs-comment"># Line 18</span>
<span class="hljs-comment"># Line 19</span>
<span class="hljs-comment"># Line 20</span>

cat <span class="hljs-string">"<span class="hljs-variable">$OUTPREFIX</span>"</span>* &gt; <span class="hljs-string">"<span class="hljs-variable">$0</span>.copy"</span>  <span class="hljs-comment"># Concatenate the chunks.</span>
rm <span class="hljs-string">"<span class="hljs-variable">$OUTPREFIX</span>"</span>*               <span class="hljs-comment"># Get rid of the chunks.</span>

<span class="hljs-built_in">exit</span> $?</pre>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
      </dl>
    </div>
    <div class="VARIABLELIST">
      <p><b><a name="FAENCENCR1" id="FAENCENCR1"></a>Encoding and Encryption</b></p>
      <dl>
        <dt><a name="SUMREF" id="SUMREF"></a><b class="COMMAND">sum</b>, <a name="CKSUMREF" id="CKSUMREF"></a><b class="COMMAND">cksum</b>, <a name="MD5SUMREF" id="MD5SUMREF"></a><b class="COMMAND">md5sum</b>, <a name="SHA1SUMREF" id="SHA1SUMREF"></a><b class="COMMAND">sha1sum</b></dt>
        <dd>
          <p><a name="CHECKSUMREF" id="CHECKSUMREF"></a>These are utilities for generating <i class="FIRSTTERM">checksums</i>. A <i class="FIRSTTERM">checksum</i> is a number <a name="AEN12840" href="#FTN.AEN12840" id="AEN12840"><span class="footnote">[3]</span></a> mathematically calculated from the contents of a file, for the purpose of checking its integrity. A script might refer to a list of checksums for security purposes, such as ensuring that the contents of key system files have not been altered or corrupted. For security applications, use the <b class="COMMAND">md5sum</b> (<b class="COMMAND">m</b>essage <b class="COMMAND">d</b>igest <b class="COMMAND">5</b> check<b class="COMMAND">sum</b>) command, or better yet, the newer <b class="COMMAND">sha1sum</b> (Secure Hash Algorithm). <a name="AEN12849" href="#FTN.AEN12849" id="AEN12849"><span class="footnote">[4]</span></a></p>
          <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
            <tbody><tr>
              <td>
                <pre class="SCREEN hljs"><span class="hljs-meta">bash$</span><span class="bash"> cksum /boot/vmlinuz</span>
1670054224 804083 /boot/vmlinuz
<span class="hljs-meta">
bash$</span><span class="bash"> <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Top Secret"</span> | cksum</span>
3391003827 10
<span class="hljs-meta">


bash$</span><span class="bash"> md5sum /boot/vmlinuz</span>
0f43eccea8f09e0a0b2b5cf1dcf333ba  /boot/vmlinuz
<span class="hljs-meta">
bash$</span><span class="bash"> <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Top Secret"</span> | md5sum</span>
8babc97a6f62a4649716f4df8d61728f  -
              </pre>
              </td>
            </tr>
          </tbody></table>
          <div class="NOTE">
            <table class="NOTE" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/note.gif" hspace="5" alt="Note"></td>
                <td align="left" valign="top">
                  <p>The <b class="COMMAND">cksum</b> command shows the size, in bytes, of its target, whether file or <tt class="FILENAME">stdout</tt>.</p>
                  <p>The <b class="COMMAND">md5sum</b> and <b class="COMMAND">sha1sum</b> commands display a <a href="special-chars.html#DASHREF2">dash</a> when they receive their input from <tt class="FILENAME">stdout</tt>.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
          <div class="EXAMPLE">
            <a name="FILEINTEGRITY" id="FILEINTEGRITY"></a>
            <p><b>Example 16-38. Checking file integrity</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># file-integrity.sh: Checking whether files in a given directory</span>
<span class="hljs-comment">#                    have been tampered with.</span>

E_DIR_NOMATCH=80
E_BAD_DBFILE=81

dbfile=File_record.md5
<span class="hljs-comment"># Filename for storing records (database file).</span>


<span class="hljs-function"><span class="hljs-title">set_up_database</span></span> ()
{
  <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span><span class="hljs-variable">$directory</span><span class="hljs-string">""</span> &gt; <span class="hljs-string">"<span class="hljs-variable">$dbfile</span>"</span>
  <span class="hljs-comment"># Write directory name to first line of file.</span>
  md5sum <span class="hljs-string">"<span class="hljs-variable">$directory</span>"</span>/* &gt;&gt; <span class="hljs-string">"<span class="hljs-variable">$dbfile</span>"</span>
  <span class="hljs-comment"># Append md5 checksums and filenames.</span>
}

<span class="hljs-function"><span class="hljs-title">check_database</span></span> ()
{
  <span class="hljs-built_in">local</span> n=0
  <span class="hljs-built_in">local</span> filename
  <span class="hljs-built_in">local</span> checksum

  <span class="hljs-comment"># ------------------------------------------- #</span>
  <span class="hljs-comment">#  This file check should be unnecessary,</span>
  <span class="hljs-comment">#+ but better safe than sorry.</span>

  <span class="hljs-keyword">if</span> [ ! -r <span class="hljs-string">"<span class="hljs-variable">$dbfile</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Unable to read checksum database file!"</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BAD_DBFILE</span>
  <span class="hljs-keyword">fi</span>
  <span class="hljs-comment"># ------------------------------------------- #</span>

  <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> record[n]
  <span class="hljs-keyword">do</span>

    directory_checked=<span class="hljs-string">"<span class="hljs-variable">${record[0]}</span>"</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$directory_checked</span>"</span> != <span class="hljs-string">"<span class="hljs-variable">$directory</span>"</span> ]
    <span class="hljs-keyword">then</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"Directories do not match up!"</span>
      <span class="hljs-comment"># Tried to use file for a different directory.</span>
      <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_DIR_NOMATCH</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$n</span>"</span> -gt 0 ]   <span class="hljs-comment"># Not directory name.</span>
    <span class="hljs-keyword">then</span>
      filename[n]=$( <span class="hljs-built_in">echo</span> <span class="hljs-variable">${record[$n]}</span> | awk <span class="hljs-string">'{ print $2 }'</span> )
      <span class="hljs-comment">#  md5sum writes records backwards,</span>
      <span class="hljs-comment">#+ checksum first, then filename.</span>
      checksum[n]=$( md5sum <span class="hljs-string">"<span class="hljs-variable">${filename[n]}</span>"</span> )


      <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">${record[n]}</span>"</span> = <span class="hljs-string">"<span class="hljs-variable">${checksum[n]}</span>"</span> ]
      <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${filename[n]}</span> unchanged."</span>

        <span class="hljs-keyword">elif</span> [ <span class="hljs-string">"`basename <span class="hljs-variable">${filename[n]}</span>`"</span> != <span class="hljs-string">"<span class="hljs-variable">$dbfile</span>"</span> ]
               <span class="hljs-comment">#  Skip over checksum database file,</span>
               <span class="hljs-comment">#+ as it will change with each invocation of script.</span>
               <span class="hljs-comment">#  ---</span>
               <span class="hljs-comment">#  This unfortunately means that when running</span>
               <span class="hljs-comment">#+ this script on $PWD, tampering with the</span>
               <span class="hljs-comment">#+ checksum database file will not be detected.</span>
               <span class="hljs-comment">#  Exercise: Fix this.</span>
        <span class="hljs-keyword">then</span>
          <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${filename[n]}</span> : CHECKSUM ERROR!"</span>
        <span class="hljs-comment"># File has been changed since last checked.</span>
        <span class="hljs-keyword">fi</span>

      <span class="hljs-keyword">fi</span>



    <span class="hljs-built_in">let</span> <span class="hljs-string">"n+=1"</span>
  <span class="hljs-keyword">done</span> &lt;<span class="hljs-string">"<span class="hljs-variable">$dbfile</span>"</span>       <span class="hljs-comment"># Read from checksum database file. </span>

}  

<span class="hljs-comment"># =================================================== #</span>
<span class="hljs-comment"># main ()</span>

<span class="hljs-keyword">if</span> [ -z  <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
<span class="hljs-keyword">then</span>
  directory=<span class="hljs-string">"<span class="hljs-variable">$PWD</span>"</span>      <span class="hljs-comment">#  If not specified,</span>
<span class="hljs-keyword">else</span>                    <span class="hljs-comment">#+ use current working directory.</span>
  directory=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
<span class="hljs-keyword">fi</span>  

clear                   <span class="hljs-comment"># Clear screen.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">" Running file integrity check on <span class="hljs-variable">$directory</span>"</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># ------------------------------------------------------------------ #</span>
  <span class="hljs-keyword">if</span> [ ! -r <span class="hljs-string">"<span class="hljs-variable">$dbfile</span>"</span> ] <span class="hljs-comment"># Need to create database file?</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Setting up database file, \""</span><span class="hljs-variable">$directory</span><span class="hljs-string">"/"</span><span class="hljs-variable">$dbfile</span><span class="hljs-string">"\"."</span>; <span class="hljs-built_in">echo</span>
    set_up_database
  <span class="hljs-keyword">fi</span>  
<span class="hljs-comment"># ------------------------------------------------------------------ #</span>

check_database          <span class="hljs-comment"># Do the actual work.</span>

<span class="hljs-built_in">echo</span> 

<span class="hljs-comment">#  You may wish to redirect the stdout of this script to a file,</span>
<span class="hljs-comment">#+ especially if the directory checked has many files in it.</span>

<span class="hljs-built_in">exit</span> 0

<span class="hljs-comment">#  For a much more thorough file integrity check,</span>
<span class="hljs-comment">#+ consider the "Tripwire" package,</span>
<span class="hljs-comment">#+ http://sourceforge.net/projects/tripwire/.</span></pre>
                </td>
              </tr>
            </tbody></table>
          </div>
          <p>Also see <a href="contributed-scripts.html#DIRECTORYINFO">Example A-19</a>, <a href="colorizing.html#HORSERACE">Example 36-16</a>, and <a href="string-manipulation.html#RANDSTRING">Example 10-2</a> for creative uses of the <b class="COMMAND">md5sum</b> command.</p>
          <div class="NOTE">
            <table class="NOTE no-border" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/note.gif" hspace="5" alt="Note"></td>
                <td align="left" valign="top">
                  <p>There have been reports that the 128-bit <b class="COMMAND">md5sum</b> can be cracked, so the more secure 160-bit <b class="COMMAND">sha1sum</b> is a welcome new addition to the checksum toolkit.</p>
                  <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
                    <tbody><tr>
                      <td>
                        <pre class="SCREEN hljs"><span class="hljs-meta">bash$</span><span class="bash"> md5sum testfile</span>
e181e2c8720c60522c4c4c981108e367  testfile
<span class="hljs-meta">

bash$</span><span class="bash"> sha1sum testfile</span>
5d7425a9c08a66c3177f1e31286fa40986ffc996  testfile
              </pre>
                      </td>
                    </tr>
                  </tbody></table>
                </td>
              </tr>
            </tbody></table>
          </div>
          <p>Security consultants have demonstrated that even <b class="COMMAND">sha1sum</b> can be compromised. Fortunately, newer Linux distros include longer bit-length <b class="COMMAND">sha224sum</b>, <b class="COMMAND">sha256sum</b>, <b class="COMMAND">sha384sum</b>, and <b class="COMMAND">sha512sum</b> commands.</p>
        </dd>
        <dt><a name="UUENCODEREF" id="UUENCODEREF"></a><b class="COMMAND">uuencode</b></dt>
        <dd>
          <p>This utility encodes binary files (images, sound files, compressed files, etc.) into <a href="special-chars.html#ASCIIDEF">ASCII</a> characters, making them suitable for transmission in the body of an e-mail message or in a newsgroup posting. This is especially useful where MIME (multimedia) encoding is not available.</p>
        </dd>
        <dt><a name="UUDECODEREF" id="UUDECODEREF"></a><b class="COMMAND">uudecode</b></dt>
        <dd>
          <p>This reverses the encoding, decoding <i class="FIRSTTERM">uuencoded</i> files back into the original binaries.</p>
          <div class="EXAMPLE">
            <a name="EX52" id="EX52"></a>
            <p><b>Example 16-39. Uudecoding encoded files</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># Uudecodes all uuencoded files in current working directory.</span>

lines=35        <span class="hljs-comment"># Allow 35 lines for the header (very generous).</span>

<span class="hljs-keyword">for</span> File <span class="hljs-keyword">in</span> *   <span class="hljs-comment"># Test all the files in $PWD.</span>
<span class="hljs-keyword">do</span>
  search1=`head -n <span class="hljs-variable">$lines</span> <span class="hljs-variable">$File</span> | grep begin | wc -w`
  search2=`tail -n <span class="hljs-variable">$lines</span> <span class="hljs-variable">$File</span> | grep end | wc -w`
  <span class="hljs-comment">#  Uuencoded files have a "begin" near the beginning,</span>
  <span class="hljs-comment">#+ and an "end" near the end.</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$search1</span>"</span> -gt 0 ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$search2</span>"</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"uudecoding - <span class="hljs-variable">$File</span> -"</span>
      uudecode <span class="hljs-variable">$File</span>
    <span class="hljs-keyword">fi</span>  
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>  

<span class="hljs-comment">#  Note that running this script upon itself fools it</span>
<span class="hljs-comment">#+ into thinking it is a uuencoded file,</span>
<span class="hljs-comment">#+ because it contains both "begin" and "end".</span>

<span class="hljs-comment">#  Exercise:</span>
<span class="hljs-comment">#  --------</span>
<span class="hljs-comment">#  Modify this script to check each file for a newsgroup header,</span>
<span class="hljs-comment">#+ and skip to next if not found.</span>

<span class="hljs-built_in">exit</span> 0</pre>
                </td>
              </tr>
            </tbody></table>
          </div>
          <div class="TIP">
            <table class="TIP" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/tip.gif" hspace="5" alt="Tip"></td>
                <td align="left" valign="top">
                  <p>The <a href="textproc.html#FOLDREF">fold -s</a> command may be useful (possibly in a pipe) to process long uudecoded text messages downloaded from Usenet newsgroups.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
        <dt><a name="MIMENCODEREF" id="MIMENCODEREF"></a><b class="COMMAND">mimencode</b>, <a name="MMENCODEREF" id="MMENCODEREF"></a><b class="COMMAND">mmencode</b></dt>
        <dd>
          <p>The <b class="COMMAND">mimencode</b> and <b class="COMMAND">mmencode</b> commands process multimedia-encoded e-mail attachments. Although <i class="FIRSTTERM">mail user agents</i> (such as <i class="FIRSTTERM">pine</i> or <i class="FIRSTTERM">kmail</i>) normally handle this automatically, these particular utilities permit manipulating such attachments manually from the command-line or in <a href="timedate.html#BATCHPROCREF">batch processing mode</a> by means of a shell script.</p>
        </dd>
        <dt><a name="CRYPTREF" id="CRYPTREF"></a><b class="COMMAND">crypt</b></dt>
        <dd>
          <p>At one time, this was the standard UNIX file encryption utility. <a name="AEN12969" href="#FTN.AEN12969" id="AEN12969"><span class="footnote">[5]</span></a> Politically-motivated government regulations prohibiting the export of encryption software resulted in the disappearance of <b class="COMMAND">crypt</b> from much of the UNIX world, and it is still missing from most Linux distributions. Fortunately, programmers have come up with a number of decent alternatives to it, among them the author's very own <a href="ftp://metalab.unc.edu/pub/Linux/utils/file/cruft-0.2.tar.gz" target="_top">cruft</a> (see <a href="contributed-scripts.html#ENCRYPTEDPW">Example A-4</a>).</p>
        </dd>
        <dt><a name="OPENSSLREF" id="OPENSSLREF"></a><b class="COMMAND">openssl</b></dt>
        <dd>
          <p>This is an Open Source implementation of <i class="FIRSTTERM">Secure Sockets Layer</i> encryption.</p>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs"><span class="hljs-comment"># To encrypt a file:</span>
openssl aes-128-ecb -salt -<span class="hljs-keyword">in</span> file.txt -out file.encrypted \
-pass pass:my_password
<span class="hljs-comment">#          ^^^^^^^^^^^   User-selected password.</span>
<span class="hljs-comment">#       aes-128-ecb      is the encryption method chosen.</span>

<span class="hljs-comment"># To decrypt an openssl-encrypted file:</span>
openssl aes-128-ecb -d -salt -<span class="hljs-keyword">in</span> file.encrypted -out file.txt \
-pass pass:my_password
<span class="hljs-comment">#          ^^^^^^^^^^^   User-selected password.</span></pre>
              </td>
            </tr>
          </tbody></table>
          <p><a href="special-chars.html#PIPEREF">Piping</a> <i class="FIRSTTERM">openssl</i> to/from <a href="filearchiv.html#TARREF">tar</a> makes it possible to encrypt an entire directory tree.</p>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs"><span class="hljs-comment"># To encrypt a directory:</span>

sourcedir=<span class="hljs-string">"/home/bozo/testfiles"</span>
encrfile=<span class="hljs-string">"encr-dir.tar.gz"</span>
password=my_secret_password

tar czvf - <span class="hljs-string">"<span class="hljs-variable">$sourcedir</span>"</span> |
openssl des3 -salt -out <span class="hljs-string">"<span class="hljs-variable">$encrfile</span>"</span> -pass pass:<span class="hljs-string">"<span class="hljs-variable">$password</span>"</span>
<span class="hljs-comment">#       ^^^^   Uses des3 encryption.</span>
<span class="hljs-comment"># Writes encrypted file "encr-dir.tar.gz" in current working directory.</span>

<span class="hljs-comment"># To decrypt the resulting tarball:</span>
openssl des3 -d -salt -<span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">$encrfile</span>"</span> -pass pass:<span class="hljs-string">"<span class="hljs-variable">$password</span>"</span> |
tar -xzv
<span class="hljs-comment"># Decrypts and unpacks into current working directory.</span></pre>
              </td>
            </tr>
          </tbody></table>
          <p>Of course, <i class="FIRSTTERM">openssl</i> has many other uses, such as obtaining signed <i class="FIRSTTERM">certificates</i> for Web sites. See the <a href="basic.html#INFOREF">info</a> page.</p>
        </dd>
        <dt><a name="SHREDREF" id="SHREDREF"></a><b class="COMMAND">shred</b></dt>
        <dd>
          <p>Securely erase a file by overwriting it multiple times with random bit patterns before deleting it. This command has the same effect as <a href="extmisc.html#BLOTOUT">Example 16-61</a>, but does it in a more thorough and elegant manner.</p>
          <p>This is one of the GNU <i class="FIRSTTERM">fileutils</i>.</p>
          <div class="CAUTION">
            <table class="CAUTION" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/caution.gif" hspace="5" alt="Caution"></td>
                <td align="left" valign="top">
                  <p>Advanced forensic technology may still be able to recover the contents of a file, even after application of <b class="COMMAND">shred</b>.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
      </dl>
    </div>
    <div class="VARIABLELIST">
      <p><b><a name="FAMISC1" id="FAMISC1"></a>Miscellaneous</b></p>
      <dl>
        <dt><a name="MKTEMPREF" id="MKTEMPREF"></a><b class="COMMAND">mktemp</b></dt>
        <dd>
          <p>Create a <i class="FIRSTTERM">temporary file</i> <a name="AEN13030" href="#FTN.AEN13030" id="AEN13030"><span class="footnote">[6]</span></a> with a <span class="QUOTE">"unique"</span> filename. When invoked from the command-line without additional arguments, it creates a zero-length file in the <tt class="FILENAME">/tmp</tt> directory.</p>
          <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
            <tbody><tr>
              <td>
                <pre class="SCREEN hljs"><span class="hljs-meta">bash$</span><span class="bash"> mktemp</span>
/tmp/tmp.zzsvql3154
              </pre>
              </td>
            </tr>
          </tbody></table>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs">PREFIX=filename
tempfile=`mktemp <span class="hljs-variable">$PREFIX</span>.XXXXXX`
<span class="hljs-comment">#                        ^^^^^^ Need at least 6 placeholders</span>
<span class="hljs-comment">#+                              in the filename template.</span>
<span class="hljs-comment">#   If no filename template supplied,</span>
<span class="hljs-comment">#+ "tmp.XXXXXXXXXX" is the default.</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"tempfile name = <span class="hljs-variable">$tempfile</span>"</span>
<span class="hljs-comment"># tempfile name = filename.QA2ZpY</span>
<span class="hljs-comment">#                 or something similar...</span>

<span class="hljs-comment">#  Creates a file of that name in the current working directory</span>
<span class="hljs-comment">#+ with 600 file permissions.</span>
<span class="hljs-comment">#  A "umask 177" is therefore unnecessary,</span>
<span class="hljs-comment">#+ but it's good programming practice nevertheless.</span></pre>
              </td>
            </tr>
          </tbody></table>
        </dd>
        <dt><a name="MAKEREF" id="MAKEREF"></a><b class="COMMAND">make</b></dt>
        <dd>
          <p><a name="MAKEFILEREF" id="MAKEFILEREF"></a></p>
          <p>Utility for building and compiling binary packages. This can also be used for any set of operations triggered by incremental changes in source files.</p>
          <p>The <i class="FIRSTTERM">make</i> command checks a <tt class="FILENAME">Makefile</tt>, a list of file dependencies and operations to be carried out.</p>
          <p>The <i class="FIRSTTERM">make</i> utility is, in effect, a powerful scripting language similar in many ways to <i class="FIRSTTERM">Bash</i>, but with the capability of recognizing <i class="FIRSTTERM">dependencies</i>. For in-depth coverage of this useful tool set, see the <a href="http://www.gnu.org/manual/manual.html" target="_top">GNU software documentation site</a>.</p>
        </dd>
        <dt><a name="INSTALLREF" id="INSTALLREF"></a><b class="COMMAND">install</b></dt>
        <dd>
          <p>Special purpose file copying command, similar to <a href="basic.html#CPREF">cp</a>, but capable of setting permissions and attributes of the copied files. This command seems tailormade for installing software packages, and as such it shows up frequently in <tt class="FILENAME">Makefiles</tt> (in the <tt class="REPLACEABLE"><i>make install :</i></tt> section). It could likewise prove useful in installation scripts.</p>
        </dd>
        <dt><a name="DOS2UNIXREF" id="DOS2UNIXREF"></a><b class="COMMAND">dos2unix</b></dt>
        <dd>
          <p>This utility, written by Benjamin Lin and collaborators, converts DOS-formatted text files (lines terminated by CR-LF) to UNIX format (lines terminated by LF only), and <a href="gotchas.html#DOSNEWLINES">vice-versa</a>.</p>
        </dd>
        <dt><a name="PTXREF" id="PTXREF"></a><b class="COMMAND">ptx</b></dt>
        <dd>
          <p>The <b class="COMMAND">ptx [targetfile]</b> command outputs a permuted index (cross-reference list) of the targetfile. This may be further filtered and formatted in a pipe, if necessary.</p>
        </dd>
        <dt><a name="MOREREF" id="MOREREF"></a><b class="COMMAND">more</b>, <a name="LESSREF" id="LESSREF"></a><b class="COMMAND">less</b></dt>
        <dd>
          <p>Pagers that display a text file or stream to <tt class="FILENAME">stdout</tt>, one screenful at a time. These may be used to filter the output of <tt class="FILENAME">stdout</tt> . . . or of a script.</p>
          <p>An interesting application of <i class="FIRSTTERM">more</i> is to <span class="QUOTE">"test drive"</span> a command sequence, to forestall potentially unpleasant consequences.</p>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs">ls /home/bozo | awk <span class="hljs-string">'{print "rm -rf " $1}'</span> | more
<span class="hljs-comment">#                                            ^^^^</span>
                 
<span class="hljs-comment"># Testing the effect of the following (disastrous) command-line:</span>
<span class="hljs-comment">#      ls /home/bozo | awk '{print "rm -rf " $1}' | sh</span>
<span class="hljs-comment">#      Hand off to the shell to execute . . .       ^^</span></pre>
              </td>
            </tr>
          </tbody></table>
          <p>The <i class="FIRSTTERM">less</i> pager has the interesting property of doing a formatted display of <i class="FIRSTTERM">man page</i> source. See <a href="contributed-scripts.html#MANED">Example A-39</a>.</p>
        </dd>
      </dl>
    </div>
  </div>
  <h3 class="FOOTNOTES">Notes</h3>
  <table border="0" class="FOOTNOTES" width="100%">
    <tbody><tr>
      <td align="left" valign="top" width="5%"><a name="FTN.AEN11885" href="filearchiv.html#AEN11885" id="FTN.AEN11885"><span class="footnote">[1]</span></a></td>
      <td align="left" valign="top" width="95%">
        <p>An <i class="FIRSTTERM">archive</i>, in the sense discussed here, is simply a set of related files stored in a single location.</p>
      </td>
    </tr>
    <tr>
      <td align="left" valign="top" width="5%"><a name="FTN.AEN11896" href="filearchiv.html#AEN11896" id="FTN.AEN11896"><span class="footnote">[2]</span></a></td>
      <td align="left" valign="top" width="95%">
        <p>A <tt class="REPLACEABLE"><i>tar czvf ArchiveName.tar.gz *</i></tt> <em>will</em> include dotfiles in subdirectories <em>below</em> the current working directory. This is an undocumented GNU <b class="COMMAND">tar</b> <span class="QUOTE">"feature."</span></p>
      </td>
    </tr>
    <tr>
      <td align="left" valign="top" width="5%"><a name="FTN.AEN12840" href="filearchiv.html#AEN12840" id="FTN.AEN12840"><span class="footnote">[3]</span></a></td>
      <td align="left" valign="top" width="95%">
        <p>The checksum may be expressed as a <i class="FIRSTTERM">hexadecimal</i> number, or to some other base.</p>
      </td>
    </tr>
    <tr>
      <td align="left" valign="top" width="5%"><a name="FTN.AEN12849" href="filearchiv.html#AEN12849" id="FTN.AEN12849"><span class="footnote">[4]</span></a></td>
      <td align="left" valign="top" width="95%">
        <p>For even <em>better</em> security, use the <i class="FIRSTTERM">sha256sum</i>, <i class="FIRSTTERM">sha512</i>, and <i class="FIRSTTERM">sha1pass</i> commands.</p>
      </td>
    </tr>
    <tr>
      <td align="left" valign="top" width="5%"><a name="FTN.AEN12969" href="filearchiv.html#AEN12969" id="FTN.AEN12969"><span class="footnote">[5]</span></a></td>
      <td align="left" valign="top" width="95%">
        <p>This is a symmetric block cipher, used to encrypt files on a single system or local network, as opposed to the <i class="FIRSTTERM">public key</i> cipher class, of which <i class="FIRSTTERM">pgp</i> is a well-known example.</p>
      </td>
    </tr>
    <tr>
      <td align="left" valign="top" width="5%"><a name="FTN.AEN13030" href="filearchiv.html#AEN13030" id="FTN.AEN13030"><span class="footnote">[6]</span></a></td>
      <td align="left" valign="top" width="95%">
        <p>Creates a temporary <i class="FIRSTTERM">directory</i> when invoked with the <tt class="OPTION">-d</tt> option.</p>
      </td>
    </tr>
  </tbody></table>
  <div class="NAVFOOTER">
    <hr align="left" width="100%">
    <table summary="Footer navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tbody><tr>
        <td width="33%" align="left" valign="top"><a href="textproc.html" accesskey="P">Prev</a></td>
        <td width="34%" align="center" valign="top"><a href="index.html" accesskey="H">Home</a></td>
        <td width="33%" align="right" valign="top"><a href="communications.html" accesskey="N">Next</a></td>
      </tr>
      <tr>
        <td width="33%" align="left" valign="top">Text Processing Commands</td>
        <td width="34%" align="center" valign="top"><a href="external.html" accesskey="U">Up</a></td>
        <td width="33%" align="right" valign="top">Communications Commands</td>
      </tr>
    </tbody></table>
  </div>


</body></html>
