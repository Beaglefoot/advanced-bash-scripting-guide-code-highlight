<!DOCTYPE html><html><head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.7.28">
  <title>Using exec</title>
  <meta name="GENERATOR" content="Modular DocBook HTML Stylesheet Version 1.7">
  <link rel="HOME" title="Advanced Bash-Scripting Guide" href="index.html">
  <link rel="UP" title="I/O Redirection" href="io-redirection.html">
  <link rel="PREVIOUS" title="I/O Redirection" href="io-redirection.html">
  <link rel="NEXT" title="Redirecting Code Blocks" href="redircb.html">
<link rel="stylesheet" href="styles/custom.css"><link rel="stylesheet" href="styles/atom-one-dark.css"><script>
    document.addEventListener('DOMContentLoaded', () => {
      const manuallySetTheme = localStorage.getItem('bash-guide-theme');

      if (manuallySetTheme === 'dark') document.body.classList.add('dark-mode');
      else if (manuallySetTheme === 'light') document.body.classList.remove('dark-mode');
      else if (matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark-mode');
      }

      document.getElementById('theme-toggle').addEventListener(
        'click',
        () => {
          const isSet = document.body.classList.toggle('dark-mode');
          localStorage.setItem('bash-guide-theme', isSet ? 'dark' : 'light');
        }
      );
    });
  </script></head>
<body class="SECT1" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#840084" alink="#0000FF">
  <div class="NAVHEADER">
    <table summary="Header navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tbody><tr>
        <th colspan="3" align="center">Advanced Bash-Scripting Guide:</th>
      </tr>
      <tr>
        <td width="10%" align="left" valign="bottom"><a href="io-redirection.html" accesskey="P">Prev</a></td>
        <td width="80%" align="center" valign="bottom">Chapter 20. I/O Redirection</td>
        <td width="10%" align="right" valign="bottom"><a href="redircb.html" accesskey="N">Next</a></td>
      </tr>
    </tbody></table>
    <hr align="left" width="100%">
  </div>
  <div class="SECT1">
    <h1 class="SECT1"><a name="AEN17974" id="AEN17974"></a>20.1. Using <i class="FIRSTTERM">exec</i></h1>
    <p><a name="USINGEXECREF" id="USINGEXECREF"></a></p>
    <p>An <b class="COMMAND">exec &lt;filename</b> command redirects <tt class="FILENAME">stdin</tt> to a file. From that point on, all <tt class="FILENAME">stdin</tt> comes from that file, rather than its normal source (usually keyboard input). This provides a method of reading a file line by line and possibly parsing each line of input using <a href="sedawk.html#SEDREF">sed</a> and/or <a href="awk.html#AWKREF">awk</a>.</p>
    <div class="EXAMPLE">
      <a name="REDIR1" id="REDIR1"></a>
      <p><b>Example 20-1. Redirecting <tt class="FILENAME">stdin</tt> using <i class="FIRSTTERM">exec</i></b></p>
      <table border="0" bgcolor="#E0E0E0" width="100%">
        <tbody><tr>
          <td>
            <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># Redirecting stdin using 'exec'.</span>


<span class="hljs-built_in">exec</span> 6&lt;&amp;0          <span class="hljs-comment"># Link file descriptor #6 with stdin.</span>
                   <span class="hljs-comment"># Saves stdin.</span>

<span class="hljs-built_in">exec</span> &lt; data-file   <span class="hljs-comment"># stdin replaced by file "data-file"</span>

<span class="hljs-built_in">read</span> a1            <span class="hljs-comment"># Reads first line of file "data-file".</span>
<span class="hljs-built_in">read</span> a2            <span class="hljs-comment"># Reads second line of file "data-file."</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Following lines read from file."</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"-------------------------------"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$a1</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$a2</span>

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>

<span class="hljs-built_in">exec</span> 0&lt;&amp;6 6&lt;&amp;-
<span class="hljs-comment">#  Now restore stdin from fd #6, where it had been saved,</span>
<span class="hljs-comment">#+ and close fd #6 ( 6&lt;&amp;- ) to free it for other processes to use.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># &lt;&amp;6 6&lt;&amp;-    also works.</span>

<span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Enter data  "</span>
<span class="hljs-built_in">read</span> b1  <span class="hljs-comment"># Now "read" functions as expected, reading from normal stdin.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Input read from stdin."</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"----------------------"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"b1 = <span class="hljs-variable">$b1</span>"</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">exit</span> 0</pre>
          </td>
        </tr>
      </tbody></table>
    </div>
    <p>Similarly, an <b class="COMMAND">exec &gt;filename</b> command redirects <tt class="FILENAME">stdout</tt> to a designated file. This sends all command output that would normally go to <tt class="FILENAME">stdout</tt> to that file.</p>
    <div class="IMPORTANT">
      <table class="IMPORTANT" width="100%" border="0">
        <tbody><tr>
          <td width="25" align="center" valign="top"><img src="images/important.gif" hspace="5" alt="Important"></td>
          <td align="left" valign="top">
            <p><b class="COMMAND">exec N &gt; filename</b> affects the entire script or <i class="FIRSTTERM">current shell</i>. Redirection in the <a href="special-chars.html#PROCESSIDREF">PID</a> of the script or shell from that point on has changed. However . . .</p>
            <p><b class="COMMAND">N &gt; filename</b> affects only the newly-forked process, not the entire script or shell.</p>
            <p>Thank you, Ahmed Darwish, for pointing this out.</p>
          </td>
        </tr>
      </tbody></table>
    </div>
    <div class="EXAMPLE">
      <a name="REASSIGNSTDOUT" id="REASSIGNSTDOUT"></a>
      <p><b>Example 20-2. Redirecting <tt class="FILENAME">stdout</tt> using <i class="FIRSTTERM">exec</i></b></p>
      <table border="0" bgcolor="#E0E0E0" width="100%">
        <tbody><tr>
          <td>
            <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># reassign-stdout.sh</span>

LOGFILE=logfile.txt

<span class="hljs-built_in">exec</span> 6&gt;&amp;1           <span class="hljs-comment"># Link file descriptor #6 with stdout.</span>
                    <span class="hljs-comment"># Saves stdout.</span>

<span class="hljs-built_in">exec</span> &gt; <span class="hljs-variable">$LOGFILE</span>     <span class="hljs-comment"># stdout replaced with file "logfile.txt".</span>

<span class="hljs-comment"># ----------------------------------------------------------- #</span>
<span class="hljs-comment"># All output from commands in this block sent to file $LOGFILE.</span>

<span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Logfile: "</span>
date
<span class="hljs-built_in">echo</span> <span class="hljs-string">"-------------------------------------"</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Output of \"ls -al\" command"</span>
<span class="hljs-built_in">echo</span>
ls -al
<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Output of \"df\" command"</span>
<span class="hljs-built_in">echo</span>
df

<span class="hljs-comment"># ----------------------------------------------------------- #</span>

<span class="hljs-built_in">exec</span> 1&gt;&amp;6 6&gt;&amp;-      <span class="hljs-comment"># Restore stdout and close file descriptor #6.</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"== stdout now restored to default == "</span>
<span class="hljs-built_in">echo</span>
ls -al
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">exit</span> 0</pre>
          </td>
        </tr>
      </tbody></table>
    </div>
    <div class="EXAMPLE">
      <a name="UPPERCONV" id="UPPERCONV"></a>
      <p><b>Example 20-3. Redirecting both <tt class="FILENAME">stdin</tt> and <tt class="FILENAME">stdout</tt> in the same script with <i class="FIRSTTERM">exec</i></b></p>
      <table border="0" bgcolor="#E0E0E0" width="100%">
        <tbody><tr>
          <td>
            <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># upperconv.sh</span>
<span class="hljs-comment"># Converts a specified input file to uppercase.</span>

E_FILE_ACCESS=70
E_WRONG_ARGS=71

<span class="hljs-keyword">if</span> [ ! -r <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]     <span class="hljs-comment"># Is specified input file readable?</span>
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Can't read from input file!"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$0</span> input-file output-file"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_FILE_ACCESS</span>
<span class="hljs-keyword">fi</span>                   <span class="hljs-comment">#  Will exit with same error</span>
                     <span class="hljs-comment">#+ even if input file ($1) not specified (why?).</span>

<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Need to specify output file."</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$0</span> input-file output-file"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_WRONG_ARGS</span>
<span class="hljs-keyword">fi</span>


<span class="hljs-built_in">exec</span> 4&lt;&amp;0
<span class="hljs-built_in">exec</span> &lt; <span class="hljs-variable">$1</span>            <span class="hljs-comment"># Will read from input file.</span>

<span class="hljs-built_in">exec</span> 7&gt;&amp;1
<span class="hljs-built_in">exec</span> &gt; <span class="hljs-variable">$2</span>            <span class="hljs-comment"># Will write to output file.</span>
                     <span class="hljs-comment"># Assumes output file writable (add check?).</span>

<span class="hljs-comment"># -----------------------------------------------</span>
    cat - | tr a-z A-Z   <span class="hljs-comment"># Uppercase conversion.</span>
<span class="hljs-comment">#   ^^^^^                # Reads from stdin.</span>
<span class="hljs-comment">#           ^^^^^^^^^^   # Writes to stdout.</span>
<span class="hljs-comment"># However, both stdin and stdout were redirected.</span>
<span class="hljs-comment"># Note that the 'cat' can be omitted.</span>
<span class="hljs-comment"># -----------------------------------------------</span>

<span class="hljs-built_in">exec</span> 1&gt;&amp;7 7&gt;&amp;-       <span class="hljs-comment"># Restore stout.</span>
<span class="hljs-built_in">exec</span> 0&lt;&amp;4 4&lt;&amp;-       <span class="hljs-comment"># Restore stdin.</span>

<span class="hljs-comment"># After restoration, the following line prints to stdout as expected.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"File \"<span class="hljs-variable">$1</span>\" written to \"<span class="hljs-variable">$2</span>\" as uppercase conversion."</span>

<span class="hljs-built_in">exit</span> 0</pre>
          </td>
        </tr>
      </tbody></table>
    </div>
    <p>I/O redirection is a clever way of avoiding the dreaded <a href="subshells.html#PARVIS">inaccessible variables within a subshell</a> problem.</p>
    <div class="EXAMPLE">
      <a name="AVOIDSUBSHELL" id="AVOIDSUBSHELL"></a>
      <p><b>Example 20-4. Avoiding a subshell</b></p>
      <table border="0" bgcolor="#E0E0E0" width="100%">
        <tbody><tr>
          <td>
            <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># avoid-subshell.sh</span>
<span class="hljs-comment"># Suggested by Matthew Walker.</span>

Lines=0

<span class="hljs-built_in">echo</span>

cat myfile.txt | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line;
                 <span class="hljs-keyword">do</span> {
                   <span class="hljs-built_in">echo</span> <span class="hljs-variable">$line</span>
                   (( Lines++ ));  <span class="hljs-comment">#  Incremented values of this variable</span>
                                   <span class="hljs-comment">#+ inaccessible outside loop.</span>
                                   <span class="hljs-comment">#  Subshell problem.</span>
                 }
                 <span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Number of lines read = <span class="hljs-variable">$Lines</span>"</span>     <span class="hljs-comment"># 0</span>
                                         <span class="hljs-comment"># Wrong!</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"------------------------"</span>


<span class="hljs-built_in">exec</span> 3&lt;&gt; myfile.txt
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line &lt;&amp;3
<span class="hljs-keyword">do</span> {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>
  (( Lines++ ));                   <span class="hljs-comment">#  Incremented values of this variable</span>
                                   <span class="hljs-comment">#+ accessible outside loop.</span>
                                   <span class="hljs-comment">#  No subshell, no problem.</span>
}
<span class="hljs-keyword">done</span>
<span class="hljs-built_in">exec</span> 3&gt;&amp;-

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Number of lines read = <span class="hljs-variable">$Lines</span>"</span>     <span class="hljs-comment"># 8</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">exit</span> 0

<span class="hljs-comment"># Lines below not seen by script.</span>

$ cat myfile.txt

Line 1.
Line 2.
Line 3.
Line 4.
Line 5.
Line 6.
Line 7.
Line 8.</pre>
          </td>
        </tr>
      </tbody></table>
    </div>
  </div>
  <div class="NAVFOOTER">
    <hr align="left" width="100%">
    <table summary="Footer navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tbody><tr>
        <td width="33%" align="left" valign="top"><a href="io-redirection.html" accesskey="P">Prev</a></td>
        <td width="34%" align="center" valign="top"><a href="index.html" accesskey="H">Home</a></td>
        <td width="33%" align="right" valign="top"><a href="redircb.html" accesskey="N">Next</a></td>
      </tr>
      <tr>
        <td width="33%" align="left" valign="top">I/O Redirection</td>
        <td width="34%" align="center" valign="top"><a href="io-redirection.html" accesskey="U">Up</a></td>
        <td width="33%" align="right" valign="top">Redirecting Code Blocks</td>
      </tr>
    </tbody></table>
  </div>


<button id="theme-toggle">Toggle theme</button></body></html>
