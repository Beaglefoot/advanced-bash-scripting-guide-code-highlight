<!DOCTYPE html><html><head>
    <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.7.28">
    <title>Contributed Scripts</title>
    <meta name="GENERATOR" content="Modular DocBook HTML Stylesheet Version 1.7">
    <link rel="HOME" title="Advanced Bash-Scripting Guide" href="index.html">
    <link rel="PREVIOUS" title="Bibliography" href="biblio.html">
    <link rel="NEXT" title="Reference Cards" href="refcards.html">
  <link rel="stylesheet" href="styles/custom.css"><link rel="stylesheet" href="styles/atom-one-dark.css"><script>
    document.addEventListener('DOMContentLoaded', () => {
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark-mode');
      }

      document.getElementById('theme-toggle').addEventListener(
        'click',
        () => document.body.classList.toggle('dark-mode')
      );
    });
  </script></head>
  <body class="APPENDIX" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#840084" alink="#0000FF">
    <div class="NAVHEADER">
      <table summary="Header navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
        <tbody><tr>
          <th colspan="3" align="center">Advanced Bash-Scripting Guide:</th>
        </tr>
        <tr>
          <td width="10%" align="left" valign="bottom">
            <a href="biblio.html" accesskey="P">Prev</a>
          </td>
          <td width="80%" align="center" valign="bottom"></td>
          <td width="10%" align="right" valign="bottom">
            <a href="refcards.html" accesskey="N">Next</a>
          </td>
        </tr>
      </tbody></table>
      <hr align="left" width="100%">
    </div>
    <div class="APPENDIX">
      <h1>
        <a name="CONTRIBUTED-SCRIPTS" id="CONTRIBUTED-SCRIPTS"></a>Appendix A.
        Contributed Scripts
      </h1>
      <p>
        These scripts, while not fitting into the text of this document, do
        illustrate some interesting shell programming techniques. Some are
        useful, too. Have fun analyzing and running them.
      </p>
      <div class="EXAMPLE">
        <a name="MAILFORMAT" id="MAILFORMAT"></a>
        <p>
          <b>Example A-1. <i class="FIRSTTERM">mailformat</i>: Formatting an
            e-mail message</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># mail-format.sh (ver. 1.1): Format e-mail messages.</span>

<span class="hljs-comment"># Gets rid of carets, tabs, and also folds excessively long lines.</span>

<span class="hljs-comment"># =================================================================</span>
<span class="hljs-comment">#                 Standard Check for Script Argument(s)</span>
ARGS=1
E_BADARGS=85
E_NOFILE=86

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ne <span class="hljs-variable">$ARGS</span> ]  <span class="hljs-comment"># Correct number of arguments passed to script?</span>
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` filename"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BADARGS</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ -f <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]       <span class="hljs-comment"># Check if file exists.</span>
<span class="hljs-keyword">then</span>
    file_name=<span class="hljs-variable">$1</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"File \"<span class="hljs-variable">$1</span>\" does not exist."</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOFILE</span>
<span class="hljs-keyword">fi</span>
<span class="hljs-comment"># -----------------------------------------------------------------</span>

MAXWIDTH=70          <span class="hljs-comment"># Width to fold excessively long lines to.</span>

<span class="hljs-comment"># =================================</span>
<span class="hljs-comment"># A variable can hold a sed script.</span>
<span class="hljs-comment"># It's a useful technique.</span>
sedscript=<span class="hljs-string">'s/^&gt;//
s/^  *&gt;//
s/^  *//
s/              *//'</span>
<span class="hljs-comment"># =================================</span>

<span class="hljs-comment">#  Delete carets and tabs at beginning of lines,</span>
<span class="hljs-comment">#+ then fold lines to $MAXWIDTH characters.</span>
sed <span class="hljs-string">"<span class="hljs-variable">$sedscript</span>"</span> <span class="hljs-variable">$1</span> | fold -s --width=<span class="hljs-variable">$MAXWIDTH</span>
                        <span class="hljs-comment">#  -s option to "fold"</span>
                        <span class="hljs-comment">#+ breaks lines at whitespace, if possible.</span>


<span class="hljs-comment">#  This script was inspired by an article in a well-known trade journal</span>
<span class="hljs-comment">#+ extolling a 164K MS Windows utility with similar functionality.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  An nice set of text processing utilities and an efficient</span>
<span class="hljs-comment">#+ scripting language provide an alternative to the bloated executables</span>
<span class="hljs-comment">#+ of a clunky operating system.</span>

<span class="hljs-built_in">exit</span> $?</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="RN" id="RN"></a>
        <p>
          <b>Example A-2. <i class="FIRSTTERM">rn</i>: A simple-minded file
            renaming utility</b>
        </p>
        <p>
          This script is a modification of
          <a href="textproc.html#LOWERCASE">Example 16-22</a>.
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#! /bin/bash</span>
<span class="hljs-comment"># rn.sh</span>

<span class="hljs-comment"># Very simpleminded filename "rename" utility (based on "lowercase.sh").</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  The "ren" utility, by Vladimir Lanin (lanin@csd2.nyu.edu),</span>
<span class="hljs-comment">#+ does a much better job of this.</span>


ARGS=2
E_BADARGS=85
ONE=1                     <span class="hljs-comment"># For getting singular/plural right (see below).</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ne <span class="hljs-string">"<span class="hljs-variable">$ARGS</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` old-pattern new-pattern"</span>
  <span class="hljs-comment"># As in "rn gif jpg", which renames all gif files in working directory to jpg.</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BADARGS</span>
<span class="hljs-keyword">fi</span>

number=0                  <span class="hljs-comment"># Keeps track of how many files actually renamed.</span>


<span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> *<span class="hljs-variable">$1</span>*      <span class="hljs-comment">#Traverse all matching files in directory.</span>
<span class="hljs-keyword">do</span>
   <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">"<span class="hljs-variable">$filename</span>"</span> ]  <span class="hljs-comment"># If finds match...</span>
   <span class="hljs-keyword">then</span>
     fname=`basename <span class="hljs-variable">$filename</span>`            <span class="hljs-comment"># Strip off path.</span>
     n=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$fname</span> | sed -e <span class="hljs-string">"s/<span class="hljs-variable">$1</span>/<span class="hljs-variable">$2</span>/"</span>`   <span class="hljs-comment"># Substitute new for old in filename.</span>
     mv <span class="hljs-variable">$fname</span> <span class="hljs-variable">$n</span>                          <span class="hljs-comment"># Rename.</span>
     <span class="hljs-built_in">let</span> <span class="hljs-string">"number += 1"</span>
   <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>   

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$number</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$ONE</span>"</span> ]                <span class="hljs-comment"># For correct grammar.</span>
<span class="hljs-keyword">then</span>
 <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$number</span> file renamed."</span>
<span class="hljs-keyword">else</span> 
 <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$number</span> files renamed."</span>
<span class="hljs-keyword">fi</span> 

<span class="hljs-built_in">exit</span> $?


<span class="hljs-comment"># Exercises:</span>
<span class="hljs-comment"># ---------</span>
<span class="hljs-comment"># What types of files will this not work on?</span>
<span class="hljs-comment"># How can this be fixed?</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="BLANKRENAME" id="BLANKRENAME"></a>
        <p>
          <b>Example A-3. <i class="FIRSTTERM">blank-rename</i>: Renames
            filenames containing blanks</b>
        </p>
        <p>This is an even simpler-minded version of previous script.</p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#! /bin/bash</span>
<span class="hljs-comment"># blank-rename.sh</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Substitutes underscores for blanks in all the filenames in a directory.</span>

ONE=1                     <span class="hljs-comment"># For getting singular/plural right (see below).</span>
number=0                  <span class="hljs-comment"># Keeps track of how many files actually renamed.</span>
FOUND=0                   <span class="hljs-comment"># Successful return value.</span>

<span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> *         <span class="hljs-comment">#Traverse all files in directory.</span>
<span class="hljs-keyword">do</span>
     <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$filename</span>"</span> | grep -q <span class="hljs-string">" "</span>         <span class="hljs-comment">#  Check whether filename</span>
     <span class="hljs-keyword">if</span> [ $? -eq <span class="hljs-variable">$FOUND</span> ]                   <span class="hljs-comment">#+ contains space(s).</span>
     <span class="hljs-keyword">then</span>
       fname=<span class="hljs-variable">$filename</span>                      <span class="hljs-comment"># Yes, this filename needs work.</span>
       n=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$fname</span> | sed -e <span class="hljs-string">"s/ /_/g"</span>`   <span class="hljs-comment"># Substitute underscore for blank.</span>
       mv <span class="hljs-string">"<span class="hljs-variable">$fname</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$n</span>"</span>                     <span class="hljs-comment"># Do the actual renaming.</span>
       <span class="hljs-built_in">let</span> <span class="hljs-string">"number += 1"</span>
     <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>   

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$number</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$ONE</span>"</span> ]                 <span class="hljs-comment"># For correct grammar.</span>
<span class="hljs-keyword">then</span>
 <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$number</span> file renamed."</span>
<span class="hljs-keyword">else</span> 
 <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$number</span> files renamed."</span>
<span class="hljs-keyword">fi</span> 

<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="ENCRYPTEDPW" id="ENCRYPTEDPW"></a>
        <p>
          <b>Example A-4. <i class="FIRSTTERM">encryptedpw</i>: Uploading to an
            ftp site, using a locally encrypted password</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># Example "ex72.sh" modified to use encrypted password.</span>

<span class="hljs-comment">#  Note that this is still rather insecure,</span>
<span class="hljs-comment">#+ since the decrypted password is sent in the clear.</span>
<span class="hljs-comment">#  Use something like "ssh" if this is a concern.</span>

E_BADARGS=85

<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` filename"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BADARGS</span>
<span class="hljs-keyword">fi</span>  

Username=bozo           <span class="hljs-comment"># Change to suit.</span>
pword=/home/bozo/secret/password_encrypted.file
<span class="hljs-comment"># File containing encrypted password.</span>

Filename=`basename <span class="hljs-variable">$1</span>`  <span class="hljs-comment"># Strips pathname out of file name.</span>

Server=<span class="hljs-string">"XXX"</span>
Directory=<span class="hljs-string">"YYY"</span>         <span class="hljs-comment"># Change above to actual server name &amp; directory.</span>


Password=`cruft &lt;<span class="hljs-variable">$pword</span>`          <span class="hljs-comment"># Decrypt password.</span>
<span class="hljs-comment">#  Uses the author's own "cruft" file encryption package,</span>
<span class="hljs-comment">#+ based on the classic "onetime pad" algorithm,</span>
<span class="hljs-comment">#+ and obtainable from:</span>
<span class="hljs-comment">#+ Primary-site:   ftp://ibiblio.org/pub/Linux/utils/file</span>
<span class="hljs-comment">#+                 cruft-0.2.tar.gz [16k]</span>


ftp -n <span class="hljs-variable">$Server</span> &lt;&lt;End-Of-Session
user <span class="hljs-variable">$Username</span> <span class="hljs-variable">$Password</span>
binary
bell
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$Directory</span>
put <span class="hljs-variable">$Filename</span>
<span class="hljs-built_in">bye</span>
End-Of-Session
<span class="hljs-comment"># -n option to "ftp" disables auto-logon.</span>
<span class="hljs-comment"># Note that "bell" rings 'bell' after each file transfer.</span>

<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="COPYCD" id="COPYCD"></a>
        <p>
          <b>Example A-5. <i class="FIRSTTERM">copy-cd</i>: Copying a data CD</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># copy-cd.sh: copying a data CD</span>

CDROM=/dev/cdrom                           <span class="hljs-comment"># CD ROM device</span>
OF=/home/bozo/projects/cdimage.iso         <span class="hljs-comment"># output file</span>
<span class="hljs-comment">#       /xxxx/xxxxxxxx/                      Change to suit your system.</span>
BLOCKSIZE=2048
<span class="hljs-comment"># SPEED=10                                 # If unspecified, uses max spd.</span>
<span class="hljs-comment"># DEVICE=/dev/cdrom                          older version.</span>
DEVICE=<span class="hljs-string">"1,0,0"</span>

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"Insert source CD, but do *not* mount it."</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Press ENTER when ready. "</span>
<span class="hljs-built_in">read</span> ready                                 <span class="hljs-comment"># Wait for input, $ready not used.</span>

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"Copying the source CD to <span class="hljs-variable">$OF</span>."</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"This may take a while. Please be patient."</span>

dd <span class="hljs-keyword">if</span>=<span class="hljs-variable">$CDROM</span> of=<span class="hljs-variable">$OF</span> bs=<span class="hljs-variable">$BLOCKSIZE</span>          <span class="hljs-comment"># Raw device copy.</span>


<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"Remove data CD."</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Insert blank CDR."</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Press ENTER when ready. "</span>
<span class="hljs-built_in">read</span> ready                                 <span class="hljs-comment"># Wait for input, $ready not used.</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Copying <span class="hljs-variable">$OF</span> to CDR."</span>

<span class="hljs-comment"># cdrecord -v -isosize speed=$SPEED dev=$DEVICE $OF   # Old version.</span>
wodim -v -isosize dev=<span class="hljs-variable">$DEVICE</span> <span class="hljs-variable">$OF</span>
<span class="hljs-comment"># Uses Joerg Schilling's "cdrecord" package (see its docs).</span>
<span class="hljs-comment"># http://www.fokus.gmd.de/nthp/employees/schilling/cdrecord.html</span>
<span class="hljs-comment"># Newer Linux distros may use "wodim" rather than "cdrecord" ...</span>


<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"Done copying <span class="hljs-variable">$OF</span> to CDR on device <span class="hljs-variable">$CDROM</span>."</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Do you want to erase the image file (y/n)? "</span>  <span class="hljs-comment"># Probably a huge file.</span>
<span class="hljs-built_in">read</span> answer

<span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$answer</span>"</span> <span class="hljs-keyword">in</span>
[yY]) rm -f <span class="hljs-variable">$OF</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$OF</span> erased."</span>
      ;;
*)    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$OF</span> not erased."</span>;;
<span class="hljs-keyword">esac</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># Exercise:</span>
<span class="hljs-comment"># Change the above "case" statement to also accept "yes" and "Yes" as input.</span>

<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="COLLATZ" id="COLLATZ"></a>
        <p><b>Example A-6. Collatz series</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># collatz.sh</span>

<span class="hljs-comment">#  The notorious "hailstone" or Collatz series.</span>
<span class="hljs-comment">#  -------------------------------------------</span>
<span class="hljs-comment">#  1) Get the integer "seed" from the command-line.</span>
<span class="hljs-comment">#  2) NUMBER &lt;-- seed</span>
<span class="hljs-comment">#  3) Print NUMBER.</span>
<span class="hljs-comment">#  4)  If NUMBER is even, divide by 2, or</span>
<span class="hljs-comment">#  5)+ if odd, multiply by 3 and add 1.</span>
<span class="hljs-comment">#  6) NUMBER &lt;-- result </span>
<span class="hljs-comment">#  7) Loop back to step 3 (for specified number of iterations).</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  The theory is that every such sequence,</span>
<span class="hljs-comment">#+ no matter how large the initial value,</span>
<span class="hljs-comment">#+ eventually settles down to repeating "4,2,1..." cycles,</span>
<span class="hljs-comment">#+ even after fluctuating through a wide range of values.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  This is an instance of an "iterate,"</span>
<span class="hljs-comment">#+ an operation that feeds its output back into its input.</span>
<span class="hljs-comment">#  Sometimes the result is a "chaotic" series.</span>


MAX_ITERATIONS=200
<span class="hljs-comment"># For large seed numbers (&gt;32000), try increasing MAX_ITERATIONS.</span>

h=<span class="hljs-variable">${1:-$$}</span>                      <span class="hljs-comment">#  Seed.</span>
                                <span class="hljs-comment">#  Use $PID as seed,</span>
                                <span class="hljs-comment">#+ if not specified as command-line arg.</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"C(<span class="hljs-variable">$h</span>) -*- <span class="hljs-variable">$MAX_ITERATIONS</span> Iterations"</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-keyword">for</span> ((i=1; i&lt;=MAX_ITERATIONS; i++))
<span class="hljs-keyword">do</span>

<span class="hljs-comment"># echo -n "$h   "</span>
<span class="hljs-comment">#            ^^^ </span>
<span class="hljs-comment">#            tab</span>
<span class="hljs-comment"># printf does it better ...</span>
COLWIDTH=%7d
<span class="hljs-built_in">printf</span> <span class="hljs-variable">$COLWIDTH</span> <span class="hljs-variable">$h</span>

  <span class="hljs-built_in">let</span> <span class="hljs-string">"remainder = h % 2"</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$remainder</span>"</span> -eq 0 ]   <span class="hljs-comment"># Even?</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"h /= 2"</span>              <span class="hljs-comment"># Divide by 2.</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"h = h*3 + 1"</span>         <span class="hljs-comment"># Multiply by 3 and add 1.</span>
  <span class="hljs-keyword">fi</span>


COLUMNS=10                    <span class="hljs-comment"># Output 10 values per line.</span>
<span class="hljs-built_in">let</span> <span class="hljs-string">"line_break = i % <span class="hljs-variable">$COLUMNS</span>"</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$line_break</span>"</span> -eq 0 ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span>
<span class="hljs-keyword">fi</span>  

<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-comment">#  For more information on this strange mathematical function,</span>
<span class="hljs-comment">#+ see _Computers, Pattern, Chaos, and Beauty_, by Pickover, p. 185 ff.,</span>
<span class="hljs-comment">#+ as listed in the bibliography.</span>

<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p><a name="DAYSBETWEEN0" id="DAYSBETWEEN0"></a></p>
      <div class="EXAMPLE">
        <a name="DAYSBETWEEN" id="DAYSBETWEEN"></a>
        <p>
          <b>Example A-7. <i class="FIRSTTERM">days-between</i>: Days between
            two dates</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># days-between.sh:    Number of days between two dates.</span>
<span class="hljs-comment"># Usage: ./days-between.sh [M]M/[D]D/YYYY [M]M/[D]D/YYYY</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Note: Script modified to account for changes in Bash, v. 2.05b +,</span>
<span class="hljs-comment">#+      that closed the loophole permitting large negative</span>
<span class="hljs-comment">#+      integer return values.</span>

ARGS=2                <span class="hljs-comment"># Two command-line parameters expected.</span>
E_PARAM_ERR=85        <span class="hljs-comment"># Param error.</span>

REFYR=1600            <span class="hljs-comment"># Reference year.</span>
CENTURY=100
DIY=365
ADJ_DIY=367           <span class="hljs-comment"># Adjusted for leap year + fraction.</span>
MIY=12
DIM=31
LEAPCYCLE=4

MAXRETVAL=255         <span class="hljs-comment">#  Largest permissible</span>
                      <span class="hljs-comment">#+ positive return value from a function.</span>

diff=                 <span class="hljs-comment"># Declare global variable for date difference.</span>
value=                <span class="hljs-comment"># Declare global variable for absolute value.</span>
day=                  <span class="hljs-comment"># Declare globals for day, month, year.</span>
month=
year=


Param_Error ()        <span class="hljs-comment"># Command-line parameters wrong.</span>
{
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` [M]M/[D]D/YYYY [M]M/[D]D/YYYY"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"       (date must be after 1/3/1600)"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_PARAM_ERR</span>
}  


Parse_Date ()                 <span class="hljs-comment"># Parse date from command-line params.</span>
{
  month=<span class="hljs-variable">${1%%/**}</span>
  dm=<span class="hljs-variable">${1%/**}</span>                 <span class="hljs-comment"># Day and month.</span>
  day=<span class="hljs-variable">${dm#*/}</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"year = `basename <span class="hljs-variable">$1</span>`"</span>  <span class="hljs-comment"># Not a filename, but works just the same.</span>
}  


check_date ()                 <span class="hljs-comment"># Checks for invalid date(s) passed.</span>
{
  [ <span class="hljs-string">"<span class="hljs-variable">$day</span>"</span> -gt <span class="hljs-string">"<span class="hljs-variable">$DIM</span>"</span> ] || [ <span class="hljs-string">"<span class="hljs-variable">$month</span>"</span> -gt <span class="hljs-string">"<span class="hljs-variable">$MIY</span>"</span> ] ||
  [ <span class="hljs-string">"<span class="hljs-variable">$year</span>"</span> -lt <span class="hljs-string">"<span class="hljs-variable">$REFYR</span>"</span> ] &amp;&amp; Param_Error
  <span class="hljs-comment"># Exit script on bad value(s).</span>
  <span class="hljs-comment"># Uses or-list / and-list.</span>
  <span class="hljs-comment">#</span>
  <span class="hljs-comment"># Exercise: Implement more rigorous date checking.</span>
}


strip_leading_zero () <span class="hljs-comment">#  Better to strip possible leading zero(s)</span>
{                     <span class="hljs-comment">#+ from day and/or month</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">${1#0}</span>       <span class="hljs-comment">#+ since otherwise Bash will interpret them</span>
}                     <span class="hljs-comment">#+ as octal values (POSIX.2, sect 2.9.2.1).</span>


day_index ()          <span class="hljs-comment"># Gauss' Formula:</span>
{                     <span class="hljs-comment"># Days from March 1, 1600 to date passed as param.</span>
                      <span class="hljs-comment">#           ^^^^^^^^^^^^^</span>
  day=<span class="hljs-variable">$1</span>
  month=<span class="hljs-variable">$2</span>
  year=<span class="hljs-variable">$3</span>

  <span class="hljs-built_in">let</span> <span class="hljs-string">"month = <span class="hljs-variable">$month</span> - 2"</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$month</span>"</span> -le 0 ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"month += 12"</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"year -= 1"</span>
  <span class="hljs-keyword">fi</span>  

  <span class="hljs-built_in">let</span> <span class="hljs-string">"year -= <span class="hljs-variable">$REFYR</span>"</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"indexyr = <span class="hljs-variable">$year</span> / <span class="hljs-variable">$CENTURY</span>"</span>


  <span class="hljs-built_in">let</span> <span class="hljs-string">"Days = <span class="hljs-variable">$DIY</span>*<span class="hljs-variable">$year</span> + <span class="hljs-variable">$year</span>/<span class="hljs-variable">$LEAPCYCLE</span> - <span class="hljs-variable">$indexyr</span> \
              + <span class="hljs-variable">$indexyr</span>/<span class="hljs-variable">$LEAPCYCLE</span> + <span class="hljs-variable">$ADJ_DIY</span>*<span class="hljs-variable">$month</span>/<span class="hljs-variable">$MIY</span> + <span class="hljs-variable">$day</span> - <span class="hljs-variable">$DIM</span>"</span>
  <span class="hljs-comment">#  For an in-depth explanation of this algorithm, see</span>
  <span class="hljs-comment">#+   http://weblogs.asp.net/pgreborio/archive/2005/01/06/347968.aspx</span>


  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$Days</span>

}  


calculate_difference ()            <span class="hljs-comment"># Difference between two day indices.</span>
{
  <span class="hljs-built_in">let</span> <span class="hljs-string">"diff = <span class="hljs-variable">$1</span> - <span class="hljs-variable">$2</span>"</span>             <span class="hljs-comment"># Global variable.</span>
}  


abs ()                             <span class="hljs-comment">#  Absolute value</span>
{                                  <span class="hljs-comment">#  Uses global "value" variable.</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> -lt 0 ]                <span class="hljs-comment">#  If negative</span>
  <span class="hljs-keyword">then</span>                             <span class="hljs-comment">#+ then</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"value = 0 - <span class="hljs-variable">$1</span>"</span>           <span class="hljs-comment">#+ change sign,</span>
  <span class="hljs-keyword">else</span>                             <span class="hljs-comment">#+ else</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"value = <span class="hljs-variable">$1</span>"</span>               <span class="hljs-comment">#+ leave it alone.</span>
  <span class="hljs-keyword">fi</span>
}



<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ne <span class="hljs-string">"<span class="hljs-variable">$ARGS</span>"</span> ]              <span class="hljs-comment"># Require two command-line params.</span>
<span class="hljs-keyword">then</span>
  Param_Error
<span class="hljs-keyword">fi</span>  

Parse_Date <span class="hljs-variable">$1</span>
check_date <span class="hljs-variable">$day</span> <span class="hljs-variable">$month</span> <span class="hljs-variable">$year</span>       <span class="hljs-comment">#  See if valid date.</span>

strip_leading_zero <span class="hljs-variable">$day</span>            <span class="hljs-comment">#  Remove any leading zeroes</span>
day=$?                             <span class="hljs-comment">#+ on day and/or month.</span>
strip_leading_zero <span class="hljs-variable">$month</span>
month=$?

<span class="hljs-built_in">let</span> <span class="hljs-string">"date1 = `day_index <span class="hljs-variable">$day</span> <span class="hljs-variable">$month</span> <span class="hljs-variable">$year</span>`"</span>


Parse_Date <span class="hljs-variable">$2</span>
check_date <span class="hljs-variable">$day</span> <span class="hljs-variable">$month</span> <span class="hljs-variable">$year</span>

strip_leading_zero <span class="hljs-variable">$day</span>
day=$?
strip_leading_zero <span class="hljs-variable">$month</span>
month=$?

date2=$(day_index <span class="hljs-variable">$day</span> <span class="hljs-variable">$month</span> <span class="hljs-variable">$year</span>) <span class="hljs-comment"># Command substitution.</span>


calculate_difference <span class="hljs-variable">$date1</span> <span class="hljs-variable">$date2</span>

abs <span class="hljs-variable">$diff</span>                            <span class="hljs-comment"># Make sure it's positive.</span>
diff=<span class="hljs-variable">$value</span>

<span class="hljs-built_in">echo</span> <span class="hljs-variable">$diff</span>

<span class="hljs-built_in">exit</span> 0

<span class="hljs-comment">#  Exercise:</span>
<span class="hljs-comment">#  --------</span>
<span class="hljs-comment">#  If given only one command-line parameter, have the script</span>
<span class="hljs-comment">#+ use today's date as the second.</span>


<span class="hljs-comment">#  Compare this script with</span>
<span class="hljs-comment">#+ the implementation of Gauss' Formula in a C program at</span>
<span class="hljs-comment">#+    http://buschencrew.hypermart.net/software/datedif</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="MAKEDICT" id="MAKEDICT"></a>
        <p>
          <b>Example A-8. Making a <i class="FIRSTTERM">dictionary</i></b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># makedict.sh  [make dictionary]</span>

<span class="hljs-comment"># Modification of /usr/sbin/mkdict (/usr/sbin/cracklib-forman) script.</span>
<span class="hljs-comment"># Original script copyright 1993, by Alec Muffett.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  This modified script included in this document in a manner</span>
<span class="hljs-comment">#+ consistent with the "LICENSE" document of the "Crack" package</span>
<span class="hljs-comment">#+ that the original script is a part of.</span>

<span class="hljs-comment">#  This script processes text files to produce a sorted list</span>
<span class="hljs-comment">#+ of words found in the files.</span>
<span class="hljs-comment">#  This may be useful for compiling dictionaries</span>
<span class="hljs-comment">#+ and for other lexicographic purposes.</span>


E_BADARGS=85

<span class="hljs-keyword">if</span> [ ! -r <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]                    <span class="hljs-comment">#  Need at least one</span>
<span class="hljs-keyword">then</span>                                <span class="hljs-comment">#+ valid file argument.</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$0</span> files-to-process"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BADARGS</span>
<span class="hljs-keyword">fi</span>  


<span class="hljs-comment"># SORT="sort"                       #  No longer necessary to define</span>
                                    <span class="hljs-comment">#+ options to sort. Changed from</span>
                                    <span class="hljs-comment">#+ original script.</span>

cat $* |                            <span class="hljs-comment">#  Dump specified files to stdout.</span>
        tr A-Z a-z |                <span class="hljs-comment">#  Convert to lowercase.</span>
        tr <span class="hljs-string">' '</span> <span class="hljs-string">'\012'</span> |             <span class="hljs-comment">#  New: change spaces to newlines.</span>
<span class="hljs-comment">#       tr -cd '\012[a-z][0-9]' |   #  Get rid of everything</span>
                                    <span class="hljs-comment">#+ non-alphanumeric (in orig. script).</span>
        tr -c <span class="hljs-string">'\012a-z'</span>  <span class="hljs-string">'\012'</span> |   <span class="hljs-comment">#  Rather than deleting non-alpha</span>
                                    <span class="hljs-comment">#+ chars, change them to newlines.</span>
        sort |                      <span class="hljs-comment">#  $SORT options unnecessary now.</span>
        uniq |                      <span class="hljs-comment">#  Remove duplicates.</span>
        grep -v <span class="hljs-string">'^#'</span> |              <span class="hljs-comment">#  Delete lines starting with #.</span>
        grep -v <span class="hljs-string">'^$'</span>                <span class="hljs-comment">#  Delete blank lines.</span>

<span class="hljs-built_in">exit</span> $?</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p><a name="SOUNDEX0" id="SOUNDEX0"></a></p>
      <div class="EXAMPLE">
        <a name="SOUNDEX" id="SOUNDEX"></a>
        <p><b>Example A-9. Soundex conversion</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># soundex.sh: Calculate "soundex" code for names</span>

<span class="hljs-comment"># =======================================================</span>
<span class="hljs-comment">#        Soundex script</span>
<span class="hljs-comment">#              by</span>
<span class="hljs-comment">#         Mendel Cooper</span>
<span class="hljs-comment">#     thegrendel.abs@gmail.com</span>
<span class="hljs-comment">#     reldate: 23 January, 2002</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#   Placed in the Public Domain.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># A slightly different version of this script appeared in</span>
<span class="hljs-comment">#+ Ed Schaefer's July, 2002 "Shell Corner" column</span>
<span class="hljs-comment">#+ in "Unix Review" on-line,</span>
<span class="hljs-comment">#+ http://www.unixreview.com/documents/uni1026336632258/</span>
<span class="hljs-comment"># =======================================================</span>


ARGCOUNT=1                     <span class="hljs-comment"># Need name as argument.</span>
E_WRONGARGS=90

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ne <span class="hljs-string">"<span class="hljs-variable">$ARGCOUNT</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` name"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_WRONGARGS</span>
<span class="hljs-keyword">fi</span>  


assign_value ()                <span class="hljs-comment">#  Assigns numerical value</span>
{                              <span class="hljs-comment">#+ to letters of name.</span>

  val1=bfpv                    <span class="hljs-comment"># 'b,f,p,v' = 1</span>
  val2=cgjkqsxz                <span class="hljs-comment"># 'c,g,j,k,q,s,x,z' = 2</span>
  val3=dt                      <span class="hljs-comment">#  etc.</span>
  val4=l
  val5=mn
  val6=r

<span class="hljs-comment"># Exceptionally clever use of 'tr' follows.</span>
<span class="hljs-comment"># Try to figure out what is going on here.</span>

value=$( <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> \
| tr -d wh \
| tr <span class="hljs-variable">$val1</span> 1 | tr <span class="hljs-variable">$val2</span> 2 | tr <span class="hljs-variable">$val3</span> 3 \
| tr <span class="hljs-variable">$val4</span> 4 | tr <span class="hljs-variable">$val5</span> 5 | tr <span class="hljs-variable">$val6</span> 6 \
| tr -s 123456 \
| tr -d aeiouy )

<span class="hljs-comment"># Assign letter values.</span>
<span class="hljs-comment"># Remove duplicate numbers, except when separated by vowels.</span>
<span class="hljs-comment"># Ignore vowels, except as separators, so delete them last.</span>
<span class="hljs-comment"># Ignore 'w' and 'h', even as separators, so delete them first.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># The above command substitution lays more pipe than a plumber &lt;g&gt;.</span>

}  


input_name=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Name = <span class="hljs-variable">$input_name</span>"</span>


<span class="hljs-comment"># Change all characters of name input to lowercase.</span>
<span class="hljs-comment"># ------------------------------------------------</span>
name=$( <span class="hljs-built_in">echo</span> <span class="hljs-variable">$input_name</span> | tr A-Z a-z )
<span class="hljs-comment"># ------------------------------------------------</span>
<span class="hljs-comment"># Just in case argument to script is mixed case.</span>


<span class="hljs-comment"># Prefix of soundex code: first letter of name.</span>
<span class="hljs-comment"># --------------------------------------------</span>


char_pos=0                     <span class="hljs-comment"># Initialize character position. </span>
prefix0=<span class="hljs-variable">${name:$char_pos:1}</span>
prefix=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$prefix0</span> | tr a-z A-Z`
                               <span class="hljs-comment"># Uppercase 1st letter of soundex.</span>

<span class="hljs-built_in">let</span> <span class="hljs-string">"char_pos += 1"</span>            <span class="hljs-comment"># Bump character position to 2nd letter of name.</span>
name1=<span class="hljs-variable">${name:$char_pos}</span>


<span class="hljs-comment"># ++++++++++++++++++++++++++ Exception Patch ++++++++++++++++++++++++++++++</span>
<span class="hljs-comment">#  Now, we run both the input name and the name shifted one char</span>
<span class="hljs-comment">#+ to the right through the value-assigning function.</span>
<span class="hljs-comment">#  If we get the same value out, that means that the first two characters</span>
<span class="hljs-comment">#+ of the name have the same value assigned, and that one should cancel.</span>
<span class="hljs-comment">#  However, we also need to test whether the first letter of the name</span>
<span class="hljs-comment">#+ is a vowel or 'w' or 'h', because otherwise this would bollix things up.</span>

char1=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$prefix</span> | tr A-Z a-z`    <span class="hljs-comment"># First letter of name, lowercased.</span>

assign_value <span class="hljs-variable">$name</span>
s1=<span class="hljs-variable">$value</span>
assign_value <span class="hljs-variable">$name1</span>
s2=<span class="hljs-variable">$value</span>
assign_value <span class="hljs-variable">$char1</span>
s3=<span class="hljs-variable">$value</span>
s3=9<span class="hljs-variable">$s3</span>                              <span class="hljs-comment">#  If first letter of name is a vowel</span>
                                     <span class="hljs-comment">#+ or 'w' or 'h',</span>
                                     <span class="hljs-comment">#+ then its "value" will be null (unset).</span>
                                     <span class="hljs-comment">#+ Therefore, set it to 9, an otherwise</span>
                                     <span class="hljs-comment">#+ unused value, which can be tested for.</span>


<span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$s1</span>"</span> -ne <span class="hljs-string">"<span class="hljs-variable">$s2</span>"</span> || <span class="hljs-string">"<span class="hljs-variable">$s3</span>"</span> -eq 9 ]]
<span class="hljs-keyword">then</span>
  suffix=<span class="hljs-variable">$s2</span>
<span class="hljs-keyword">else</span>  
  suffix=<span class="hljs-variable">${s2:$char_pos}</span>
<span class="hljs-keyword">fi</span>  
<span class="hljs-comment"># ++++++++++++++++++++++ end Exception Patch ++++++++++++++++++++++++++++++</span>


padding=000                    <span class="hljs-comment"># Use at most 3 zeroes to pad.</span>


soun=<span class="hljs-variable">$prefix</span><span class="hljs-variable">$suffix</span><span class="hljs-variable">$padding</span>    <span class="hljs-comment"># Pad with zeroes.</span>

MAXLEN=4                       <span class="hljs-comment"># Truncate to maximum of 4 chars.</span>
soundex=<span class="hljs-variable">${soun:0:$MAXLEN}</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Soundex = <span class="hljs-variable">$soundex</span>"</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-comment">#  The soundex code is a method of indexing and classifying names</span>
<span class="hljs-comment">#+ by grouping together the ones that sound alike.</span>
<span class="hljs-comment">#  The soundex code for a given name is the first letter of the name,</span>
<span class="hljs-comment">#+ followed by a calculated three-number code.</span>
<span class="hljs-comment">#  Similar sounding names should have almost the same soundex codes.</span>

<span class="hljs-comment">#   Examples:</span>
<span class="hljs-comment">#   Smith and Smythe both have a "S-530" soundex.</span>
<span class="hljs-comment">#   Harrison = H-625</span>
<span class="hljs-comment">#   Hargison = H-622</span>
<span class="hljs-comment">#   Harriman = H-655</span>

<span class="hljs-comment">#  This works out fairly well in practice, but there are numerous anomalies.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  The U.S. Census and certain other governmental agencies use soundex,</span>
<span class="hljs-comment">#  as do genealogical researchers.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  For more information,</span>
<span class="hljs-comment">#+ see the "National Archives and Records Administration home page",</span>
<span class="hljs-comment">#+ http://www.nara.gov/genealogy/soundex/soundex.html</span>



<span class="hljs-comment"># Exercise:</span>
<span class="hljs-comment"># --------</span>
<span class="hljs-comment"># Simplify the "Exception Patch" section of this script.</span>

<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p><a name="LIFEREF" id="LIFEREF"></a></p>
      <div class="EXAMPLE">
        <a name="LIFESLOW" id="LIFESLOW"></a>
        <p>
          <b>Example A-10. <i class="FIRSTTERM">Game of Life</i></b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># life.sh: "Life in the Slow Lane"</span>
<span class="hljs-comment"># Author: Mendel Cooper</span>
<span class="hljs-comment"># License: GPL3</span>

<span class="hljs-comment"># Version 0.2:   Patched by Daniel Albers</span>
<span class="hljs-comment">#+               to allow non-square grids as input.</span>
<span class="hljs-comment"># Version 0.2.1: Added 2-second delay between generations.</span>

<span class="hljs-comment"># ##################################################################### #</span>
<span class="hljs-comment"># This is the Bash script version of John Conway's "Game of Life".      #</span>
<span class="hljs-comment"># "Life" is a simple implementation of cellular automata.               #</span>
<span class="hljs-comment"># --------------------------------------------------------------------- #</span>
<span class="hljs-comment"># On a rectangular grid, let each "cell" be either "living" or "dead."  #</span>
<span class="hljs-comment"># Designate a living cell with a dot, and a dead one with a blank space.#</span>
<span class="hljs-comment">#      Begin with an arbitrarily drawn dot-and-blank grid,              #</span>
<span class="hljs-comment">#+     and let this be the starting generation: generation 0.           #</span>
<span class="hljs-comment"># Determine each successive generation by the following rules:          #</span>
<span class="hljs-comment">#   1) Each cell has 8 neighbors, the adjoining cells                   #</span>
<span class="hljs-comment">#+     left, right, top, bottom, and the 4 diagonals.                   #</span>
<span class="hljs-comment">#                                                                       #</span>
<span class="hljs-comment">#                       123                                             #</span>
<span class="hljs-comment">#                       4*5     The * is the cell under consideration.  #</span>
<span class="hljs-comment">#                       678                                             #</span>
<span class="hljs-comment">#                                                                       #</span>
<span class="hljs-comment"># 2) A living cell with either 2 or 3 living neighbors remains alive.   #</span>
SURVIVE=2                                                               <span class="hljs-comment">#</span>
<span class="hljs-comment"># 3) A dead cell with 3 living neighbors comes alive, a "birth."        #</span>
BIRTH=3                                                                 <span class="hljs-comment">#</span>
<span class="hljs-comment"># 4) All other cases result in a dead cell for the next generation.     #</span>
<span class="hljs-comment"># ##################################################################### #</span>


startfile=gen0   <span class="hljs-comment"># Read the starting generation from the file "gen0" ...</span>
                 <span class="hljs-comment"># Default, if no other file specified when invoking script.</span>
                 <span class="hljs-comment">#</span>
<span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]   <span class="hljs-comment"># Specify another "generation 0" file.</span>
<span class="hljs-keyword">then</span>
    startfile=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
<span class="hljs-keyword">fi</span>  

<span class="hljs-comment">############################################</span>
<span class="hljs-comment">#  Abort script if "startfile" not specified</span>
<span class="hljs-comment">#+ and</span>
<span class="hljs-comment">#+ default file "gen0" not present.</span>

E_NOSTARTFILE=86

<span class="hljs-keyword">if</span> [ ! -e <span class="hljs-string">"<span class="hljs-variable">$startfile</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Startfile \""</span><span class="hljs-variable">$startfile</span><span class="hljs-string">"\" missing!"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOSTARTFILE</span>
<span class="hljs-keyword">fi</span>
<span class="hljs-comment">############################################</span>


ALIVE1=.
DEAD1=_
                 <span class="hljs-comment"># Represent living and dead cells in the start-up file.</span>

<span class="hljs-comment">#  -----------------------------------------------------#</span>
<span class="hljs-comment">#  This script uses a 10 x 10 grid (may be increased,</span>
<span class="hljs-comment">#+ but a large grid will slow down execution).</span>
ROWS=10
COLS=10
<span class="hljs-comment">#  Change above two variables to match desired grid size.</span>
<span class="hljs-comment">#  -----------------------------------------------------#</span>

GENERATIONS=10          <span class="hljs-comment">#  How many generations to cycle through.</span>
                        <span class="hljs-comment">#  Adjust this upwards</span>
                        <span class="hljs-comment">#+ if you have time on your hands.</span>

NONE_ALIVE=85           <span class="hljs-comment">#  Exit status on premature bailout,</span>
                        <span class="hljs-comment">#+ if no cells left alive.</span>
DELAY=2                 <span class="hljs-comment">#  Pause between generations.</span>
TRUE=0
FALSE=1
ALIVE=0
DEAD=1

avar=                   <span class="hljs-comment"># Global; holds current generation.</span>
generation=0            <span class="hljs-comment"># Initialize generation count.</span>

<span class="hljs-comment"># =================================================================</span>

<span class="hljs-built_in">let</span> <span class="hljs-string">"cells = <span class="hljs-variable">$ROWS</span> * <span class="hljs-variable">$COLS</span>"</span>   <span class="hljs-comment"># How many cells.</span>

<span class="hljs-comment"># Arrays containing "cells."</span>
<span class="hljs-built_in">declare</span> -a initial
<span class="hljs-built_in">declare</span> -a current

<span class="hljs-function"><span class="hljs-title">display</span></span> ()
{

alive=0                 <span class="hljs-comment"># How many cells alive at any given time.</span>
                        <span class="hljs-comment"># Initially zero.</span>

<span class="hljs-built_in">declare</span> -a arr
arr=( `<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>` )     <span class="hljs-comment"># Convert passed arg to array.</span>

element_count=<span class="hljs-variable">${#arr[*]}</span>

<span class="hljs-built_in">local</span> i
<span class="hljs-built_in">local</span> rowcheck

<span class="hljs-keyword">for</span> ((i=0; i&lt;<span class="hljs-variable">$element_count</span>; i++))
<span class="hljs-keyword">do</span>

  <span class="hljs-comment"># Insert newline at end of each row.</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"rowcheck = <span class="hljs-variable">$i</span> % COLS"</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$rowcheck</span>"</span> -eq 0 ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span>                <span class="hljs-comment"># Newline.</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"      "</span>    <span class="hljs-comment"># Indent.</span>
  <span class="hljs-keyword">fi</span>  

  cell=<span class="hljs-variable">${arr[i]}</span>

  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$cell</span>"</span> = . ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"alive += 1"</span>
  <span class="hljs-keyword">fi</span>  

  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$cell</span>"</span> | sed -e <span class="hljs-string">'s/_/ /g'</span>
  <span class="hljs-comment"># Print out array, changing underscores to spaces.</span>
<span class="hljs-keyword">done</span>  

<span class="hljs-built_in">return</span>

}

IsValid ()                            <span class="hljs-comment"># Test if cell coordinate valid.</span>
{

  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>  -o -z <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ]          <span class="hljs-comment"># Mandatory arguments missing?</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$FALSE</span>
  <span class="hljs-keyword">fi</span>

<span class="hljs-built_in">local</span> row
<span class="hljs-built_in">local</span> lower_limit=0                   <span class="hljs-comment"># Disallow negative coordinate.</span>
<span class="hljs-built_in">local</span> upper_limit
<span class="hljs-built_in">local</span> left
<span class="hljs-built_in">local</span> right

<span class="hljs-built_in">let</span> <span class="hljs-string">"upper_limit = <span class="hljs-variable">$ROWS</span> * <span class="hljs-variable">$COLS</span> - 1"</span> <span class="hljs-comment"># Total number of cells.</span>


<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> -lt <span class="hljs-string">"<span class="hljs-variable">$lower_limit</span>"</span> -o <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> -gt <span class="hljs-string">"<span class="hljs-variable">$upper_limit</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$FALSE</span>                       <span class="hljs-comment"># Out of array bounds.</span>
<span class="hljs-keyword">fi</span>  

row=<span class="hljs-variable">$2</span>
<span class="hljs-built_in">let</span> <span class="hljs-string">"left = <span class="hljs-variable">$row</span> * <span class="hljs-variable">$COLS</span>"</span>             <span class="hljs-comment"># Left limit.</span>
<span class="hljs-built_in">let</span> <span class="hljs-string">"right = <span class="hljs-variable">$left</span> + <span class="hljs-variable">$COLS</span> - 1"</span>       <span class="hljs-comment"># Right limit.</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> -lt <span class="hljs-string">"<span class="hljs-variable">$left</span>"</span> -o <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> -gt <span class="hljs-string">"<span class="hljs-variable">$right</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$FALSE</span>                       <span class="hljs-comment"># Beyond row boundary.</span>
<span class="hljs-keyword">fi</span>  

<span class="hljs-built_in">return</span> <span class="hljs-variable">$TRUE</span>                          <span class="hljs-comment"># Valid coordinate.</span>

}  


IsAlive ()              <span class="hljs-comment">#  Test whether cell is alive.</span>
                        <span class="hljs-comment">#  Takes array, cell number, and</span>
{                       <span class="hljs-comment">#+ state of cell as arguments.</span>
  GetCount <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-variable">$2</span>      <span class="hljs-comment">#  Get alive cell count in neighborhood.</span>
  <span class="hljs-built_in">local</span> nhbd=$?

  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$nhbd</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$BIRTH</span>"</span> ]  <span class="hljs-comment"># Alive in any case.</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$ALIVE</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$3</span>"</span> = <span class="hljs-string">"."</span> -a <span class="hljs-string">"<span class="hljs-variable">$nhbd</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$SURVIVE</span>"</span> ]
  <span class="hljs-keyword">then</span>                  <span class="hljs-comment"># Alive only if previously alive.</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$ALIVE</span>
  <span class="hljs-keyword">fi</span>  

  <span class="hljs-built_in">return</span> <span class="hljs-variable">$DEAD</span>          <span class="hljs-comment"># Defaults to dead.</span>

}  


GetCount ()             <span class="hljs-comment"># Count live cells in passed cell's neighborhood.</span>
                        <span class="hljs-comment"># Two arguments needed:</span>
                        <span class="hljs-comment"># $1) variable holding array</span>
                        <span class="hljs-comment"># $2) cell number</span>
{
  <span class="hljs-built_in">local</span> cell_number=<span class="hljs-variable">$2</span>
  <span class="hljs-built_in">local</span> array
  <span class="hljs-built_in">local</span> top
  <span class="hljs-built_in">local</span> center
  <span class="hljs-built_in">local</span> bottom
  <span class="hljs-built_in">local</span> r
  <span class="hljs-built_in">local</span> row
  <span class="hljs-built_in">local</span> i
  <span class="hljs-built_in">local</span> t_top
  <span class="hljs-built_in">local</span> t_cen
  <span class="hljs-built_in">local</span> t_bot
  <span class="hljs-built_in">local</span> count=0
  <span class="hljs-built_in">local</span> ROW_NHBD=3

  array=( `<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>` )

  <span class="hljs-built_in">let</span> <span class="hljs-string">"top = <span class="hljs-variable">$cell_number</span> - <span class="hljs-variable">$COLS</span> - 1"</span>    <span class="hljs-comment"># Set up cell neighborhood.</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"center = <span class="hljs-variable">$cell_number</span> - 1"</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"bottom = <span class="hljs-variable">$cell_number</span> + <span class="hljs-variable">$COLS</span> - 1"</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"r = <span class="hljs-variable">$cell_number</span> / <span class="hljs-variable">$COLS</span>"</span>

  <span class="hljs-keyword">for</span> ((i=0; i&lt;<span class="hljs-variable">$ROW_NHBD</span>; i++))           <span class="hljs-comment"># Traverse from left to right. </span>
  <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"t_top = <span class="hljs-variable">$top</span> + <span class="hljs-variable">$i</span>"</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"t_cen = <span class="hljs-variable">$center</span> + <span class="hljs-variable">$i</span>"</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"t_bot = <span class="hljs-variable">$bottom</span> + <span class="hljs-variable">$i</span>"</span>


    <span class="hljs-built_in">let</span> <span class="hljs-string">"row = <span class="hljs-variable">$r</span>"</span>                        <span class="hljs-comment"># Count center row.</span>
    IsValid <span class="hljs-variable">$t_cen</span> <span class="hljs-variable">$row</span>                   <span class="hljs-comment"># Valid cell position?</span>
    <span class="hljs-keyword">if</span> [ $? -eq <span class="hljs-string">"<span class="hljs-variable">$TRUE</span>"</span> ]
    <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${array[$t_cen]}</span> = <span class="hljs-string">"<span class="hljs-variable">$ALIVE1</span>"</span> ] <span class="hljs-comment"># Is it alive?</span>
      <span class="hljs-keyword">then</span>                                <span class="hljs-comment"># If yes, then ...</span>
        <span class="hljs-built_in">let</span> <span class="hljs-string">"count += 1"</span>                  <span class="hljs-comment"># Increment count.</span>
      <span class="hljs-keyword">fi</span>        
    <span class="hljs-keyword">fi</span>  

    <span class="hljs-built_in">let</span> <span class="hljs-string">"row = <span class="hljs-variable">$r</span> - 1"</span>                    <span class="hljs-comment"># Count top row.          </span>
    IsValid <span class="hljs-variable">$t_top</span> <span class="hljs-variable">$row</span>
    <span class="hljs-keyword">if</span> [ $? -eq <span class="hljs-string">"<span class="hljs-variable">$TRUE</span>"</span> ]
    <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${array[$t_top]}</span> = <span class="hljs-string">"<span class="hljs-variable">$ALIVE1</span>"</span> ] <span class="hljs-comment"># Redundancy here.</span>
      <span class="hljs-keyword">then</span>                                <span class="hljs-comment"># Can it be optimized?</span>
        <span class="hljs-built_in">let</span> <span class="hljs-string">"count += 1"</span>
      <span class="hljs-keyword">fi</span>        
    <span class="hljs-keyword">fi</span>  

    <span class="hljs-built_in">let</span> <span class="hljs-string">"row = <span class="hljs-variable">$r</span> + 1"</span>                    <span class="hljs-comment"># Count bottom row.</span>
    IsValid <span class="hljs-variable">$t_bot</span> <span class="hljs-variable">$row</span>
    <span class="hljs-keyword">if</span> [ $? -eq <span class="hljs-string">"<span class="hljs-variable">$TRUE</span>"</span> ]
    <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${array[$t_bot]}</span> = <span class="hljs-string">"<span class="hljs-variable">$ALIVE1</span>"</span> ] 
      <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">let</span> <span class="hljs-string">"count += 1"</span>
      <span class="hljs-keyword">fi</span>        
    <span class="hljs-keyword">fi</span>  

  <span class="hljs-keyword">done</span>  


  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${array[$cell_number]}</span> = <span class="hljs-string">"<span class="hljs-variable">$ALIVE1</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"count -= 1"</span>        <span class="hljs-comment">#  Make sure value of tested cell itself</span>
  <span class="hljs-keyword">fi</span>                        <span class="hljs-comment">#+ is not counted.</span>


  <span class="hljs-built_in">return</span> <span class="hljs-variable">$count</span>
  
}

next_gen ()               <span class="hljs-comment"># Update generation array.</span>
{

<span class="hljs-built_in">local</span> array
<span class="hljs-built_in">local</span> i=0

array=( `<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>` )     <span class="hljs-comment"># Convert passed arg to array.</span>

<span class="hljs-keyword">while</span> [ <span class="hljs-string">"<span class="hljs-variable">$i</span>"</span> -lt <span class="hljs-string">"<span class="hljs-variable">$cells</span>"</span> ]
<span class="hljs-keyword">do</span>
  IsAlive <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-variable">$i</span> <span class="hljs-variable">${array[$i]}</span>   <span class="hljs-comment"># Is the cell alive?</span>
  <span class="hljs-keyword">if</span> [ $? -eq <span class="hljs-string">"<span class="hljs-variable">$ALIVE</span>"</span> ]
  <span class="hljs-keyword">then</span>                           <span class="hljs-comment">#  If alive, then</span>
    array[<span class="hljs-variable">$i</span>]=.                  <span class="hljs-comment">#+ represent the cell as a period.</span>
  <span class="hljs-keyword">else</span>  
    array[<span class="hljs-variable">$i</span>]=<span class="hljs-string">"_"</span>                <span class="hljs-comment">#  Otherwise underscore</span>
   <span class="hljs-keyword">fi</span>                            <span class="hljs-comment">#+ (will later be converted to space).</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"i += 1"</span> 
<span class="hljs-keyword">done</span>   


<span class="hljs-comment">#    let "generation += 1"       # Increment generation count.</span>
<span class="hljs-comment">###  Why was the above line commented out?</span>


<span class="hljs-comment"># Set variable to pass as parameter to "display" function.</span>
avar=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">${array[@]}</span>`   <span class="hljs-comment"># Convert array back to string variable.</span>
display <span class="hljs-string">"<span class="hljs-variable">$avar</span>"</span>           <span class="hljs-comment"># Display it.</span>
<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Generation <span class="hljs-variable">$generation</span>  -  <span class="hljs-variable">$alive</span> alive"</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$alive</span>"</span> -eq 0 ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Premature exit: no more cells alive!"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$NONE_ALIVE</span>        <span class="hljs-comment">#  No point in continuing</span>
<span class="hljs-keyword">fi</span>                        <span class="hljs-comment">#+ if no live cells.</span>

}


<span class="hljs-comment"># =========================================================</span>

<span class="hljs-comment"># main ()</span>
<span class="hljs-comment"># {</span>

<span class="hljs-comment"># Load initial array with contents of startup file.</span>
initial=( `cat <span class="hljs-string">"<span class="hljs-variable">$startfile</span>"</span> | sed -e <span class="hljs-string">'/#/d'</span> | tr -d <span class="hljs-string">'\n'</span> |\
<span class="hljs-comment"># Delete lines containing '#' comment character.</span>
           sed -e <span class="hljs-string">'s/\./\. /g'</span> -e <span class="hljs-string">'s/_/_ /g'</span>` )
<span class="hljs-comment"># Remove linefeeds and insert space between elements.</span>

clear          <span class="hljs-comment"># Clear screen.</span>

<span class="hljs-built_in">echo</span> <span class="hljs-comment">#         Title</span>
setterm -reverse on
<span class="hljs-built_in">echo</span> <span class="hljs-string">"======================="</span>
setterm -reverse off
<span class="hljs-built_in">echo</span> <span class="hljs-string">"    <span class="hljs-variable">$GENERATIONS</span> generations"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"           of"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"\"Life in the Slow Lane\""</span>
setterm -reverse on
<span class="hljs-built_in">echo</span> <span class="hljs-string">"======================="</span>
setterm -reverse off

sleep <span class="hljs-variable">$DELAY</span>   <span class="hljs-comment"># Display "splash screen" for 2 seconds.</span>


<span class="hljs-comment"># -------- Display first generation. --------</span>
Gen0=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">${initial[@]}</span>`
display <span class="hljs-string">"<span class="hljs-variable">$Gen0</span>"</span>           <span class="hljs-comment"># Display only.</span>
<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Generation <span class="hljs-variable">$generation</span>  -  <span class="hljs-variable">$alive</span> alive"</span>
sleep <span class="hljs-variable">$DELAY</span>
<span class="hljs-comment"># -------------------------------------------</span>


<span class="hljs-built_in">let</span> <span class="hljs-string">"generation += 1"</span>     <span class="hljs-comment"># Bump generation count.</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># ------- Display second generation. -------</span>
Cur=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">${initial[@]}</span>`
next_gen <span class="hljs-string">"<span class="hljs-variable">$Cur</span>"</span>          <span class="hljs-comment"># Update &amp; display.</span>
sleep <span class="hljs-variable">$DELAY</span>
<span class="hljs-comment"># ------------------------------------------</span>

<span class="hljs-built_in">let</span> <span class="hljs-string">"generation += 1"</span>     <span class="hljs-comment"># Increment generation count.</span>

<span class="hljs-comment"># ------ Main loop for displaying subsequent generations ------</span>
<span class="hljs-keyword">while</span> [ <span class="hljs-string">"<span class="hljs-variable">$generation</span>"</span> -le <span class="hljs-string">"<span class="hljs-variable">$GENERATIONS</span>"</span> ]
<span class="hljs-keyword">do</span>
  Cur=<span class="hljs-string">"<span class="hljs-variable">$avar</span>"</span>
  next_gen <span class="hljs-string">"<span class="hljs-variable">$Cur</span>"</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"generation += 1"</span>
  sleep <span class="hljs-variable">$DELAY</span>
<span class="hljs-keyword">done</span>
<span class="hljs-comment"># ==============================================================</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-comment"># }</span>

<span class="hljs-built_in">exit</span> 0   <span class="hljs-comment"># CEOF:EOF</span>



<span class="hljs-comment"># The grid in this script has a "boundary problem."</span>
<span class="hljs-comment"># The the top, bottom, and sides border on a void of dead cells.</span>
<span class="hljs-comment"># Exercise: Change the script to have the grid wrap around,</span>
<span class="hljs-comment"># +         so that the left and right sides will "touch,"      </span>
<span class="hljs-comment"># +         as will the top and bottom.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Exercise: Create a new "gen0" file to seed this script.</span>
<span class="hljs-comment">#           Use a 12 x 16 grid, instead of the original 10 x 10 one.</span>
<span class="hljs-comment">#           Make the necessary changes to the script,</span>
<span class="hljs-comment">#+          so it will run with the altered file.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Exercise: Modify this script so that it can determine the grid size</span>
<span class="hljs-comment">#+          from the "gen0" file, and set any variables necessary</span>
<span class="hljs-comment">#+          for the script to run.</span>
<span class="hljs-comment">#           This would make unnecessary any changes to variables</span>
<span class="hljs-comment">#+          in the script for an altered grid size.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Exercise: Optimize this script.</span>
<span class="hljs-comment">#           It has redundant code.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="GEN0DATA" id="GEN0DATA"></a>
        <p>
          <b>Example A-11. Data file for
            <i class="FIRSTTERM">Game of Life</i></b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-comment"># gen0</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># This is an example "generation 0" start-up file for "life.sh".</span>
<span class="hljs-comment"># --------------------------------------------------------------</span>
<span class="hljs-comment">#  The "gen0" file is a 10 x 10 grid using a period (.) for live cells,</span>
<span class="hljs-comment">#+ and an underscore (_) for dead ones. We cannot simply use spaces</span>
<span class="hljs-comment">#+ for dead cells in this file because of a peculiarity in Bash arrays.</span>
<span class="hljs-comment">#  [Exercise for the reader: explain this.]</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Lines beginning with a '#' are comments, and the script ignores them.</span>
__.__..___
__.._.____
____.___..
_._______.
____._____
..__...___
____._____
___...____
__.._..___
_..___..__</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>+++</p>
      <p>
        The following script is by Mark Moraes of the University of Toronto. See
        the file <tt class="FILENAME">Moraes-COPYRIGHT</tt> for permissions and
        restrictions. This file is included in the combined
        <a href="mirrorsites.html#WHERE_TARBALL">HTML/source tarball</a> of the
        <em>ABS Guide</em>.
      </p>
      <div class="EXAMPLE">
        <a name="BEHEAD" id="BEHEAD"></a>
        <p>
          <b>Example A-12. <i class="FIRSTTERM">behead</i>: Removing mail and
            news message headers</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#! /bin/sh</span>
<span class="hljs-comment">#  Strips off the header from a mail/News message i.e. till the first</span>
<span class="hljs-comment">#+ empty line.</span>
<span class="hljs-comment">#  Author: Mark Moraes, University of Toronto</span>

<span class="hljs-comment"># ==&gt; These comments added by author of this document.</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -eq 0 ]; <span class="hljs-keyword">then</span>
<span class="hljs-comment"># ==&gt; If no command-line args present, then works on file redirected to stdin.</span>
        sed -e <span class="hljs-string">'1,/^$/d'</span> -e <span class="hljs-string">'/^[        ]*$/d'</span>
        <span class="hljs-comment"># --&gt; Delete empty lines and all lines until </span>
        <span class="hljs-comment"># --&gt; first one beginning with white space.</span>
<span class="hljs-keyword">else</span>
<span class="hljs-comment"># ==&gt; If command-line args present, then work on files named.</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">do</span>
                sed -e <span class="hljs-string">'1,/^$/d'</span> -e <span class="hljs-string">'/^[        ]*$/d'</span> <span class="hljs-variable">$i</span>
                <span class="hljs-comment"># --&gt; Ditto, as above.</span>
        <span class="hljs-keyword">done</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">exit</span>

<span class="hljs-comment"># ==&gt; Exercise: Add error checking and other options.</span>
<span class="hljs-comment"># ==&gt;</span>
<span class="hljs-comment"># ==&gt; Note that the small sed script repeats, except for the arg passed.</span>
<span class="hljs-comment"># ==&gt; Does it make sense to embed it in a function? Why or why not?</span>


/*
 * Copyright University of Toronto 1988, 1989.
 * Written by Mark Moraes
 *
 * Permission is granted to anyone to use this software <span class="hljs-keyword">for</span> any purpose on
 * any computer system, and to alter it and redistribute it freely, subject
 * to the following restrictions:
 *
 * 1. The author and the University of Toronto are not responsible 
 *    <span class="hljs-keyword">for</span> the consequences of use of this software, no matter how awful, 
 *    even <span class="hljs-keyword">if</span> they arise from flaws <span class="hljs-keyword">in</span> it.
 *
 * 2. The origin of this software must not be misrepresented, either by
 *    explicit claim or by omission.  Since few users ever <span class="hljs-built_in">read</span> sources,
 *    credits must appear <span class="hljs-keyword">in</span> the documentation.
 *
 * 3. Altered versions must be plainly marked as such, and must not be
 *    misrepresented as being the original software.  Since few users
 *    ever <span class="hljs-built_in">read</span> sources, credits must appear <span class="hljs-keyword">in</span> the documentation.
 *
 * 4. This notice may not be removed or altered.
 */</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>+</p>
      <p>
        Antek Sawicki contributed the following script, which makes very clever
        use of the parameter substitution operators discussed in
        <a href="parameter-substitution.html">Section 10.2</a>.
      </p>
      <p><a name="PW0" id="PW0"></a></p>
      <div class="EXAMPLE">
        <a name="PW" id="PW"></a>
        <p>
          <b>Example A-13. <i class="FIRSTTERM">password</i>: Generating random
            8-character passwords</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  Random password generator for Bash 2.x +</span>
<span class="hljs-comment">#+ by Antek Sawicki &lt;tenox@tenox.tc&gt;,</span>
<span class="hljs-comment">#+ who generously gave usage permission to the ABS Guide author.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># ==&gt; Comments added by document author ==&gt;</span>


MATRIX=<span class="hljs-string">"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"</span>
<span class="hljs-comment"># ==&gt; Password will consist of alphanumeric characters.</span>
LENGTH=<span class="hljs-string">"8"</span>
<span class="hljs-comment"># ==&gt; May change 'LENGTH' for longer password.</span>


<span class="hljs-keyword">while</span> [ <span class="hljs-string">"<span class="hljs-variable">${n:=1}</span>"</span> -le <span class="hljs-string">"<span class="hljs-variable">$LENGTH</span>"</span> ]
<span class="hljs-comment"># ==&gt; Recall that := is "default substitution" operator.</span>
<span class="hljs-comment"># ==&gt; So, if 'n' has not been initialized, set it to 1.</span>
<span class="hljs-keyword">do</span>
        PASS=<span class="hljs-string">"<span class="hljs-variable">$PASS</span><span class="hljs-variable">${MATRIX:$(($RANDOM%${#MATRIX}</span>)):1}"</span>
        <span class="hljs-comment"># ==&gt; Very clever, but tricky.</span>

        <span class="hljs-comment"># ==&gt; Starting from the innermost nesting...</span>
        <span class="hljs-comment"># ==&gt; ${#MATRIX} returns length of array MATRIX.</span>

        <span class="hljs-comment"># ==&gt; $RANDOM%${#MATRIX} returns random number between 1</span>
        <span class="hljs-comment"># ==&gt; and [length of MATRIX] - 1.</span>

        <span class="hljs-comment"># ==&gt; ${MATRIX:$(($RANDOM%${#MATRIX})):1}</span>
        <span class="hljs-comment"># ==&gt; returns expansion of MATRIX at random position, by length 1. </span>
        <span class="hljs-comment"># ==&gt; See {var:pos:len} parameter substitution in Chapter 9.</span>
        <span class="hljs-comment"># ==&gt; and the associated examples.</span>

        <span class="hljs-comment"># ==&gt; PASS=... simply pastes this result onto previous PASS (concatenation).</span>

        <span class="hljs-comment"># ==&gt; To visualize this more clearly, uncomment the following line</span>
        <span class="hljs-comment">#                 echo "$PASS"</span>
        <span class="hljs-comment"># ==&gt; to see PASS being built up,</span>
        <span class="hljs-comment"># ==&gt; one character at a time, each iteration of the loop.</span>

        <span class="hljs-built_in">let</span> n+=1
        <span class="hljs-comment"># ==&gt; Increment 'n' for next pass.</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$PASS</span>"</span>      <span class="hljs-comment"># ==&gt; Or, redirect to a file, as desired.</span>

<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>+</p>
      <p>
        <a name="ZFIFO" id="ZFIFO"></a>James R. Van Zandt contributed this
        script which uses named pipes and, in his words,
        <span class="QUOTE">"really exercises quoting and escaping."</span>
      </p>
      <div class="EXAMPLE">
        <a name="FIFO" id="FIFO"></a>
        <p>
          <b>Example A-14. <i class="FIRSTTERM">fifo</i>: Making daily backups,
            using named pipes</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># ==&gt; Script by James R. Van Zandt, and used here with his permission.</span>

<span class="hljs-comment"># ==&gt; Comments added by author of this document.</span>

  
  HERE=`uname -n`    <span class="hljs-comment"># ==&gt; hostname</span>
  THERE=bilbo
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"starting remote backup to <span class="hljs-variable">$THERE</span> at `date +%r`"</span>
  <span class="hljs-comment"># ==&gt; `date +%r` returns time in 12-hour format, i.e. "08:08:34 PM".</span>
  
  <span class="hljs-comment"># make sure /pipe really is a pipe and not a plain file</span>
  rm -rf /pipe
  mkfifo /pipe       <span class="hljs-comment"># ==&gt; Create a "named pipe", named "/pipe" ...</span>
  
  <span class="hljs-comment"># ==&gt; 'su xyz' runs commands as user "xyz".</span>
  <span class="hljs-comment"># ==&gt; 'ssh' invokes secure shell (remote login client).</span>
  su xyz -c <span class="hljs-string">"ssh <span class="hljs-variable">$THERE</span> \"cat &gt; /home/xyz/backup/<span class="hljs-variable">${HERE}</span>-daily.tar.gz\" &lt; /pipe"</span>&amp;
  <span class="hljs-built_in">cd</span> /
  tar -czf - bin boot dev etc home info lib man root sbin share usr var &gt; /pipe
  <span class="hljs-comment"># ==&gt; Uses named pipe, /pipe, to communicate between processes:</span>
  <span class="hljs-comment"># ==&gt; 'tar/gzip' writes to /pipe and 'ssh' reads from /pipe.</span>

  <span class="hljs-comment"># ==&gt; The end result is this backs up the main directories, from / on down.</span>

  <span class="hljs-comment"># ==&gt;  What are the advantages of a "named pipe" in this situation,</span>
  <span class="hljs-comment"># ==&gt;+ as opposed to an "anonymous pipe", with |?</span>
  <span class="hljs-comment"># ==&gt;  Will an anonymous pipe even work here?</span>

  <span class="hljs-comment"># ==&gt;  Is it necessary to delete the pipe before exiting the script?</span>
  <span class="hljs-comment"># ==&gt;  How could that be done?</span>


  <span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>+</p>
      <p><a name="PRIMES1" id="PRIMES1"></a></p>
      <p>
        Stephane Chazelas used the following script to demonstrate generating
        prime numbers without arrays.
      </p>
      <p><a name="PRIMES00" id="PRIMES00"></a></p>
      <div class="EXAMPLE">
        <a name="PRIMES" id="PRIMES"></a>
        <p>
          <b>Example A-15. Generating prime numbers using the modulo operator</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># primes.sh: Generate prime numbers, without using arrays.</span>
<span class="hljs-comment"># Script contributed by Stephane Chazelas.</span>

<span class="hljs-comment">#  This does *not* use the classic "Sieve of Eratosthenes" algorithm,</span>
<span class="hljs-comment">#+ but instead the more intuitive method of testing each candidate number</span>
<span class="hljs-comment">#+ for factors (divisors), using the "%" modulo operator.</span>


LIMIT=1000                    <span class="hljs-comment"># Primes, 2 ... 1000.</span>

<span class="hljs-function"><span class="hljs-title">Primes</span></span>()
{
 (( n = <span class="hljs-variable">$1</span> + 1 ))             <span class="hljs-comment"># Bump to next integer.</span>
 <span class="hljs-built_in">shift</span>                        <span class="hljs-comment"># Next parameter in list.</span>
<span class="hljs-comment">#  echo "_n=$n i=$i_"</span>
 
 <span class="hljs-keyword">if</span> (( n == LIMIT ))
 <span class="hljs-keyword">then</span> <span class="hljs-built_in">echo</span> $*
 <span class="hljs-built_in">return</span>
 <span class="hljs-keyword">fi</span>

 <span class="hljs-keyword">for</span> i; <span class="hljs-keyword">do</span>                    <span class="hljs-comment"># "i" set to "@", previous values of $n.</span>
<span class="hljs-comment">#   echo "-n=$n i=$i-"</span>
   (( i * i &gt; n )) &amp;&amp; <span class="hljs-built_in">break</span>   <span class="hljs-comment"># Optimization.</span>
   (( n % i )) &amp;&amp; <span class="hljs-built_in">continue</span>    <span class="hljs-comment"># Sift out non-primes using modulo operator.</span>
   Primes <span class="hljs-variable">$n</span> <span class="hljs-variable">$@</span>               <span class="hljs-comment"># Recursion inside loop.</span>
   <span class="hljs-built_in">return</span>
   <span class="hljs-keyword">done</span>

   Primes <span class="hljs-variable">$n</span> <span class="hljs-variable">$@</span> <span class="hljs-variable">$n</span>            <span class="hljs-comment">#  Recursion outside loop.</span>
                              <span class="hljs-comment">#  Successively accumulate</span>
                              <span class="hljs-comment">#+ positional parameters.</span>
                              <span class="hljs-comment">#  "$@" is the accumulating list of primes.</span>
}

Primes 1

<span class="hljs-built_in">exit</span> $?

<span class="hljs-comment"># Pipe output of the script to 'fmt' for prettier printing.</span>

<span class="hljs-comment">#  Uncomment lines 16 and 24 to help figure out what is going on.</span>

<span class="hljs-comment">#  Compare the speed of this algorithm for generating primes</span>
<span class="hljs-comment">#+ with the Sieve of Eratosthenes (ex68.sh).</span>


<span class="hljs-comment">#  Exercise: Rewrite this script without recursion.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>+</p>
      <p>Rick Boivie's revision of Jordi Sanfeliu's <em>tree</em> script.</p>
      <div class="EXAMPLE">
        <a name="TREE" id="TREE"></a>
        <p>
          <b>Example A-16. <i class="FIRSTTERM">tree</i>: Displaying a directory
            tree</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># tree.sh</span>

<span class="hljs-comment">#  Written by Rick Boivie.</span>
<span class="hljs-comment">#  Used with permission.</span>
<span class="hljs-comment">#  This is a revised and simplified version of a script</span>
<span class="hljs-comment">#+ by Jordi Sanfeliu (the original author), and patched by Ian Kjos.</span>
<span class="hljs-comment">#  This script replaces the earlier version used in</span>
<span class="hljs-comment">#+ previous releases of the Advanced Bash Scripting Guide.</span>
<span class="hljs-comment">#  Copyright (c) 2002, by Jordi Sanfeliu, Rick Boivie, and Ian Kjos.</span>

<span class="hljs-comment"># ==&gt; Comments added by the author of this document.</span>


<span class="hljs-function"><span class="hljs-title">search</span></span> () {
<span class="hljs-keyword">for</span> dir <span class="hljs-keyword">in</span> `<span class="hljs-built_in">echo</span> *`
<span class="hljs-comment">#  ==&gt; `echo *` lists all the files in current working directory,</span>
<span class="hljs-comment">#+ ==&gt; without line breaks.</span>
<span class="hljs-comment">#  ==&gt; Similar effect to for dir in *</span>
<span class="hljs-comment">#  ==&gt; but "dir in `echo *`" will not handle filenames with blanks.</span>
<span class="hljs-keyword">do</span>
  <span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$dir</span>"</span> ] ; <span class="hljs-keyword">then</span> <span class="hljs-comment"># ==&gt; If it is a directory (-d)...</span>
  zz=0                    <span class="hljs-comment"># ==&gt; Temp variable, keeping track of</span>
                          <span class="hljs-comment">#     directory level.</span>
  <span class="hljs-keyword">while</span> [ <span class="hljs-variable">$zz</span> != <span class="hljs-variable">$1</span> ]     <span class="hljs-comment"># Keep track of inner nested loop.</span>
    <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"| "</span>        <span class="hljs-comment"># ==&gt; Display vertical connector symbol,</span>
                          <span class="hljs-comment"># ==&gt; with 2 spaces &amp; no line feed</span>
                          <span class="hljs-comment">#     in order to indent.</span>
      zz=`expr <span class="hljs-variable">$zz</span> + 1`   <span class="hljs-comment"># ==&gt; Increment zz.</span>
    <span class="hljs-keyword">done</span>

    <span class="hljs-keyword">if</span> [ -L <span class="hljs-string">"<span class="hljs-variable">$dir</span>"</span> ] ; <span class="hljs-keyword">then</span> <span class="hljs-comment"># ==&gt; If directory is a symbolic link...</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"+---<span class="hljs-variable">$dir</span>"</span> `ls -l <span class="hljs-variable">$dir</span> | sed <span class="hljs-string">'s/^.*'</span><span class="hljs-variable">$dir</span><span class="hljs-string">' //'</span>`
      <span class="hljs-comment"># ==&gt; Display horiz. connector and list directory name, but...</span>
      <span class="hljs-comment"># ==&gt; delete date/time part of long listing.</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"+---<span class="hljs-variable">$dir</span>"</span>       <span class="hljs-comment"># ==&gt; Display horizontal connector symbol...</span>
      <span class="hljs-comment"># ==&gt; and print directory name.</span>
      numdirs=`expr <span class="hljs-variable">$numdirs</span> + 1` <span class="hljs-comment"># ==&gt; Increment directory count.</span>
      <span class="hljs-keyword">if</span> <span class="hljs-built_in">cd</span> <span class="hljs-string">"<span class="hljs-variable">$dir</span>"</span> ; <span class="hljs-keyword">then</span>         <span class="hljs-comment"># ==&gt; If can move to subdirectory...</span>
        search `expr <span class="hljs-variable">$1</span> + 1`      <span class="hljs-comment"># with recursion ;-)</span>
        <span class="hljs-comment"># ==&gt; Function calls itself.</span>
        <span class="hljs-built_in">cd</span> ..
      <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
}

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> != 0 ] ; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">cd</span> <span class="hljs-variable">$1</span>   <span class="hljs-comment"># Move to indicated directory.</span>
  <span class="hljs-comment">#else   # stay in current directory</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Initial directory = `pwd`"</span>
numdirs=0

search 0
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Total directories = <span class="hljs-variable">$numdirs</span>"</span>

<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>
        Patsie's version of a directory <i class="FIRSTTERM">tree</i> script.
      </p>
      <div class="EXAMPLE">
        <a name="TREE2" id="TREE2"></a>
        <p>
          <b>Example A-17. <i class="FIRSTTERM">tree2</i>: Alternate directory
            tree script</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># tree2.sh</span>

<span class="hljs-comment"># Lightly modified/reformatted by ABS Guide author.</span>
<span class="hljs-comment"># Included in ABS Guide with permission of script author (thanks!).</span>

<span class="hljs-comment">## Recursive file/dirsize checking script, by Patsie</span>
<span class="hljs-comment">##</span>
<span class="hljs-comment">## This script builds a list of files/directories and their size (du -akx)</span>
<span class="hljs-comment">## and processes this list to a human readable tree shape</span>
<span class="hljs-comment">## The 'du -akx' is only as good as the permissions the owner has.</span>
<span class="hljs-comment">## So preferably run as root* to get the best results, or use only on</span>
<span class="hljs-comment">## directories for which you have read permissions. Anything you can't</span>
<span class="hljs-comment">## read is not in the list.</span>

<span class="hljs-comment">#* ABS Guide author advises caution when running scripts as root!</span>


<span class="hljs-comment">##########  THIS IS CONFIGURABLE  ##########</span>

TOP=5                   <span class="hljs-comment"># Top 5 biggest (sub)directories.</span>
MAXRECURS=5             <span class="hljs-comment"># Max 5 subdirectories/recursions deep.</span>
E_BL=80                 <span class="hljs-comment"># Blank line already returned.</span>
E_DIR=81                <span class="hljs-comment"># Directory not specified.</span>


<span class="hljs-comment">##########  DON'T CHANGE ANYTHING BELOW THIS LINE  ##########</span>

PID=$$                            <span class="hljs-comment"># Our own process ID.</span>
SELF=`basename <span class="hljs-variable">$0</span>`                <span class="hljs-comment"># Our own program name.</span>
TMP=<span class="hljs-string">"/tmp/<span class="hljs-variable">${SELF}</span>.<span class="hljs-variable">${PID}</span>.tmp"</span>     <span class="hljs-comment"># Temporary 'du' result.</span>

<span class="hljs-comment"># Convert number to dotted thousand.</span>
<span class="hljs-keyword">function</span> dot { <span class="hljs-built_in">echo</span> <span class="hljs-string">"            $*"</span> |
               sed -e :a -e <span class="hljs-string">'s/\(.*[0-9]\)\([0-9]\{3\}\)/\1,\2/;ta'</span> |
               tail -c 12; }

<span class="hljs-comment"># Usage: tree &lt;recursion&gt; &lt;indent prefix&gt; &lt;min size&gt; &lt;directory&gt;</span>
<span class="hljs-keyword">function</span> tree {
  recurs=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>           <span class="hljs-comment"># How deep nested are we?</span>
  prefix=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>           <span class="hljs-comment"># What do we display before file/dirname?</span>
  minsize=<span class="hljs-string">"<span class="hljs-variable">$3</span>"</span>          <span class="hljs-comment"># What is the minumum file/dirsize?</span>
  dirname=<span class="hljs-string">"<span class="hljs-variable">$4</span>"</span>          <span class="hljs-comment"># Which directory are we checking?</span>

<span class="hljs-comment"># Get ($TOP) biggest subdirs/subfiles from TMP file.</span>
  LIST=`egrep <span class="hljs-string">"[[:space:]]<span class="hljs-variable">${dirname}</span>/[^/]*$"</span> <span class="hljs-string">"<span class="hljs-variable">$TMP</span>"</span> |
        awk <span class="hljs-string">'{if($1&gt;'</span><span class="hljs-variable">$minsize</span><span class="hljs-string">') print;}'</span> | sort -nr | head -<span class="hljs-variable">$TOP</span>`
  [ -z <span class="hljs-string">"<span class="hljs-variable">$LIST</span>"</span> ] &amp;&amp; <span class="hljs-built_in">return</span>        <span class="hljs-comment"># Empty list, then go back.</span>

  cnt=0
  num=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$LIST</span>"</span> | wc -l`      <span class="hljs-comment"># How many entries in the list.</span>

  <span class="hljs-comment">## Main loop</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$LIST</span>"</span> | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> size name; <span class="hljs-keyword">do</span>
    ((cnt+=1))                    <span class="hljs-comment"># Count entry number.</span>
    bname=`basename <span class="hljs-string">"<span class="hljs-variable">$name</span>"</span>`      <span class="hljs-comment"># We only need a basename of the entry.</span>
    [ -d <span class="hljs-string">"<span class="hljs-variable">$name</span>"</span> ] &amp;&amp; bname=<span class="hljs-string">"<span class="hljs-variable">$bname</span>/"</span>
                                  <span class="hljs-comment"># If it's a directory, append a slash.</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"`dot <span class="hljs-variable">$size</span>`<span class="hljs-variable">$prefix</span> +-<span class="hljs-variable">$bname</span>"</span>
                                  <span class="hljs-comment"># Display the result.</span>
    <span class="hljs-comment">#  Call ourself recursively if it's a directory</span>
    <span class="hljs-comment">#+ and we're not nested too deep ($MAXRECURS).</span>
    <span class="hljs-comment">#  The recursion goes up: $((recurs+1))</span>
    <span class="hljs-comment">#  The prefix gets a space if it's the last entry,</span>
    <span class="hljs-comment">#+ or a pipe if there are more entries.</span>
    <span class="hljs-comment">#  The minimum file/dirsize becomes</span>
    <span class="hljs-comment">#+ a tenth of his parent: $((size/10)).</span>
    <span class="hljs-comment"># Last argument is the full directory name to check.</span>
    <span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$name</span>"</span> -a <span class="hljs-variable">$recurs</span> -lt <span class="hljs-variable">$MAXRECURS</span> ]; <span class="hljs-keyword">then</span>
      [ <span class="hljs-variable">$cnt</span> -lt <span class="hljs-variable">$num</span> ] \
        || (tree $((recurs+<span class="hljs-number">1</span>)) <span class="hljs-string">"<span class="hljs-variable">$prefix</span>  "</span> $((size/<span class="hljs-number">10</span>)) <span class="hljs-string">"<span class="hljs-variable">$name</span>"</span>) \
        &amp;&amp; (tree $((recurs+<span class="hljs-number">1</span>)) <span class="hljs-string">"<span class="hljs-variable">$prefix</span> |"</span> $((size/<span class="hljs-number">10</span>)) <span class="hljs-string">"<span class="hljs-variable">$name</span>"</span>)
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>

  [ $? -eq 0 ] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">"           <span class="hljs-variable">$prefix</span>"</span>
  <span class="hljs-comment"># Every time we jump back add a 'blank' line.</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$E_BL</span>
  <span class="hljs-comment"># We return 80 to tell we added a blank line already.</span>
}

<span class="hljs-comment">###                ###</span>
<span class="hljs-comment">###  main program  ###</span>
<span class="hljs-comment">###                ###</span>

rootdir=<span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>
[ -d <span class="hljs-string">"<span class="hljs-variable">$rootdir</span>"</span> ] ||
  { <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$SELF</span>: Usage: <span class="hljs-variable">$SELF</span> &lt;directory&gt;"</span> &gt;&amp;2; <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_DIR</span>; }
  <span class="hljs-comment"># We should be called with a directory name.</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Building inventory list, please wait ..."</span>
     <span class="hljs-comment"># Show "please wait" message.</span>
du -akx <span class="hljs-string">"<span class="hljs-variable">$rootdir</span>"</span> 1&gt;<span class="hljs-string">"<span class="hljs-variable">$TMP</span>"</span> 2&gt;/dev/null
     <span class="hljs-comment"># Build a temporary list of all files/dirs and their size.</span>
size=`tail -1 <span class="hljs-string">"<span class="hljs-variable">$TMP</span>"</span> | awk <span class="hljs-string">'{print $1}'</span>`
     <span class="hljs-comment"># What is our rootdirectory's size?</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"`dot <span class="hljs-variable">$size</span>` <span class="hljs-variable">$rootdir</span>"</span>
     <span class="hljs-comment"># Display rootdirectory's entry.</span>
tree 0 <span class="hljs-string">""</span> 0 <span class="hljs-string">"<span class="hljs-variable">$rootdir</span>"</span>
     <span class="hljs-comment"># Display the tree below our rootdirectory.</span>

rm <span class="hljs-string">"<span class="hljs-variable">$TMP</span>"</span> 2&gt;/dev/null
     <span class="hljs-comment"># Clean up TMP file.</span>

<span class="hljs-built_in">exit</span> $?</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>
        Noah Friedman permitted use of his <em>string function</em> script. It
        essentially reproduces some of the <i class="FIRSTTERM">C</i>-library
        string manipulation functions.
      </p>
      <div class="EXAMPLE">
        <a name="STRING" id="STRING"></a>
        <p>
          <b>Example A-18. <i class="FIRSTTERM">string functions</i>: C-style
            string functions</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># string.bash --- bash emulation of string(3) library routines</span>
<span class="hljs-comment"># Author: Noah Friedman &lt;friedman@prep.ai.mit.edu&gt;</span>
<span class="hljs-comment"># ==&gt;     Used with his kind permission in this document.</span>
<span class="hljs-comment"># Created: 1992-07-01</span>
<span class="hljs-comment"># Last modified: 1993-09-29</span>
<span class="hljs-comment"># Public domain</span>

<span class="hljs-comment"># Conversion to bash v2 syntax done by Chet Ramey</span>

<span class="hljs-comment"># Commentary:</span>
<span class="hljs-comment"># Code:</span>

<span class="hljs-comment">#:docstring strcat:</span>
<span class="hljs-comment"># Usage: strcat s1 s2</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Strcat appends the value of variable s2 to variable s1. </span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Example:</span>
<span class="hljs-comment">#    a="foo"</span>
<span class="hljs-comment">#    b="bar"</span>
<span class="hljs-comment">#    strcat a b</span>
<span class="hljs-comment">#    echo $a</span>
<span class="hljs-comment">#    =&gt; foobar</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#:end docstring:</span>

<span class="hljs-comment">###;;;autoload   ==&gt; Autoloading of function commented out.</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">strcat</span></span> ()
{
    <span class="hljs-built_in">local</span> s1_val s2_val

    s1_val=<span class="hljs-variable">${!1}</span>                        <span class="hljs-comment"># indirect variable expansion</span>
    s2_val=<span class="hljs-variable">${!2}</span>
    <span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>=\<span class="hljs-string">'"${s1_val}${s2_val}"\'</span>
    <span class="hljs-comment"># ==&gt; eval $1='${s1_val}${s2_val}' avoids problems,</span>
    <span class="hljs-comment"># ==&gt; if one of the variables contains a single quote.</span>
}

<span class="hljs-comment">#:docstring strncat:</span>
<span class="hljs-comment"># Usage: strncat s1 s2 $n</span>
<span class="hljs-comment"># </span>
<span class="hljs-comment"># Line strcat, but strncat appends a maximum of n characters from the value</span>
<span class="hljs-comment"># of variable s2.  It copies fewer if the value of variabl s2 is shorter</span>
<span class="hljs-comment"># than n characters.  Echoes result on stdout.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Example:</span>
<span class="hljs-comment">#    a=foo</span>
<span class="hljs-comment">#    b=barbaz</span>
<span class="hljs-comment">#    strncat a b 3</span>
<span class="hljs-comment">#    echo $a</span>
<span class="hljs-comment">#    =&gt; foobar</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#:end docstring:</span>

<span class="hljs-comment">###;;;autoload</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">strncat</span></span> ()
{
    <span class="hljs-built_in">local</span> s1=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
    <span class="hljs-built_in">local</span> s2=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>
    <span class="hljs-built_in">local</span> -i n=<span class="hljs-string">"<span class="hljs-variable">$3</span>"</span>
    <span class="hljs-built_in">local</span> s1_val s2_val

    s1_val=<span class="hljs-variable">${!s1}</span>                       <span class="hljs-comment"># ==&gt; indirect variable expansion</span>
    s2_val=<span class="hljs-variable">${!s2}</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#s2_val}</span> -gt <span class="hljs-variable">${n}</span> ]; <span class="hljs-keyword">then</span>
       s2_val=<span class="hljs-variable">${s2_val:0:$n}</span>            <span class="hljs-comment"># ==&gt; substring extraction</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-variable">$s1</span>"</span>=\<span class="hljs-string">'"${s1_val}${s2_val}"\'</span>
    <span class="hljs-comment"># ==&gt; eval $1='${s1_val}${s2_val}' avoids problems,</span>
    <span class="hljs-comment"># ==&gt; if one of the variables contains a single quote.</span>
}

<span class="hljs-comment">#:docstring strcmp:</span>
<span class="hljs-comment"># Usage: strcmp $s1 $s2</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Strcmp compares its arguments and returns an integer less than, equal to,</span>
<span class="hljs-comment"># or greater than zero, depending on whether string s1 is lexicographically</span>
<span class="hljs-comment"># less than, equal to, or greater than string s2.</span>
<span class="hljs-comment">#:end docstring:</span>

<span class="hljs-comment">###;;;autoload</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">strcmp</span></span> ()
{
    [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> = <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ] &amp;&amp; <span class="hljs-built_in">return</span> 0

    [ <span class="hljs-string">"<span class="hljs-variable">${1}</span>"</span> <span class="hljs-string">'&lt;'</span> <span class="hljs-string">"<span class="hljs-variable">${2}</span>"</span> ] &gt; /dev/null &amp;&amp; <span class="hljs-built_in">return</span> -1

    <span class="hljs-built_in">return</span> 1
}

<span class="hljs-comment">#:docstring strncmp:</span>
<span class="hljs-comment"># Usage: strncmp $s1 $s2 $n</span>
<span class="hljs-comment"># </span>
<span class="hljs-comment"># Like strcmp, but makes the comparison by examining a maximum of n</span>
<span class="hljs-comment"># characters (n less than or equal to zero yields equality).</span>
<span class="hljs-comment">#:end docstring:</span>

<span class="hljs-comment">###;;;autoload</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">strncmp</span></span> ()
{
    <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">${3}</span>"</span> -o <span class="hljs-string">"<span class="hljs-variable">${3}</span>"</span> -le <span class="hljs-string">"0"</span> ]; <span class="hljs-keyword">then</span>
       <span class="hljs-built_in">return</span> 0
    <span class="hljs-keyword">fi</span>
   
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${3}</span> -ge <span class="hljs-variable">${#1}</span> -a <span class="hljs-variable">${3}</span> -ge <span class="hljs-variable">${#2}</span> ]; <span class="hljs-keyword">then</span>
       strcmp <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>
       <span class="hljs-built_in">return</span> $?
    <span class="hljs-keyword">else</span>
       s1=<span class="hljs-variable">${1:0:$3}</span>
       s2=<span class="hljs-variable">${2:0:$3}</span>
       strcmp <span class="hljs-variable">$s1</span> <span class="hljs-variable">$s2</span>
       <span class="hljs-built_in">return</span> $?
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment">#:docstring strlen:</span>
<span class="hljs-comment"># Usage: strlen s</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Strlen returns the number of characters in string literal s.</span>
<span class="hljs-comment">#:end docstring:</span>

<span class="hljs-comment">###;;;autoload</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">strlen</span></span> ()
{
    <span class="hljs-built_in">eval</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"\${#<span class="hljs-variable">${1}</span>}"</span>
    <span class="hljs-comment"># ==&gt; Returns the length of the value of the variable</span>
    <span class="hljs-comment"># ==&gt; whose name is passed as an argument.</span>
}

<span class="hljs-comment">#:docstring strspn:</span>
<span class="hljs-comment"># Usage: strspn $s1 $s2</span>
<span class="hljs-comment"># </span>
<span class="hljs-comment"># Strspn returns the length of the maximum initial segment of string s1,</span>
<span class="hljs-comment"># which consists entirely of characters from string s2.</span>
<span class="hljs-comment">#:end docstring:</span>

<span class="hljs-comment">###;;;autoload</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">strspn</span></span> ()
{
    <span class="hljs-comment"># Unsetting IFS allows whitespace to be handled as normal chars. </span>
    <span class="hljs-built_in">local</span> IFS=
    <span class="hljs-built_in">local</span> result=<span class="hljs-string">"<span class="hljs-variable">${1%%[!${2}</span>]*}"</span>
 
    <span class="hljs-built_in">echo</span> <span class="hljs-variable">${#result}</span>
}

<span class="hljs-comment">#:docstring strcspn:</span>
<span class="hljs-comment"># Usage: strcspn $s1 $s2</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Strcspn returns the length of the maximum initial segment of string s1,</span>
<span class="hljs-comment"># which consists entirely of characters not from string s2.</span>
<span class="hljs-comment">#:end docstring:</span>

<span class="hljs-comment">###;;;autoload</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">strcspn</span></span> ()
{
    <span class="hljs-comment"># Unsetting IFS allows whitspace to be handled as normal chars. </span>
    <span class="hljs-built_in">local</span> IFS=
    <span class="hljs-built_in">local</span> result=<span class="hljs-string">"<span class="hljs-variable">${1%%[${2}</span>]*}"</span>
 
    <span class="hljs-built_in">echo</span> <span class="hljs-variable">${#result}</span>
}

<span class="hljs-comment">#:docstring strstr:</span>
<span class="hljs-comment"># Usage: strstr s1 s2</span>
<span class="hljs-comment"># </span>
<span class="hljs-comment"># Strstr echoes a substring starting at the first occurrence of string s2 in</span>
<span class="hljs-comment"># string s1, or nothing if s2 does not occur in the string.  If s2 points to</span>
<span class="hljs-comment"># a string of zero length, strstr echoes s1.</span>
<span class="hljs-comment">#:end docstring:</span>

<span class="hljs-comment">###;;;autoload</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">strstr</span></span> ()
{
    <span class="hljs-comment"># if s2 points to a string of zero length, strstr echoes s1</span>
    [ <span class="hljs-variable">${#2}</span> -eq 0 ] &amp;&amp; { <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ; <span class="hljs-built_in">return</span> 0; }

    <span class="hljs-comment"># strstr echoes nothing if s2 does not occur in s1</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-keyword">in</span>
    *<span class="hljs-variable">$2</span>*) ;;
    *) <span class="hljs-built_in">return</span> 1;;
    <span class="hljs-keyword">esac</span>

    <span class="hljs-comment"># use the pattern matching code to strip off the match and everything</span>
    <span class="hljs-comment"># following it</span>
    first=<span class="hljs-variable">${1/$2*/}</span>

    <span class="hljs-comment"># then strip off the first unmatched portion of the string</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${1##$first}</span>"</span>
}

<span class="hljs-comment">#:docstring strtok:</span>
<span class="hljs-comment"># Usage: strtok s1 s2</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Strtok considers the string s1 to consist of a sequence of zero or more</span>
<span class="hljs-comment"># text tokens separated by spans of one or more characters from the</span>
<span class="hljs-comment"># separator string s2.  The first call (with a non-empty string s1</span>
<span class="hljs-comment"># specified) echoes a string consisting of the first token on stdout. The</span>
<span class="hljs-comment"># function keeps track of its position in the string s1 between separate</span>
<span class="hljs-comment"># calls, so that subsequent calls made with the first argument an empty</span>
<span class="hljs-comment"># string will work through the string immediately following that token.  In</span>
<span class="hljs-comment"># this way subsequent calls will work through the string s1 until no tokens</span>
<span class="hljs-comment"># remain.  The separator string s2 may be different from call to call.</span>
<span class="hljs-comment"># When no token remains in s1, an empty value is echoed on stdout.</span>
<span class="hljs-comment">#:end docstring:</span>

<span class="hljs-comment">###;;;autoload</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">strtok</span></span> ()
{
 :
}

<span class="hljs-comment">#:docstring strtrunc:</span>
<span class="hljs-comment"># Usage: strtrunc $n $s1 {$s2} {$...}</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Used by many functions like strncmp to truncate arguments for comparison.</span>
<span class="hljs-comment"># Echoes the first n characters of each string s1 s2 ... on stdout. </span>
<span class="hljs-comment">#:end docstring:</span>

<span class="hljs-comment">###;;;autoload</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">strtrunc</span></span> ()
{
    n=<span class="hljs-variable">$1</span> ; <span class="hljs-built_in">shift</span>
    <span class="hljs-keyword">for</span> z; <span class="hljs-keyword">do</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${z:0:$n}</span>"</span>
    <span class="hljs-keyword">done</span>
}

<span class="hljs-comment"># provide string</span>

<span class="hljs-comment"># string.bash ends here</span>


<span class="hljs-comment"># ========================================================================== #</span>
<span class="hljs-comment"># ==&gt; Everything below here added by the document author.</span>

<span class="hljs-comment"># ==&gt; Suggested use of this script is to delete everything below here,</span>
<span class="hljs-comment"># ==&gt; and "source" this file into your own scripts.</span>

<span class="hljs-comment"># strcat</span>
string0=one
string1=two
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Testing \"strcat\" function:"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Original \"string0\" = <span class="hljs-variable">$string0</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"\"string1\" = <span class="hljs-variable">$string1</span>"</span>
strcat string0 string1
<span class="hljs-built_in">echo</span> <span class="hljs-string">"New \"string0\" = <span class="hljs-variable">$string0</span>"</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># strlen</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Testing \"strlen\" function:"</span>
str=123456789
<span class="hljs-built_in">echo</span> <span class="hljs-string">"\"str\" = <span class="hljs-variable">$str</span>"</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Length of \"str\" = "</span>
strlen str
<span class="hljs-built_in">echo</span>



<span class="hljs-comment"># Exercise:</span>
<span class="hljs-comment"># --------</span>
<span class="hljs-comment"># Add code to test all the other string functions above.</span>


<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>
        Michael Zick's complex array example uses the
        <a href="filearchiv.html#MD5SUMREF">md5sum</a> check sum command to
        encode directory information.
      </p>
      <div class="EXAMPLE">
        <a name="DIRECTORYINFO" id="DIRECTORYINFO"></a>
        <p><b>Example A-19. Directory information</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#! /bin/bash</span>
<span class="hljs-comment"># directory-info.sh</span>
<span class="hljs-comment"># Parses and lists directory information.</span>

<span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Change lines 273 and 353 per "README" file.</span>

<span class="hljs-comment"># Michael Zick is the author of this script.</span>
<span class="hljs-comment"># Used here with his permission.</span>

<span class="hljs-comment"># Controls</span>
<span class="hljs-comment"># If overridden by command arguments, they must be in the order:</span>
<span class="hljs-comment">#   Arg1: "Descriptor Directory"</span>
<span class="hljs-comment">#   Arg2: "Exclude Paths"</span>
<span class="hljs-comment">#   Arg3: "Exclude Directories"</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Environment Settings override Defaults.</span>
<span class="hljs-comment"># Command arguments override Environment Settings.</span>

<span class="hljs-comment"># Default location for content addressed file descriptors.</span>
MD5UCFS=<span class="hljs-variable">${1:-<span class="hljs-variable">${MD5UCFS:-'/tmpfs/ucfs'}</span>}</span>

<span class="hljs-comment"># Directory paths never to list or enter</span>
<span class="hljs-built_in">declare</span> -a \
  EXCLUDE_PATHS=<span class="hljs-variable">${2:-<span class="hljs-variable">${EXCLUDE_PATHS:-'(/proc /dev /devfs /tmpfs)'}</span>}</span>

<span class="hljs-comment"># Directories never to list or enter</span>
<span class="hljs-built_in">declare</span> -a \
  EXCLUDE_DIRS=<span class="hljs-variable">${3:-<span class="hljs-variable">${EXCLUDE_DIRS:-'(ucfs lost+found tmp wtmp)'}</span>}</span>

<span class="hljs-comment"># Files never to list or enter</span>
<span class="hljs-built_in">declare</span> -a \
  EXCLUDE_FILES=<span class="hljs-variable">${3:-<span class="hljs-variable">${EXCLUDE_FILES:-'(core "Name with Spaces")'}</span>}</span>


<span class="hljs-comment"># Here document used as a comment block.</span>
: &lt;&lt;LSfieldsDoc
<span class="hljs-comment"># # # # # List Filesystem Directory Information # # # # #</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       ListDirectory "FileGlob" "Field-Array-Name"</span>
<span class="hljs-comment"># or</span>
<span class="hljs-comment">#       ListDirectory -of "FileGlob" "Field-Array-Filename"</span>
<span class="hljs-comment">#       '-of' meaning 'output to filename'</span>
<span class="hljs-comment"># # # # #</span>

String format description based on: ls (GNU fileutils) version 4.0.36

Produces a line (or more) formatted:
inode permissions hard-links owner group ...
32736 -rw-------    1 mszick   mszick

size    day month date hh:mm:ss year path
2756608 Sun Apr 20 08:53:06 2003 /home/mszick/core

Unless it is formatted:
inode permissions hard-links owner group ...
266705 crw-rw----    1    root  uucp

major minor day month date hh:mm:ss year path
4,  68 Sun Apr 20 09:27:33 2003 /dev/ttyS4
NOTE: that pesky comma after the major number

NOTE: the <span class="hljs-string">'path'</span> may be multiple fields:
/home/mszick/core
/proc/982/fd/0 -&gt; /dev/null
/proc/982/fd/1 -&gt; /home/mszick/.xsession-errors
/proc/982/fd/13 -&gt; /tmp/tmpfZVVOCs (deleted)
/proc/982/fd/7 -&gt; /tmp/kde-mszick/ksycoca
/proc/982/fd/8 -&gt; socket:[11586]
/proc/982/fd/9 -&gt; pipe:[11588]

If that isn<span class="hljs-string">'t enough to keep your parser guessing,
either or both of the path components may be relative:
../Built-Shared -&gt; Built-Static
../linux-2.4.20.tar.bz2 -&gt; ../../../SRCS/linux-2.4.20.tar.bz2

The first character of the 11 (10?) character permissions field:
'</span>s<span class="hljs-string">' Socket
'</span>d<span class="hljs-string">' Directory
'</span>b<span class="hljs-string">' Block device
'</span>c<span class="hljs-string">' Character device
'</span>l<span class="hljs-string">' Symbolic link
NOTE: Hard links not marked - test for identical inode numbers
on identical filesystems.
All information about hard linked files are shared, except
for the names and the name'</span>s location <span class="hljs-keyword">in</span> the directory system.
NOTE: A <span class="hljs-string">"Hard link"</span> is known as a <span class="hljs-string">"File Alias"</span> on some systems.
<span class="hljs-string">'-'</span> An undistingushed file

Followed by three groups of letters <span class="hljs-keyword">for</span>: User, Group, Others
Character 1: <span class="hljs-string">'-'</span> Not readable; <span class="hljs-string">'r'</span> Readable
Character 2: <span class="hljs-string">'-'</span> Not writable; <span class="hljs-string">'w'</span> Writable
Character 3, User and Group: Combined execute and special
<span class="hljs-string">'-'</span> Not Executable, Not Special
<span class="hljs-string">'x'</span> Executable, Not Special
<span class="hljs-string">'s'</span> Executable, Special
<span class="hljs-string">'S'</span> Not Executable, Special
Character 3, Others: Combined execute and sticky (tacky?)
<span class="hljs-string">'-'</span> Not Executable, Not Tacky
<span class="hljs-string">'x'</span> Executable, Not Tacky
<span class="hljs-string">'t'</span> Executable, Tacky
<span class="hljs-string">'T'</span> Not Executable, Tacky

Followed by an access indicator
Haven<span class="hljs-string">'t tested this one, it may be the eleventh character
or it may generate another field
'</span> <span class="hljs-string">' No alternate access
'</span>+<span class="hljs-string">' Alternate access
LSfieldsDoc


ListDirectory()
{
        local -a T
        local -i of=0           # Default return in variable
#       OLD_IFS=$IFS            # Using BASH default '</span> \t\n<span class="hljs-string">'

        case "$#" in
        3)      case "$1" in
                -of)    of=1 ; shift ;;
                 * )    return 1 ;;
                esac ;;
        2)      : ;;            # Poor man'</span>s <span class="hljs-string">"continue"</span>
        *)      <span class="hljs-built_in">return</span> 1 ;;
        <span class="hljs-keyword">esac</span>

        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> the (ls) command is NOT quoted (")</span>
        T=( $(ls --inode --ignore-backups --almost-all --directory \
        --full-time --color=none --time=status --sort=none \
        --format=long <span class="hljs-variable">$1</span>) )

        <span class="hljs-keyword">case</span> <span class="hljs-variable">$of</span> <span class="hljs-keyword">in</span>
        <span class="hljs-comment"># Assign T back to the array whose name was passed as $2</span>
                0) <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\( \"\$\{T\[@\]\}\" \) ;;
        <span class="hljs-comment"># Write T into filename passed as $2</span>
                1) <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${T[@]}</span>"</span> &gt; <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ;;
        <span class="hljs-keyword">esac</span>
        <span class="hljs-built_in">return</span> 0
   }

<span class="hljs-comment"># # # # # Is that string a legal number? # # # # #</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       IsNumber "Var"</span>
<span class="hljs-comment"># # # # # There has to be a better way, sigh...</span>

<span class="hljs-function"><span class="hljs-title">IsNumber</span></span>()
{
        <span class="hljs-built_in">local</span> -i int
        <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -eq 0 ]
        <span class="hljs-keyword">then</span>
                <span class="hljs-built_in">return</span> 1
        <span class="hljs-keyword">else</span>
                (<span class="hljs-built_in">let</span> int=<span class="hljs-variable">$1</span>)  2&gt;/dev/null
                <span class="hljs-built_in">return</span> $?       <span class="hljs-comment"># Exit status of the let thread</span>
        <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># # # # # Index Filesystem Directory Information # # # # #</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       IndexList "Field-Array-Name" "Index-Array-Name"</span>
<span class="hljs-comment"># or</span>
<span class="hljs-comment">#       IndexList -if Field-Array-Filename Index-Array-Name</span>
<span class="hljs-comment">#       IndexList -of Field-Array-Name Index-Array-Filename</span>
<span class="hljs-comment">#       IndexList -if -of Field-Array-Filename Index-Array-Filename</span>
<span class="hljs-comment"># # # # #</span>

: &lt;&lt;IndexListDoc
Walk an array of directory fields produced by ListDirectory

Having suppressed the line breaks <span class="hljs-keyword">in</span> an otherwise line oriented
report, build an index to the array element <span class="hljs-built_in">which</span> starts each line.

Each line gets two index entries, the first element of each line
(inode) and the element that holds the pathname of the file.

The first index entry pair (Line-Number==0) are informational:
Index-Array-Name[0] : Number of <span class="hljs-string">"Lines"</span> indexed
Index-Array-Name[1] : <span class="hljs-string">"Current Line"</span> pointer into Index-Array-Name

The following index pairs (<span class="hljs-keyword">if</span> any) hold element indexes into
the Field-Array-Name per:
Index-Array-Name[Line-Number * 2] : The <span class="hljs-string">"inode"</span> field element.
NOTE: This distance may be either +11 or +12 elements.
Index-Array-Name[(Line-Number * 2) + 1] : The <span class="hljs-string">"pathname"</span> element.
NOTE: This distance may be a variable number of elements.
Next line index pair <span class="hljs-keyword">for</span> Line-Number+1.
IndexListDoc



<span class="hljs-function"><span class="hljs-title">IndexList</span></span>()
{
        <span class="hljs-built_in">local</span> -a LIST                   <span class="hljs-comment"># Local of listname passed</span>
        <span class="hljs-built_in">local</span> -a -i INDEX=( 0 0 )       <span class="hljs-comment"># Local of index to return</span>
        <span class="hljs-built_in">local</span> -i Lidx Lcnt
        <span class="hljs-built_in">local</span> -i <span class="hljs-keyword">if</span>=0 of=0              <span class="hljs-comment"># Default to variable names</span>

        <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$#</span>"</span> <span class="hljs-keyword">in</span>                    <span class="hljs-comment"># Simplistic option testing</span>
                0) <span class="hljs-built_in">return</span> 1 ;;
                1) <span class="hljs-built_in">return</span> 1 ;;
                2) : ;;                 <span class="hljs-comment"># Poor man's continue</span>
                3) <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-keyword">in</span>
                        -<span class="hljs-keyword">if</span>) <span class="hljs-keyword">if</span>=1 ;;
                        -of) of=1 ;;
                         * ) <span class="hljs-built_in">return</span> 1 ;;
                   <span class="hljs-keyword">esac</span> ; <span class="hljs-built_in">shift</span> ;;
                4) <span class="hljs-keyword">if</span>=1 ; of=1 ; <span class="hljs-built_in">shift</span> ; <span class="hljs-built_in">shift</span> ;;
                *) <span class="hljs-built_in">return</span> 1
        <span class="hljs-keyword">esac</span>

        <span class="hljs-comment"># Make local copy of list</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$if</span>"</span> <span class="hljs-keyword">in</span>
                0) <span class="hljs-built_in">eval</span> LIST=\( \"\$\{<span class="hljs-variable">$1</span>\[@\]\}\" \) ;;
                1) LIST=( $(cat <span class="hljs-variable">$1</span>) ) ;;
        <span class="hljs-keyword">esac</span>

        <span class="hljs-comment"># Grok (grope?) the array</span>
        Lcnt=<span class="hljs-variable">${#LIST[@]}</span>
        Lidx=0
        until (( Lidx &gt;= Lcnt ))
        <span class="hljs-keyword">do</span>
        <span class="hljs-keyword">if</span> IsNumber <span class="hljs-variable">${LIST[$Lidx]}</span>
        <span class="hljs-keyword">then</span>
                <span class="hljs-built_in">local</span> -i inode name
                <span class="hljs-built_in">local</span> ft
                inode=Lidx
                <span class="hljs-built_in">local</span> m=<span class="hljs-variable">${LIST[$Lidx+2]}</span>        <span class="hljs-comment"># Hard Links field</span>
                ft=<span class="hljs-variable">${LIST[$Lidx+1]:0:1}</span>         <span class="hljs-comment"># Fast-Stat</span>
                <span class="hljs-keyword">case</span> <span class="hljs-variable">$ft</span> <span class="hljs-keyword">in</span>
                b)      ((Lidx+=12)) ;;         <span class="hljs-comment"># Block device</span>
                c)      ((Lidx+=12)) ;;         <span class="hljs-comment"># Character device</span>
                *)      ((Lidx+=11)) ;;         <span class="hljs-comment"># Anything else</span>
                <span class="hljs-keyword">esac</span>
                name=Lidx
                <span class="hljs-keyword">case</span> <span class="hljs-variable">$ft</span> <span class="hljs-keyword">in</span>
                -)      ((Lidx+=1)) ;;          <span class="hljs-comment"># The easy one</span>
                b)      ((Lidx+=1)) ;;          <span class="hljs-comment"># Block device</span>
                c)      ((Lidx+=1)) ;;          <span class="hljs-comment"># Character device</span>
                d)      ((Lidx+=1)) ;;          <span class="hljs-comment"># The other easy one</span>
                l)      ((Lidx+=3)) ;;          <span class="hljs-comment"># At LEAST two more fields</span>
<span class="hljs-comment">#  A little more elegance here would handle pipes,</span>
<span class="hljs-comment">#+ sockets, deleted files - later.</span>
                *)      until IsNumber <span class="hljs-variable">${LIST[$Lidx]}</span> || ((Lidx &gt;= Lcnt))
                        <span class="hljs-keyword">do</span>
                                ((Lidx+=1))
                        <span class="hljs-keyword">done</span>
                        ;;                      <span class="hljs-comment"># Not required</span>
                <span class="hljs-keyword">esac</span>
                INDEX[<span class="hljs-variable">${#INDEX[*]}</span>]=<span class="hljs-variable">$inode</span>
                INDEX[<span class="hljs-variable">${#INDEX[*]}</span>]=<span class="hljs-variable">$name</span>
                INDEX[0]=<span class="hljs-variable">${INDEX[0]}</span>+1          <span class="hljs-comment"># One more "line" found</span>
<span class="hljs-comment"># echo "Line: ${INDEX[0]} Type: $ft Links: $m Inode: \</span>
<span class="hljs-comment"># ${LIST[$inode]} Name: ${LIST[$name]}"</span>

        <span class="hljs-keyword">else</span>
                ((Lidx+=1))
        <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">done</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$of</span>"</span> <span class="hljs-keyword">in</span>
                0) <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\( \"\$\{INDEX\[@\]\}\" \) ;;
                1) <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${INDEX[@]}</span>"</span> &gt; <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ;;
        <span class="hljs-keyword">esac</span>
        <span class="hljs-built_in">return</span> 0                                <span class="hljs-comment"># What could go wrong?</span>
}

<span class="hljs-comment"># # # # # Content Identify File # # # # #</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       DigestFile Input-Array-Name Digest-Array-Name</span>
<span class="hljs-comment"># or</span>
<span class="hljs-comment">#       DigestFile -if Input-FileName Digest-Array-Name</span>
<span class="hljs-comment"># # # # #</span>

<span class="hljs-comment"># Here document used as a comment block.</span>
: &lt;&lt;DigestFilesDoc

The key (no pun intended) to a Unified Content File System (UCFS)
is to distinguish the files <span class="hljs-keyword">in</span> the system based on their content.
Distinguishing files by their name is just so 20th Century.

The content is distinguished by computing a checksum of that content.
This version uses the md5sum program to generate a 128 bit checksum
representative of the file<span class="hljs-string">'s contents.
There is a chance that two files having different content might
generate the same checksum using md5sum (or any checksum).  Should
that become a problem, then the use of md5sum can be replace by a
cyrptographic signature.  But until then...

The md5sum program is documented as outputting three fields (and it
does), but when read it appears as two fields (array elements).  This
is caused by the lack of whitespace between the second and third field.
So this function gropes the md5sum output and returns:
        [0]     32 character checksum in hexidecimal (UCFS filename)
        [1]     Single character: '</span> <span class="hljs-string">' text file, '</span>*<span class="hljs-string">' binary file
        [2]     Filesystem (20th Century Style) name
        Note: That name may be the character '</span>-<span class="hljs-string">' indicating STDIN read.

DigestFilesDoc



DigestFile()
{
        local if=0              # Default, variable name
        local -a T1 T2

        case "$#" in
        3)      case "$1" in
                -if)    if=1 ; shift ;;
                 * )    return 1 ;;
                esac ;;
        2)      : ;;            # Poor man'</span>s <span class="hljs-string">"continue"</span>
        *)      <span class="hljs-built_in">return</span> 1 ;;
        <span class="hljs-keyword">esac</span>

        <span class="hljs-keyword">case</span> <span class="hljs-variable">$if</span> <span class="hljs-keyword">in</span>
        0) <span class="hljs-built_in">eval</span> T1=\( \"\$\{<span class="hljs-variable">$1</span>\[@\]\}\" \)
           T2=( $(<span class="hljs-built_in">echo</span> <span class="hljs-variable">${T1[@]}</span> | md5sum -) )
           ;;
        1) T2=( $(md5sum <span class="hljs-variable">$1</span>) )
           ;;
        <span class="hljs-keyword">esac</span>

        <span class="hljs-keyword">case</span> <span class="hljs-variable">${#T2[@]}</span> <span class="hljs-keyword">in</span>
        0) <span class="hljs-built_in">return</span> 1 ;;
        1) <span class="hljs-built_in">return</span> 1 ;;
        2) <span class="hljs-keyword">case</span> <span class="hljs-variable">${T2[1]:0:1}</span> <span class="hljs-keyword">in</span>         <span class="hljs-comment"># SanScrit-2.0.5</span>
           \*) T2[<span class="hljs-variable">${#T2[@]}</span>]=<span class="hljs-variable">${T2[1]:1}</span>
               T2[1]=\*
               ;;
            *) T2[<span class="hljs-variable">${#T2[@]}</span>]=<span class="hljs-variable">${T2[1]}</span>
               T2[1]=<span class="hljs-string">" "</span>
               ;;
           <span class="hljs-keyword">esac</span>
           ;;
        3) : ;; <span class="hljs-comment"># Assume it worked</span>
        *) <span class="hljs-built_in">return</span> 1 ;;
        <span class="hljs-keyword">esac</span>

        <span class="hljs-built_in">local</span> -i len=<span class="hljs-variable">${#T2[0]}</span>
        <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$len</span> -ne 32 ] ; <span class="hljs-keyword">then</span> <span class="hljs-built_in">return</span> 1 ; <span class="hljs-keyword">fi</span>
        <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\( \"\$\{T2\[@\]\}\" \)
}

<span class="hljs-comment"># # # # # Locate File # # # # #</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       LocateFile [-l] FileName Location-Array-Name</span>
<span class="hljs-comment"># or</span>
<span class="hljs-comment">#       LocateFile [-l] -of FileName Location-Array-FileName</span>
<span class="hljs-comment"># # # # #</span>

<span class="hljs-comment"># A file location is Filesystem-id and inode-number</span>

<span class="hljs-comment"># Here document used as a comment block.</span>
: &lt;&lt;StatFieldsDoc
        Based on <span class="hljs-built_in">stat</span>, version 2.2
        <span class="hljs-built_in">stat</span> -t and <span class="hljs-built_in">stat</span> -lt fields
        [0]     name
        [1]     Total size
                File - number of bytes
                Symbolic link - string length of pathname
        [2]     Number of (512 byte) blocks allocated
        [3]     File <span class="hljs-built_in">type</span> and Access rights (hex)
        [4]     User ID of owner
        [5]     Group ID of owner
        [6]     Device number
        [7]     Inode number
        [8]     Number of hard links
        [9]     Device <span class="hljs-built_in">type</span> (<span class="hljs-keyword">if</span> inode device) Major
        [10]    Device <span class="hljs-built_in">type</span> (<span class="hljs-keyword">if</span> inode device) Minor
        [11]    Time of last access
                May be disabled <span class="hljs-keyword">in</span> <span class="hljs-string">'mount'</span> with noatime
                atime of files changed by <span class="hljs-built_in">exec</span>, <span class="hljs-built_in">read</span>, pipe, utime, mknod (mmap?)
                atime of directories changed by addition/deletion of files
        [12]    Time of last modification
                mtime of files changed by write, truncate, utime, mknod
                mtime of directories changed by addtition/deletion of files
        [13]    Time of last change
                ctime reflects time of changed inode information (owner, group
                permissions, link count
-*-*- Per:
        Return code: 0
        Size of array: 14
        Contents of array
        Element 0: /home/mszick
        Element 1: 4096
        Element 2: 8
        Element 3: 41e8
        Element 4: 500
        Element 5: 500
        Element 6: 303
        Element 7: 32385
        Element 8: 22
        Element 9: 0
        Element 10: 0
        Element 11: 1051221030
        Element 12: 1051214068
        Element 13: 1051214068

        For a link <span class="hljs-keyword">in</span> the form of linkname -&gt; realname
        <span class="hljs-built_in">stat</span> -t  linkname returns the linkname (link) information
        <span class="hljs-built_in">stat</span> -lt linkname returns the realname information

        <span class="hljs-built_in">stat</span> -tf and <span class="hljs-built_in">stat</span> -ltf fields
        [0]     name
        [1]     ID-0?           <span class="hljs-comment"># Maybe someday, but Linux stat structure</span>
        [2]     ID-0?           <span class="hljs-comment"># does not have either LABEL nor UUID</span>
                                <span class="hljs-comment"># fields, currently information must come</span>
                                <span class="hljs-comment"># from file-system specific utilities</span>
        These will be munged into:
        [1]     UUID <span class="hljs-keyword">if</span> possible
        [2]     Volume Label <span class="hljs-keyword">if</span> possible
        Note: <span class="hljs-string">'mount -l'</span> does <span class="hljs-built_in">return</span> the label and could <span class="hljs-built_in">return</span> the UUID

        [3]     Maximum length of filenames
        [4]     Filesystem <span class="hljs-built_in">type</span>
        [5]     Total blocks <span class="hljs-keyword">in</span> the filesystem
        [6]     Free blocks
        [7]     Free blocks <span class="hljs-keyword">for</span> non-root user(s)
        [8]     Block size of the filesystem
        [9]     Total inodes
        [10]    Free inodes

-*-*- Per:
        Return code: 0
        Size of array: 11
        Contents of array
        Element 0: /home/mszick
        Element 1: 0
        Element 2: 0
        Element 3: 255
        Element 4: ef53
        Element 5: 2581445
        Element 6: 2277180
        Element 7: 2146050
        Element 8: 4096
        Element 9: 1311552
        Element 10: 1276425

StatFieldsDoc


<span class="hljs-comment">#       LocateFile [-l] FileName Location-Array-Name</span>
<span class="hljs-comment">#       LocateFile [-l] -of FileName Location-Array-FileName</span>

<span class="hljs-function"><span class="hljs-title">LocateFile</span></span>()
{
        <span class="hljs-built_in">local</span> -a LOC LOC1 LOC2
        <span class="hljs-built_in">local</span> lk=<span class="hljs-string">""</span> of=0

        <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$#</span>"</span> <span class="hljs-keyword">in</span>
        0) <span class="hljs-built_in">return</span> 1 ;;
        1) <span class="hljs-built_in">return</span> 1 ;;
        2) : ;;
        *) <span class="hljs-keyword">while</span> (( <span class="hljs-string">"<span class="hljs-variable">$#</span>"</span> &gt; 2 ))
           <span class="hljs-keyword">do</span>
              <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-keyword">in</span>
               -l) lk=-1 ;;
              -of) of=1 ;;
                *) <span class="hljs-built_in">return</span> 1 ;;
              <span class="hljs-keyword">esac</span>
           <span class="hljs-built_in">shift</span>
           <span class="hljs-keyword">done</span> ;;
        <span class="hljs-keyword">esac</span>

<span class="hljs-comment"># More Sanscrit-2.0.5</span>
      <span class="hljs-comment"># LOC1=( $(stat -t $lk $1) )</span>
      <span class="hljs-comment"># LOC2=( $(stat -tf $lk $1) )</span>
      <span class="hljs-comment"># Uncomment above two lines if system has "stat" command installed.</span>
        LOC=( <span class="hljs-variable">${LOC1[@]:0:1}</span> <span class="hljs-variable">${LOC1[@]:3:11}</span>
              <span class="hljs-variable">${LOC2[@]:1:2}</span> <span class="hljs-variable">${LOC2[@]:4:1}</span> )

        <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$of</span>"</span> <span class="hljs-keyword">in</span>
                0) <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\( \"\$\{LOC\[@\]\}\" \) ;;
                1) <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${LOC[@]}</span>"</span> &gt; <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ;;
        <span class="hljs-keyword">esac</span>
        <span class="hljs-built_in">return</span> 0
<span class="hljs-comment"># Which yields (if you are lucky, and have "stat" installed)</span>
<span class="hljs-comment"># -*-*- Location Discriptor -*-*-</span>
<span class="hljs-comment">#       Return code: 0</span>
<span class="hljs-comment">#       Size of array: 15</span>
<span class="hljs-comment">#       Contents of array</span>
<span class="hljs-comment">#       Element 0: /home/mszick         20th Century name</span>
<span class="hljs-comment">#       Element 1: 41e8                 Type and Permissions</span>
<span class="hljs-comment">#       Element 2: 500                  User</span>
<span class="hljs-comment">#       Element 3: 500                  Group</span>
<span class="hljs-comment">#       Element 4: 303                  Device</span>
<span class="hljs-comment">#       Element 5: 32385                inode</span>
<span class="hljs-comment">#       Element 6: 22                   Link count</span>
<span class="hljs-comment">#       Element 7: 0                    Device Major</span>
<span class="hljs-comment">#       Element 8: 0                    Device Minor</span>
<span class="hljs-comment">#       Element 9: 1051224608           Last Access</span>
<span class="hljs-comment">#       Element 10: 1051214068          Last Modify</span>
<span class="hljs-comment">#       Element 11: 1051214068          Last Status</span>
<span class="hljs-comment">#       Element 12: 0                   UUID (to be)</span>
<span class="hljs-comment">#       Element 13: 0                   Volume Label (to be)</span>
<span class="hljs-comment">#       Element 14: ef53                Filesystem type</span>
}



<span class="hljs-comment"># And then there was some test code</span>

ListArray() <span class="hljs-comment"># ListArray Name</span>
{
        <span class="hljs-built_in">local</span> -a Ta

        <span class="hljs-built_in">eval</span> Ta=\( \"\$\{<span class="hljs-variable">$1</span>\[@\]\}\" \)
        <span class="hljs-built_in">echo</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"-*-*- List of Array -*-*-"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Size of array <span class="hljs-variable">$1</span>: <span class="hljs-variable">${#Ta[*]}</span>"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Contents of array <span class="hljs-variable">$1</span>:"</span>
        <span class="hljs-keyword">for</span> (( i=0 ; i&lt;<span class="hljs-variable">${#Ta[*]}</span> ; i++ ))
        <span class="hljs-keyword">do</span>
            <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\tElement <span class="hljs-variable">$i</span>: <span class="hljs-variable">${Ta[$i]}</span>"</span>
        <span class="hljs-keyword">done</span>
        <span class="hljs-built_in">return</span> 0
}

<span class="hljs-built_in">declare</span> -a CUR_DIR
<span class="hljs-comment"># For small arrays</span>
ListDirectory <span class="hljs-string">"<span class="hljs-variable">${PWD}</span>"</span> CUR_DIR
ListArray CUR_DIR

<span class="hljs-built_in">declare</span> -a DIR_DIG
DigestFile CUR_DIR DIR_DIG
<span class="hljs-built_in">echo</span> <span class="hljs-string">"The new \"name\" (checksum) for <span class="hljs-variable">${CUR_DIR[9]}</span> is <span class="hljs-variable">${DIR_DIG[0]}</span>"</span>

<span class="hljs-built_in">declare</span> -a DIR_ENT
<span class="hljs-comment"># BIG_DIR # For really big arrays - use a temporary file in ramdisk</span>
<span class="hljs-comment"># BIG-DIR # ListDirectory -of "${CUR_DIR[11]}/*" "/tmpfs/junk2"</span>
ListDirectory <span class="hljs-string">"<span class="hljs-variable">${CUR_DIR[11]}</span>/*"</span> DIR_ENT

<span class="hljs-built_in">declare</span> -a DIR_IDX
<span class="hljs-comment"># BIG-DIR # IndexList -if "/tmpfs/junk2" DIR_IDX</span>
IndexList DIR_ENT DIR_IDX

<span class="hljs-built_in">declare</span> -a IDX_DIG
<span class="hljs-comment"># BIG-DIR # DIR_ENT=( $(cat /tmpfs/junk2) )</span>
<span class="hljs-comment"># BIG-DIR # DigestFile -if /tmpfs/junk2 IDX_DIG</span>
DigestFile DIR_ENT IDX_DIG
<span class="hljs-comment"># Small (should) be able to parallize IndexList &amp; DigestFile</span>
<span class="hljs-comment"># Large (should) be able to parallize IndexList &amp; DigestFile &amp; the assignment</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"The \"name\" (checksum) for the contents of <span class="hljs-variable">${PWD}</span> is <span class="hljs-variable">${IDX_DIG[0]}</span>"</span>

<span class="hljs-built_in">declare</span> -a FILE_LOC
LocateFile <span class="hljs-variable">${PWD}</span> FILE_LOC
ListArray FILE_LOC

<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>
        Stephane Chazelas demonstrates object-oriented programming in a Bash
        script.
      </p>
      <p>
        Mariusz Gniazdowski contributed a
        <a href="internal.html#HASHREF">hash</a> library for use in scripts.
      </p>
      <div class="EXAMPLE">
        <a name="HASHLIB" id="HASHLIB"></a>
        <p><b>Example A-20. Library of hash functions</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-comment"># Hash:</span>
<span class="hljs-comment"># Hash function library</span>
<span class="hljs-comment"># Author: Mariusz Gniazdowski &lt;mariusz.gn-at-gmail.com&gt;</span>
<span class="hljs-comment"># Date: 2005-04-07</span>

<span class="hljs-comment"># Functions making emulating hashes in Bash a little less painful.</span>


<span class="hljs-comment">#    Limitations:</span>
<span class="hljs-comment">#  * Only global variables are supported.</span>
<span class="hljs-comment">#  * Each hash instance generates one global variable per value.</span>
<span class="hljs-comment">#  * Variable names collisions are possible</span>
<span class="hljs-comment">#+   if you define variable like __hash__hashname_key</span>
<span class="hljs-comment">#  * Keys must use chars that can be part of a Bash variable name</span>
<span class="hljs-comment">#+   (no dashes, periods, etc.).</span>
<span class="hljs-comment">#  * The hash is created as a variable:</span>
<span class="hljs-comment">#    ... hashname_keyname</span>
<span class="hljs-comment">#    So if somone will create hashes like:</span>
<span class="hljs-comment">#      myhash_ + mykey = myhash__mykey</span>
<span class="hljs-comment">#      myhash + _mykey = myhash__mykey</span>
<span class="hljs-comment">#    Then there will be a collision.</span>
<span class="hljs-comment">#    (This should not pose a major problem.)</span>


Hash_config_varname_prefix=__hash__


<span class="hljs-comment"># Emulates:  hash[key]=value</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Params:</span>
<span class="hljs-comment"># 1 - hash</span>
<span class="hljs-comment"># 2 - key</span>
<span class="hljs-comment"># 3 - value</span>
<span class="hljs-keyword">function</span> hash_set {
        <span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${1}</span>_<span class="hljs-variable">${2}</span>=\"<span class="hljs-variable">${3}</span>\""</span>
}


<span class="hljs-comment"># Emulates:  value=hash[key]</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Params:</span>
<span class="hljs-comment"># 1 - hash</span>
<span class="hljs-comment"># 2 - key</span>
<span class="hljs-comment"># 3 - value (name of global variable to set)</span>
<span class="hljs-keyword">function</span> hash_get_into {
        <span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-variable">$3</span>=\"\$<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${1}</span>_<span class="hljs-variable">${2}</span>\""</span>
}


<span class="hljs-comment"># Emulates:  echo hash[key]</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Params:</span>
<span class="hljs-comment"># 1 - hash</span>
<span class="hljs-comment"># 2 - key</span>
<span class="hljs-comment"># 3 - echo params (like -n, for example)</span>
<span class="hljs-keyword">function</span> hash_echo {
        <span class="hljs-built_in">eval</span> <span class="hljs-string">"echo <span class="hljs-variable">$3</span> \"\$<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${1}</span>_<span class="hljs-variable">${2}</span>\""</span>
}


<span class="hljs-comment"># Emulates:  hash1[key1]=hash2[key2]</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Params:</span>
<span class="hljs-comment"># 1 - hash1</span>
<span class="hljs-comment"># 2 - key1</span>
<span class="hljs-comment"># 3 - hash2</span>
<span class="hljs-comment"># 4 - key2</span>
<span class="hljs-keyword">function</span> hash_copy {
<span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${1}</span>_<span class="hljs-variable">${2}</span>\
=\"\$<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${3}</span>_<span class="hljs-variable">${4}</span>\""</span>
}


<span class="hljs-comment"># Emulates:  hash[keyN-1]=hash[key2]=...hash[key1]</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Copies first key to rest of keys.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Params:</span>
<span class="hljs-comment"># 1 - hash1</span>
<span class="hljs-comment"># 2 - key1</span>
<span class="hljs-comment"># 3 - key2</span>
<span class="hljs-comment"># . . .</span>
<span class="hljs-comment"># N - keyN</span>
<span class="hljs-keyword">function</span> hash_dup {
  <span class="hljs-built_in">local</span> hashName=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> keyName=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>
  <span class="hljs-built_in">shift</span> 2
  until [ <span class="hljs-variable">${#}</span> -le 0 ]; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${hashName}</span>_<span class="hljs-variable">${1}</span>\
=\"\$<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${hashName}</span>_<span class="hljs-variable">${keyName}</span>\""</span>
  <span class="hljs-built_in">shift</span>;
  <span class="hljs-keyword">done</span>;
}


<span class="hljs-comment"># Emulates:  unset hash[key]</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Params:</span>
<span class="hljs-comment"># 1 - hash</span>
<span class="hljs-comment"># 2 - key</span>
<span class="hljs-keyword">function</span> hash_unset {
        <span class="hljs-built_in">eval</span> <span class="hljs-string">"unset <span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${1}</span>_<span class="hljs-variable">${2}</span>"</span>
}


<span class="hljs-comment"># Emulates something similar to:  ref=&amp;hash[key]</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># The reference is name of the variable in which value is held.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Params:</span>
<span class="hljs-comment"># 1 - hash</span>
<span class="hljs-comment"># 2 - key</span>
<span class="hljs-comment"># 3 - ref - Name of global variable to set.</span>
<span class="hljs-keyword">function</span> hash_get_ref_into {
        <span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-variable">$3</span>=\"<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${1}</span>_<span class="hljs-variable">${2}</span>\""</span>
}


<span class="hljs-comment"># Emulates something similar to:  echo &amp;hash[key]</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># That reference is name of variable in which value is held.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Params:</span>
<span class="hljs-comment"># 1 - hash</span>
<span class="hljs-comment"># 2 - key</span>
<span class="hljs-comment"># 3 - echo params (like -n for example)</span>
<span class="hljs-keyword">function</span> hash_echo_ref {
        <span class="hljs-built_in">eval</span> <span class="hljs-string">"echo <span class="hljs-variable">$3</span> \"<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${1}</span>_<span class="hljs-variable">${2}</span>\""</span>
}



<span class="hljs-comment"># Emulates something similar to:  $$hash[key](param1, param2, ...)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Params:</span>
<span class="hljs-comment"># 1 - hash</span>
<span class="hljs-comment"># 2 - key</span>
<span class="hljs-comment"># 3,4, ... - Function parameters</span>
<span class="hljs-keyword">function</span> hash_call {
  <span class="hljs-built_in">local</span> <span class="hljs-built_in">hash</span> key
  <span class="hljs-built_in">hash</span>=<span class="hljs-variable">$1</span>
  key=<span class="hljs-variable">$2</span>
  <span class="hljs-built_in">shift</span> 2
  <span class="hljs-built_in">eval</span> <span class="hljs-string">"eval \"\$<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${hash}</span>_<span class="hljs-variable">${key}</span> \\\"\\\$@\\\"\""</span>
}


<span class="hljs-comment"># Emulates something similar to:  isset(hash[key]) or hash[key]==NULL</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Params:</span>
<span class="hljs-comment"># 1 - hash</span>
<span class="hljs-comment"># 2 - key</span>
<span class="hljs-comment"># Returns:</span>
<span class="hljs-comment"># 0 - there is such key</span>
<span class="hljs-comment"># 1 - there is no such key</span>
<span class="hljs-keyword">function</span> hash_is_set {
  <span class="hljs-built_in">eval</span> <span class="hljs-string">"if [[ \"\${<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${1}</span>_<span class="hljs-variable">${2}</span>-a}\" = \"a\" &amp;&amp; 
  \"\${<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${1}</span>_<span class="hljs-variable">${2}</span>-b}\" = \"b\" ]]
    then return 1; else return 0; fi"</span>
}


<span class="hljs-comment"># Emulates something similar to:</span>
<span class="hljs-comment">#   foreach($hash as $key =&gt; $value) { fun($key,$value); }</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># It is possible to write different variations of this function.</span>
<span class="hljs-comment"># Here we use a function call to make it as "generic" as possible.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Params:</span>
<span class="hljs-comment"># 1 - hash</span>
<span class="hljs-comment"># 2 - function name</span>
<span class="hljs-keyword">function</span> hash_foreach {
  <span class="hljs-built_in">local</span> keyname oldIFS=<span class="hljs-string">"<span class="hljs-variable">$IFS</span>"</span>
  IFS=<span class="hljs-string">' '</span>
  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">eval</span> <span class="hljs-string">"echo \${!<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${1}</span>_*}"</span>); <span class="hljs-keyword">do</span>
    keyname=$(<span class="hljs-built_in">eval</span> <span class="hljs-string">"echo \${i##<span class="hljs-variable">${Hash_config_varname_prefix}</span><span class="hljs-variable">${1}</span>_}"</span>)
    <span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-variable">$2</span> <span class="hljs-variable">$keyname</span> \"\$<span class="hljs-variable">$i</span>\""</span>
  <span class="hljs-keyword">done</span>
IFS=<span class="hljs-string">"<span class="hljs-variable">$oldIFS</span>"</span>
}

<span class="hljs-comment">#  <span class="hljs-doctag">NOTE:</span> In lines 103 and 116, ampersand changed.</span>
<span class="hljs-comment">#  But, it doesn't matter, because these are comment lines anyhow.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>Here is an example script using the foregoing hash library.</p>
      <div class="EXAMPLE">
        <a name="HASHEXAMPLE" id="HASHEXAMPLE"></a>
        <p><b>Example A-21. Colorizing text using hash functions</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># hash-example.sh: Colorizing text.</span>
<span class="hljs-comment"># Author: Mariusz Gniazdowski &lt;mariusz.gn-at-gmail.com&gt;</span>

. Hash.lib      <span class="hljs-comment"># Load the library of functions.</span>

hash_set colors red          <span class="hljs-string">"\033[0;31m"</span>
hash_set colors blue         <span class="hljs-string">"\033[0;34m"</span>
hash_set colors light_blue   <span class="hljs-string">"\033[1;34m"</span>
hash_set colors light_red    <span class="hljs-string">"\033[1;31m"</span>
hash_set colors cyan         <span class="hljs-string">"\033[0;36m"</span>
hash_set colors light_green  <span class="hljs-string">"\033[1;32m"</span>
hash_set colors light_gray   <span class="hljs-string">"\033[0;37m"</span>
hash_set colors green        <span class="hljs-string">"\033[0;32m"</span>
hash_set colors yellow       <span class="hljs-string">"\033[1;33m"</span>
hash_set colors light_purple <span class="hljs-string">"\033[1;35m"</span>
hash_set colors purple       <span class="hljs-string">"\033[0;35m"</span>
hash_set colors reset_color  <span class="hljs-string">"\033[0;00m"</span>


<span class="hljs-comment"># $1 - keyname</span>
<span class="hljs-comment"># $2 - value</span>
<span class="hljs-function"><span class="hljs-title">try_colors</span></span>() {
        <span class="hljs-built_in">echo</span> -en <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"This line is <span class="hljs-variable">$1</span>."</span>
}
hash_foreach colors try_colors
hash_echo colors reset_color -en

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">'\nLet us overwrite some colors with yellow.\n'</span>
<span class="hljs-comment"># It's hard to read yellow text on some terminals.</span>
hash_dup colors yellow   red light_green blue green light_gray cyan
hash_foreach colors try_colors
hash_echo colors reset_color -en

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">'\nLet us delete them and try colors once more . . .\n'</span>

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> red light_green blue green light_gray cyan; <span class="hljs-keyword">do</span>
        hash_unset colors <span class="hljs-variable">$i</span>
<span class="hljs-keyword">done</span>
hash_foreach colors try_colors
hash_echo colors reset_color -en

hash_set other txt <span class="hljs-string">"Other examples . . ."</span>
hash_echo other txt
hash_get_into other txt text
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$text</span>

hash_set other my_fun try_colors
hash_call other my_fun   purple <span class="hljs-string">"`hash_echo colors purple`"</span>
hash_echo colors reset_color -en

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"Back to normal?"</span>; <span class="hljs-built_in">echo</span>

<span class="hljs-built_in">exit</span> $?

<span class="hljs-comment">#  On some terminals, the "light" colors print in bold,</span>
<span class="hljs-comment">#  and end up looking darker than the normal ones.</span>
<span class="hljs-comment">#  Why is this?</span>
</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>
        <a name="HASHEX2_0" id="HASHEX2_0"></a>An example illustrating the
        mechanics of hashing, but from a different point of view.
      </p>
      <div class="EXAMPLE">
        <a name="HASHEX2" id="HASHEX2"></a>
        <p><b>Example A-22. More on hash functions</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># $Id: ha.sh,v 1.2 2005/04/21 23:24:26 oliver Exp $</span>
<span class="hljs-comment"># Copyright 2005 Oliver Beckstein</span>
<span class="hljs-comment"># Released under the GNU Public License</span>
<span class="hljs-comment"># Author of script granted permission for inclusion in ABS Guide.</span>
<span class="hljs-comment"># (Thank you!)</span>

<span class="hljs-comment">#----------------------------------------------------------------</span>
<span class="hljs-comment"># pseudo hash based on indirect parameter expansion</span>
<span class="hljs-comment"># API: access through functions:</span>
<span class="hljs-comment"># </span>
<span class="hljs-comment"># create the hash:</span>
<span class="hljs-comment">#  </span>
<span class="hljs-comment">#      newhash Lovers</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># add entries (note single quotes for spaces)</span>
<span class="hljs-comment">#    </span>
<span class="hljs-comment">#      addhash Lovers Tristan Isolde</span>
<span class="hljs-comment">#      addhash Lovers 'Romeo Montague' 'Juliet Capulet'</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># access value by key</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#      gethash Lovers Tristan   ----&gt;  Isolde</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># show all keys</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#      keyshash Lovers         ----&gt; 'Tristan'  'Romeo Montague'</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Convention: instead of perls' foo{bar} = boing' syntax,</span>
<span class="hljs-comment"># use</span>
<span class="hljs-comment">#       '_foo_bar=boing' (two underscores, no spaces)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># 1) store key   in _NAME_keys[]</span>
<span class="hljs-comment"># 2) store value in _NAME_values[] using the same integer index</span>
<span class="hljs-comment"># The integer index for the last entry is _NAME_ptr</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> No error or sanity checks, just bare bones.</span>


<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">_inihash</span></span> () {
    <span class="hljs-comment"># private function</span>
    <span class="hljs-comment"># call at the beginning of each procedure</span>
    <span class="hljs-comment"># defines: _keys _values _ptr</span>
    <span class="hljs-comment">#</span>
    <span class="hljs-comment"># Usage: _inihash NAME</span>
    <span class="hljs-built_in">local</span> name=<span class="hljs-variable">$1</span>
    _keys=_<span class="hljs-variable">${name}</span>_keys
    _values=_<span class="hljs-variable">${name}</span>_values
    _ptr=_<span class="hljs-variable">${name}</span>_ptr
}

<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">newhash</span></span> () {
    <span class="hljs-comment"># Usage: newhash NAME</span>
    <span class="hljs-comment">#        NAME should not contain spaces or dots.</span>
    <span class="hljs-comment">#        Actually: it must be a legal name for a Bash variable.</span>
    <span class="hljs-comment"># We rely on Bash automatically recognising arrays.</span>
    <span class="hljs-built_in">local</span> name=<span class="hljs-variable">$1</span> 
    <span class="hljs-built_in">local</span> _keys _values _ptr
    _inihash <span class="hljs-variable">${name}</span>
    <span class="hljs-built_in">eval</span> <span class="hljs-variable">${_ptr}</span>=0
}


<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">addhash</span></span> () {
    <span class="hljs-comment"># Usage: addhash NAME KEY 'VALUE with spaces'</span>
    <span class="hljs-comment">#        arguments with spaces need to be quoted with single quotes ''</span>
    <span class="hljs-built_in">local</span> name=<span class="hljs-variable">$1</span> k=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> v=<span class="hljs-string">"<span class="hljs-variable">$3</span>"</span> 
    <span class="hljs-built_in">local</span> _keys _values _ptr
    _inihash <span class="hljs-variable">${name}</span>

    <span class="hljs-comment">#echo "DEBUG(addhash): ${_ptr}=${!_ptr}"</span>

    <span class="hljs-built_in">eval</span> <span class="hljs-built_in">let</span> <span class="hljs-variable">${_ptr}</span>=<span class="hljs-variable">${_ptr}</span>+1
    <span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-variable">$_keys</span>[<span class="hljs-variable">${!_ptr}</span>]=\"<span class="hljs-variable">${k}</span>\""</span>
    <span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-variable">$_values</span>[<span class="hljs-variable">${!_ptr}</span>]=\"<span class="hljs-variable">${v}</span>\""</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">gethash</span></span> () {
    <span class="hljs-comment">#  Usage: gethash NAME KEY</span>
    <span class="hljs-comment">#         Returns boing</span>
    <span class="hljs-comment">#         ERR=0 if entry found, 1 otherwise</span>
    <span class="hljs-comment">#  That's not a proper hash --</span>
    <span class="hljs-comment">#+ we simply linearly search through the keys.</span>
    <span class="hljs-built_in">local</span> name=<span class="hljs-variable">$1</span> key=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> 
    <span class="hljs-built_in">local</span> _keys _values _ptr 
    <span class="hljs-built_in">local</span> k v i found h
    _inihash <span class="hljs-variable">${name}</span>
    
    <span class="hljs-comment"># _ptr holds the highest index in the hash</span>
    found=0

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(seq 1 <span class="hljs-variable">${!_ptr}</span>); <span class="hljs-keyword">do</span>
        h=<span class="hljs-string">"\${<span class="hljs-variable">${_keys}</span>[<span class="hljs-variable">${i}</span>]}"</span>  <span class="hljs-comment">#  Safer to do it in two steps,</span>
        <span class="hljs-built_in">eval</span> k=<span class="hljs-variable">${h}</span>             <span class="hljs-comment">#+ especially when quoting for spaces.</span>
        <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">${k}</span>"</span> = <span class="hljs-string">"<span class="hljs-variable">${key}</span>"</span> ]; <span class="hljs-keyword">then</span> found=1; <span class="hljs-built_in">break</span>; <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>;

    [ <span class="hljs-variable">${found}</span> = 0 ] &amp;&amp; <span class="hljs-built_in">return</span> 1;
    <span class="hljs-comment"># else: i is the index that matches the key</span>
    h=<span class="hljs-string">"\${<span class="hljs-variable">${_values}</span>[<span class="hljs-variable">${i}</span>]}"</span>
    <span class="hljs-built_in">eval</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${h}</span>"</span>
    <span class="hljs-built_in">return</span> 0;   
}

<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">keyshash</span></span> () {
    <span class="hljs-comment"># Usage: keyshash NAME</span>
    <span class="hljs-comment"># Returns list of all keys defined for hash name.</span>
    <span class="hljs-built_in">local</span> name=<span class="hljs-variable">$1</span> key=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> 
    <span class="hljs-built_in">local</span> _keys _values _ptr 
    <span class="hljs-built_in">local</span> k i h
    _inihash <span class="hljs-variable">${name}</span>
    
    <span class="hljs-comment"># _ptr holds the highest index in the hash</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(seq 1 <span class="hljs-variable">${!_ptr}</span>); <span class="hljs-keyword">do</span>
        h=<span class="hljs-string">"\${<span class="hljs-variable">${_keys}</span>[<span class="hljs-variable">${i}</span>]}"</span>   <span class="hljs-comment">#  Safer to do it in two steps,</span>
        <span class="hljs-built_in">eval</span> k=<span class="hljs-variable">${h}</span>              <span class="hljs-comment">#+ especially when quoting for spaces.</span>
        <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"'<span class="hljs-variable">${k}</span>' "</span>
    <span class="hljs-keyword">done</span>;
}


<span class="hljs-comment"># -----------------------------------------------------------------------</span>

<span class="hljs-comment"># Now, let's test it.</span>
<span class="hljs-comment"># (Per comments at the beginning of the script.)</span>
newhash Lovers
addhash Lovers Tristan Isolde
addhash Lovers <span class="hljs-string">'Romeo Montague'</span> <span class="hljs-string">'Juliet Capulet'</span>

<span class="hljs-comment"># Output results.</span>
<span class="hljs-built_in">echo</span>
gethash Lovers Tristan      <span class="hljs-comment"># Isolde</span>
<span class="hljs-built_in">echo</span>
keyshash Lovers             <span class="hljs-comment"># 'Tristan' 'Romeo Montague'</span>
<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>


<span class="hljs-built_in">exit</span> 0

<span class="hljs-comment"># Exercise:</span>
<span class="hljs-comment"># --------</span>

<span class="hljs-comment"># Add error checks to the functions.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>
        Now for a script that installs and mounts those cute USB keychain
        solid-state <span class="QUOTE">"hard drives."</span>
      </p>
      <div class="EXAMPLE">
        <a name="USBINST" id="USBINST"></a>
        <p><b>Example A-23. Mounting USB keychain storage devices</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># ==&gt; usb.sh</span>
<span class="hljs-comment"># ==&gt; Script for mounting and installing pen/keychain USB storage devices.</span>
<span class="hljs-comment"># ==&gt; Runs as root at system startup (see below).</span>
<span class="hljs-comment"># ==&gt;</span>
<span class="hljs-comment"># ==&gt; Newer Linux distros (2004 or later) autodetect</span>
<span class="hljs-comment"># ==&gt; and install USB pen drives, and therefore don't need this script.</span>
<span class="hljs-comment"># ==&gt; But, it's still instructive.</span>
 
<span class="hljs-comment">#  This code is free software covered by GNU GPL license version 2 or above.</span>
<span class="hljs-comment">#  Please refer to http://www.gnu.org/ for the full license text.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  Some code lifted from usb-mount by Michael Hamilton's usb-mount (LGPL)</span>
<span class="hljs-comment">#+ see http://users.actrix.co.nz/michael/usbmount.html</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  INSTALL</span>
<span class="hljs-comment">#  -------</span>
<span class="hljs-comment">#  Put this in /etc/hotplug/usb/diskonkey.</span>
<span class="hljs-comment">#  Then look in /etc/hotplug/usb.distmap, and copy all usb-storage entries</span>
<span class="hljs-comment">#+ into /etc/hotplug/usb.usermap, substituting "usb-storage" for "diskonkey".</span>
<span class="hljs-comment">#  Otherwise this code is only run during the kernel module invocation/removal</span>
<span class="hljs-comment">#+ (at least in my tests), which defeats the purpose.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  TODO</span>
<span class="hljs-comment">#  ----</span>
<span class="hljs-comment">#  Handle more than one diskonkey device at one time (e.g. /dev/diskonkey1</span>
<span class="hljs-comment">#+ and /mnt/diskonkey1), etc. The biggest problem here is the handling in</span>
<span class="hljs-comment">#+ devlabel, which I haven't yet tried.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  AUTHOR and SUPPORT</span>
<span class="hljs-comment">#  ------------------</span>
<span class="hljs-comment">#  Konstantin Riabitsev, &lt;icon linux duke edu&gt;.</span>
<span class="hljs-comment">#  Send any problem reports to my email address at the moment.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># ==&gt; Comments added by ABS Guide author.</span>



SYMLINKDEV=/dev/diskonkey
MOUNTPOINT=/mnt/diskonkey
DEVLABEL=/sbin/devlabel
DEVLABELCONFIG=/etc/sysconfig/devlabel
IAM=<span class="hljs-variable">$0</span>

<span class="hljs-comment">##</span>
<span class="hljs-comment"># Functions lifted near-verbatim from usb-mount code.</span>
<span class="hljs-comment">#</span>
<span class="hljs-keyword">function</span> allAttachedScsiUsb {
  find /proc/scsi/ -path <span class="hljs-string">'/proc/scsi/usb-storage*'</span> -<span class="hljs-built_in">type</span> f |
  xargs grep -l <span class="hljs-string">'Attached: Yes'</span>
}
<span class="hljs-keyword">function</span> scsiDevFromScsiUsb {
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$1</span> | awk -F<span class="hljs-string">"[-/]"</span> <span class="hljs-string">'{ n=$(NF-1);
  print "/dev/sd" substr("abcdefghijklmnopqrstuvwxyz", n+1, 1) }'</span>
}

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">${ACTION}</span>"</span> = <span class="hljs-string">"add"</span> ] &amp;&amp; [ -f <span class="hljs-string">"<span class="hljs-variable">${DEVICE}</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-comment">##</span>
    <span class="hljs-comment"># lifted from usbcam code.</span>
    <span class="hljs-comment">#</span>
    <span class="hljs-keyword">if</span> [ -f /var/run/console.lock ]; <span class="hljs-keyword">then</span>
        CONSOLEOWNER=`cat /var/run/console.lock`
    <span class="hljs-keyword">elif</span> [ -f /var/lock/console.lock ]; <span class="hljs-keyword">then</span>
        CONSOLEOWNER=`cat /var/lock/console.lock`
    <span class="hljs-keyword">else</span>
        CONSOLEOWNER=
    <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">for</span> procEntry <span class="hljs-keyword">in</span> $(allAttachedScsiUsb); <span class="hljs-keyword">do</span>
        scsiDev=$(scsiDevFromScsiUsb <span class="hljs-variable">$procEntry</span>)
        <span class="hljs-comment">#  Some bug with usb-storage?</span>
        <span class="hljs-comment">#  Partitions are not in /proc/partitions until they are accessed</span>
        <span class="hljs-comment">#+ somehow.</span>
        /sbin/fdisk -l <span class="hljs-variable">$scsiDev</span> &gt;/dev/null
        <span class="hljs-comment">##</span>
        <span class="hljs-comment">#  Most devices have partitioning info, so the data would be on</span>
        <span class="hljs-comment">#+ /dev/sd?1. However, some stupider ones don't have any partitioning</span>
        <span class="hljs-comment">#+ and use the entire device for data storage. This tries to</span>
        <span class="hljs-comment">#+ guess semi-intelligently if we have a /dev/sd?1 and if not, then</span>
        <span class="hljs-comment">#+ it uses the entire device and hopes for the better.</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-keyword">if</span> grep -q `basename <span class="hljs-variable">$scsiDev</span>`1 /proc/partitions; <span class="hljs-keyword">then</span>
            part=<span class="hljs-string">"<span class="hljs-variable">$scsiDev</span>"</span><span class="hljs-string">"1"</span>
        <span class="hljs-keyword">else</span>
            part=<span class="hljs-variable">$scsiDev</span>
        <span class="hljs-keyword">fi</span>
        <span class="hljs-comment">##</span>
        <span class="hljs-comment">#  Change ownership of the partition to the console user so they can</span>
        <span class="hljs-comment">#+ mount it.</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-keyword">if</span> [ ! -z <span class="hljs-string">"<span class="hljs-variable">$CONSOLEOWNER</span>"</span> ]; <span class="hljs-keyword">then</span>
            chown <span class="hljs-variable">$CONSOLEOWNER</span>:disk <span class="hljs-variable">$part</span>
        <span class="hljs-keyword">fi</span>
        <span class="hljs-comment">##</span>
        <span class="hljs-comment"># This checks if we already have this UUID defined with devlabel.</span>
        <span class="hljs-comment"># If not, it then adds the device to the list.</span>
        <span class="hljs-comment">#</span>
        prodid=`<span class="hljs-variable">$DEVLABEL</span> printid -d <span class="hljs-variable">$part</span>`
        <span class="hljs-keyword">if</span> ! grep -q <span class="hljs-variable">$prodid</span> <span class="hljs-variable">$DEVLABELCONFIG</span>; <span class="hljs-keyword">then</span>
            <span class="hljs-comment"># cross our fingers and hope it works</span>
            <span class="hljs-variable">$DEVLABEL</span> add -d <span class="hljs-variable">$part</span> -s <span class="hljs-variable">$SYMLINKDEV</span> 2&gt;/dev/null
        <span class="hljs-keyword">fi</span>
        <span class="hljs-comment">##</span>
        <span class="hljs-comment"># Check if the mount point exists and create if it doesn't.</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-keyword">if</span> [ ! -e <span class="hljs-variable">$MOUNTPOINT</span> ]; <span class="hljs-keyword">then</span>
            mkdir -p <span class="hljs-variable">$MOUNTPOINT</span>
        <span class="hljs-keyword">fi</span>
        <span class="hljs-comment">##</span>
        <span class="hljs-comment"># Take care of /etc/fstab so mounting is easy.</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-keyword">if</span> ! grep -q <span class="hljs-string">"^<span class="hljs-variable">$SYMLINKDEV</span>"</span> /etc/fstab; <span class="hljs-keyword">then</span>
            <span class="hljs-comment"># Add an fstab entry</span>
            <span class="hljs-built_in">echo</span> -e \
                <span class="hljs-string">"<span class="hljs-variable">$SYMLINKDEV</span>\t\t<span class="hljs-variable">$MOUNTPOINT</span>\t\tauto\tnoauto,owner,kudzu 0 0"</span> \
                &gt;&gt; /etc/fstab
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">if</span> [ ! -z <span class="hljs-string">"<span class="hljs-variable">$REMOVER</span>"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-comment">##</span>
        <span class="hljs-comment"># Make sure this script is triggered on device removal.</span>
        <span class="hljs-comment">#</span>
        mkdir -p `dirname <span class="hljs-variable">$REMOVER</span>`
        ln -s <span class="hljs-variable">$IAM</span> <span class="hljs-variable">$REMOVER</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">elif</span> [ <span class="hljs-string">"<span class="hljs-variable">${ACTION}</span>"</span> = <span class="hljs-string">"remove"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-comment">##</span>
    <span class="hljs-comment"># If the device is mounted, unmount it cleanly.</span>
    <span class="hljs-comment">#</span>
    <span class="hljs-keyword">if</span> grep -q <span class="hljs-string">"<span class="hljs-variable">$MOUNTPOINT</span>"</span> /etc/mtab; <span class="hljs-keyword">then</span>
        <span class="hljs-comment"># unmount cleanly</span>
        umount -l <span class="hljs-variable">$MOUNTPOINT</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-comment">##</span>
    <span class="hljs-comment"># Remove it from /etc/fstab if it's there.</span>
    <span class="hljs-comment">#</span>
    <span class="hljs-keyword">if</span> grep -q <span class="hljs-string">"^<span class="hljs-variable">$SYMLINKDEV</span>"</span> /etc/fstab; <span class="hljs-keyword">then</span>
        grep -v <span class="hljs-string">"^<span class="hljs-variable">$SYMLINKDEV</span>"</span> /etc/fstab &gt; /etc/.fstab.new
        mv -f /etc/.fstab.new /etc/fstab
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>Converting a text file to HTML format.</p>
      <div class="EXAMPLE">
        <a name="TOHTML" id="TOHTML"></a>
        <p><b>Example A-24. Converting to HTML</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># tohtml.sh [v. 0.2.01, reldate: 04/13/12, a teeny bit less buggy]</span>

<span class="hljs-comment"># Convert a text file to HTML format.</span>
<span class="hljs-comment"># Author: Mendel Cooper</span>
<span class="hljs-comment"># License: GPL3</span>
<span class="hljs-comment"># Usage: sh tohtml.sh &lt; textfile &gt; htmlfile</span>
<span class="hljs-comment"># Script can easily be modified to accept source and target filenames.</span>

<span class="hljs-comment">#    Assumptions:</span>
<span class="hljs-comment"># 1) Paragraphs in (target) text file are separated by a blank line.</span>
<span class="hljs-comment"># 2) Jpeg images (*.jpg) are located in "images" subdirectory.</span>
<span class="hljs-comment">#    In the target file, the image names are enclosed in square brackets,</span>
<span class="hljs-comment">#    for example, [image01.jpg].</span>
<span class="hljs-comment"># 3) Emphasized (italic) phrases begin with a space+underscore</span>
<span class="hljs-comment">#+   or the first character on the line is an underscore,</span>
<span class="hljs-comment">#+   and end with an underscore+space or underscore+end-of-line.</span>


<span class="hljs-comment"># Settings</span>
FNTSIZE=2        <span class="hljs-comment"># Small-medium font size</span>
IMGDIR=<span class="hljs-string">"images"</span>  <span class="hljs-comment"># Image directory</span>
<span class="hljs-comment"># Headers</span>
HDR01=<span class="hljs-string">'&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;'</span>
HDR02=<span class="hljs-string">'&lt;!-- Converted to HTML by ***tohtml.sh*** script --&gt;'</span>
HDR03=<span class="hljs-string">'&lt;!-- script author: M. Leo Cooper &lt;thegrendel.abs@gmail.com&gt; --&gt;'</span>
HDR10=<span class="hljs-string">'&lt;html&gt;'</span>
HDR11=<span class="hljs-string">'&lt;head&gt;'</span>
HDR11a=<span class="hljs-string">'&lt;/head&gt;'</span>
HDR12a=<span class="hljs-string">'&lt;title&gt;'</span>
HDR12b=<span class="hljs-string">'&lt;/title&gt;'</span>
HDR121=<span class="hljs-string">'&lt;META NAME="GENERATOR" CONTENT="tohtml.sh script"&gt;'</span>
HDR13=<span class="hljs-string">'&lt;body bgcolor="#dddddd"&gt;'</span>   <span class="hljs-comment"># Change background color to suit.</span>
HDR14a=<span class="hljs-string">'&lt;font size='</span>
HDR14b=<span class="hljs-string">'&gt;'</span>
<span class="hljs-comment"># Footers</span>
FTR10=<span class="hljs-string">'&lt;/body&gt;'</span>
FTR11=<span class="hljs-string">'&lt;/html&gt;'</span>
<span class="hljs-comment"># Tags</span>
BOLD=<span class="hljs-string">"&lt;b&gt;"</span>
CENTER=<span class="hljs-string">"&lt;center&gt;"</span>
END_CENTER=<span class="hljs-string">"&lt;/center&gt;"</span>
LF=<span class="hljs-string">"&lt;br&gt;"</span>


<span class="hljs-function"><span class="hljs-title">write_headers</span></span> ()
  {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$HDR01</span>"</span>
  <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$HDR02</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$HDR03</span>"</span>
  <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$HDR10</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$HDR11</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$HDR121</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$HDR11a</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$HDR13</span>"</span>
  <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$HDR14a</span>"</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$FNTSIZE</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$HDR14b</span>"</span>
  <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$BOLD</span>"</span>        <span class="hljs-comment"># Everything in bold (more easily readable).</span>
  }


<span class="hljs-function"><span class="hljs-title">process_text</span></span> ()
  {
  <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line     <span class="hljs-comment"># Read one line at a time.</span>
  <span class="hljs-keyword">do</span>
    {
    <span class="hljs-keyword">if</span> [ ! <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> ]  <span class="hljs-comment"># Blank line?</span>
    <span class="hljs-keyword">then</span>              <span class="hljs-comment"># Then new paragraph must follow.</span>
      <span class="hljs-built_in">echo</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$LF</span>"</span>      <span class="hljs-comment"># Insert two &lt;br&gt; tags.</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$LF</span>"</span>
      <span class="hljs-built_in">echo</span>
      <span class="hljs-built_in">continue</span>        <span class="hljs-comment"># Skip the underscore test.</span>
    <span class="hljs-keyword">else</span>              <span class="hljs-comment"># Otherwise . . .</span>

      <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> =~ \[*jpg\] ]]    <span class="hljs-comment"># Is a graphic?</span>
      <span class="hljs-keyword">then</span>                            <span class="hljs-comment"># Strip away brackets.</span>
        temp=$( <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> | sed -e <span class="hljs-string">'s/\[//'</span> -e <span class="hljs-string">'s/\]//'</span> )
        line=<span class="hljs-string">""</span><span class="hljs-variable">$CENTER</span><span class="hljs-string">" &lt;img src="</span>\"<span class="hljs-variable">$IMGDIR</span><span class="hljs-string">"/<span class="hljs-variable">$temp</span>\"&gt; "</span><span class="hljs-variable">$END_CENTER</span><span class="hljs-string">" "</span>
                                      <span class="hljs-comment"># Add image tag.</span>
                                      <span class="hljs-comment"># And, center it.</span>
      <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">fi</span>


    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> | grep -q _
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"$?"</span> -eq 0 ]    <span class="hljs-comment"># If line contains underscore ...</span>
    <span class="hljs-keyword">then</span>
      <span class="hljs-comment"># ===================================================</span>
      <span class="hljs-comment"># Convert underscored phrase to italics.</span>
      temp=$( <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> |
              sed -e <span class="hljs-string">'s/ _/ &lt;i&gt;/'</span> -e <span class="hljs-string">'s/_/&lt;\/i&gt; /'</span> |
              sed -e <span class="hljs-string">'s/^_/&lt;i&gt;/'</span>  -e <span class="hljs-string">'s/_/&lt;\/i&gt;/'</span> )
      <span class="hljs-comment">#  Process only underscores prefixed by space,</span>
      <span class="hljs-comment">#+ or at beginning or end of line.</span>
      <span class="hljs-comment">#  Do not convert underscores embedded within a word!</span>
      line=<span class="hljs-string">"<span class="hljs-variable">$temp</span>"</span>
      <span class="hljs-comment"># Slows script execution. Can be optimized?</span>
      <span class="hljs-comment"># ===================================================</span>
    <span class="hljs-keyword">fi</span>


   
<span class="hljs-comment">#   echo</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>
<span class="hljs-comment">#   echo</span>
<span class="hljs-comment">#   Don't want extra blank lines in generated text!</span>
    } <span class="hljs-comment"># End while</span>
  <span class="hljs-keyword">done</span>
  }   <span class="hljs-comment"># End process_text ()</span>


write_footers ()  <span class="hljs-comment"># Termination tags.</span>
  {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$FTR10</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$FTR11</span>"</span>
  }


<span class="hljs-comment"># main () {</span>
<span class="hljs-comment"># =========</span>
write_headers
process_text
write_footers
<span class="hljs-comment"># =========</span>
<span class="hljs-comment">#         }</span>

<span class="hljs-built_in">exit</span> $?

<span class="hljs-comment">#  Exercises:</span>
<span class="hljs-comment">#  ---------</span>
<span class="hljs-comment">#  1) Fixup: Check for closing underscore before a comma or period.</span>
<span class="hljs-comment">#  2) Add a test for the presence of a closing underscore</span>
<span class="hljs-comment">#+    in phrases to be italicized.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>
        Here is something to warm the hearts of webmasters and mistresses: a
        script that saves weblogs.
      </p>
      <div class="EXAMPLE">
        <a name="ARCHIVWEBLOGS" id="ARCHIVWEBLOGS"></a>
        <p><b>Example A-25. Preserving weblogs</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># archiveweblogs.sh v1.0</span>

<span class="hljs-comment"># Troy Engel &lt;tengel@fluid.com&gt;</span>
<span class="hljs-comment"># Slightly modified by document author.</span>
<span class="hljs-comment"># Used with permission.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  This script will preserve the normally rotated and</span>
<span class="hljs-comment">#+ thrown away weblogs from a default RedHat/Apache installation.</span>
<span class="hljs-comment">#  It will save the files with a date/time stamp in the filename,</span>
<span class="hljs-comment">#+ bzipped, to a given directory.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  Run this from crontab nightly at an off hour,</span>
<span class="hljs-comment">#+ as bzip2 can suck up some serious CPU on huge logs:</span>
<span class="hljs-comment">#  0 2 * * * /opt/sbin/archiveweblogs.sh</span>


PROBLEM=66

<span class="hljs-comment"># Set this to your backup dir.</span>
BKP_DIR=/opt/backups/weblogs

<span class="hljs-comment"># Default Apache/RedHat stuff</span>
LOG_DAYS=<span class="hljs-string">"4 3 2 1"</span>
LOG_DIR=/var/<span class="hljs-built_in">log</span>/httpd
LOG_FILES=<span class="hljs-string">"access_log error_log"</span>

<span class="hljs-comment"># Default RedHat program locations</span>
LS=/bin/ls
MV=/bin/mv
ID=/usr/bin/id
CUT=/bin/cut
COL=/usr/bin/column
BZ2=/usr/bin/bzip2

<span class="hljs-comment"># Are we root?</span>
USER=`<span class="hljs-variable">$ID</span> -u`
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"X<span class="hljs-variable">$USER</span>"</span> != <span class="hljs-string">"X0"</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"PANIC: Only root can run this script!"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$PROBLEM</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Backup dir exists/writable?</span>
<span class="hljs-keyword">if</span> [ ! -x <span class="hljs-variable">$BKP_DIR</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"PANIC: <span class="hljs-variable">$BKP_DIR</span> doesn't exist or isn't writable!"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$PROBLEM</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Move, rename and bzip2 the logs</span>
<span class="hljs-keyword">for</span> logday <span class="hljs-keyword">in</span> <span class="hljs-variable">$LOG_DAYS</span>; <span class="hljs-keyword">do</span>
  <span class="hljs-keyword">for</span> logfile <span class="hljs-keyword">in</span> <span class="hljs-variable">$LOG_FILES</span>; <span class="hljs-keyword">do</span>
    MYFILE=<span class="hljs-string">"<span class="hljs-variable">$LOG_DIR</span>/<span class="hljs-variable">$logfile</span>.<span class="hljs-variable">$logday</span>"</span>
    <span class="hljs-keyword">if</span> [ -w <span class="hljs-variable">$MYFILE</span> ]; <span class="hljs-keyword">then</span>
      DTS=`<span class="hljs-variable">$LS</span> -lgo --time-style=+%Y%m%d <span class="hljs-variable">$MYFILE</span> | <span class="hljs-variable">$COL</span> -t | <span class="hljs-variable">$CUT</span> -d <span class="hljs-string">' '</span> -f7`
      <span class="hljs-variable">$MV</span> <span class="hljs-variable">$MYFILE</span> <span class="hljs-variable">$BKP_DIR</span>/<span class="hljs-variable">$logfile</span>.<span class="hljs-variable">$DTS</span>
      <span class="hljs-variable">$BZ2</span> <span class="hljs-variable">$BKP_DIR</span>/<span class="hljs-variable">$logfile</span>.<span class="hljs-variable">$DTS</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-comment"># Only spew an error if the file exits (ergo non-writable).</span>
      <span class="hljs-keyword">if</span> [ -f <span class="hljs-variable">$MYFILE</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"ERROR: <span class="hljs-variable">$MYFILE</span> not writable. Skipping."</span>
      <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>
        <a name="PROTECTLITERAL0" id="PROTECTLITERAL0"></a>How to keep the shell
        from expanding and reinterpreting text strings.
      </p>
      <div class="EXAMPLE">
        <a name="PROTECTLITERAL" id="PROTECTLITERAL"></a>
        <p><b>Example A-26. Protecting literal strings</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#! /bin/bash</span>
<span class="hljs-comment"># protect_literal.sh</span>

<span class="hljs-comment"># set -vx</span>

:&lt;&lt;-<span class="hljs-string">'_Protect_Literal_String_Doc'</span>

    Copyright (c) Michael S. Zick, 2003; All Rights Reserved
    License: Unrestricted reuse <span class="hljs-keyword">in</span> any form, <span class="hljs-keyword">for</span> any purpose.
    Warranty: None
    Revision: <span class="hljs-variable">$ID</span>$

    Documentation redirected to the Bash no-operation.
    Bash will <span class="hljs-string">'/dev/null'</span> this block when the script is first <span class="hljs-built_in">read</span>.
    (Uncomment the above <span class="hljs-built_in">set</span> <span class="hljs-built_in">command</span> to see this action.)

    Remove the first (Sha-Bang) line when sourcing this as a library
    procedure.  Also comment out the example use code <span class="hljs-keyword">in</span> the two
    places <span class="hljs-built_in">where</span> shown.


    Usage:
        _protect_literal_str <span class="hljs-string">'Whatever string meets your ${fancy}'</span>
        Just echos the argument to standard out, hard quotes
        restored.

        $(_protect_literal_str <span class="hljs-string">'Whatever string meets your ${fancy}'</span>)
        as the right-hand-side of an assignment statement.

    Does:
        As the right-hand-side of an assignment, preserves the
        hard quotes protecting the contents of the literal during
        assignment.

    Notes:
        The strange names (_*) are used to avoid trampling on
        the user<span class="hljs-string">'s chosen names when this is sourced as a
        library.

_Protect_Literal_String_Doc

# The '</span><span class="hljs-keyword">for</span> illustration<span class="hljs-string">' function form

_protect_literal_str() {

# Pick an un-used, non-printing character as local IFS.
# Not required, but shows that we are ignoring it.
    local IFS=$'</span>\x1B<span class="hljs-string">'               # \ESC character

# Enclose the All-Elements-Of in hard quotes during assignment.
    local tmp=$'</span>\x27<span class="hljs-string">'$@$'</span>\x27<span class="hljs-string">'
#    local tmp=$'</span>\<span class="hljs-string">''</span><span class="hljs-variable">$@</span>$<span class="hljs-string">'\'</span><span class="hljs-string">'         # Even uglier.

    local len=${#tmp}               # Info only.
    echo $tmp is $len long.         # Output AND information.
}

# This is the short-named version.
_pls() {
    local IFS=$'</span>x1B<span class="hljs-string">'                # \ESC character (not required)
    echo $'</span>\x27<span class="hljs-string">'$@$'</span>\x27<span class="hljs-string">'           # Hard quoted parameter glob
}

# :&lt;&lt;-'</span>_Protect_Literal_String_Test<span class="hljs-string">'
# # # Remove the above "# " to disable this code. # # #

# See how that looks when printed.
echo
echo "- - Test One - -"
_protect_literal_str '</span>Hello <span class="hljs-variable">$user</span><span class="hljs-string">'
_protect_literal_str '</span>Hello <span class="hljs-string">"<span class="hljs-variable">${username}</span>"</span><span class="hljs-string">'
echo

# Which yields:
# - - Test One - -
# '</span>Hello <span class="hljs-variable">$user</span><span class="hljs-string">' is 13 long.
# '</span>Hello <span class="hljs-string">"<span class="hljs-variable">${username}</span>"</span><span class="hljs-string">' is 21 long.

#  Looks as expected, but why all of the trouble?
#  The difference is hidden inside the Bash internal order
#+ of operations.
#  Which shows when you use it on the RHS of an assignment.

# Declare an array for test values.
declare -a arrayZ

# Assign elements with various types of quotes and escapes.
arrayZ=( zero "$(_pls '</span>Hello <span class="hljs-variable">${Me}</span><span class="hljs-string">')" '</span>Hello <span class="hljs-variable">${You}</span><span class="hljs-string">' "\'</span>Pass: <span class="hljs-variable">${pw}</span>\<span class="hljs-string">'" )

# Now list that array and see what is there.
echo "- - Test Two - -"
for (( i=0 ; i&lt;${#arrayZ[*]} ; i++ ))
do
    echo  Element $i: ${arrayZ[$i]} is: ${#arrayZ[$i]} long.
done
echo

# Which yields:
# - - Test Two - -
# Element 0: zero is: 4 long.           # Our marker element
# Element 1: '</span>Hello <span class="hljs-variable">${Me}</span><span class="hljs-string">' is: 13 long. # Our "$(_pls '</span>...<span class="hljs-string">' )"
# Element 2: Hello ${You} is: 12 long.  # Quotes are missing
# Element 3: \'</span>Pass: \<span class="hljs-string">' is: 10 long.    # ${pw} expanded to nothing

# Now make an assignment with that result.
declare -a array2=( ${arrayZ[@]} )

# And print what happened.
echo "- - Test Three - -"
for (( i=0 ; i&lt;${#array2[*]} ; i++ ))
do
    echo  Element $i: ${array2[$i]} is: ${#array2[$i]} long.
done
echo

# Which yields:
# - - Test Three - -
# Element 0: zero is: 4 long.           # Our marker element.
# Element 1: Hello ${Me} is: 11 long.   # Intended result.
# Element 2: Hello is: 5 long.          # ${You} expanded to nothing.
# Element 3: '</span>Pass: is: 6 long.         <span class="hljs-comment"># Split on the whitespace.</span>
<span class="hljs-comment"># Element 4: ' is: 1 long.              # The end quote is here now.</span>

<span class="hljs-comment">#  Our Element 1 has had its leading and trailing hard quotes stripped.</span>
<span class="hljs-comment">#  Although not shown, leading and trailing whitespace is also stripped.</span>
<span class="hljs-comment">#  Now that the string contents are set, Bash will always, internally,</span>
<span class="hljs-comment">#+ hard quote the contents as required during its operations.</span>

<span class="hljs-comment">#  Why?</span>
<span class="hljs-comment">#  Considering our "$(_pls 'Hello ${Me}')" construction:</span>
<span class="hljs-comment">#  " ... " -&gt; Expansion required, strip the quotes.</span>
<span class="hljs-comment">#  $( ... ) -&gt; Replace with the result of..., strip this.</span>
<span class="hljs-comment">#  _pls ' ... ' -&gt; called with literal arguments, strip the quotes.</span>
<span class="hljs-comment">#  The result returned includes hard quotes; BUT the above processing</span>
<span class="hljs-comment">#+ has already been done, so they become part of the value assigned.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  Similarly, during further usage of the string variable, the ${Me}</span>
<span class="hljs-comment">#+ is part of the contents (result) and survives any operations</span>
<span class="hljs-comment">#  (Until explicitly told to evaluate the string).</span>

<span class="hljs-comment">#  Hint: See what happens when the hard quotes ($'\x27') are replaced</span>
<span class="hljs-comment">#+ with soft quotes ($'\x22') in the above procedures.</span>
<span class="hljs-comment">#  Interesting also is to remove the addition of any quoting.</span>

<span class="hljs-comment"># _Protect_Literal_String_Test</span>
<span class="hljs-comment"># # # Remove the above "# " to disable this code. # # #</span>

<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>
        <a name="UNPROTECTLITERAL0" id="UNPROTECTLITERAL0"></a>But, what if you
        <em>want</em> the shell to expand and reinterpret strings?
      </p>
      <div class="EXAMPLE">
        <a name="UNPROTECTLITERAL" id="UNPROTECTLITERAL"></a>
        <p><b>Example A-27. Unprotecting literal strings</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#! /bin/bash</span>
<span class="hljs-comment"># unprotect_literal.sh</span>

<span class="hljs-comment"># set -vx</span>

:&lt;&lt;-<span class="hljs-string">'_UnProtect_Literal_String_Doc'</span>

    Copyright (c) Michael S. Zick, 2003; All Rights Reserved
    License: Unrestricted reuse <span class="hljs-keyword">in</span> any form, <span class="hljs-keyword">for</span> any purpose.
    Warranty: None
    Revision: <span class="hljs-variable">$ID</span>$

    Documentation redirected to the Bash no-operation. Bash will
    <span class="hljs-string">'/dev/null'</span> this block when the script is first <span class="hljs-built_in">read</span>.
    (Uncomment the above <span class="hljs-built_in">set</span> <span class="hljs-built_in">command</span> to see this action.)

    Remove the first (Sha-Bang) line when sourcing this as a library
    procedure.  Also comment out the example use code <span class="hljs-keyword">in</span> the two
    places <span class="hljs-built_in">where</span> shown.


    Usage:
        Complement of the <span class="hljs-string">"<span class="hljs-subst">$(_pls 'Literal String')</span>"</span> <span class="hljs-keyword">function</span>.
        (See the protect_literal.sh example.)

        StringVar=$(_upls ProtectedSringVariable)

    Does:
        When used on the right-hand-side of an assignment statement;
        makes the substitions embedded <span class="hljs-keyword">in</span> the protected string.

    Notes:
        The strange names (_*) are used to avoid trampling on
        the user<span class="hljs-string">'s chosen names when this is sourced as a
        library.


_UnProtect_Literal_String_Doc

_upls() {
    local IFS=$'</span>x1B<span class="hljs-string">'                # \ESC character (not required)
    eval echo $@                    # Substitution on the glob.
}

# :&lt;&lt;-'</span>_UnProtect_Literal_String_Test<span class="hljs-string">'
# # # Remove the above "# " to disable this code. # # #


_pls() {
    local IFS=$'</span>x1B<span class="hljs-string">'                # \ESC character (not required)
    echo $'</span>\x27<span class="hljs-string">'$@$'</span>\x27<span class="hljs-string">'           # Hard quoted parameter glob
}

# Declare an array for test values.
declare -a arrayZ

# Assign elements with various types of quotes and escapes.
arrayZ=( zero "$(_pls '</span>Hello <span class="hljs-variable">${Me}</span><span class="hljs-string">')" '</span>Hello <span class="hljs-variable">${You}</span><span class="hljs-string">' "\'</span>Pass: <span class="hljs-variable">${pw}</span>\<span class="hljs-string">'" )

# Now make an assignment with that result.
declare -a array2=( ${arrayZ[@]} )

# Which yielded:
# - - Test Three - -
# Element 0: zero is: 4 long            # Our marker element.
# Element 1: Hello ${Me} is: 11 long    # Intended result.
# Element 2: Hello is: 5 long           # ${You} expanded to nothing.
# Element 3: '</span>Pass: is: 6 long          <span class="hljs-comment"># Split on the whitespace.</span>
<span class="hljs-comment"># Element 4: ' is: 1 long               # The end quote is here now.</span>

<span class="hljs-comment"># set -vx</span>

<span class="hljs-comment">#  Initialize 'Me' to something for the embedded ${Me} substitution.</span>
<span class="hljs-comment">#  This needs to be done ONLY just prior to evaluating the</span>
<span class="hljs-comment">#+ protected string.</span>
<span class="hljs-comment">#  (This is why it was protected to begin with.)</span>

Me=<span class="hljs-string">"to the array guy."</span>

<span class="hljs-comment"># Set a string variable destination to the result.</span>
newVar=$(_upls <span class="hljs-variable">${array2[1]}</span>)

<span class="hljs-comment"># Show what the contents are.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$newVar</span>

<span class="hljs-comment"># Do we really need a function to do this?</span>
newerVar=$(<span class="hljs-built_in">eval</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">${array2[1]}</span>)
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$newerVar</span>

<span class="hljs-comment">#  I guess not, but the _upls function gives us a place to hang</span>
<span class="hljs-comment">#+ the documentation on.</span>
<span class="hljs-comment">#  This helps when we forget what a # construction like:</span>
<span class="hljs-comment">#+ $(eval echo ... ) means.</span>

<span class="hljs-comment"># What if Me isn't set when the protected string is evaluated?</span>
<span class="hljs-built_in">unset</span> Me
newestVar=$(_upls <span class="hljs-variable">${array2[1]}</span>)
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$newestVar</span>

<span class="hljs-comment"># Just gone, no hints, no runs, no errors.</span>

<span class="hljs-comment">#  Why in the world?</span>
<span class="hljs-comment">#  Setting the contents of a string variable containing character</span>
<span class="hljs-comment">#+ sequences that have a meaning in Bash is a general problem in</span>
<span class="hljs-comment">#+ script programming.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  This problem is now solved in eight lines of code</span>
<span class="hljs-comment">#+ (and four pages of description).</span>

<span class="hljs-comment">#  Where is all this going?</span>
<span class="hljs-comment">#  Dynamic content Web pages as an array of Bash strings.</span>
<span class="hljs-comment">#  Content set per request by a Bash 'eval' command</span>
<span class="hljs-comment">#+ on the stored page template.</span>
<span class="hljs-comment">#  Not intended to replace PHP, just an interesting thing to do.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  Don't have a webserver application?</span>
<span class="hljs-comment">#  No problem, check the example directory of the Bash source;</span>
<span class="hljs-comment">#+ there is a Bash script for that also.</span>

<span class="hljs-comment"># _UnProtect_Literal_String_Test</span>
<span class="hljs-comment"># # # Remove the above "# " to disable this code. # # #</span>

<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>This interesting script helps hunt down spammers.</p>
      <p><a name="ISSPAMMER2_0" id="ISSPAMMER2_0"></a></p>
      <div class="EXAMPLE">
        <a name="ISSPAMMER2" id="ISSPAMMER2"></a>
        <p><b>Example A-28. Spammer Identification</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># $Id: is_spammer.bash,v 1.12.2.11 2004/10/01 21:42:33 mszick Exp $</span>
<span class="hljs-comment"># Above line is RCS info.</span>

<span class="hljs-comment"># The latest version of this script is available from http://www.morethan.org.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Spammer-identification</span>
<span class="hljs-comment"># by Michael S. Zick</span>
<span class="hljs-comment"># Used in the ABS Guide with permission.</span>



<span class="hljs-comment">#######################################################</span>
<span class="hljs-comment"># Documentation</span>
<span class="hljs-comment"># See also "Quickstart" at end of script.</span>
<span class="hljs-comment">#######################################################</span>

:&lt;&lt;-<span class="hljs-string">'__is_spammer_Doc_'</span>

    Copyright (c) Michael S. Zick, 2004
    License: Unrestricted reuse <span class="hljs-keyword">in</span> any form, <span class="hljs-keyword">for</span> any purpose.
    Warranty: None -{Its a script; the user is on their own.}-

Impatient?
    Application code: goto <span class="hljs-string">"# # # Hunt the Spammer' program code # # #"</span>
    Example output: <span class="hljs-string">":&lt;&lt;-'_is_spammer_outputs_'"</span>
    How to use: Enter script name without arguments.
                Or goto <span class="hljs-string">"Quickstart"</span> at end of script.

Provides
    Given a domain name or IP(v4) address as input:

    Does an exhaustive <span class="hljs-built_in">set</span> of queries to find the associated
    network resources (short of recursing into TLDs).

    Checks the IP(v4) addresses found against Blacklist
    nameservers.

    If found to be a blacklisted IP(v4) address,
    reports the blacklist text records.
    (Usually hyper-links to the specific report.)

Requires
    A working Internet connection.
    (Exercise: Add check and/or abort <span class="hljs-keyword">if</span> not on-line when running script.)
    Bash with arrays (2.05b+).

    The external program <span class="hljs-string">'dig'</span> --
    a utility program provided with the <span class="hljs-string">'bind'</span> <span class="hljs-built_in">set</span> of programs.
    Specifically, the version <span class="hljs-built_in">which</span> is part of Bind series 9.x
    See: http://www.isc.org

    All usages of <span class="hljs-string">'dig'</span> are limited to wrapper <span class="hljs-built_in">functions</span>,
    <span class="hljs-built_in">which</span> may be rewritten as required.
    See: dig_wrappers.bash <span class="hljs-keyword">for</span> details.
         (<span class="hljs-string">"Additional documentation"</span> -- below)

Usage
    Script requires a single argument, <span class="hljs-built_in">which</span> may be:
    1) A domain name;
    2) An IP(v4) address;
    3) A filename, with one name or address per line.

    Script accepts an optional second argument, <span class="hljs-built_in">which</span> may be:
    1) A Blacklist server name;
    2) A filename, with one Blacklist server name per line.

    If the second argument is not provided, the script uses
    a built-in <span class="hljs-built_in">set</span> of (free) Blacklist servers.

    See also, the Quickstart at the end of this script (after <span class="hljs-string">'exit'</span>).

Return Codes
    0 - All OK
    1 - Script failure
    2 - Something is Blacklisted

Optional environment variables
    SPAMMER_TRACE
        If <span class="hljs-built_in">set</span> to a writable file,
        script will <span class="hljs-built_in">log</span> an execution flow trace.

    SPAMMER_DATA
        If <span class="hljs-built_in">set</span> to a writable file, script will dump its
        discovered data <span class="hljs-keyword">in</span> the form of GraphViz file.
        See: http://www.research.att.com/sw/tools/graphviz

    SPAMMER_LIMIT
        Limits the depth of resource tracing.

        Default is 2 levels.

        A setting of 0 (zero) means <span class="hljs-string">'unlimited'</span> . . .
          Caution: script might recurse the whole Internet!

        A <span class="hljs-built_in">limit</span> of 1 or 2 is most useful when processing
        a file of domain names and addresses.
        A higher <span class="hljs-built_in">limit</span> can be useful when hunting spam gangs.


Additional documentation
    Download the archived <span class="hljs-built_in">set</span> of scripts
    explaining and illustrating the <span class="hljs-keyword">function</span> contained within this script.
    http://bash.deta.in/mszick_clf.tar.bz2


Study notes
    This script uses a large number of <span class="hljs-built_in">functions</span>.
    Nearly all general <span class="hljs-built_in">functions</span> have their own example script.
    Each of the example scripts have tutorial level comments.

Scripting project
    Add support <span class="hljs-keyword">for</span> IP(v6) addresses.
    IP(v6) addresses are recognized but not processed.

Advanced project
    Add the reverse lookup detail to the discovered information.

    Report the delegation chain and abuse contacts.

    Modify the GraphViz file output to include the
    newly discovered information.

__is_spammer_Doc_

<span class="hljs-comment">#######################################################</span>




<span class="hljs-comment">#### Special IFS settings used for string parsing. ####</span>

<span class="hljs-comment"># Whitespace == :Space:Tab:Line Feed:Carriage Return:</span>
WSP_IFS=$<span class="hljs-string">'\x20'</span>$<span class="hljs-string">'\x09'</span>$<span class="hljs-string">'\x0A'</span>$<span class="hljs-string">'\x0D'</span>

<span class="hljs-comment"># No Whitespace == Line Feed:Carriage Return</span>
NO_WSP=$<span class="hljs-string">'\x0A'</span>$<span class="hljs-string">'\x0D'</span>

<span class="hljs-comment"># Field separator for dotted decimal IP addresses</span>
ADR_IFS=<span class="hljs-variable">${NO_WSP}</span><span class="hljs-string">'.'</span>

<span class="hljs-comment"># Array to dotted string conversions</span>
DOT_IFS=<span class="hljs-string">'.'</span><span class="hljs-variable">${WSP_IFS}</span>

<span class="hljs-comment"># # # Pending operations stack machine # # #</span>
<span class="hljs-comment"># This set of functions described in func_stack.bash.</span>
<span class="hljs-comment"># (See "Additional documentation" above.)</span>
<span class="hljs-comment"># # #</span>

<span class="hljs-comment"># Global stack of pending operations.</span>
<span class="hljs-built_in">declare</span> -f -a _pending_
<span class="hljs-comment"># Global sentinel for stack runners</span>
<span class="hljs-built_in">declare</span> -i _p_ctrl_
<span class="hljs-comment"># Global holder for currently executing function</span>
<span class="hljs-built_in">declare</span> -f _pend_current_

<span class="hljs-comment"># # # Debug version only - remove for regular use # # #</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># The function stored in _pend_hook_ is called</span>
<span class="hljs-comment"># immediately before each pending function is</span>
<span class="hljs-comment"># evaluated.  Stack clean, _pend_current_ set.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># This thingy demonstrated in pend_hook.bash.</span>
<span class="hljs-built_in">declare</span> -f _pend_hook_
<span class="hljs-comment"># # #</span>

<span class="hljs-comment"># The do nothing function</span>
<span class="hljs-function"><span class="hljs-title">pend_dummy</span></span>() { : ; }

<span class="hljs-comment"># Clear and initialize the function stack.</span>
<span class="hljs-function"><span class="hljs-title">pend_init</span></span>() {
    <span class="hljs-built_in">unset</span> _pending_[@]
    pend_func pend_stop_mark
    _pend_hook_=<span class="hljs-string">'pend_dummy'</span>  <span class="hljs-comment"># Debug only.</span>
}

<span class="hljs-comment"># Discard the top function on the stack.</span>
<span class="hljs-function"><span class="hljs-title">pend_pop</span></span>() {
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_pending_[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">local</span> -i _top_
        _top_=<span class="hljs-variable">${#_pending_[@]}</span>-1
        <span class="hljs-built_in">unset</span> _pending_[<span class="hljs-variable">$_top_</span>]
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># pend_func function_name [$(printf '%q\n' arguments)]</span>
<span class="hljs-function"><span class="hljs-title">pend_func</span></span>() {
    <span class="hljs-built_in">local</span> IFS=<span class="hljs-variable">${NO_WSP}</span>
    <span class="hljs-built_in">set</span> -f
    _pending_[<span class="hljs-variable">${#_pending_[@]}</span>]=<span class="hljs-variable">$@</span>
    <span class="hljs-built_in">set</span> +f
}

<span class="hljs-comment"># The function which stops the release:</span>
<span class="hljs-function"><span class="hljs-title">pend_stop_mark</span></span>() {
    _p_ctrl_=0
}

<span class="hljs-function"><span class="hljs-title">pend_mark</span></span>() {
    pend_func pend_stop_mark
}

<span class="hljs-comment"># Execute functions until 'pend_stop_mark' . . .</span>
<span class="hljs-function"><span class="hljs-title">pend_release</span></span>() {
    <span class="hljs-built_in">local</span> -i _top_             <span class="hljs-comment"># Declare _top_ as integer.</span>
    _p_ctrl_=<span class="hljs-variable">${#_pending_[@]}</span>
    <span class="hljs-keyword">while</span> [ <span class="hljs-variable">${_p_ctrl_}</span> -gt 0 ]
    <span class="hljs-keyword">do</span>
       _top_=<span class="hljs-variable">${#_pending_[@]}</span>-1
       _pend_current_=<span class="hljs-variable">${_pending_[$_top_]}</span>
       <span class="hljs-built_in">unset</span> _pending_[<span class="hljs-variable">$_top_</span>]
       <span class="hljs-variable">$_pend_hook_</span>            <span class="hljs-comment"># Debug only.</span>
       <span class="hljs-built_in">eval</span> <span class="hljs-variable">$_pend_current_</span>
    <span class="hljs-keyword">done</span>
}

<span class="hljs-comment"># Drop functions until 'pend_stop_mark' . . .</span>
<span class="hljs-function"><span class="hljs-title">pend_drop</span></span>() {
    <span class="hljs-built_in">local</span> -i _top_
    <span class="hljs-built_in">local</span> _pd_ctrl_=<span class="hljs-variable">${#_pending_[@]}</span>
    <span class="hljs-keyword">while</span> [ <span class="hljs-variable">${_pd_ctrl_}</span> -gt 0 ]
    <span class="hljs-keyword">do</span>
       _top_=<span class="hljs-variable">$_pd_ctrl_</span>-1
       <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">${_pending_[$_top_]}</span>"</span> == <span class="hljs-string">'pend_stop_mark'</span> ]
       <span class="hljs-keyword">then</span>
           <span class="hljs-built_in">unset</span> _pending_[<span class="hljs-variable">$_top_</span>]
           <span class="hljs-built_in">break</span>
       <span class="hljs-keyword">else</span>
           <span class="hljs-built_in">unset</span> _pending_[<span class="hljs-variable">$_top_</span>]
           _pd_ctrl_=<span class="hljs-variable">$_top_</span>
       <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_pending_[@]}</span> -eq 0 ]
    <span class="hljs-keyword">then</span>
        pend_func pend_stop_mark
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment">#### Array editors ####</span>

<span class="hljs-comment"># This function described in edit_exact.bash.</span>
<span class="hljs-comment"># (See "Additional documentation," above.)</span>
<span class="hljs-comment"># edit_exact &lt;excludes_array_name&gt; &lt;target_array_name&gt;</span>
<span class="hljs-function"><span class="hljs-title">edit_exact</span></span>() {
    [ <span class="hljs-variable">$#</span> -eq 2 ] ||
    [ <span class="hljs-variable">$#</span> -eq 3 ] || <span class="hljs-built_in">return</span> 1
    <span class="hljs-built_in">local</span> -a _ee_Excludes
    <span class="hljs-built_in">local</span> -a _ee_Target
    <span class="hljs-built_in">local</span> _ee_x
    <span class="hljs-built_in">local</span> _ee_t
    <span class="hljs-built_in">local</span> IFS=<span class="hljs-variable">${NO_WSP}</span>
    <span class="hljs-built_in">set</span> -f
    <span class="hljs-built_in">eval</span> _ee_Excludes=\( \$\{<span class="hljs-variable">$1</span>\[@\]\} \)
    <span class="hljs-built_in">eval</span> _ee_Target=\( \$\{<span class="hljs-variable">$2</span>\[@\]\} \)
    <span class="hljs-built_in">local</span> _ee_len=<span class="hljs-variable">${#_ee_Target[@]}</span>     <span class="hljs-comment"># Original length.</span>
    <span class="hljs-built_in">local</span> _ee_cnt=<span class="hljs-variable">${#_ee_Excludes[@]}</span>   <span class="hljs-comment"># Exclude list length.</span>
    [ <span class="hljs-variable">${_ee_len}</span> -ne 0 ] || <span class="hljs-built_in">return</span> 0    <span class="hljs-comment"># Can't edit zero length.</span>
    [ <span class="hljs-variable">${_ee_cnt}</span> -ne 0 ] || <span class="hljs-built_in">return</span> 0    <span class="hljs-comment"># Can't edit zero length.</span>
    <span class="hljs-keyword">for</span> (( x = 0; x &lt; <span class="hljs-variable">${_ee_cnt}</span> ; x++ ))
    <span class="hljs-keyword">do</span>
        _ee_x=<span class="hljs-variable">${_ee_Excludes[$x]}</span>
        <span class="hljs-keyword">for</span> (( n = 0 ; n &lt; <span class="hljs-variable">${_ee_len}</span> ; n++ ))
        <span class="hljs-keyword">do</span>
            _ee_t=<span class="hljs-variable">${_ee_Target[$n]}</span>
            <span class="hljs-keyword">if</span> [ x<span class="hljs-string">"<span class="hljs-variable">${_ee_t}</span>"</span> == x<span class="hljs-string">"<span class="hljs-variable">${_ee_x}</span>"</span> ]
            <span class="hljs-keyword">then</span>
                <span class="hljs-built_in">unset</span> _ee_Target[<span class="hljs-variable">$n</span>]     <span class="hljs-comment"># Discard match.</span>
                [ <span class="hljs-variable">$#</span> -eq 2 ] &amp;&amp; <span class="hljs-built_in">break</span>    <span class="hljs-comment"># If 2 arguments, then done.</span>
            <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">done</span>
    <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\( \$\{_ee_Target\[@\]\} \)
    <span class="hljs-built_in">set</span> +f
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># This function described in edit_by_glob.bash.</span>
<span class="hljs-comment"># edit_by_glob &lt;excludes_array_name&gt; &lt;target_array_name&gt;</span>
<span class="hljs-function"><span class="hljs-title">edit_by_glob</span></span>() {
    [ <span class="hljs-variable">$#</span> -eq 2 ] ||
    [ <span class="hljs-variable">$#</span> -eq 3 ] || <span class="hljs-built_in">return</span> 1
    <span class="hljs-built_in">local</span> -a _ebg_Excludes
    <span class="hljs-built_in">local</span> -a _ebg_Target
    <span class="hljs-built_in">local</span> _ebg_x
    <span class="hljs-built_in">local</span> _ebg_t
    <span class="hljs-built_in">local</span> IFS=<span class="hljs-variable">${NO_WSP}</span>
    <span class="hljs-built_in">set</span> -f
    <span class="hljs-built_in">eval</span> _ebg_Excludes=\( \$\{<span class="hljs-variable">$1</span>\[@\]\} \)
    <span class="hljs-built_in">eval</span> _ebg_Target=\( \$\{<span class="hljs-variable">$2</span>\[@\]\} \)
    <span class="hljs-built_in">local</span> _ebg_len=<span class="hljs-variable">${#_ebg_Target[@]}</span>
    <span class="hljs-built_in">local</span> _ebg_cnt=<span class="hljs-variable">${#_ebg_Excludes[@]}</span>
    [ <span class="hljs-variable">${_ebg_len}</span> -ne 0 ] || <span class="hljs-built_in">return</span> 0
    [ <span class="hljs-variable">${_ebg_cnt}</span> -ne 0 ] || <span class="hljs-built_in">return</span> 0
    <span class="hljs-keyword">for</span> (( x = 0; x &lt; <span class="hljs-variable">${_ebg_cnt}</span> ; x++ ))
    <span class="hljs-keyword">do</span>
        _ebg_x=<span class="hljs-variable">${_ebg_Excludes[$x]}</span>
        <span class="hljs-keyword">for</span> (( n = 0 ; n &lt; <span class="hljs-variable">${_ebg_len}</span> ; n++ ))
        <span class="hljs-keyword">do</span>
            [ <span class="hljs-variable">$#</span> -eq 3 ] &amp;&amp; _ebg_x=<span class="hljs-variable">${_ebg_x}</span><span class="hljs-string">'*'</span>  <span class="hljs-comment">#  Do prefix edit</span>
            <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${_ebg_Target[$n]:=}</span> ]          <span class="hljs-comment">#+ if defined &amp; set.</span>
            <span class="hljs-keyword">then</span>
                _ebg_t=<span class="hljs-variable">${_ebg_Target[$n]/#${_ebg_x}</span>/}
                [ <span class="hljs-variable">${#_ebg_t}</span> -eq 0 ] &amp;&amp; <span class="hljs-built_in">unset</span> _ebg_Target[<span class="hljs-variable">$n</span>]
            <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">done</span>
    <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\( \$\{_ebg_Target\[@\]\} \)
    <span class="hljs-built_in">set</span> +f
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># This function described in unique_lines.bash.</span>
<span class="hljs-comment"># unique_lines &lt;in_name&gt; &lt;out_name&gt;</span>
<span class="hljs-function"><span class="hljs-title">unique_lines</span></span>() {
    [ <span class="hljs-variable">$#</span> -eq 2 ] || <span class="hljs-built_in">return</span> 1
    <span class="hljs-built_in">local</span> -a _ul_in
    <span class="hljs-built_in">local</span> -a _ul_out
    <span class="hljs-built_in">local</span> -i _ul_cnt
    <span class="hljs-built_in">local</span> -i _ul_pos
    <span class="hljs-built_in">local</span> _ul_tmp
    <span class="hljs-built_in">local</span> IFS=<span class="hljs-variable">${NO_WSP}</span>
    <span class="hljs-built_in">set</span> -f
    <span class="hljs-built_in">eval</span> _ul_in=\( \$\{<span class="hljs-variable">$1</span>\[@\]\} \)
    _ul_cnt=<span class="hljs-variable">${#_ul_in[@]}</span>
    <span class="hljs-keyword">for</span> (( _ul_pos = 0 ; _ul_pos &lt; <span class="hljs-variable">${_ul_cnt}</span> ; _ul_pos++ ))
    <span class="hljs-keyword">do</span>
        <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${_ul_in[${_ul_pos}</span>]:=} ]      <span class="hljs-comment"># If defined &amp; not empty</span>
        <span class="hljs-keyword">then</span>
            _ul_tmp=<span class="hljs-variable">${_ul_in[${_ul_pos}</span>]}
            _ul_out[<span class="hljs-variable">${#_ul_out[@]}</span>]=<span class="hljs-variable">${_ul_tmp}</span>
            <span class="hljs-keyword">for</span> (( zap = _ul_pos ; zap &lt; <span class="hljs-variable">${_ul_cnt}</span> ; zap++ ))
            <span class="hljs-keyword">do</span>
                [ <span class="hljs-variable">${_ul_in[${zap}</span>]:=} ] &amp;&amp;
                [ <span class="hljs-string">'x'</span><span class="hljs-variable">${_ul_in[${zap}</span>]} == <span class="hljs-string">'x'</span><span class="hljs-variable">${_ul_tmp}</span> ] &amp;&amp;
                    <span class="hljs-built_in">unset</span> _ul_in[<span class="hljs-variable">${zap}</span>]
            <span class="hljs-keyword">done</span>
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>
    <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\( \$\{_ul_out\[@\]\} \)
    <span class="hljs-built_in">set</span> +f
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># This function described in char_convert.bash.</span>
<span class="hljs-comment"># to_lower &lt;string&gt;</span>
<span class="hljs-function"><span class="hljs-title">to_lower</span></span>() {
    [ <span class="hljs-variable">$#</span> -eq 1 ] || <span class="hljs-built_in">return</span> 1
    <span class="hljs-built_in">local</span> _tl_out
    _tl_out=<span class="hljs-variable">${1//A/a}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//B/b}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//C/c}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//D/d}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//E/e}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//F/f}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//G/g}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//H/h}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//I/i}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//J/j}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//K/k}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//L/l}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//M/m}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//N/n}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//O/o}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//P/p}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//Q/q}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//R/r}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//S/s}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//T/t}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//U/u}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//V/v}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//W/w}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//X/x}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//Y/y}</span>
    _tl_out=<span class="hljs-variable">${_tl_out//Z/z}</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-variable">${_tl_out}</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment">#### Application helper functions ####</span>

<span class="hljs-comment"># Not everybody uses dots as separators (APNIC, for example).</span>
<span class="hljs-comment"># This function described in to_dot.bash</span>
<span class="hljs-comment"># to_dot &lt;string&gt;</span>
<span class="hljs-function"><span class="hljs-title">to_dot</span></span>() {
    [ <span class="hljs-variable">$#</span> -eq 1 ] || <span class="hljs-built_in">return</span> 1
    <span class="hljs-built_in">echo</span> <span class="hljs-variable">${1//[#|@|%]/.}</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># This function described in is_number.bash.</span>
<span class="hljs-comment"># is_number &lt;input&gt;</span>
<span class="hljs-function"><span class="hljs-title">is_number</span></span>() {
    [ <span class="hljs-string">"<span class="hljs-variable">$#</span>"</span> -eq 1 ]    || <span class="hljs-built_in">return</span> 1  <span class="hljs-comment"># is blank?</span>
    [ x<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> == <span class="hljs-string">'x0'</span> ] &amp;&amp; <span class="hljs-built_in">return</span> 0  <span class="hljs-comment"># is zero?</span>
    <span class="hljs-built_in">local</span> -i tst
    <span class="hljs-built_in">let</span> tst=<span class="hljs-variable">$1</span> 2&gt;/dev/null         <span class="hljs-comment"># else is numeric!</span>
    <span class="hljs-built_in">return</span> $?
}

<span class="hljs-comment"># This function described in is_address.bash.</span>
<span class="hljs-comment"># is_address &lt;input&gt;</span>
<span class="hljs-function"><span class="hljs-title">is_address</span></span>() {
    [ <span class="hljs-variable">$#</span> -eq 1 ] || <span class="hljs-built_in">return</span> 1    <span class="hljs-comment"># Blank ==&gt; false</span>
    <span class="hljs-built_in">local</span> -a _ia_input
    <span class="hljs-built_in">local</span> IFS=<span class="hljs-variable">${ADR_IFS}</span>
    _ia_input=( <span class="hljs-variable">$1</span> )
    <span class="hljs-keyword">if</span>  [ <span class="hljs-variable">${#_ia_input[@]}</span> -eq 4 ]  &amp;&amp;
        is_number <span class="hljs-variable">${_ia_input[0]}</span>   &amp;&amp;
        is_number <span class="hljs-variable">${_ia_input[1]}</span>   &amp;&amp;
        is_number <span class="hljs-variable">${_ia_input[2]}</span>   &amp;&amp;
        is_number <span class="hljs-variable">${_ia_input[3]}</span>   &amp;&amp;
        [ <span class="hljs-variable">${_ia_input[0]}</span> -lt 256 ] &amp;&amp;
        [ <span class="hljs-variable">${_ia_input[1]}</span> -lt 256 ] &amp;&amp;
        [ <span class="hljs-variable">${_ia_input[2]}</span> -lt 256 ] &amp;&amp;
        [ <span class="hljs-variable">${_ia_input[3]}</span> -lt 256 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">return</span> 0
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">return</span> 1
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment">#  This function described in split_ip.bash.</span>
<span class="hljs-comment">#  split_ip &lt;IP_address&gt;</span>
<span class="hljs-comment">#+ &lt;array_name_norm&gt; [&lt;array_name_rev&gt;]</span>
<span class="hljs-function"><span class="hljs-title">split_ip</span></span>() {
    [ <span class="hljs-variable">$#</span> -eq 3 ] ||              <span class="hljs-comment">#  Either three</span>
    [ <span class="hljs-variable">$#</span> -eq 2 ] || <span class="hljs-built_in">return</span> 1     <span class="hljs-comment">#+ or two arguments</span>
    <span class="hljs-built_in">local</span> -a _si_input
    <span class="hljs-built_in">local</span> IFS=<span class="hljs-variable">${ADR_IFS}</span>
    _si_input=( <span class="hljs-variable">$1</span> )
    IFS=<span class="hljs-variable">${WSP_IFS}</span>
    <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\(\ \$\{_si_input\[@\]\}\ \)
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -eq 3 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-comment"># Build query order array.</span>
        <span class="hljs-built_in">local</span> -a _dns_ip
        _dns_ip[0]=<span class="hljs-variable">${_si_input[3]}</span>
        _dns_ip[1]=<span class="hljs-variable">${_si_input[2]}</span>
        _dns_ip[2]=<span class="hljs-variable">${_si_input[1]}</span>
        _dns_ip[3]=<span class="hljs-variable">${_si_input[0]}</span>
        <span class="hljs-built_in">eval</span> <span class="hljs-variable">$3</span>=\(\ \$\{_dns_ip\[@\]\}\ \)
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># This function described in dot_array.bash.</span>
<span class="hljs-comment"># dot_array &lt;array_name&gt;</span>
<span class="hljs-function"><span class="hljs-title">dot_array</span></span>() {
    [ <span class="hljs-variable">$#</span> -eq 1 ] || <span class="hljs-built_in">return</span> 1     <span class="hljs-comment"># Single argument required.</span>
    <span class="hljs-built_in">local</span> -a _da_input
    <span class="hljs-built_in">eval</span> _da_input=\(\ \$\{<span class="hljs-variable">$1</span>\[@\]\}\ \)
    <span class="hljs-built_in">local</span> IFS=<span class="hljs-variable">${DOT_IFS}</span>
    <span class="hljs-built_in">local</span> _da_output=<span class="hljs-variable">${_da_input[@]}</span>
    IFS=<span class="hljs-variable">${WSP_IFS}</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-variable">${_da_output}</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># This function described in file_to_array.bash</span>
<span class="hljs-comment"># file_to_array &lt;file_name&gt; &lt;line_array_name&gt;</span>
<span class="hljs-function"><span class="hljs-title">file_to_array</span></span>() {
    [ <span class="hljs-variable">$#</span> -eq 2 ] || <span class="hljs-built_in">return</span> 1  <span class="hljs-comment"># Two arguments required.</span>
    <span class="hljs-built_in">local</span> IFS=<span class="hljs-variable">${NO_WSP}</span>
    <span class="hljs-built_in">local</span> -a _fta_tmp_
    _fta_tmp_=( $(cat <span class="hljs-variable">$1</span>) )
    <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\( \$\{_fta_tmp_\[@\]\} \)
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment">#  Columnized print of an array of multi-field strings.</span>
<span class="hljs-comment">#  col_print &lt;array_name&gt; &lt;min_space&gt; &lt;</span>
<span class="hljs-comment">#+ tab_stop [tab_stops]&gt;</span>
<span class="hljs-function"><span class="hljs-title">col_print</span></span>() {
    [ <span class="hljs-variable">$#</span> -gt 2 ] || <span class="hljs-built_in">return</span> 0
    <span class="hljs-built_in">local</span> -a _cp_inp
    <span class="hljs-built_in">local</span> -a _cp_spc
    <span class="hljs-built_in">local</span> -a _cp_line
    <span class="hljs-built_in">local</span> _cp_min
    <span class="hljs-built_in">local</span> _cp_mcnt
    <span class="hljs-built_in">local</span> _cp_pos
    <span class="hljs-built_in">local</span> _cp_cnt
    <span class="hljs-built_in">local</span> _cp_tab
    <span class="hljs-built_in">local</span> -i _cp
    <span class="hljs-built_in">local</span> -i _cpf
    <span class="hljs-built_in">local</span> _cp_fld
    <span class="hljs-comment"># WARNING: FOLLOWING LINE NOT BLANK -- IT IS QUOTED SPACES.</span>
    <span class="hljs-built_in">local</span> _cp_max=<span class="hljs-string">'                                                            '</span>
    <span class="hljs-built_in">set</span> -f
    <span class="hljs-built_in">local</span> IFS=<span class="hljs-variable">${NO_WSP}</span>
    <span class="hljs-built_in">eval</span> _cp_inp=\(\ \$\{<span class="hljs-variable">$1</span>\[@\]\}\ \)
    [ <span class="hljs-variable">${#_cp_inp[@]}</span> -gt 0 ] || <span class="hljs-built_in">return</span> 0 <span class="hljs-comment"># Empty is easy.</span>
    _cp_mcnt=<span class="hljs-variable">$2</span>
    _cp_min=<span class="hljs-variable">${_cp_max:1:${_cp_mcnt}</span>}
    <span class="hljs-built_in">shift</span>
    <span class="hljs-built_in">shift</span>
    _cp_cnt=<span class="hljs-variable">$#</span>
    <span class="hljs-keyword">for</span> (( _cp = 0 ; _cp &lt; _cp_cnt ; _cp++ ))
    <span class="hljs-keyword">do</span>
        _cp_spc[<span class="hljs-variable">${#_cp_spc[@]}</span>]=<span class="hljs-string">"<span class="hljs-variable">${_cp_max:2:$1}</span>"</span> <span class="hljs-comment">#"</span>
        <span class="hljs-built_in">shift</span>
    <span class="hljs-keyword">done</span>
    _cp_cnt=<span class="hljs-variable">${#_cp_inp[@]}</span>
    <span class="hljs-keyword">for</span> (( _cp = 0 ; _cp &lt; _cp_cnt ; _cp++ ))
    <span class="hljs-keyword">do</span>
        _cp_pos=1
        IFS=<span class="hljs-variable">${NO_WSP}</span>$<span class="hljs-string">'\x20'</span>
        _cp_line=( <span class="hljs-variable">${_cp_inp[${_cp}</span>]} )
        IFS=<span class="hljs-variable">${NO_WSP}</span>
        <span class="hljs-keyword">for</span> (( _cpf = 0 ; _cpf &lt; <span class="hljs-variable">${#_cp_line[@]}</span> ; _cpf++ ))
        <span class="hljs-keyword">do</span>
            _cp_tab=<span class="hljs-variable">${_cp_spc[${_cpf}</span>]:<span class="hljs-variable">${_cp_pos}</span>}
            <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_cp_tab}</span> -lt <span class="hljs-variable">${_cp_mcnt}</span> ]
            <span class="hljs-keyword">then</span>
                _cp_tab=<span class="hljs-string">"<span class="hljs-variable">${_cp_min}</span>"</span>
            <span class="hljs-keyword">fi</span>
            <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">${_cp_tab}</span>"</span>
            (( _cp_pos = <span class="hljs-variable">${_cp_pos}</span> + <span class="hljs-variable">${#_cp_tab}</span> ))
            _cp_fld=<span class="hljs-string">"<span class="hljs-variable">${_cp_line[${_cpf}</span>]}"</span>
            <span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${_cp_fld}</span>
            (( _cp_pos = <span class="hljs-variable">${_cp_pos}</span> + <span class="hljs-variable">${#_cp_fld}</span> ))
        <span class="hljs-keyword">done</span>
        <span class="hljs-built_in">echo</span>
    <span class="hljs-keyword">done</span>
    <span class="hljs-built_in">set</span> +f
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># # # # 'Hunt the Spammer' data flow # # # #</span>

<span class="hljs-comment"># Application return code</span>
<span class="hljs-built_in">declare</span> -i _hs_RC

<span class="hljs-comment"># Original input, from which IP addresses are removed</span>
<span class="hljs-comment"># After which, domain names to check</span>
<span class="hljs-built_in">declare</span> -a uc_name

<span class="hljs-comment"># Original input IP addresses are moved here</span>
<span class="hljs-comment"># After which, IP addresses to check</span>
<span class="hljs-built_in">declare</span> -a uc_address

<span class="hljs-comment"># Names against which address expansion run</span>
<span class="hljs-comment"># Ready for name detail lookup</span>
<span class="hljs-built_in">declare</span> -a chk_name

<span class="hljs-comment"># Addresses against which name expansion run</span>
<span class="hljs-comment"># Ready for address detail lookup</span>
<span class="hljs-built_in">declare</span> -a chk_address

<span class="hljs-comment">#  Recursion is depth-first-by-name.</span>
<span class="hljs-comment">#  The expand_input_address maintains this list</span>
<span class="hljs-comment">#+ to prohibit looking up addresses twice during</span>
<span class="hljs-comment">#+ domain name recursion.</span>
<span class="hljs-built_in">declare</span> -a been_there_addr
been_there_addr=( <span class="hljs-string">'127.0.0.1'</span> ) <span class="hljs-comment"># Whitelist localhost</span>

<span class="hljs-comment"># Names which we have checked (or given up on)</span>
<span class="hljs-built_in">declare</span> -a known_name

<span class="hljs-comment"># Addresses which we have checked (or given up on)</span>
<span class="hljs-built_in">declare</span> -a known_address

<span class="hljs-comment">#  List of zero or more Blacklist servers to check.</span>
<span class="hljs-comment">#  Each 'known_address' will be checked against each server,</span>
<span class="hljs-comment">#+ with negative replies and failures suppressed.</span>
<span class="hljs-built_in">declare</span> -a list_server

<span class="hljs-comment"># Indirection limit - set to zero == no limit</span>
indirect=<span class="hljs-variable">${SPAMMER_LIMIT:=2}</span>

<span class="hljs-comment"># # # # 'Hunt the Spammer' information output data # # # #</span>

<span class="hljs-comment"># Any domain name may have multiple IP addresses.</span>
<span class="hljs-comment"># Any IP address may have multiple domain names.</span>
<span class="hljs-comment"># Therefore, track unique address-name pairs.</span>
<span class="hljs-built_in">declare</span> -a known_pair
<span class="hljs-built_in">declare</span> -a reverse_pair

<span class="hljs-comment">#  In addition to the data flow variables; known_address</span>
<span class="hljs-comment">#+ known_name and list_server, the following are output to the</span>
<span class="hljs-comment">#+ external graphics interface file.</span>

<span class="hljs-comment"># Authority chain, parent -&gt; SOA fields.</span>
<span class="hljs-built_in">declare</span> -a auth_chain

<span class="hljs-comment"># Reference chain, parent name -&gt; child name</span>
<span class="hljs-built_in">declare</span> -a ref_chain

<span class="hljs-comment"># DNS chain - domain name -&gt; address</span>
<span class="hljs-built_in">declare</span> -a name_address

<span class="hljs-comment"># Name and service pairs - domain name -&gt; service</span>
<span class="hljs-built_in">declare</span> -a name_srvc

<span class="hljs-comment"># Name and resource pairs - domain name -&gt; Resource Record</span>
<span class="hljs-built_in">declare</span> -a name_resource

<span class="hljs-comment"># Parent and Child pairs - parent name -&gt; child name</span>
<span class="hljs-comment"># This MAY NOT be the same as the ref_chain followed!</span>
<span class="hljs-built_in">declare</span> -a parent_child

<span class="hljs-comment"># Address and Blacklist hit pairs - address-&gt;server</span>
<span class="hljs-built_in">declare</span> -a address_hits

<span class="hljs-comment"># Dump interface file data</span>
<span class="hljs-built_in">declare</span> -f _dot_dump
_dot_dump=pend_dummy   <span class="hljs-comment"># Initially a no-op</span>

<span class="hljs-comment">#  Data dump is enabled by setting the environment variable SPAMMER_DATA</span>
<span class="hljs-comment">#+ to the name of a writable file.</span>
<span class="hljs-built_in">declare</span> _dot_file

<span class="hljs-comment"># Helper function for the dump-to-dot-file function</span>
<span class="hljs-comment"># dump_to_dot &lt;array_name&gt; &lt;prefix&gt;</span>
<span class="hljs-function"><span class="hljs-title">dump_to_dot</span></span>() {
    <span class="hljs-built_in">local</span> -a _dda_tmp
    <span class="hljs-built_in">local</span> -i _dda_cnt
    <span class="hljs-built_in">local</span> _dda_form=<span class="hljs-string">'    '</span><span class="hljs-variable">${2}</span><span class="hljs-string">'%04u %s\n'</span>
    <span class="hljs-built_in">local</span> IFS=<span class="hljs-variable">${NO_WSP}</span>
    <span class="hljs-built_in">eval</span> _dda_tmp=\(\ \$\{<span class="hljs-variable">$1</span>\[@\]\}\ \)
    _dda_cnt=<span class="hljs-variable">${#_dda_tmp[@]}</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${_dda_cnt}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-keyword">for</span> (( _dda = 0 ; _dda &lt; _dda_cnt ; _dda++ ))
        <span class="hljs-keyword">do</span>
            <span class="hljs-built_in">printf</span> <span class="hljs-string">"<span class="hljs-variable">${_dda_form}</span>"</span> \
                   <span class="hljs-string">"<span class="hljs-variable">${_dda}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${_dda_tmp[${_dda}</span>]}"</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># Which will also set _dot_dump to this function . . .</span>
<span class="hljs-function"><span class="hljs-title">dump_dot</span></span>() {
    <span class="hljs-built_in">local</span> -i _dd_cnt
    <span class="hljs-built_in">echo</span> <span class="hljs-string">'# Data vintage: '</span>$(date -R) &gt;<span class="hljs-variable">${_dot_file}</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">'# ABS Guide: is_spammer.bash; v2, 2004-msz'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
    <span class="hljs-built_in">echo</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">'digraph G {'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#known_name[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'# Known domain name nodes'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        _dd_cnt=<span class="hljs-variable">${#known_name[@]}</span>
        <span class="hljs-keyword">for</span> (( _dd = 0 ; _dd &lt; _dd_cnt ; _dd++ ))
        <span class="hljs-keyword">do</span>
            <span class="hljs-built_in">printf</span> <span class="hljs-string">'    N%04u [label="%s"] ;\n'</span> \
                   <span class="hljs-string">"<span class="hljs-variable">${_dd}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${known_name[${_dd}</span>]}"</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#known_address[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'# Known address nodes'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        _dd_cnt=<span class="hljs-variable">${#known_address[@]}</span>
        <span class="hljs-keyword">for</span> (( _dd = 0 ; _dd &lt; _dd_cnt ; _dd++ ))
        <span class="hljs-keyword">do</span>
            <span class="hljs-built_in">printf</span> <span class="hljs-string">'    A%04u [label="%s"] ;\n'</span> \
                   <span class="hljs-string">"<span class="hljs-variable">${_dd}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${known_address[${_dd}</span>]}"</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-built_in">echo</span>                                   &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">'/*'</span>                              &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">' * Known relationships :: User conversion to'</span>  &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">' * graphic form by hand or program required.'</span>  &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">' *'</span>                              &gt;&gt;<span class="hljs-variable">${_dot_file}</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#auth_chain[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
      <span class="hljs-built_in">echo</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">'# Authority ref. edges followed &amp; field source.'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        dump_to_dot auth_chain AC
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#ref_chain[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'# Name ref. edges followed and field source.'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        dump_to_dot ref_chain RC
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#name_address[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'# Known name-&gt;address edges'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        dump_to_dot name_address NA
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#name_srvc[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'# Known name-&gt;service edges'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        dump_to_dot name_srvc NS
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#name_resource[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'# Known name-&gt;resource edges'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        dump_to_dot name_resource NR
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#parent_child[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'# Known parent-&gt;child edges'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        dump_to_dot parent_child PC
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#list_server[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'# Known Blacklist nodes'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        _dd_cnt=<span class="hljs-variable">${#list_server[@]}</span>
        <span class="hljs-keyword">for</span> (( _dd = 0 ; _dd &lt; _dd_cnt ; _dd++ ))
        <span class="hljs-keyword">do</span>
            <span class="hljs-built_in">printf</span> <span class="hljs-string">'    LS%04u [label="%s"] ;\n'</span> \
                   <span class="hljs-string">"<span class="hljs-variable">${_dd}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${list_server[${_dd}</span>]}"</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
        <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">fi</span>

    unique_lines address_hits address_hits
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#address_hits[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
      <span class="hljs-built_in">echo</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">'# Known address-&gt;Blacklist_hit edges'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">'# CAUTION: dig warnings can trigger false hits.'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
       dump_to_dot address_hits AH
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">echo</span>          &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">' *'</span>     &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">' * That is a lot of relationships. Happy graphing.'</span> &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">' */'</span>    &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">'}'</span>      &gt;&gt;<span class="hljs-variable">${_dot_file}</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># # # # 'Hunt the Spammer' execution flow # # # #</span>

<span class="hljs-comment">#  Execution trace is enabled by setting the</span>
<span class="hljs-comment">#+ environment variable SPAMMER_TRACE to the name of a writable file.</span>
<span class="hljs-built_in">declare</span> -a _trace_log
<span class="hljs-built_in">declare</span> _log_file

<span class="hljs-comment"># Function to fill the trace log</span>
<span class="hljs-function"><span class="hljs-title">trace_logger</span></span>() {
    _trace_log[<span class="hljs-variable">${#_trace_log[@]}</span>]=<span class="hljs-variable">${_pend_current_}</span>
}

<span class="hljs-comment"># Dump trace log to file function variable.</span>
<span class="hljs-built_in">declare</span> -f _log_dump
_log_dump=pend_dummy   <span class="hljs-comment"># Initially a no-op.</span>

<span class="hljs-comment"># Dump the trace log to a file.</span>
<span class="hljs-function"><span class="hljs-title">dump_log</span></span>() {
    <span class="hljs-built_in">local</span> -i _dl_cnt
    _dl_cnt=<span class="hljs-variable">${#_trace_log[@]}</span>
    <span class="hljs-keyword">for</span> (( _dl = 0 ; _dl &lt; _dl_cnt ; _dl++ ))
    <span class="hljs-keyword">do</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-variable">${_trace_log[${_dl}</span>]} &gt;&gt; <span class="hljs-variable">${_log_file}</span>
    <span class="hljs-keyword">done</span>
    _dl_cnt=<span class="hljs-variable">${#_pending_[@]}</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${_dl_cnt}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        _dl_cnt=<span class="hljs-variable">${_dl_cnt}</span>-1
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'# # # Operations stack not empty # # #'</span> &gt;&gt; <span class="hljs-variable">${_log_file}</span>
        <span class="hljs-keyword">for</span> (( _dl = <span class="hljs-variable">${_dl_cnt}</span> ; _dl &gt;= 0 ; _dl-- ))
        <span class="hljs-keyword">do</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-variable">${_pending_[${_dl}</span>]} &gt;&gt; <span class="hljs-variable">${_log_file}</span>
        <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># # # Utility program 'dig' wrappers # # #</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  These wrappers are derived from the</span>
<span class="hljs-comment">#+ examples shown in dig_wrappers.bash.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  The major difference is these return</span>
<span class="hljs-comment">#+ their results as a list in an array.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  See dig_wrappers.bash for details and</span>
<span class="hljs-comment">#+ use that script to develop any changes.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># # #</span>

<span class="hljs-comment"># Short form answer: 'dig' parses answer.</span>

<span class="hljs-comment"># Forward lookup :: Name -&gt; Address</span>
<span class="hljs-comment"># short_fwd &lt;domain_name&gt; &lt;array_name&gt;</span>
<span class="hljs-function"><span class="hljs-title">short_fwd</span></span>() {
    <span class="hljs-built_in">local</span> -a _sf_reply
    <span class="hljs-built_in">local</span> -i _sf_rc
    <span class="hljs-built_in">local</span> -i _sf_cnt
    IFS=<span class="hljs-variable">${NO_WSP}</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-string">'.'</span>
<span class="hljs-comment"># echo 'sfwd: '${1}</span>
  _sf_reply=( $(dig +short <span class="hljs-variable">${1}</span> -c <span class="hljs-keyword">in</span> -t a 2&gt;/dev/null) )
  _sf_rc=$?
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${_sf_rc}</span> -ne 0 ]
  <span class="hljs-keyword">then</span>
    _trace_log[<span class="hljs-variable">${#_trace_log[@]}</span>]=<span class="hljs-string">'## Lookup error '</span><span class="hljs-variable">${_sf_rc}</span><span class="hljs-string">' on '</span><span class="hljs-variable">${1}</span><span class="hljs-string">' ##'</span>
<span class="hljs-comment"># [ ${_sf_rc} -ne 9 ] &amp;&amp; pend_drop</span>
        <span class="hljs-built_in">return</span> <span class="hljs-variable">${_sf_rc}</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-comment"># Some versions of 'dig' return warnings on stdout.</span>
        _sf_cnt=<span class="hljs-variable">${#_sf_reply[@]}</span>
        <span class="hljs-keyword">for</span> (( _sf = 0 ; _sf &lt; <span class="hljs-variable">${_sf_cnt}</span> ; _sf++ ))
        <span class="hljs-keyword">do</span>
            [ <span class="hljs-string">'x'</span><span class="hljs-variable">${_sf_reply[${_sf}</span>]:0:2} == <span class="hljs-string">'x;;'</span> ] &amp;&amp;
                <span class="hljs-built_in">unset</span> _sf_reply[<span class="hljs-variable">${_sf}</span>]
        <span class="hljs-keyword">done</span>
        <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\( \$\{_sf_reply\[@\]\} \)
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># Reverse lookup :: Address -&gt; Name</span>
<span class="hljs-comment"># short_rev &lt;ip_address&gt; &lt;array_name&gt;</span>
<span class="hljs-function"><span class="hljs-title">short_rev</span></span>() {
    <span class="hljs-built_in">local</span> -a _sr_reply
    <span class="hljs-built_in">local</span> -i _sr_rc
    <span class="hljs-built_in">local</span> -i _sr_cnt
    IFS=<span class="hljs-variable">${NO_WSP}</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-string">'.'</span>
<span class="hljs-comment"># echo 'srev: '${1}</span>
  _sr_reply=( $(dig +short -x <span class="hljs-variable">${1}</span> 2&gt;/dev/null) )
  _sr_rc=$?
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${_sr_rc}</span> -ne 0 ]
  <span class="hljs-keyword">then</span>
    _trace_log[<span class="hljs-variable">${#_trace_log[@]}</span>]=<span class="hljs-string">'## Lookup error '</span><span class="hljs-variable">${_sr_rc}</span><span class="hljs-string">' on '</span><span class="hljs-variable">${1}</span><span class="hljs-string">' ##'</span>
<span class="hljs-comment"># [ ${_sr_rc} -ne 9 ] &amp;&amp; pend_drop</span>
        <span class="hljs-built_in">return</span> <span class="hljs-variable">${_sr_rc}</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-comment"># Some versions of 'dig' return warnings on stdout.</span>
        _sr_cnt=<span class="hljs-variable">${#_sr_reply[@]}</span>
        <span class="hljs-keyword">for</span> (( _sr = 0 ; _sr &lt; <span class="hljs-variable">${_sr_cnt}</span> ; _sr++ ))
        <span class="hljs-keyword">do</span>
            [ <span class="hljs-string">'x'</span><span class="hljs-variable">${_sr_reply[${_sr}</span>]:0:2} == <span class="hljs-string">'x;;'</span> ] &amp;&amp;
                <span class="hljs-built_in">unset</span> _sr_reply[<span class="hljs-variable">${_sr}</span>]
        <span class="hljs-keyword">done</span>
        <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\( \$\{_sr_reply\[@\]\} \)
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># Special format lookup used to query blacklist servers.</span>
<span class="hljs-comment"># short_text &lt;ip_address&gt; &lt;array_name&gt;</span>
<span class="hljs-function"><span class="hljs-title">short_text</span></span>() {
    <span class="hljs-built_in">local</span> -a _st_reply
    <span class="hljs-built_in">local</span> -i _st_rc
    <span class="hljs-built_in">local</span> -i _st_cnt
    IFS=<span class="hljs-variable">${NO_WSP}</span>
<span class="hljs-comment"># echo 'stxt: '${1}</span>
  _st_reply=( $(dig +short <span class="hljs-variable">${1}</span> -c <span class="hljs-keyword">in</span> -t txt 2&gt;/dev/null) )
  _st_rc=$?
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${_st_rc}</span> -ne 0 ]
  <span class="hljs-keyword">then</span>
    _trace_log[<span class="hljs-variable">${#_trace_log[@]}</span>]=<span class="hljs-string">'##Text lookup error '</span><span class="hljs-variable">${_st_rc}</span><span class="hljs-string">' on '</span><span class="hljs-variable">${1}</span><span class="hljs-string">'##'</span>
<span class="hljs-comment"># [ ${_st_rc} -ne 9 ] &amp;&amp; pend_drop</span>
        <span class="hljs-built_in">return</span> <span class="hljs-variable">${_st_rc}</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-comment"># Some versions of 'dig' return warnings on stdout.</span>
        _st_cnt=<span class="hljs-variable">${#_st_reply[@]}</span>
        <span class="hljs-keyword">for</span> (( _st = 0 ; _st &lt; <span class="hljs-variable">${#_st_cnt}</span> ; _st++ ))
        <span class="hljs-keyword">do</span>
            [ <span class="hljs-string">'x'</span><span class="hljs-variable">${_st_reply[${_st}</span>]:0:2} == <span class="hljs-string">'x;;'</span> ] &amp;&amp;
                <span class="hljs-built_in">unset</span> _st_reply[<span class="hljs-variable">${_st}</span>]
        <span class="hljs-keyword">done</span>
        <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\( \$\{_st_reply\[@\]\} \)
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># The long forms, a.k.a., the parse it yourself versions</span>

<span class="hljs-comment"># RFC 2782   Service lookups</span>
<span class="hljs-comment"># dig +noall +nofail +answer _ldap._tcp.openldap.org -t srv</span>
<span class="hljs-comment"># _&lt;service&gt;._&lt;protocol&gt;.&lt;domain_name&gt;</span>
<span class="hljs-comment"># _ldap._tcp.openldap.org. 3600   IN     SRV    0 0 389 ldap.openldap.org.</span>
<span class="hljs-comment"># domain TTL Class SRV Priority Weight Port Target</span>

<span class="hljs-comment"># Forward lookup :: Name -&gt; poor man's zone transfer</span>
<span class="hljs-comment"># long_fwd &lt;domain_name&gt; &lt;array_name&gt;</span>
<span class="hljs-function"><span class="hljs-title">long_fwd</span></span>() {
    <span class="hljs-built_in">local</span> -a _lf_reply
    <span class="hljs-built_in">local</span> -i _lf_rc
    <span class="hljs-built_in">local</span> -i _lf_cnt
    IFS=<span class="hljs-variable">${NO_WSP}</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-string">':'</span>
<span class="hljs-comment"># echo 'lfwd: '${1}</span>
  _lf_reply=( $(
     dig +noall +nofail +answer +authority +additional \
         <span class="hljs-variable">${1}</span> -t soa <span class="hljs-variable">${1}</span> -t mx <span class="hljs-variable">${1}</span> -t any 2&gt;/dev/null) )
  _lf_rc=$?
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${_lf_rc}</span> -ne 0 ]
  <span class="hljs-keyword">then</span>
    _trace_log[<span class="hljs-variable">${#_trace_log[@]}</span>]=<span class="hljs-string">'# Zone lookup err '</span><span class="hljs-variable">${_lf_rc}</span><span class="hljs-string">' on '</span><span class="hljs-variable">${1}</span><span class="hljs-string">' #'</span>
<span class="hljs-comment"># [ ${_lf_rc} -ne 9 ] &amp;&amp; pend_drop</span>
        <span class="hljs-built_in">return</span> <span class="hljs-variable">${_lf_rc}</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-comment"># Some versions of 'dig' return warnings on stdout.</span>
        _lf_cnt=<span class="hljs-variable">${#_lf_reply[@]}</span>
        <span class="hljs-keyword">for</span> (( _lf = 0 ; _lf &lt; <span class="hljs-variable">${_lf_cnt}</span> ; _lf++ ))
        <span class="hljs-keyword">do</span>
            [ <span class="hljs-string">'x'</span><span class="hljs-variable">${_lf_reply[${_lf}</span>]:0:2} == <span class="hljs-string">'x;;'</span> ] &amp;&amp;
                <span class="hljs-built_in">unset</span> _lf_reply[<span class="hljs-variable">${_lf}</span>]
        <span class="hljs-keyword">done</span>
        <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\( \$\{_lf_reply\[@\]\} \)
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}
<span class="hljs-comment">#  The reverse lookup domain name corresponding to the IPv6 address:</span>
<span class="hljs-comment">#      4321:0:1:2:3:4:567:89ab</span>
<span class="hljs-comment">#  would be (nibble, I.E: Hexdigit) reversed:</span>
<span class="hljs-comment">#  b.a.9.8.7.6.5.0.4.0.0.0.3.0.0.0.2.0.0.0.1.0.0.0.0.0.0.0.1.2.3.4.IP6.ARPA.</span>

<span class="hljs-comment"># Reverse lookup :: Address -&gt; poor man's delegation chain</span>
<span class="hljs-comment"># long_rev &lt;rev_ip_address&gt; &lt;array_name&gt;</span>
<span class="hljs-function"><span class="hljs-title">long_rev</span></span>() {
    <span class="hljs-built_in">local</span> -a _lr_reply
    <span class="hljs-built_in">local</span> -i _lr_rc
    <span class="hljs-built_in">local</span> -i _lr_cnt
    <span class="hljs-built_in">local</span> _lr_dns
    _lr_dns=<span class="hljs-variable">${1}</span><span class="hljs-string">'.in-addr.arpa.'</span>
    IFS=<span class="hljs-variable">${NO_WSP}</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-string">':'</span>
<span class="hljs-comment"># echo 'lrev: '${1}</span>
  _lr_reply=( $(
       dig +noall +nofail +answer +authority +additional \
           <span class="hljs-variable">${_lr_dns}</span> -t soa <span class="hljs-variable">${_lr_dns}</span> -t any 2&gt;/dev/null) )
  _lr_rc=$?
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${_lr_rc}</span> -ne 0 ]
  <span class="hljs-keyword">then</span>
    _trace_log[<span class="hljs-variable">${#_trace_log[@]}</span>]=<span class="hljs-string">'# Deleg lkp error '</span><span class="hljs-variable">${_lr_rc}</span><span class="hljs-string">' on '</span><span class="hljs-variable">${1}</span><span class="hljs-string">' #'</span>
<span class="hljs-comment"># [ ${_lr_rc} -ne 9 ] &amp;&amp; pend_drop</span>
        <span class="hljs-built_in">return</span> <span class="hljs-variable">${_lr_rc}</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-comment"># Some versions of 'dig' return warnings on stdout.</span>
        _lr_cnt=<span class="hljs-variable">${#_lr_reply[@]}</span>
        <span class="hljs-keyword">for</span> (( _lr = 0 ; _lr &lt; <span class="hljs-variable">${_lr_cnt}</span> ; _lr++ ))
        <span class="hljs-keyword">do</span>
            [ <span class="hljs-string">'x'</span><span class="hljs-variable">${_lr_reply[${_lr}</span>]:0:2} == <span class="hljs-string">'x;;'</span> ] &amp;&amp;
                <span class="hljs-built_in">unset</span> _lr_reply[<span class="hljs-variable">${_lr}</span>]
        <span class="hljs-keyword">done</span>
        <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\( \$\{_lr_reply\[@\]\} \)
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># # # Application specific functions # # #</span>

<span class="hljs-comment"># Mung a possible name; suppresses root and TLDs.</span>
<span class="hljs-comment"># name_fixup &lt;string&gt;</span>
<span class="hljs-function"><span class="hljs-title">name_fixup</span></span>(){
    <span class="hljs-built_in">local</span> -a _nf_tmp
    <span class="hljs-built_in">local</span> -i _nf_end
    <span class="hljs-built_in">local</span> _nf_str
    <span class="hljs-built_in">local</span> IFS
    _nf_str=$(to_lower <span class="hljs-variable">${1}</span>)
    _nf_str=$(to_dot <span class="hljs-variable">${_nf_str}</span>)
    _nf_end=<span class="hljs-variable">${#_nf_str}</span>-1
    [ <span class="hljs-variable">${_nf_str:${_nf_end}</span>} != <span class="hljs-string">'.'</span> ] &amp;&amp;
        _nf_str=<span class="hljs-variable">${_nf_str}</span><span class="hljs-string">'.'</span>
    IFS=<span class="hljs-variable">${ADR_IFS}</span>
    _nf_tmp=( <span class="hljs-variable">${_nf_str}</span> )
    IFS=<span class="hljs-variable">${WSP_IFS}</span>
    _nf_end=<span class="hljs-variable">${#_nf_tmp[@]}</span>
    <span class="hljs-keyword">case</span> <span class="hljs-variable">${_nf_end}</span> <span class="hljs-keyword">in</span>
    0) <span class="hljs-comment"># No dots, only dots.</span>
        <span class="hljs-built_in">echo</span>
        <span class="hljs-built_in">return</span> 1
    ;;
    1) <span class="hljs-comment"># Only a TLD.</span>
        <span class="hljs-built_in">echo</span>
        <span class="hljs-built_in">return</span> 1
    ;;
    2) <span class="hljs-comment"># Maybe okay.</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-variable">${_nf_str}</span>
       <span class="hljs-built_in">return</span> 0
       <span class="hljs-comment"># Needs a lookup table?</span>
       <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_nf_tmp[1]}</span> -eq 2 ]
       <span class="hljs-keyword">then</span> <span class="hljs-comment"># Country coded TLD.</span>
           <span class="hljs-built_in">echo</span>
           <span class="hljs-built_in">return</span> 1
       <span class="hljs-keyword">else</span>
           <span class="hljs-built_in">echo</span> <span class="hljs-variable">${_nf_str}</span>
           <span class="hljs-built_in">return</span> 0
       <span class="hljs-keyword">fi</span>
    ;;
    <span class="hljs-keyword">esac</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-variable">${_nf_str}</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># Grope and mung original input(s).</span>
<span class="hljs-function"><span class="hljs-title">split_input</span></span>() {
    [ <span class="hljs-variable">${#uc_name[@]}</span> -gt 0 ] || <span class="hljs-built_in">return</span> 0
    <span class="hljs-built_in">local</span> -i _si_cnt
    <span class="hljs-built_in">local</span> -i _si_len
    <span class="hljs-built_in">local</span> _si_str
    unique_lines uc_name uc_name
    _si_cnt=<span class="hljs-variable">${#uc_name[@]}</span>
    <span class="hljs-keyword">for</span> (( _si = 0 ; _si &lt; _si_cnt ; _si++ ))
    <span class="hljs-keyword">do</span>
        _si_str=<span class="hljs-variable">${uc_name[$_si]}</span>
        <span class="hljs-keyword">if</span> is_address <span class="hljs-variable">${_si_str}</span>
        <span class="hljs-keyword">then</span>
            uc_address[<span class="hljs-variable">${#uc_address[@]}</span>]=<span class="hljs-variable">${_si_str}</span>
            <span class="hljs-built_in">unset</span> uc_name[<span class="hljs-variable">$_si</span>]
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">if</span> ! uc_name[<span class="hljs-variable">$_si</span>]=$(name_fixup <span class="hljs-variable">${_si_str}</span>)
            <span class="hljs-keyword">then</span>
                <span class="hljs-built_in">unset</span> ucname[<span class="hljs-variable">$_si</span>]
            <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>
  uc_name=( <span class="hljs-variable">${uc_name[@]}</span> )
  _si_cnt=<span class="hljs-variable">${#uc_name[@]}</span>
  _trace_log[<span class="hljs-variable">${#_trace_log[@]}</span>]=<span class="hljs-string">'#Input '</span><span class="hljs-variable">${_si_cnt}</span><span class="hljs-string">' unchkd name input(s).#'</span>
  _si_cnt=<span class="hljs-variable">${#uc_address[@]}</span>
  _trace_log[<span class="hljs-variable">${#_trace_log[@]}</span>]=<span class="hljs-string">'#Input '</span><span class="hljs-variable">${_si_cnt}</span><span class="hljs-string">' unchkd addr input(s).#'</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># # # Discovery functions -- recursively interlocked by external data # # #</span>
<span class="hljs-comment"># # # The leading 'if list is empty; return 0' in each is required. # # #</span>

<span class="hljs-comment"># Recursion limiter</span>
<span class="hljs-comment"># limit_chk() &lt;next_level&gt;</span>
<span class="hljs-function"><span class="hljs-title">limit_chk</span></span>() {
    <span class="hljs-built_in">local</span> -i _lc_lmt
    <span class="hljs-comment"># Check indirection limit.</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${indirect}</span> -eq 0 ] || [ <span class="hljs-variable">$#</span> -eq 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-comment"># The 'do-forever' choice</span>
        <span class="hljs-built_in">echo</span> 1                 <span class="hljs-comment"># Any value will do.</span>
        <span class="hljs-built_in">return</span> 0               <span class="hljs-comment"># OK to continue.</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-comment"># Limiting is in effect.</span>
        <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${indirect}</span> -lt <span class="hljs-variable">${1}</span> ]
        <span class="hljs-keyword">then</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-variable">${1}</span>          <span class="hljs-comment"># Whatever.</span>
            <span class="hljs-built_in">return</span> 1           <span class="hljs-comment"># Stop here.</span>
        <span class="hljs-keyword">else</span>
            _lc_lmt=<span class="hljs-variable">${1}</span>+1     <span class="hljs-comment"># Bump the given limit.</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-variable">${_lc_lmt}</span>    <span class="hljs-comment"># Echo it.</span>
            <span class="hljs-built_in">return</span> 0           <span class="hljs-comment"># OK to continue.</span>
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># For each name in uc_name:</span>
<span class="hljs-comment">#     Move name to chk_name.</span>
<span class="hljs-comment">#     Add addresses to uc_address.</span>
<span class="hljs-comment">#     Pend expand_input_address.</span>
<span class="hljs-comment">#     Repeat until nothing new found.</span>
<span class="hljs-comment"># expand_input_name &lt;indirection_limit&gt;</span>
<span class="hljs-function"><span class="hljs-title">expand_input_name</span></span>() {
    [ <span class="hljs-variable">${#uc_name[@]}</span> -gt 0 ] || <span class="hljs-built_in">return</span> 0
    <span class="hljs-built_in">local</span> -a _ein_addr
    <span class="hljs-built_in">local</span> -a _ein_new
    <span class="hljs-built_in">local</span> -i _ucn_cnt
    <span class="hljs-built_in">local</span> -i _ein_cnt
    <span class="hljs-built_in">local</span> _ein_tst
    _ucn_cnt=<span class="hljs-variable">${#uc_name[@]}</span>

    <span class="hljs-keyword">if</span>  ! _ein_cnt=$(limit_chk <span class="hljs-variable">${1}</span>)
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">return</span> 0
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">for</span> (( _ein = 0 ; _ein &lt; _ucn_cnt ; _ein++ ))
    <span class="hljs-keyword">do</span>
        <span class="hljs-keyword">if</span> short_fwd <span class="hljs-variable">${uc_name[${_ein}</span>]} _ein_new
        <span class="hljs-keyword">then</span>
          <span class="hljs-keyword">for</span> (( _ein_cnt = 0 ; _ein_cnt &lt; <span class="hljs-variable">${#_ein_new[@]}</span>; _ein_cnt++ ))
          <span class="hljs-keyword">do</span>
              _ein_tst=<span class="hljs-variable">${_ein_new[${_ein_cnt}</span>]}
              <span class="hljs-keyword">if</span> is_address <span class="hljs-variable">${_ein_tst}</span>
              <span class="hljs-keyword">then</span>
                  _ein_addr[<span class="hljs-variable">${#_ein_addr[@]}</span>]=<span class="hljs-variable">${_ein_tst}</span>
              <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>
    unique_lines _ein_addr _ein_addr     <span class="hljs-comment"># Scrub duplicates.</span>
    edit_exact chk_address _ein_addr     <span class="hljs-comment"># Scrub pending detail.</span>
    edit_exact known_address _ein_addr   <span class="hljs-comment"># Scrub already detailed.</span>
 <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_ein_addr[@]}</span> -gt 0 ]        <span class="hljs-comment"># Anything new?</span>
 <span class="hljs-keyword">then</span>
   uc_address=( <span class="hljs-variable">${uc_address[@]}</span> <span class="hljs-variable">${_ein_addr[@]}</span> )
   pend_func expand_input_address <span class="hljs-variable">${1}</span>
   _trace_log[<span class="hljs-variable">${#_trace_log[@]}</span>]=<span class="hljs-string">'#Add '</span><span class="hljs-variable">${#_ein_addr[@]}</span><span class="hljs-string">' unchkd addr inp.#'</span>
    <span class="hljs-keyword">fi</span>
    edit_exact chk_name uc_name          <span class="hljs-comment"># Scrub pending detail.</span>
    edit_exact known_name uc_name        <span class="hljs-comment"># Scrub already detailed.</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#uc_name[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        chk_name=( <span class="hljs-variable">${chk_name[@]}</span> <span class="hljs-variable">${uc_name[@]}</span>  )
        pend_func detail_each_name <span class="hljs-variable">${1}</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">unset</span> uc_name[@]
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># For each address in uc_address:</span>
<span class="hljs-comment">#     Move address to chk_address.</span>
<span class="hljs-comment">#     Add names to uc_name.</span>
<span class="hljs-comment">#     Pend expand_input_name.</span>
<span class="hljs-comment">#     Repeat until nothing new found.</span>
<span class="hljs-comment"># expand_input_address &lt;indirection_limit&gt;</span>
<span class="hljs-function"><span class="hljs-title">expand_input_address</span></span>() {
    [ <span class="hljs-variable">${#uc_address[@]}</span> -gt 0 ] || <span class="hljs-built_in">return</span> 0
    <span class="hljs-built_in">local</span> -a _eia_addr
    <span class="hljs-built_in">local</span> -a _eia_name
    <span class="hljs-built_in">local</span> -a _eia_new
    <span class="hljs-built_in">local</span> -i _uca_cnt
    <span class="hljs-built_in">local</span> -i _eia_cnt
    <span class="hljs-built_in">local</span> _eia_tst
    unique_lines uc_address _eia_addr
    <span class="hljs-built_in">unset</span> uc_address[@]
    edit_exact been_there_addr _eia_addr
    _uca_cnt=<span class="hljs-variable">${#_eia_addr[@]}</span>
    [ <span class="hljs-variable">${_uca_cnt}</span> -gt 0 ] &amp;&amp;
        been_there_addr=( <span class="hljs-variable">${been_there_addr[@]}</span> <span class="hljs-variable">${_eia_addr[@]}</span> )

    <span class="hljs-keyword">for</span> (( _eia = 0 ; _eia &lt; _uca_cnt ; _eia++ ))
     <span class="hljs-keyword">do</span>
       <span class="hljs-keyword">if</span> short_rev <span class="hljs-variable">${_eia_addr[${_eia}</span>]} _eia_new
       <span class="hljs-keyword">then</span>
         <span class="hljs-keyword">for</span> (( _eia_cnt = 0 ; _eia_cnt &lt; <span class="hljs-variable">${#_eia_new[@]}</span> ; _eia_cnt++ ))
         <span class="hljs-keyword">do</span>
           _eia_tst=<span class="hljs-variable">${_eia_new[${_eia_cnt}</span>]}
           <span class="hljs-keyword">if</span> _eia_tst=$(name_fixup <span class="hljs-variable">${_eia_tst}</span>)
           <span class="hljs-keyword">then</span>
             _eia_name[<span class="hljs-variable">${#_eia_name[@]}</span>]=<span class="hljs-variable">${_eia_tst}</span>
       <span class="hljs-keyword">fi</span>
     <span class="hljs-keyword">done</span>
           <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>
    unique_lines _eia_name _eia_name     <span class="hljs-comment"># Scrub duplicates.</span>
    edit_exact chk_name _eia_name        <span class="hljs-comment"># Scrub pending detail.</span>
    edit_exact known_name _eia_name      <span class="hljs-comment"># Scrub already detailed.</span>
 <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_eia_name[@]}</span> -gt 0 ]        <span class="hljs-comment"># Anything new?</span>
 <span class="hljs-keyword">then</span>
   uc_name=( <span class="hljs-variable">${uc_name[@]}</span> <span class="hljs-variable">${_eia_name[@]}</span> )
   pend_func expand_input_name <span class="hljs-variable">${1}</span>
   _trace_log[<span class="hljs-variable">${#_trace_log[@]}</span>]=<span class="hljs-string">'#Add '</span><span class="hljs-variable">${#_eia_name[@]}</span><span class="hljs-string">' unchkd name inp.#'</span>
    <span class="hljs-keyword">fi</span>
    edit_exact chk_address _eia_addr     <span class="hljs-comment"># Scrub pending detail.</span>
    edit_exact known_address _eia_addr   <span class="hljs-comment"># Scrub already detailed.</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_eia_addr[@]}</span> -gt 0 ]        <span class="hljs-comment"># Anything new?</span>
    <span class="hljs-keyword">then</span>
        chk_address=( <span class="hljs-variable">${chk_address[@]}</span> <span class="hljs-variable">${_eia_addr[@]}</span> )
        pend_func detail_each_address <span class="hljs-variable">${1}</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># The parse-it-yourself zone reply.</span>
<span class="hljs-comment"># The input is the chk_name list.</span>
<span class="hljs-comment"># detail_each_name &lt;indirection_limit&gt;</span>
<span class="hljs-function"><span class="hljs-title">detail_each_name</span></span>() {
    [ <span class="hljs-variable">${#chk_name[@]}</span> -gt 0 ] || <span class="hljs-built_in">return</span> 0
    <span class="hljs-built_in">local</span> -a _den_chk       <span class="hljs-comment"># Names to check</span>
    <span class="hljs-built_in">local</span> -a _den_name      <span class="hljs-comment"># Names found here</span>
    <span class="hljs-built_in">local</span> -a _den_address   <span class="hljs-comment"># Addresses found here</span>
    <span class="hljs-built_in">local</span> -a _den_pair      <span class="hljs-comment"># Pairs found here</span>
    <span class="hljs-built_in">local</span> -a _den_rev       <span class="hljs-comment"># Reverse pairs found here</span>
    <span class="hljs-built_in">local</span> -a _den_tmp       <span class="hljs-comment"># Line being parsed</span>
    <span class="hljs-built_in">local</span> -a _den_auth      <span class="hljs-comment"># SOA contact being parsed</span>
    <span class="hljs-built_in">local</span> -a _den_new       <span class="hljs-comment"># The zone reply</span>
    <span class="hljs-built_in">local</span> -a _den_pc        <span class="hljs-comment"># Parent-Child gets big fast</span>
    <span class="hljs-built_in">local</span> -a _den_ref       <span class="hljs-comment"># So does reference chain</span>
    <span class="hljs-built_in">local</span> -a _den_nr        <span class="hljs-comment"># Name-Resource can be big</span>
    <span class="hljs-built_in">local</span> -a _den_na        <span class="hljs-comment"># Name-Address</span>
    <span class="hljs-built_in">local</span> -a _den_ns        <span class="hljs-comment"># Name-Service</span>
    <span class="hljs-built_in">local</span> -a _den_achn      <span class="hljs-comment"># Chain of Authority</span>
    <span class="hljs-built_in">local</span> -i _den_cnt       <span class="hljs-comment"># Count of names to detail</span>
    <span class="hljs-built_in">local</span> -i _den_lmt       <span class="hljs-comment"># Indirection limit</span>
    <span class="hljs-built_in">local</span> _den_who          <span class="hljs-comment"># Named being processed</span>
    <span class="hljs-built_in">local</span> _den_rec          <span class="hljs-comment"># Record type being processed</span>
    <span class="hljs-built_in">local</span> _den_cont         <span class="hljs-comment"># Contact domain</span>
    <span class="hljs-built_in">local</span> _den_str          <span class="hljs-comment"># Fixed up name string</span>
    <span class="hljs-built_in">local</span> _den_str2         <span class="hljs-comment"># Fixed up reverse</span>
    <span class="hljs-built_in">local</span> IFS=<span class="hljs-variable">${WSP_IFS}</span>

    <span class="hljs-comment"># Local, unique copy of names to check</span>
    unique_lines chk_name _den_chk
    <span class="hljs-built_in">unset</span> chk_name[@]       <span class="hljs-comment"># Done with globals.</span>

    <span class="hljs-comment"># Less any names already known</span>
    edit_exact known_name _den_chk
    _den_cnt=<span class="hljs-variable">${#_den_chk[@]}</span>

    <span class="hljs-comment"># If anything left, add to known_name.</span>
    [ <span class="hljs-variable">${_den_cnt}</span> -gt 0 ] &amp;&amp;
        known_name=( <span class="hljs-variable">${known_name[@]}</span> <span class="hljs-variable">${_den_chk[@]}</span> )

    <span class="hljs-comment"># for the list of (previously) unknown names . . .</span>
    <span class="hljs-keyword">for</span> (( _den = 0 ; _den &lt; _den_cnt ; _den++ ))
    <span class="hljs-keyword">do</span>
        _den_who=<span class="hljs-variable">${_den_chk[${_den}</span>]}
        <span class="hljs-keyword">if</span> long_fwd <span class="hljs-variable">${_den_who}</span> _den_new
        <span class="hljs-keyword">then</span>
            unique_lines _den_new _den_new
            <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_den_new[@]}</span> -eq 0 ]
            <span class="hljs-keyword">then</span>
                _den_pair[<span class="hljs-variable">${#_den_pair[@]}</span>]=<span class="hljs-string">'0.0.0.0 '</span><span class="hljs-variable">${_den_who}</span>
            <span class="hljs-keyword">fi</span>

            <span class="hljs-comment"># Parse each line in the reply.</span>
            <span class="hljs-keyword">for</span> (( _line = 0 ; _line &lt; <span class="hljs-variable">${#_den_new[@]}</span> ; _line++ ))
            <span class="hljs-keyword">do</span>
                IFS=<span class="hljs-variable">${NO_WSP}</span>$<span class="hljs-string">'\x09'</span>$<span class="hljs-string">'\x20'</span>
                _den_tmp=( <span class="hljs-variable">${_den_new[${_line}</span>]} )
                IFS=<span class="hljs-variable">${WSP_IFS}</span>
              <span class="hljs-comment"># If usable record and not a warning message . . .</span>
              <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_den_tmp[@]}</span> -gt 4 ] &amp;&amp; [ <span class="hljs-string">'x'</span><span class="hljs-variable">${_den_tmp[0]}</span> != <span class="hljs-string">'x;;'</span> ]
              <span class="hljs-keyword">then</span>
                    _den_rec=<span class="hljs-variable">${_den_tmp[3]}</span>
                    _den_nr[<span class="hljs-variable">${#_den_nr[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_rec}</span>
                    <span class="hljs-comment"># Begin at RFC1033 (+++)</span>
                    <span class="hljs-keyword">case</span> <span class="hljs-variable">${_den_rec}</span> <span class="hljs-keyword">in</span>

<span class="hljs-comment">#&lt;name&gt; [&lt;ttl&gt;]  [&lt;class&gt;] SOA &lt;origin&gt; &lt;person&gt;</span>
                    SOA) <span class="hljs-comment"># Start Of Authority</span>
    <span class="hljs-keyword">if</span> _den_str=$(name_fixup <span class="hljs-variable">${_den_tmp[0]}</span>)
    <span class="hljs-keyword">then</span>
      _den_name[<span class="hljs-variable">${#_den_name[@]}</span>]=<span class="hljs-variable">${_den_str}</span>
      _den_achn[<span class="hljs-variable">${#_den_achn[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span><span class="hljs-string">' SOA'</span>
      <span class="hljs-comment"># SOA origin -- domain name of master zone record</span>
      <span class="hljs-keyword">if</span> _den_str2=$(name_fixup <span class="hljs-variable">${_den_tmp[4]}</span>)
      <span class="hljs-keyword">then</span>
        _den_name[<span class="hljs-variable">${#_den_name[@]}</span>]=<span class="hljs-variable">${_den_str2}</span>
        _den_achn[<span class="hljs-variable">${#_den_achn[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str2}</span><span class="hljs-string">' SOA.O'</span>
      <span class="hljs-keyword">fi</span>
      <span class="hljs-comment"># Responsible party e-mail address (possibly bogus).</span>
      <span class="hljs-comment"># Possibility of first.last@domain.name ignored.</span>
      <span class="hljs-built_in">set</span> -f
      <span class="hljs-keyword">if</span> _den_str2=$(name_fixup <span class="hljs-variable">${_den_tmp[5]}</span>)
      <span class="hljs-keyword">then</span>
        IFS=<span class="hljs-variable">${ADR_IFS}</span>
        _den_auth=( <span class="hljs-variable">${_den_str2}</span> )
        IFS=<span class="hljs-variable">${WSP_IFS}</span>
        <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_den_auth[@]}</span> -gt 2 ]
        <span class="hljs-keyword">then</span>
          _den_cont=<span class="hljs-variable">${_den_auth[1]}</span>
          <span class="hljs-keyword">for</span> (( _auth = 2 ; _auth &lt; <span class="hljs-variable">${#_den_auth[@]}</span> ; _auth++ ))
          <span class="hljs-keyword">do</span>
            _den_cont=<span class="hljs-variable">${_den_cont}</span><span class="hljs-string">'.'</span><span class="hljs-variable">${_den_auth[${_auth}</span>]}
          <span class="hljs-keyword">done</span>
          _den_name[<span class="hljs-variable">${#_den_name[@]}</span>]=<span class="hljs-variable">${_den_cont}</span><span class="hljs-string">'.'</span>
          _den_achn[<span class="hljs-variable">${#_den_achn[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_cont}</span><span class="hljs-string">'. SOA.C'</span>
                                <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">fi</span>
        <span class="hljs-built_in">set</span> +f
                        <span class="hljs-keyword">fi</span>
                    ;;


      A) <span class="hljs-comment"># IP(v4) Address Record</span>
      <span class="hljs-keyword">if</span> _den_str=$(name_fixup <span class="hljs-variable">${_den_tmp[0]}</span>)
      <span class="hljs-keyword">then</span>
        _den_name[<span class="hljs-variable">${#_den_name[@]}</span>]=<span class="hljs-variable">${_den_str}</span>
        _den_pair[<span class="hljs-variable">${#_den_pair[@]}</span>]=<span class="hljs-variable">${_den_tmp[4]}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span>
        _den_na[<span class="hljs-variable">${#_den_na[@]}</span>]=<span class="hljs-variable">${_den_str}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_tmp[4]}</span>
        _den_ref[<span class="hljs-variable">${#_den_ref[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span><span class="hljs-string">' A'</span>
      <span class="hljs-keyword">else</span>
        _den_pair[<span class="hljs-variable">${#_den_pair[@]}</span>]=<span class="hljs-variable">${_den_tmp[4]}</span><span class="hljs-string">' unknown.domain'</span>
        _den_na[<span class="hljs-variable">${#_den_na[@]}</span>]=<span class="hljs-string">'unknown.domain '</span><span class="hljs-variable">${_den_tmp[4]}</span>
        _den_ref[<span class="hljs-variable">${#_den_ref[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' unknown.domain A'</span>
      <span class="hljs-keyword">fi</span>
      _den_address[<span class="hljs-variable">${#_den_address[@]}</span>]=<span class="hljs-variable">${_den_tmp[4]}</span>
      _den_pc[<span class="hljs-variable">${#_den_pc[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_tmp[4]}</span>
             ;;

             NS) <span class="hljs-comment"># Name Server Record</span>
             <span class="hljs-comment"># Domain name being serviced (may be other than current)</span>
               <span class="hljs-keyword">if</span> _den_str=$(name_fixup <span class="hljs-variable">${_den_tmp[0]}</span>)
                 <span class="hljs-keyword">then</span>
                   _den_name[<span class="hljs-variable">${#_den_name[@]}</span>]=<span class="hljs-variable">${_den_str}</span>
                   _den_ref[<span class="hljs-variable">${#_den_ref[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span><span class="hljs-string">' NS'</span>

             <span class="hljs-comment"># Domain name of service provider</span>
             <span class="hljs-keyword">if</span> _den_str2=$(name_fixup <span class="hljs-variable">${_den_tmp[4]}</span>)
             <span class="hljs-keyword">then</span>
               _den_name[<span class="hljs-variable">${#_den_name[@]}</span>]=<span class="hljs-variable">${_den_str2}</span>
               _den_ref[<span class="hljs-variable">${#_den_ref[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str2}</span><span class="hljs-string">' NSH'</span>
               _den_ns[<span class="hljs-variable">${#_den_ns[@]}</span>]=<span class="hljs-variable">${_den_str2}</span><span class="hljs-string">' NS'</span>
               _den_pc[<span class="hljs-variable">${#_den_pc[@]}</span>]=<span class="hljs-variable">${_den_str}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str2}</span>
              <span class="hljs-keyword">fi</span>
               <span class="hljs-keyword">fi</span>
                    ;;

             MX) <span class="hljs-comment"># Mail Server Record</span>
                 <span class="hljs-comment"># Domain name being serviced (wildcards not handled here)</span>
             <span class="hljs-keyword">if</span> _den_str=$(name_fixup <span class="hljs-variable">${_den_tmp[0]}</span>)
             <span class="hljs-keyword">then</span>
               _den_name[<span class="hljs-variable">${#_den_name[@]}</span>]=<span class="hljs-variable">${_den_str}</span>
               _den_ref[<span class="hljs-variable">${#_den_ref[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span><span class="hljs-string">' MX'</span>
             <span class="hljs-keyword">fi</span>
             <span class="hljs-comment"># Domain name of service provider</span>
             <span class="hljs-keyword">if</span> _den_str=$(name_fixup <span class="hljs-variable">${_den_tmp[5]}</span>)
             <span class="hljs-keyword">then</span>
               _den_name[<span class="hljs-variable">${#_den_name[@]}</span>]=<span class="hljs-variable">${_den_str}</span>
               _den_ref[<span class="hljs-variable">${#_den_ref[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span><span class="hljs-string">' MXH'</span>
               _den_ns[<span class="hljs-variable">${#_den_ns[@]}</span>]=<span class="hljs-variable">${_den_str}</span><span class="hljs-string">' MX'</span>
               _den_pc[<span class="hljs-variable">${#_den_pc[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span>
             <span class="hljs-keyword">fi</span>
                    ;;

             PTR) <span class="hljs-comment"># Reverse address record</span>
                  <span class="hljs-comment"># Special name</span>
             <span class="hljs-keyword">if</span> _den_str=$(name_fixup <span class="hljs-variable">${_den_tmp[0]}</span>)
             <span class="hljs-keyword">then</span>
               _den_ref[<span class="hljs-variable">${#_den_ref[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span><span class="hljs-string">' PTR'</span>
               <span class="hljs-comment"># Host name (not a CNAME)</span>
               <span class="hljs-keyword">if</span> _den_str2=$(name_fixup <span class="hljs-variable">${_den_tmp[4]}</span>)
               <span class="hljs-keyword">then</span>
                 _den_rev[<span class="hljs-variable">${#_den_rev[@]}</span>]=<span class="hljs-variable">${_den_str}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str2}</span>
                 _den_ref[<span class="hljs-variable">${#_den_ref[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str2}</span><span class="hljs-string">' PTRH'</span>
                 _den_pc[<span class="hljs-variable">${#_den_pc[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span>
               <span class="hljs-keyword">fi</span>
             <span class="hljs-keyword">fi</span>
                    ;;

             AAAA) <span class="hljs-comment"># IP(v6) Address Record</span>
             <span class="hljs-keyword">if</span> _den_str=$(name_fixup <span class="hljs-variable">${_den_tmp[0]}</span>)
             <span class="hljs-keyword">then</span>
               _den_name[<span class="hljs-variable">${#_den_name[@]}</span>]=<span class="hljs-variable">${_den_str}</span>
               _den_pair[<span class="hljs-variable">${#_den_pair[@]}</span>]=<span class="hljs-variable">${_den_tmp[4]}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span>
               _den_na[<span class="hljs-variable">${#_den_na[@]}</span>]=<span class="hljs-variable">${_den_str}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_tmp[4]}</span>
               _den_ref[<span class="hljs-variable">${#_den_ref[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span><span class="hljs-string">' AAAA'</span>
               <span class="hljs-keyword">else</span>
                 _den_pair[<span class="hljs-variable">${#_den_pair[@]}</span>]=<span class="hljs-variable">${_den_tmp[4]}</span><span class="hljs-string">' unknown.domain'</span>
                 _den_na[<span class="hljs-variable">${#_den_na[@]}</span>]=<span class="hljs-string">'unknown.domain '</span><span class="hljs-variable">${_den_tmp[4]}</span>
                 _den_ref[<span class="hljs-variable">${#_den_ref[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' unknown.domain'</span>
               <span class="hljs-keyword">fi</span>
               <span class="hljs-comment"># No processing for IPv6 addresses</span>
               _den_pc[<span class="hljs-variable">${#_den_pc[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_tmp[4]}</span>
                    ;;

             CNAME) <span class="hljs-comment"># Alias name record</span>
                    <span class="hljs-comment"># Nickname</span>
             <span class="hljs-keyword">if</span> _den_str=$(name_fixup <span class="hljs-variable">${_den_tmp[0]}</span>)
             <span class="hljs-keyword">then</span>
               _den_name[<span class="hljs-variable">${#_den_name[@]}</span>]=<span class="hljs-variable">${_den_str}</span>
               _den_ref[<span class="hljs-variable">${#_den_ref[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span><span class="hljs-string">' CNAME'</span>
               _den_pc[<span class="hljs-variable">${#_den_pc[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span>
             <span class="hljs-keyword">fi</span>
                    <span class="hljs-comment"># Hostname</span>
             <span class="hljs-keyword">if</span> _den_str=$(name_fixup <span class="hljs-variable">${_den_tmp[4]}</span>)
             <span class="hljs-keyword">then</span>
               _den_name[<span class="hljs-variable">${#_den_name[@]}</span>]=<span class="hljs-variable">${_den_str}</span>
               _den_ref[<span class="hljs-variable">${#_den_ref[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span><span class="hljs-string">' CHOST'</span>
               _den_pc[<span class="hljs-variable">${#_den_pc[@]}</span>]=<span class="hljs-variable">${_den_who}</span><span class="hljs-string">' '</span><span class="hljs-variable">${_den_str}</span>
             <span class="hljs-keyword">fi</span>
                    ;;
<span class="hljs-comment">#            TXT)</span>
<span class="hljs-comment">#            ;;</span>
                    <span class="hljs-keyword">esac</span>
                <span class="hljs-keyword">fi</span>
            <span class="hljs-keyword">done</span>
        <span class="hljs-keyword">else</span> <span class="hljs-comment"># Lookup error == 'A' record 'unknown address'</span>
            _den_pair[<span class="hljs-variable">${#_den_pair[@]}</span>]=<span class="hljs-string">'0.0.0.0 '</span><span class="hljs-variable">${_den_who}</span>
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>

    <span class="hljs-comment"># Control dot array growth.</span>
    unique_lines _den_achn _den_achn      <span class="hljs-comment"># Works best, all the same.</span>
    edit_exact auth_chain _den_achn       <span class="hljs-comment"># Works best, unique items.</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_den_achn[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        IFS=<span class="hljs-variable">${NO_WSP}</span>
        auth_chain=( <span class="hljs-variable">${auth_chain[@]}</span> <span class="hljs-variable">${_den_achn[@]}</span> )
        IFS=<span class="hljs-variable">${WSP_IFS}</span>
    <span class="hljs-keyword">fi</span>

    unique_lines _den_ref _den_ref      <span class="hljs-comment"># Works best, all the same.</span>
    edit_exact ref_chain _den_ref       <span class="hljs-comment"># Works best, unique items.</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_den_ref[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        IFS=<span class="hljs-variable">${NO_WSP}</span>
        ref_chain=( <span class="hljs-variable">${ref_chain[@]}</span> <span class="hljs-variable">${_den_ref[@]}</span> )
        IFS=<span class="hljs-variable">${WSP_IFS}</span>
    <span class="hljs-keyword">fi</span>

    unique_lines _den_na _den_na
    edit_exact name_address _den_na
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_den_na[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        IFS=<span class="hljs-variable">${NO_WSP}</span>
        name_address=( <span class="hljs-variable">${name_address[@]}</span> <span class="hljs-variable">${_den_na[@]}</span> )
        IFS=<span class="hljs-variable">${WSP_IFS}</span>
    <span class="hljs-keyword">fi</span>

    unique_lines _den_ns _den_ns
    edit_exact name_srvc _den_ns
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_den_ns[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        IFS=<span class="hljs-variable">${NO_WSP}</span>
        name_srvc=( <span class="hljs-variable">${name_srvc[@]}</span> <span class="hljs-variable">${_den_ns[@]}</span> )
        IFS=<span class="hljs-variable">${WSP_IFS}</span>
    <span class="hljs-keyword">fi</span>

    unique_lines _den_nr _den_nr
    edit_exact name_resource _den_nr
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_den_nr[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        IFS=<span class="hljs-variable">${NO_WSP}</span>
        name_resource=( <span class="hljs-variable">${name_resource[@]}</span> <span class="hljs-variable">${_den_nr[@]}</span> )
        IFS=<span class="hljs-variable">${WSP_IFS}</span>
    <span class="hljs-keyword">fi</span>

    unique_lines _den_pc _den_pc
    edit_exact parent_child _den_pc
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_den_pc[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        IFS=<span class="hljs-variable">${NO_WSP}</span>
        parent_child=( <span class="hljs-variable">${parent_child[@]}</span> <span class="hljs-variable">${_den_pc[@]}</span> )
        IFS=<span class="hljs-variable">${WSP_IFS}</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-comment"># Update list known_pair (Address and Name).</span>
    unique_lines _den_pair _den_pair
    edit_exact known_pair _den_pair
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_den_pair[@]}</span> -gt 0 ]  <span class="hljs-comment"># Anything new?</span>
    <span class="hljs-keyword">then</span>
        IFS=<span class="hljs-variable">${NO_WSP}</span>
        known_pair=( <span class="hljs-variable">${known_pair[@]}</span> <span class="hljs-variable">${_den_pair[@]}</span> )
        IFS=<span class="hljs-variable">${WSP_IFS}</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-comment"># Update list of reverse pairs.</span>
    unique_lines _den_rev _den_rev
    edit_exact reverse_pair _den_rev
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_den_rev[@]}</span> -gt 0 ]   <span class="hljs-comment"># Anything new?</span>
    <span class="hljs-keyword">then</span>
        IFS=<span class="hljs-variable">${NO_WSP}</span>
        reverse_pair=( <span class="hljs-variable">${reverse_pair[@]}</span> <span class="hljs-variable">${_den_rev[@]}</span> )
        IFS=<span class="hljs-variable">${WSP_IFS}</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-comment"># Check indirection limit -- give up if reached.</span>
    <span class="hljs-keyword">if</span> ! _den_lmt=$(limit_chk <span class="hljs-variable">${1}</span>)
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">return</span> 0
    <span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Execution engine is LIFO. Order of pend operations is important.</span>
<span class="hljs-comment"># Did we define any new addresses?</span>
unique_lines _den_address _den_address    <span class="hljs-comment"># Scrub duplicates.</span>
edit_exact known_address _den_address     <span class="hljs-comment"># Scrub already processed.</span>
edit_exact un_address _den_address        <span class="hljs-comment"># Scrub already waiting.</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_den_address[@]}</span> -gt 0 ]          <span class="hljs-comment"># Anything new?</span>
<span class="hljs-keyword">then</span>
  uc_address=( <span class="hljs-variable">${uc_address[@]}</span> <span class="hljs-variable">${_den_address[@]}</span> )
  pend_func expand_input_address <span class="hljs-variable">${_den_lmt}</span>
  _trace_log[<span class="hljs-variable">${#_trace_log[@]}</span>]=<span class="hljs-string">'# Add '</span><span class="hljs-variable">${#_den_address[@]}</span><span class="hljs-string">' unchkd addr. #'</span>
    <span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Did we find any new names?</span>
unique_lines _den_name _den_name          <span class="hljs-comment"># Scrub duplicates.</span>
edit_exact known_name _den_name           <span class="hljs-comment"># Scrub already processed.</span>
edit_exact uc_name _den_name              <span class="hljs-comment"># Scrub already waiting.</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_den_name[@]}</span> -gt 0 ]             <span class="hljs-comment"># Anything new?</span>
<span class="hljs-keyword">then</span>
  uc_name=( <span class="hljs-variable">${uc_name[@]}</span> <span class="hljs-variable">${_den_name[@]}</span> )
  pend_func expand_input_name <span class="hljs-variable">${_den_lmt}</span>
  _trace_log[<span class="hljs-variable">${#_trace_log[@]}</span>]=<span class="hljs-string">'#Added '</span><span class="hljs-variable">${#_den_name[@]}</span><span class="hljs-string">' unchkd name#'</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># The parse-it-yourself delegation reply</span>
<span class="hljs-comment"># Input is the chk_address list.</span>
<span class="hljs-comment"># detail_each_address &lt;indirection_limit&gt;</span>
<span class="hljs-function"><span class="hljs-title">detail_each_address</span></span>() {
    [ <span class="hljs-variable">${#chk_address[@]}</span> -gt 0 ] || <span class="hljs-built_in">return</span> 0
    unique_lines chk_address chk_address
    edit_exact known_address chk_address
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#chk_address[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        known_address=( <span class="hljs-variable">${known_address[@]}</span> <span class="hljs-variable">${chk_address[@]}</span> )
        <span class="hljs-built_in">unset</span> chk_address[@]
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># # # Application specific output functions # # #</span>

<span class="hljs-comment"># Pretty print the known pairs.</span>
<span class="hljs-function"><span class="hljs-title">report_pairs</span></span>() {
    <span class="hljs-built_in">echo</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">'Known network pairs.'</span>
    col_print known_pair 2 5 30

    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#auth_chain[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'Known chain of authority.'</span>
        col_print auth_chain 2 5 30 55
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#reverse_pair[@]}</span> -gt 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'Known reverse pairs.'</span>
        col_print reverse_pair 2 5 55
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># Check an address against the list of blacklist servers.</span>
<span class="hljs-comment"># A good place to capture for GraphViz: address-&gt;status(server(reports))</span>
<span class="hljs-comment"># check_lists &lt;ip_address&gt;</span>
<span class="hljs-function"><span class="hljs-title">check_lists</span></span>() {
    [ <span class="hljs-variable">$#</span> -eq 1 ] || <span class="hljs-built_in">return</span> 1
    <span class="hljs-built_in">local</span> -a _cl_fwd_addr
    <span class="hljs-built_in">local</span> -a _cl_rev_addr
    <span class="hljs-built_in">local</span> -a _cl_reply
    <span class="hljs-built_in">local</span> -i _cl_rc
    <span class="hljs-built_in">local</span> -i _ls_cnt
    <span class="hljs-built_in">local</span> _cl_dns_addr
    <span class="hljs-built_in">local</span> _cl_lkup

    split_ip <span class="hljs-variable">${1}</span> _cl_fwd_addr _cl_rev_addr
    _cl_dns_addr=$(dot_array _cl_rev_addr)<span class="hljs-string">'.'</span>
    _ls_cnt=<span class="hljs-variable">${#list_server[@]}</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">'    Checking address '</span><span class="hljs-variable">${1}</span>
    <span class="hljs-keyword">for</span> (( _cl = 0 ; _cl &lt; _ls_cnt ; _cl++ ))
    <span class="hljs-keyword">do</span>
      _cl_lkup=<span class="hljs-variable">${_cl_dns_addr}</span><span class="hljs-variable">${list_server[${_cl}</span>]}
      <span class="hljs-keyword">if</span> short_text <span class="hljs-variable">${_cl_lkup}</span> _cl_reply
      <span class="hljs-keyword">then</span>
        <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#_cl_reply[@]}</span> -gt 0 ]
        <span class="hljs-keyword">then</span>
          <span class="hljs-built_in">echo</span> <span class="hljs-string">'        Records from '</span><span class="hljs-variable">${list_server[${_cl}</span>]}
          address_hits[<span class="hljs-variable">${#address_hits[@]}</span>]=<span class="hljs-variable">${1}</span><span class="hljs-string">' '</span><span class="hljs-variable">${list_server[${_cl}</span>]}
          _hs_RC=2
          <span class="hljs-keyword">for</span> (( _clr = 0 ; _clr &lt; <span class="hljs-variable">${#_cl_reply[@]}</span> ; _clr++ ))
          <span class="hljs-keyword">do</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">'            '</span><span class="hljs-variable">${_cl_reply[${_clr}</span>]}
          <span class="hljs-keyword">done</span>
        <span class="hljs-keyword">fi</span>
      <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># # # The usual application glue # # #</span>

<span class="hljs-comment"># Who did it?</span>
<span class="hljs-function"><span class="hljs-title">credits</span></span>() {
   <span class="hljs-built_in">echo</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">'Advanced Bash Scripting Guide: is_spammer.bash, v2, 2004-msz'</span>
}

<span class="hljs-comment"># How to use it?</span>
<span class="hljs-comment"># (See also, "Quickstart" at end of script.)</span>
<span class="hljs-function"><span class="hljs-title">usage</span></span>() {
    cat &lt;&lt;-<span class="hljs-string">'_usage_statement_'</span>
    The script is_spammer.bash requires either one or two arguments.

    arg 1) May be one of:
        a) A domain name
        b) An IPv4 address
        c) The name of a file with any mix of names
           and addresses, one per line.

    arg 2) May be one of:
        a) A Blacklist server domain name
        b) The name of a file with Blacklist server
           domain names, one per line.
        c) If not present, a default list of (free)
           Blacklist servers is used.
        d) If a filename of an empty, readable, file
           is given,
           Blacklist server lookup is disabled.

    All script output is written to stdout.

    Return codes: 0 -&gt; All OK, 1 -&gt; Script failure,
                  2 -&gt; Something is Blacklisted.

    Requires the external program <span class="hljs-string">'dig'</span> from the <span class="hljs-string">'bind-9'</span>
    <span class="hljs-built_in">set</span> of DNS programs.  See: http://www.isc.org

    The domain name lookup depth <span class="hljs-built_in">limit</span> defaults to 2 levels.
    Set the environment variable SPAMMER_LIMIT to change.
    SPAMMER_LIMIT=0 means <span class="hljs-string">'unlimited'</span>

    Limit may also be <span class="hljs-built_in">set</span> on the command-line.
    If arg<span class="hljs-comment">#1 is an integer, the limit is set to that value</span>
    and <span class="hljs-keyword">then</span> the above argument rules are applied.

    Setting the environment variable <span class="hljs-string">'SPAMMER_DATA'</span> to a filename
    will cause the script to write a GraphViz graphic file.

    For the development version;
    Setting the environment variable <span class="hljs-string">'SPAMMER_TRACE'</span> to a filename
    will cause the execution engine to <span class="hljs-built_in">log</span> a <span class="hljs-keyword">function</span> call trace.

_usage_statement_
}

<span class="hljs-comment"># The default list of Blacklist servers:</span>
<span class="hljs-comment"># Many choices, see: http://www.spews.org/lists.html</span>

<span class="hljs-built_in">declare</span> -a default_servers
<span class="hljs-comment"># See: http://www.spamhaus.org (Conservative, well maintained)</span>
default_servers[0]=<span class="hljs-string">'sbl-xbl.spamhaus.org'</span>
<span class="hljs-comment"># See: http://ordb.org (Open mail relays)</span>
default_servers[1]=<span class="hljs-string">'relays.ordb.org'</span>
<span class="hljs-comment"># See: http://www.spamcop.net/ (You can report spammers here)</span>
default_servers[2]=<span class="hljs-string">'bl.spamcop.net'</span>
<span class="hljs-comment"># See: http://www.spews.org (An 'early detect' system)</span>
default_servers[3]=<span class="hljs-string">'l2.spews.dnsbl.sorbs.net'</span>
<span class="hljs-comment"># See: http://www.dnsbl.us.sorbs.net/using.shtml</span>
default_servers[4]=<span class="hljs-string">'dnsbl.sorbs.net'</span>
<span class="hljs-comment"># See: http://dsbl.org/usage (Various mail relay lists)</span>
default_servers[5]=<span class="hljs-string">'list.dsbl.org'</span>
default_servers[6]=<span class="hljs-string">'multihop.dsbl.org'</span>
default_servers[7]=<span class="hljs-string">'unconfirmed.dsbl.org'</span>

<span class="hljs-comment"># User input argument #1</span>
<span class="hljs-function"><span class="hljs-title">setup_input</span></span>() {
    <span class="hljs-keyword">if</span> [ -e <span class="hljs-variable">${1}</span> ] &amp;&amp; [ -r <span class="hljs-variable">${1}</span> ]  <span class="hljs-comment"># Name of readable file</span>
    <span class="hljs-keyword">then</span>
        file_to_array <span class="hljs-variable">${1}</span> uc_name
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'Using filename &gt;'</span><span class="hljs-variable">${1}</span><span class="hljs-string">'&lt; as input.'</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">if</span> is_address <span class="hljs-variable">${1}</span>          <span class="hljs-comment"># IP address?</span>
        <span class="hljs-keyword">then</span>
            uc_address=( <span class="hljs-variable">${1}</span> )
            <span class="hljs-built_in">echo</span> <span class="hljs-string">'Starting with address &gt;'</span><span class="hljs-variable">${1}</span><span class="hljs-string">'&lt;'</span>
        <span class="hljs-keyword">else</span>                       <span class="hljs-comment"># Must be a name.</span>
            uc_name=( <span class="hljs-variable">${1}</span> )
            <span class="hljs-built_in">echo</span> <span class="hljs-string">'Starting with domain name &gt;'</span><span class="hljs-variable">${1}</span><span class="hljs-string">'&lt;'</span>
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># User input argument #2</span>
<span class="hljs-function"><span class="hljs-title">setup_servers</span></span>() {
    <span class="hljs-keyword">if</span> [ -e <span class="hljs-variable">${1}</span> ] &amp;&amp; [ -r <span class="hljs-variable">${1}</span> ]  <span class="hljs-comment"># Name of a readable file</span>
    <span class="hljs-keyword">then</span>
        file_to_array <span class="hljs-variable">${1}</span> list_server
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'Using filename &gt;'</span><span class="hljs-variable">${1}</span><span class="hljs-string">'&lt; as blacklist server list.'</span>
    <span class="hljs-keyword">else</span>
        list_server=( <span class="hljs-variable">${1}</span> )
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'Using blacklist server &gt;'</span><span class="hljs-variable">${1}</span><span class="hljs-string">'&lt;'</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># User environment variable SPAMMER_TRACE</span>
<span class="hljs-function"><span class="hljs-title">live_log_die</span></span>() {
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${SPAMMER_TRACE:=}</span> ]    <span class="hljs-comment"># Wants trace log?</span>
    <span class="hljs-keyword">then</span>
        <span class="hljs-keyword">if</span> [ ! -e <span class="hljs-variable">${SPAMMER_TRACE}</span> ]
        <span class="hljs-keyword">then</span>
            <span class="hljs-keyword">if</span> ! touch <span class="hljs-variable">${SPAMMER_TRACE}</span> 2&gt;/dev/null
            <span class="hljs-keyword">then</span>
                pend_func <span class="hljs-built_in">echo</span> $(<span class="hljs-built_in">printf</span> <span class="hljs-string">'%q\n'</span> \
                <span class="hljs-string">'Unable to create log file &gt;'</span><span class="hljs-variable">${SPAMMER_TRACE}</span><span class="hljs-string">'&lt;'</span>)
                pend_release
                <span class="hljs-built_in">exit</span> 1
            <span class="hljs-keyword">fi</span>
            _log_file=<span class="hljs-variable">${SPAMMER_TRACE}</span>
            _pend_hook_=trace_logger
            _log_dump=dump_log
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">if</span> [ ! -w <span class="hljs-variable">${SPAMMER_TRACE}</span> ]
            <span class="hljs-keyword">then</span>
                pend_func <span class="hljs-built_in">echo</span> $(<span class="hljs-built_in">printf</span> <span class="hljs-string">'%q\n'</span> \
                <span class="hljs-string">'Unable to write log file &gt;'</span><span class="hljs-variable">${SPAMMER_TRACE}</span><span class="hljs-string">'&lt;'</span>)
                pend_release
                <span class="hljs-built_in">exit</span> 1
            <span class="hljs-keyword">fi</span>
            _log_file=<span class="hljs-variable">${SPAMMER_TRACE}</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">''</span> &gt; <span class="hljs-variable">${_log_file}</span>
            _pend_hook_=trace_logger
            _log_dump=dump_log
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># User environment variable SPAMMER_DATA</span>
<span class="hljs-function"><span class="hljs-title">data_capture</span></span>() {
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${SPAMMER_DATA:=}</span> ]    <span class="hljs-comment"># Wants a data dump?</span>
    <span class="hljs-keyword">then</span>
        <span class="hljs-keyword">if</span> [ ! -e <span class="hljs-variable">${SPAMMER_DATA}</span> ]
        <span class="hljs-keyword">then</span>
            <span class="hljs-keyword">if</span> ! touch <span class="hljs-variable">${SPAMMER_DATA}</span> 2&gt;/dev/null
            <span class="hljs-keyword">then</span>
                pend_func <span class="hljs-built_in">echo</span> $(<span class="hljs-built_in">printf</span> <span class="hljs-string">'%q]n'</span> \
                <span class="hljs-string">'Unable to create data output file &gt;'</span><span class="hljs-variable">${SPAMMER_DATA}</span><span class="hljs-string">'&lt;'</span>)
                pend_release
                <span class="hljs-built_in">exit</span> 1
            <span class="hljs-keyword">fi</span>
            _dot_file=<span class="hljs-variable">${SPAMMER_DATA}</span>
            _dot_dump=dump_dot
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">if</span> [ ! -w <span class="hljs-variable">${SPAMMER_DATA}</span> ]
            <span class="hljs-keyword">then</span>
                pend_func <span class="hljs-built_in">echo</span> $(<span class="hljs-built_in">printf</span> <span class="hljs-string">'%q\n'</span> \
                <span class="hljs-string">'Unable to write data output file &gt;'</span><span class="hljs-variable">${SPAMMER_DATA}</span><span class="hljs-string">'&lt;'</span>)
                pend_release
                <span class="hljs-built_in">exit</span> 1
            <span class="hljs-keyword">fi</span>
            _dot_file=<span class="hljs-variable">${SPAMMER_DATA}</span>
            _dot_dump=dump_dot
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># Grope user specified arguments.</span>
<span class="hljs-function"><span class="hljs-title">do_user_args</span></span>() {
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -gt 0 ] &amp;&amp; is_number <span class="hljs-variable">$1</span>
    <span class="hljs-keyword">then</span>
        indirect=<span class="hljs-variable">$1</span>
        <span class="hljs-built_in">shift</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">case</span> <span class="hljs-variable">$#</span> <span class="hljs-keyword">in</span>                     <span class="hljs-comment"># Did user treat us well?</span>
        1)
            <span class="hljs-keyword">if</span> ! setup_input <span class="hljs-variable">$1</span>    <span class="hljs-comment"># Needs error checking.</span>
            <span class="hljs-keyword">then</span>
                pend_release
                <span class="hljs-variable">$_log_dump</span>
                <span class="hljs-built_in">exit</span> 1
            <span class="hljs-keyword">fi</span>
            list_server=( <span class="hljs-variable">${default_servers[@]}</span> )
            _list_cnt=<span class="hljs-variable">${#list_server[@]}</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">'Using default blacklist server list.'</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">'Search depth limit: '</span><span class="hljs-variable">${indirect}</span>
            ;;
        2)
            <span class="hljs-keyword">if</span> ! setup_input <span class="hljs-variable">$1</span>    <span class="hljs-comment"># Needs error checking.</span>
            <span class="hljs-keyword">then</span>
                pend_release
                <span class="hljs-variable">$_log_dump</span>
                <span class="hljs-built_in">exit</span> 1
            <span class="hljs-keyword">fi</span>
            <span class="hljs-keyword">if</span> ! setup_servers <span class="hljs-variable">$2</span>  <span class="hljs-comment"># Needs error checking.</span>
            <span class="hljs-keyword">then</span>
                pend_release
                <span class="hljs-variable">$_log_dump</span>
                <span class="hljs-built_in">exit</span> 1
            <span class="hljs-keyword">fi</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">'Search depth limit: '</span><span class="hljs-variable">${indirect}</span>
            ;;
        *)
            pend_func usage
            pend_release
            <span class="hljs-variable">$_log_dump</span>
            <span class="hljs-built_in">exit</span> 1
            ;;
    <span class="hljs-keyword">esac</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># A general purpose debug tool.</span>
<span class="hljs-comment"># list_array &lt;array_name&gt;</span>
<span class="hljs-function"><span class="hljs-title">list_array</span></span>() {
    [ <span class="hljs-variable">$#</span> -eq 1 ] || <span class="hljs-built_in">return</span> 1  <span class="hljs-comment"># One argument required.</span>

    <span class="hljs-built_in">local</span> -a _la_lines
    <span class="hljs-built_in">set</span> -f
    <span class="hljs-built_in">local</span> IFS=<span class="hljs-variable">${NO_WSP}</span>
    <span class="hljs-built_in">eval</span> _la_lines=\(\ \$\{<span class="hljs-variable">$1</span>\[@\]\}\ \)
    <span class="hljs-built_in">echo</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Element count "</span><span class="hljs-variable">${#_la_lines[@]}</span><span class="hljs-string">" array "</span><span class="hljs-variable">${1}</span>
    <span class="hljs-built_in">local</span> _ln_cnt=<span class="hljs-variable">${#_la_lines[@]}</span>

    <span class="hljs-keyword">for</span> (( _i = 0; _i &lt; <span class="hljs-variable">${_ln_cnt}</span>; _i++ ))
    <span class="hljs-keyword">do</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'Element '</span><span class="hljs-variable">$_i</span><span class="hljs-string">' &gt;'</span><span class="hljs-variable">${_la_lines[$_i]}</span><span class="hljs-string">'&lt;'</span>
    <span class="hljs-keyword">done</span>
    <span class="hljs-built_in">set</span> +f
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># # # 'Hunt the Spammer' program code # # #</span>
pend_init                               <span class="hljs-comment"># Ready stack engine.</span>
pend_func credits                       <span class="hljs-comment"># Last thing to print.</span>

<span class="hljs-comment"># # # Deal with user # # #</span>
live_log_die                            <span class="hljs-comment"># Setup debug trace log.</span>
data_capture                            <span class="hljs-comment"># Setup data capture file.</span>
<span class="hljs-built_in">echo</span>
do_user_args <span class="hljs-variable">$@</span>

<span class="hljs-comment"># # # Haven't exited yet - There is some hope # # #</span>
<span class="hljs-comment"># Discovery group - Execution engine is LIFO - pend</span>
<span class="hljs-comment"># in reverse order of execution.</span>
_hs_RC=0                                <span class="hljs-comment"># Hunt the Spammer return code</span>
pend_mark
    pend_func report_pairs              <span class="hljs-comment"># Report name-address pairs.</span>

    <span class="hljs-comment"># The two detail_* are mutually recursive functions.</span>
    <span class="hljs-comment"># They also pend expand_* functions as required.</span>
    <span class="hljs-comment"># These two (the last of ???) exit the recursion.</span>
    pend_func detail_each_address       <span class="hljs-comment"># Get all resources of addresses.</span>
    pend_func detail_each_name          <span class="hljs-comment"># Get all resources of names.</span>

    <span class="hljs-comment">#  The two expand_* are mutually recursive functions,</span>
    <span class="hljs-comment">#+ which pend additional detail_* functions as required.</span>
    pend_func expand_input_address 1    <span class="hljs-comment"># Expand input names by address.</span>
    pend_func expand_input_name 1       <span class="hljs-comment"># #xpand input addresses by name.</span>

    <span class="hljs-comment"># Start with a unique set of names and addresses.</span>
    pend_func unique_lines uc_address uc_address
    pend_func unique_lines uc_name uc_name

    <span class="hljs-comment"># Separate mixed input of names and addresses.</span>
    pend_func split_input
pend_release

<span class="hljs-comment"># # # Pairs reported -- Unique list of IP addresses found</span>
<span class="hljs-built_in">echo</span>
_ip_cnt=<span class="hljs-variable">${#known_address[@]}</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#list_server[@]}</span> -eq 0 ]
<span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">'Blacklist server list empty, none checked.'</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${_ip_cnt}</span> -eq 0 ]
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'Known address list empty, none checked.'</span>
    <span class="hljs-keyword">else</span>
        _ip_cnt=<span class="hljs-variable">${_ip_cnt}</span>-1   <span class="hljs-comment"># Start at top.</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">'Checking Blacklist servers.'</span>
        <span class="hljs-keyword">for</span> (( _ip = _ip_cnt ; _ip &gt;= 0 ; _ip-- ))
        <span class="hljs-keyword">do</span>
          pend_func check_lists $( <span class="hljs-built_in">printf</span> <span class="hljs-string">'%q\n'</span> <span class="hljs-variable">${known_address[$_ip]}</span> )
        <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>
pend_release
<span class="hljs-variable">$_dot_dump</span>                   <span class="hljs-comment"># Graphics file dump</span>
<span class="hljs-variable">$_log_dump</span>                   <span class="hljs-comment"># Execution trace</span>
<span class="hljs-built_in">echo</span>


<span class="hljs-comment">##############################</span>
<span class="hljs-comment"># Example output from script #</span>
<span class="hljs-comment">##############################</span>
:&lt;&lt;-<span class="hljs-string">'_is_spammer_outputs_'</span>

./is_spammer.bash 0 web4.alojamentos7.com

Starting with domain name &gt;web4.alojamentos7.com&lt;
Using default blacklist server list.
Search depth <span class="hljs-built_in">limit</span>: 0
.:....::::...:::...:::.......::..::...:::.......::
Known network pairs.
    66.98.208.97             web4.alojamentos7.com.
    66.98.208.97             ns1.alojamentos7.com.
    69.56.202.147            ns2.alojamentos.ws.
    66.98.208.97             alojamentos7.com.
    66.98.208.97             web.alojamentos7.com.
    69.56.202.146            ns1.alojamentos.ws.
    69.56.202.146            alojamentos.ws.
    66.235.180.113           ns1.alojamentos.org.
    66.235.181.192           ns2.alojamentos.org.
    66.235.180.113           alojamentos.org.
    66.235.180.113           web6.alojamentos.org.
    216.234.234.30           ns1.theplanet.com.
    12.96.160.115            ns2.theplanet.com.
    216.185.111.52           mail1.theplanet.com.
    69.56.141.4              spooling.theplanet.com.
    216.185.111.40           theplanet.com.
    216.185.111.40           www.theplanet.com.
    216.185.111.52           mail.theplanet.com.

Checking Blacklist servers.
  Checking address 66.98.208.97
      Records from dnsbl.sorbs.net
  <span class="hljs-string">"Spam Received See: http://www.dnsbl.sorbs.net/lookup.shtml?66.98.208.97"</span>
    Checking address 69.56.202.147
    Checking address 69.56.202.146
    Checking address 66.235.180.113
    Checking address 66.235.181.192
    Checking address 216.185.111.40
    Checking address 216.234.234.30
    Checking address 12.96.160.115
    Checking address 216.185.111.52
    Checking address 69.56.141.4

Advanced Bash Scripting Guide: is_spammer.bash, v2, 2004-msz

_is_spammer_outputs_

<span class="hljs-built_in">exit</span> <span class="hljs-variable">${_hs_RC}</span>

<span class="hljs-comment">####################################################</span>
<span class="hljs-comment">#  The script ignores everything from here on down #</span>
<span class="hljs-comment">#+ because of the 'exit' command, just above.      #</span>
<span class="hljs-comment">####################################################</span>



Quickstart
==========

 Prerequisites

  Bash version 2.05b or 3.00 (bash --version)
  A version of Bash <span class="hljs-built_in">which</span> supports arrays. Array 
  support is included by default Bash configurations.

  <span class="hljs-string">'dig,'</span> version 9.x.x (dig <span class="hljs-variable">$HOSTNAME</span>, see first line of output)
  A version of dig <span class="hljs-built_in">which</span> supports the +short options. 
  See: dig_wrappers.bash <span class="hljs-keyword">for</span> details.


 Optional Prerequisites

  <span class="hljs-string">'named,'</span> a <span class="hljs-built_in">local</span> DNS caching program. Any flavor will <span class="hljs-keyword">do</span>.
  Do twice: dig <span class="hljs-variable">$HOSTNAME</span> 
  Check near bottom of output <span class="hljs-keyword">for</span>: SERVER: 127.0.0.1<span class="hljs-comment">#53</span>
  That means you have one running.


 Optional Graphics Support

  <span class="hljs-string">'date,'</span> a standard *nix thing. (date -R)

  dot Program to convert graphic description file to a 
  diagram. (dot -V)
  A part of the Graph-Viz <span class="hljs-built_in">set</span> of programs.
  See: [http://www.research.att.com/sw/tools/graphviz||GraphViz]

  <span class="hljs-string">'dotty,'</span> a visual editor <span class="hljs-keyword">for</span> graphic description files.
  Also a part of the Graph-Viz <span class="hljs-built_in">set</span> of programs.




 Quick Start

In the same directory as the is_spammer.bash script; 
Do: ./is_spammer.bash

 Usage Details

1. Blacklist server choices.

  (a) To use default, built-in list: Do nothing.

  (b) To use your own list: 

    i. Create a file with a single Blacklist server 
       domain name per line.

    ii. Provide that filename as the last argument to 
        the script.

  (c) To use a single Blacklist server: Last argument 
      to the script.

  (d) To <span class="hljs-built_in">disable</span> Blacklist lookups:

    i. Create an empty file (touch spammer.nul)
       Your choice of filename.

    ii. Provide the filename of that empty file as the 
        last argument to the script.

2. Search depth <span class="hljs-built_in">limit</span>.

  (a) To use the default value of 2: Do nothing.

  (b) To <span class="hljs-built_in">set</span> a different <span class="hljs-built_in">limit</span>: 
      A <span class="hljs-built_in">limit</span> of 0 means: no <span class="hljs-built_in">limit</span>.

    i. <span class="hljs-built_in">export</span> SPAMMER_LIMIT=1
       or whatever <span class="hljs-built_in">limit</span> you want.

    ii. OR provide the desired <span class="hljs-built_in">limit</span> as the first 
       argument to the script.

3. Optional execution trace <span class="hljs-built_in">log</span>.

  (a) To use the default setting of no <span class="hljs-built_in">log</span> output: Do nothing.

  (b) To write an execution trace <span class="hljs-built_in">log</span>:
      <span class="hljs-built_in">export</span> SPAMMER_TRACE=spammer.log
      or whatever filename you want.

4. Optional graphic description file.

  (a) To use the default setting of no graphic file: Do nothing.

  (b) To write a Graph-Viz graphic description file:
      <span class="hljs-built_in">export</span> SPAMMER_DATA=spammer.dot
      or whatever filename you want.

5. Where to start the search.

  (a) Starting with a single domain name:

    i. Without a command-line search <span class="hljs-built_in">limit</span>: First 
       argument to script.

    ii. With a command-line search <span class="hljs-built_in">limit</span>: Second 
        argument to script.

  (b) Starting with a single IP address:

    i. Without a command-line search <span class="hljs-built_in">limit</span>: First 
       argument to script.

    ii. With a command-line search <span class="hljs-built_in">limit</span>: Second 
        argument to script.

  (c) Starting with (mixed) multiple name(s) and/or address(es):
      Create a file with one name or address per line.
      Your choice of filename.

    i. Without a command-line search <span class="hljs-built_in">limit</span>: Filename as 
       first argument to script.

    ii. With a command-line search <span class="hljs-built_in">limit</span>: Filename as 
        second argument to script.

6. What to <span class="hljs-keyword">do</span> with the display output.

  (a) To view display output on screen: Do nothing.

  (b) To save display output to a file: Redirect stdout to a filename.

  (c) To discard display output: Redirect stdout to /dev/null.

7. Temporary end of decision making. 
   press RETURN 
   <span class="hljs-built_in">wait</span> (optionally, watch the dots and colons).

8. Optionally check the <span class="hljs-built_in">return</span> code.

  (a) Return code 0: All OK

  (b) Return code 1: Script setup failure

  (c) Return code 2: Something was blacklisted.

9. Where is my graph (diagram)?

The script does not directly produce a graph (diagram). 
It only produces a graphic description file. You can 
process the graphic descriptor file that was output 
with the <span class="hljs-string">'dot'</span> program.

Until you edit that descriptor file, to describe the 
relationships you want shown, all that you will get is 
a bunch of labeled name and address nodes.

All of the script<span class="hljs-string">'s discovered relationships are within 
a comment block in the graphic descriptor file, each 
with a descriptive heading.

The editing required to draw a line between a pair of 
nodes from the information in the descriptor file may 
be done with a text editor. 

Given these lines somewhere in the descriptor file:

# Known domain name nodes

N0000 [label="guardproof.info."] ;

N0002 [label="third.guardproof.info."] ;



# Known address nodes

A0000 [label="61.141.32.197"] ;



/*

# Known name-&gt;address edges

NA0000 third.guardproof.info. 61.141.32.197



# Known parent-&gt;child edges

PC0000 guardproof.info. third.guardproof.info.

 */

Turn that into the following lines by substituting node 
identifiers into the relationships:

# Known domain name nodes

N0000 [label="guardproof.info."] ;

N0002 [label="third.guardproof.info."] ;



# Known address nodes

A0000 [label="61.141.32.197"] ;



# PC0000 guardproof.info. third.guardproof.info.

N0000-&gt;N0002 ;



# NA0000 third.guardproof.info. 61.141.32.197

N0002-&gt;A0000 ;



/*

# Known name-&gt;address edges

NA0000 third.guardproof.info. 61.141.32.197



# Known parent-&gt;child edges

PC0000 guardproof.info. third.guardproof.info.

 */

Process that with the '</span>dot<span class="hljs-string">' program, and you have your 
first network diagram.

In addition to the conventional graphic edges, the 
descriptor file includes similar format pair-data that 
describes services, zone records (sub-graphs?), 
blacklisted addresses, and other things which might be 
interesting to include in your graph. This additional 
information could be displayed as different node 
shapes, colors, line sizes, etc.

The descriptor file can also be read and edited by a 
Bash script (of course). You should be able to find 
most of the functions required within the 
"is_spammer.bash" script.

# End Quickstart.



Additional Note
========== ====

Michael Zick points out that there is a "makeviz.bash" interactive
Web site at rediris.es. Can'</span>t give the full URL, since this is not
a publically accessible site.</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>Another anti-spam script.</p>
      <p><a name="WHX0" id="WHX0"></a></p>
      <div class="EXAMPLE">
        <a name="WHX" id="WHX"></a>
        <p><b>Example A-29. Spammer Hunt</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># whx.sh: "whois" spammer lookup</span>
<span class="hljs-comment"># Author: Walter Dnes</span>
<span class="hljs-comment"># Slight revisions (first section) by ABS Guide author.</span>
<span class="hljs-comment"># Used in ABS Guide with permission.</span>

<span class="hljs-comment"># Needs version 3.x or greater of Bash to run (because of =~ operator).</span>
<span class="hljs-comment"># Commented by script author and ABS Guide author.</span>



E_BADARGS=85        <span class="hljs-comment"># Missing command-line arg.</span>
E_NOHOST=86         <span class="hljs-comment"># Host not found.</span>
E_TIMEOUT=87        <span class="hljs-comment"># Host lookup timed out.</span>
E_UNDEF=88          <span class="hljs-comment"># Some other (undefined) error.</span>

HOSTWAIT=10         <span class="hljs-comment"># Specify up to 10 seconds for host query reply.</span>
                    <span class="hljs-comment"># The actual wait may be a bit longer.</span>
OUTFILE=whois.txt   <span class="hljs-comment"># Output file.</span>
PORT=4321


<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]      <span class="hljs-comment"># Check for (required) command-line arg.</span>
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$0</span> domain name or IP address"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BADARGS</span>
<span class="hljs-keyword">fi</span>


<span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> =~ [a-zA-Z][a-zA-Z]$ ]]  <span class="hljs-comment">#  Ends in two alpha chars?</span>
<span class="hljs-keyword">then</span>                                  <span class="hljs-comment">#  It's a domain name &amp;&amp;</span>
                                      <span class="hljs-comment">#+ must do host lookup.</span>
  IPADDR=$(host -W <span class="hljs-variable">$HOSTWAIT</span> <span class="hljs-variable">$1</span> | awk <span class="hljs-string">'{print $4}'</span>)
                                      <span class="hljs-comment">#  Doing host lookup</span>
                                      <span class="hljs-comment">#+ to get IP address.</span>
                                      <span class="hljs-comment">#  Extract final field.</span>
<span class="hljs-keyword">else</span>
  IPADDR=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>                         <span class="hljs-comment">#  Command-line arg was IP address.</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"IP Address is: "</span><span class="hljs-variable">$IPADDR</span><span class="hljs-string">""</span>; <span class="hljs-built_in">echo</span>

<span class="hljs-keyword">if</span> [ -e <span class="hljs-string">"<span class="hljs-variable">$OUTFILE</span>"</span> ]
<span class="hljs-keyword">then</span>
  rm -f <span class="hljs-string">"<span class="hljs-variable">$OUTFILE</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Stale output file \"<span class="hljs-variable">$OUTFILE</span>\" removed."</span>; <span class="hljs-built_in">echo</span>
<span class="hljs-keyword">fi</span>


<span class="hljs-comment">#  Sanity checks.</span>
<span class="hljs-comment">#  (This section needs more work.)</span>
<span class="hljs-comment">#  ===============================</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span> ]
<span class="hljs-comment"># No response.</span>
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Host not found!"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOHOST</span>    <span class="hljs-comment"># Bail out.</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span> =~ ^[;;] ]]
<span class="hljs-comment">#  ;; Connection timed out; no servers could be reached.</span>
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Host lookup timed out!"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_TIMEOUT</span>   <span class="hljs-comment"># Bail out.</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span> =~ [(NXDOMAIN)]$ ]]
<span class="hljs-comment">#  Host xxxxxxxxx.xxx not found: 3(NXDOMAIN)</span>
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Host not found!"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOHOST</span>    <span class="hljs-comment"># Bail out.</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span> =~ [(SERVFAIL)]$ ]]
<span class="hljs-comment">#  Host xxxxxxxxx.xxx not found: 2(SERVFAIL)</span>
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Host not found!"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOHOST</span>    <span class="hljs-comment"># Bail out.</span>
<span class="hljs-keyword">fi</span>




<span class="hljs-comment"># ======================== Main body of script ========================</span>

<span class="hljs-function"><span class="hljs-title">AFRINICquery</span></span>() {
<span class="hljs-comment">#  Define the function that queries AFRINIC. Echo a notification to the</span>
<span class="hljs-comment">#+ screen, and then run the actual query, redirecting output to $OUTFILE.</span>

  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Searching for <span class="hljs-variable">$IPADDR</span> in whois.afrinic.net"</span>
  whois -h whois.afrinic.net <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span> &gt; <span class="hljs-variable">$OUTFILE</span>

<span class="hljs-comment">#  Check for presence of reference to an rwhois.</span>
<span class="hljs-comment">#  Warn about non-functional rwhois.infosat.net server</span>
<span class="hljs-comment">#+ and attempt rwhois query.</span>
  <span class="hljs-keyword">if</span> grep -e <span class="hljs-string">"^remarks: .*rwhois\.[^ ]\+"</span> <span class="hljs-string">"<span class="hljs-variable">$OUTFILE</span>"</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">" "</span> &gt;&gt; <span class="hljs-variable">$OUTFILE</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"***"</span> &gt;&gt; <span class="hljs-variable">$OUTFILE</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"***"</span> &gt;&gt; <span class="hljs-variable">$OUTFILE</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: rwhois.infosat.net was not working \
      as of 2005/02/02"</span> &gt;&gt; <span class="hljs-variable">$OUTFILE</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"         when this script was written."</span> &gt;&gt; <span class="hljs-variable">$OUTFILE</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"***"</span> &gt;&gt; <span class="hljs-variable">$OUTFILE</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"***"</span> &gt;&gt; <span class="hljs-variable">$OUTFILE</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">" "</span> &gt;&gt; <span class="hljs-variable">$OUTFILE</span>
    RWHOIS=`grep <span class="hljs-string">"^remarks: .*rwhois\.[^ ]\+"</span> <span class="hljs-string">"<span class="hljs-variable">$OUTFILE</span>"</span> | tail -n 1 |\
    sed <span class="hljs-string">"s/\(^.*\)\(rwhois\..*\)\(:4.*\)/\2/"</span>`
    whois -h <span class="hljs-variable">${RWHOIS}</span>:<span class="hljs-variable">${PORT}</span> <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span> &gt;&gt; <span class="hljs-variable">$OUTFILE</span>
  <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">APNICquery</span></span>() {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Searching for <span class="hljs-variable">$IPADDR</span> in whois.apnic.net"</span>
  whois -h whois.apnic.net <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span> &gt; <span class="hljs-variable">$OUTFILE</span>

<span class="hljs-comment">#  Just  about  every  country has its own internet registrar.</span>
<span class="hljs-comment">#  I don't normally bother consulting them, because the regional registry</span>
<span class="hljs-comment">#+ usually supplies sufficient information.</span>
<span class="hljs-comment">#  There are a few exceptions, where the regional registry simply</span>
<span class="hljs-comment">#+ refers to the national registry for direct data.</span>
<span class="hljs-comment">#  These are Japan and South Korea in APNIC, and Brasil in LACNIC.</span>
<span class="hljs-comment">#  The following if statement checks $OUTFILE (whois.txt) for the presence</span>
<span class="hljs-comment">#+ of "KR" (South Korea) or "JP" (Japan) in the country field.</span>
<span class="hljs-comment">#  If either is found, the query is re-run against the appropriate</span>
<span class="hljs-comment">#+ national registry.</span>

  <span class="hljs-keyword">if</span> grep -E <span class="hljs-string">"^country:[ ]+KR$"</span> <span class="hljs-string">"<span class="hljs-variable">$OUTFILE</span>"</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Searching for <span class="hljs-variable">$IPADDR</span> in whois.krnic.net"</span>
    whois -h whois.krnic.net <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span> &gt;&gt; <span class="hljs-variable">$OUTFILE</span>
  <span class="hljs-keyword">elif</span> grep -E <span class="hljs-string">"^country:[ ]+JP$"</span> <span class="hljs-string">"<span class="hljs-variable">$OUTFILE</span>"</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Searching for <span class="hljs-variable">$IPADDR</span> in whois.nic.ad.jp"</span>
    whois -h whois.nic.ad.jp <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span>/e &gt;&gt; <span class="hljs-variable">$OUTFILE</span>
  <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">ARINquery</span></span>() {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Searching for <span class="hljs-variable">$IPADDR</span> in whois.arin.net"</span>
  whois -h whois.arin.net <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span> &gt; <span class="hljs-variable">$OUTFILE</span>

<span class="hljs-comment">#  Several large internet providers listed by ARIN have their own</span>
<span class="hljs-comment">#+ internal whois service, referred to as "rwhois".</span>
<span class="hljs-comment">#  A large block of IP addresses is listed with the provider</span>
<span class="hljs-comment">#+ under the ARIN registry.</span>
<span class="hljs-comment">#  To get the IP addresses of 2nd-level ISPs or other large customers,</span>
<span class="hljs-comment">#+ one has to refer to the rwhois server on port 4321.</span>
<span class="hljs-comment">#  I originally started with a bunch of "if" statements checking for</span>
<span class="hljs-comment">#+ the larger providers.</span>
<span class="hljs-comment">#  This approach is unwieldy, and there's always another rwhois server</span>
<span class="hljs-comment">#+ that I didn't know about.</span>
<span class="hljs-comment">#  A more elegant approach is to check $OUTFILE for a reference</span>
<span class="hljs-comment">#+ to a whois server, parse that server name out of the comment section,</span>
<span class="hljs-comment">#+ and re-run the query against the appropriate rwhois server.</span>
<span class="hljs-comment">#  The parsing looks a bit ugly, with a long continued line inside</span>
<span class="hljs-comment">#+ backticks.</span>
<span class="hljs-comment">#  But it only has to be done once, and will work as new servers are added.</span>
<span class="hljs-comment">#@   ABS Guide author comment: it isn't all that ugly, and is, in fact,</span>
<span class="hljs-comment">#@+  an instructive use of Regular Expressions.</span>

  <span class="hljs-keyword">if</span> grep -E <span class="hljs-string">"^Comment: .*rwhois.[^ ]+"</span> <span class="hljs-string">"<span class="hljs-variable">$OUTFILE</span>"</span>
  <span class="hljs-keyword">then</span>
    RWHOIS=`grep -e <span class="hljs-string">"^Comment:.*rwhois\.[^ ]\+"</span> <span class="hljs-string">"<span class="hljs-variable">$OUTFILE</span>"</span> | tail -n 1 |\
    sed <span class="hljs-string">"s/^\(.*\)\(rwhois\.[^ ]\+\)\(.*$\)/\2/"</span>`
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Searching for <span class="hljs-variable">$IPADDR</span> in <span class="hljs-variable">${RWHOIS}</span>"</span>
    whois -h <span class="hljs-variable">${RWHOIS}</span>:<span class="hljs-variable">${PORT}</span> <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span> &gt;&gt; <span class="hljs-variable">$OUTFILE</span>
  <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">LACNICquery</span></span>() {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Searching for <span class="hljs-variable">$IPADDR</span> in whois.lacnic.net"</span>
  whois -h whois.lacnic.net <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span> &gt; <span class="hljs-variable">$OUTFILE</span>

<span class="hljs-comment">#  The  following if statement checks $OUTFILE (whois.txt) for</span>
<span class="hljs-comment">#+ the presence of "BR" (Brasil) in the country field.</span>
<span class="hljs-comment">#  If it is found, the query is re-run against whois.registro.br.</span>

  <span class="hljs-keyword">if</span> grep -E <span class="hljs-string">"^country:[ ]+BR$"</span> <span class="hljs-string">"<span class="hljs-variable">$OUTFILE</span>"</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Searching for <span class="hljs-variable">$IPADDR</span> in whois.registro.br"</span>
    whois -h whois.registro.br <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span> &gt;&gt; <span class="hljs-variable">$OUTFILE</span>
  <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">RIPEquery</span></span>() {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Searching for <span class="hljs-variable">$IPADDR</span> in whois.ripe.net"</span>
  whois -h whois.ripe.net <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span> &gt; <span class="hljs-variable">$OUTFILE</span>
}

<span class="hljs-comment">#  Initialize a few variables.</span>
<span class="hljs-comment">#  * slash8 is the most significant octet</span>
<span class="hljs-comment">#  * slash16 consists of the two most significant octets</span>
<span class="hljs-comment">#  * octet2 is the second most significant octet</span>




slash8=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$IPADDR</span> | cut -d. -f 1`
  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$slash8</span>"</span> ]  <span class="hljs-comment"># Yet another sanity check.</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Undefined error!"</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_UNDEF</span>
  <span class="hljs-keyword">fi</span>
slash16=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$IPADDR</span> | cut -d. -f 1-2`
<span class="hljs-comment">#                             ^ Period specified as 'cut" delimiter.</span>
  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$slash16</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Undefined error!"</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_UNDEF</span>
  <span class="hljs-keyword">fi</span>
octet2=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$slash16</span> | cut -d. -f 2`
  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$octet2</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Undefined error!"</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_UNDEF</span>
  <span class="hljs-keyword">fi</span>


<span class="hljs-comment">#  Check for various odds and ends of reserved space.</span>
<span class="hljs-comment">#  There is no point in querying for those addresses.</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$slash8</span> == 0 ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$IPADDR</span> is <span class="hljs-string">'"This Network"'</span> space\; Not querying
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$slash8</span> == 10 ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$IPADDR</span> is RFC1918 space\; Not querying
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$slash8</span> == 14 ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$IPADDR</span> is <span class="hljs-string">'"Public Data Network"'</span> space\; Not querying
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$slash8</span> == 127 ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$IPADDR</span> is loopback space\; Not querying
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$slash16</span> == 169.254 ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$IPADDR</span> is link-local space\; Not querying
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$slash8</span> == 172 ] &amp;&amp; [ <span class="hljs-variable">$octet2</span> -ge 16 ] &amp;&amp; [ <span class="hljs-variable">$octet2</span> -le 31 ];<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$IPADDR</span> is RFC1918 space\; Not querying
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$slash16</span> == 192.168 ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$IPADDR</span> is RFC1918 space\; Not querying
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$slash8</span> -ge 224 ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$IPADDR</span> is either Multicast or reserved space\; Not querying
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$slash8</span> -ge 200 ] &amp;&amp; [ <span class="hljs-variable">$slash8</span> -le 201 ]; <span class="hljs-keyword">then</span> LACNICquery <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span>
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$slash8</span> -ge 202 ] &amp;&amp; [ <span class="hljs-variable">$slash8</span> -le 203 ]; <span class="hljs-keyword">then</span> APNICquery <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span>
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$slash8</span> -ge 210 ] &amp;&amp; [ <span class="hljs-variable">$slash8</span> -le 211 ]; <span class="hljs-keyword">then</span> APNICquery <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span>
<span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$slash8</span> -ge 218 ] &amp;&amp; [ <span class="hljs-variable">$slash8</span> -le 223 ]; <span class="hljs-keyword">then</span> APNICquery <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span>

<span class="hljs-comment">#  If we got this far without making a decision, query ARIN.</span>
<span class="hljs-comment">#  If a reference is found in $OUTFILE to APNIC, AFRINIC, LACNIC, or RIPE,</span>
<span class="hljs-comment">#+ query the appropriate whois server.</span>

<span class="hljs-keyword">else</span>
  ARINquery <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span>
  <span class="hljs-keyword">if</span> grep <span class="hljs-string">"whois.afrinic.net"</span> <span class="hljs-string">"<span class="hljs-variable">$OUTFILE</span>"</span>; <span class="hljs-keyword">then</span>
    AFRINICquery <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span>
  <span class="hljs-keyword">elif</span> grep -E <span class="hljs-string">"^OrgID:[ ]+RIPE$"</span> <span class="hljs-string">"<span class="hljs-variable">$OUTFILE</span>"</span>; <span class="hljs-keyword">then</span>
    RIPEquery <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span>
  <span class="hljs-keyword">elif</span> grep -E <span class="hljs-string">"^OrgID:[ ]+APNIC$"</span> <span class="hljs-string">"<span class="hljs-variable">$OUTFILE</span>"</span>; <span class="hljs-keyword">then</span>
    APNICquery <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span>
  <span class="hljs-keyword">elif</span> grep -E <span class="hljs-string">"^OrgID:[ ]+LACNIC$"</span> <span class="hljs-string">"<span class="hljs-variable">$OUTFILE</span>"</span>; <span class="hljs-keyword">then</span>
    LACNICquery <span class="hljs-string">"<span class="hljs-variable">$IPADDR</span>"</span>
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment">#@  ---------------------------------------------------------------</span>
<span class="hljs-comment">#   Try also:</span>
<span class="hljs-comment">#   wget http://logi.cc/nw/whois.php3?ACTION=doQuery&amp;DOMAIN=$IPADDR</span>
<span class="hljs-comment">#@  ---------------------------------------------------------------</span>

<span class="hljs-comment">#  We've  now  finished  the querying.</span>
<span class="hljs-comment">#  Echo a copy of the final result to the screen.</span>

cat <span class="hljs-variable">$OUTFILE</span>
<span class="hljs-comment"># Or "less $OUTFILE" . . .</span>


<span class="hljs-built_in">exit</span> 0

<span class="hljs-comment">#@  ABS Guide author comments:</span>
<span class="hljs-comment">#@  Nothing fancy here, but still a very useful tool for hunting spammers.</span>
<span class="hljs-comment">#@  Sure, the script can be cleaned up some, and it's still a bit buggy,</span>
<span class="hljs-comment">#@+ (exercise for reader), but all the same, it's a nice piece of coding</span>
<span class="hljs-comment">#@+ by Walter Dnes.</span>
<span class="hljs-comment">#@  Thank you!</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>
        <span class="QUOTE">"Little Monster's"</span> front end to
        <a href="communications.html#WGETREF">wget</a>.
      </p>
      <div class="EXAMPLE">
        <a name="WGETTER2" id="WGETTER2"></a>
        <p>
          <b>Example A-30. Making <i class="FIRSTTERM">wget</i> easier to use</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># wgetter2.bash</span>

<span class="hljs-comment"># Author: Little Monster [monster@monstruum.co.uk]</span>
<span class="hljs-comment"># ==&gt; Used in ABS Guide with permission of script author.</span>
<span class="hljs-comment"># ==&gt; This script still needs debugging and fixups (exercise for reader).</span>
<span class="hljs-comment"># ==&gt; It could also use some additional editing in the comments.</span>


<span class="hljs-comment">#  This is wgetter2 --</span>
<span class="hljs-comment">#+ a Bash script to make wget a bit more friendly, and save typing.</span>

<span class="hljs-comment">#  Carefully crafted by Little Monster.</span>
<span class="hljs-comment">#  More or less complete on 02/02/2005.</span>
<span class="hljs-comment">#  If you think this script can be improved,</span>
<span class="hljs-comment">#+ email me at: monster@monstruum.co.uk</span>
<span class="hljs-comment"># ==&gt; and cc: to the author of the ABS Guide, please.</span>
<span class="hljs-comment">#  This script is licenced under the GPL.</span>
<span class="hljs-comment">#  You are free to copy, alter and re-use it,</span>
<span class="hljs-comment">#+ but please don't try to claim you wrote it.</span>
<span class="hljs-comment">#  Log your changes here instead.</span>

<span class="hljs-comment"># =======================================================================</span>
<span class="hljs-comment"># changelog:</span>

<span class="hljs-comment"># 07/02/2005.  Fixups by Little Monster.</span>
<span class="hljs-comment"># 02/02/2005.  Minor additions by Little Monster.</span>
<span class="hljs-comment">#              (See after # +++++++++++ )</span>
<span class="hljs-comment"># 29/01/2005.  Minor stylistic edits and cleanups by author of ABS Guide.</span>
<span class="hljs-comment">#              Added exit error codes.</span>
<span class="hljs-comment"># 22/11/2004.  Finished initial version of second version of wgetter:</span>
<span class="hljs-comment">#              wgetter2 is born.</span>
<span class="hljs-comment"># 01/12/2004.  Changed 'runn' function so it can be run 2 ways --</span>
<span class="hljs-comment">#              either ask for a file name or have one input on the CL.</span>
<span class="hljs-comment"># 01/12/2004.  Made sensible handling of no URL's given.</span>
<span class="hljs-comment"># 01/12/2004.  Made loop of main options, so you don't</span>
<span class="hljs-comment">#              have to keep calling wgetter 2 all the time.</span>
<span class="hljs-comment">#              Runs as a session instead.</span>
<span class="hljs-comment"># 01/12/2004.  Added looping to 'runn' function.</span>
<span class="hljs-comment">#              Simplified and improved.</span>
<span class="hljs-comment"># 01/12/2004.  Added state to recursion setting.</span>
<span class="hljs-comment">#              Enables re-use of previous value.</span>
<span class="hljs-comment"># 05/12/2004.  Modified the file detection routine in the 'runn' function</span>
<span class="hljs-comment">#              so it's not fooled by empty values, and is cleaner.</span>
<span class="hljs-comment"># 01/02/2004.  Added cookie finding routine from later version (which </span>
<span class="hljs-comment">#              isn't ready yet), so as not to have hard-coded paths.</span>
<span class="hljs-comment"># =======================================================================</span>

<span class="hljs-comment"># Error codes for abnormal exit.</span>
E_USAGE=67        <span class="hljs-comment"># Usage message, then quit.</span>
E_NO_OPTS=68      <span class="hljs-comment"># No command-line args entered.</span>
E_NO_URLS=69      <span class="hljs-comment"># No URLs passed to script.</span>
E_NO_SAVEFILE=70  <span class="hljs-comment"># No save filename passed to script.</span>
E_USER_EXIT=71    <span class="hljs-comment"># User decides to quit.</span>


<span class="hljs-comment">#  Basic default wget command we want to use.</span>
<span class="hljs-comment">#  This is the place to change it, if required.</span>
<span class="hljs-comment">#  NB: if using a proxy, set http_proxy = yourproxy in .wgetrc.</span>
<span class="hljs-comment">#  Otherwise delete --proxy=on, below.</span>
<span class="hljs-comment"># ====================================================================</span>
CommandA=<span class="hljs-string">"wget -nc -c -t 5 --progress=bar --random-wait --proxy=on -r"</span>
<span class="hljs-comment"># ====================================================================</span>



<span class="hljs-comment"># --------------------------------------------------------------------</span>
<span class="hljs-comment"># Set some other variables and explain them.</span>

pattern=<span class="hljs-string">" -A .jpg,.JPG,.jpeg,.JPEG,.gif,.GIF,.htm,.html,.shtml,.php"</span>
                    <span class="hljs-comment"># wget's option to only get certain types of file.</span>
                    <span class="hljs-comment"># comment out if not using</span>
today=`date +%F`    <span class="hljs-comment"># Used for a filename.</span>
home=<span class="hljs-variable">$HOME</span>          <span class="hljs-comment"># Set HOME to an internal variable.</span>
                    <span class="hljs-comment"># In case some other path is used, change it here.</span>
depthDefault=3      <span class="hljs-comment"># Set a sensible default recursion.</span>
Depth=<span class="hljs-variable">$depthDefault</span> <span class="hljs-comment"># Otherwise user feedback doesn't tie in properly.</span>
RefA=<span class="hljs-string">""</span>             <span class="hljs-comment"># Set blank referring page.</span>
Flag=<span class="hljs-string">""</span>             <span class="hljs-comment">#  Default to not saving anything,</span>
                    <span class="hljs-comment">#+ or whatever else might be wanted in future.</span>
lister=<span class="hljs-string">""</span>           <span class="hljs-comment"># Used for passing a list of urls directly to wget.</span>
Woptions=<span class="hljs-string">""</span>         <span class="hljs-comment"># Used for passing wget some options for itself.</span>
inFile=<span class="hljs-string">""</span>           <span class="hljs-comment"># Used for the run function.</span>
newFile=<span class="hljs-string">""</span>          <span class="hljs-comment"># Used for the run function.</span>
savePath=<span class="hljs-string">"<span class="hljs-variable">$home</span>/w-save"</span>
Config=<span class="hljs-string">"<span class="hljs-variable">$home</span>/.wgetter2rc"</span>
                    <span class="hljs-comment">#  This is where some variables can be stored, </span>
                    <span class="hljs-comment">#+ if permanently changed from within the script.</span>
Cookie_List=<span class="hljs-string">"<span class="hljs-variable">$home</span>/.cookielist"</span>
                    <span class="hljs-comment"># So we know where the cookies are kept . . .</span>
cFlag=<span class="hljs-string">""</span>            <span class="hljs-comment"># Part of the cookie file selection routine.</span>

<span class="hljs-comment"># Define the options available. Easy to change letters here if needed.</span>
<span class="hljs-comment"># These are the optional options; you don't just wait to be asked.</span>

save=s   <span class="hljs-comment"># Save command instead of executing it.</span>
cook=c   <span class="hljs-comment"># Change cookie file for this session.</span>
<span class="hljs-built_in">help</span>=h   <span class="hljs-comment"># Usage guide.</span>
list=l   <span class="hljs-comment"># Pass wget the -i option and URL list.</span>
runn=r   <span class="hljs-comment"># Run saved commands as an argument to the option.</span>
inpu=i   <span class="hljs-comment"># Run saved commands interactively.</span>
wopt=w   <span class="hljs-comment"># Allow to enter options to pass directly to wget.</span>
<span class="hljs-comment"># --------------------------------------------------------------------</span>


<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]; <span class="hljs-keyword">then</span>   <span class="hljs-comment"># Make sure we get something for wget to eat.</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"You must at least enter a URL or option!"</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"-<span class="hljs-variable">$help</span> for usage."</span>
   <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NO_OPTS</span>
<span class="hljs-keyword">fi</span>



<span class="hljs-comment"># +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<span class="hljs-comment"># added added added added added added added added added added added added</span>

<span class="hljs-keyword">if</span> [ ! -e <span class="hljs-string">"<span class="hljs-variable">$Config</span>"</span> ]; <span class="hljs-keyword">then</span>   <span class="hljs-comment"># See if configuration file exists.</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Creating configuration file, <span class="hljs-variable">$Config</span>"</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"# This is the configuration file for wgetter2"</span> &gt; <span class="hljs-string">"<span class="hljs-variable">$Config</span>"</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"# Your customised settings will be saved in this file"</span> &gt;&gt; <span class="hljs-string">"<span class="hljs-variable">$Config</span>"</span>
<span class="hljs-keyword">else</span>
   <span class="hljs-built_in">source</span> <span class="hljs-variable">$Config</span>             <span class="hljs-comment"># Import variables we set outside the script.</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ ! -e <span class="hljs-string">"<span class="hljs-variable">$Cookie_List</span>"</span> ]; <span class="hljs-keyword">then</span>
   <span class="hljs-comment"># Set up a list of cookie files, if there isn't one.</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Hunting for cookies . . ."</span>
   find -name cookies.txt &gt;&gt; <span class="hljs-variable">$Cookie_List</span> <span class="hljs-comment"># Create the list of cookie files.</span>
<span class="hljs-keyword">fi</span> <span class="hljs-comment">#  Isolate this in its own 'if' statement,</span>
   <span class="hljs-comment">#+ in case we got interrupted while searching.</span>

<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$cFlag</span>"</span> ]; <span class="hljs-keyword">then</span> <span class="hljs-comment"># If we haven't already done this . . .</span>
   <span class="hljs-built_in">echo</span>                  <span class="hljs-comment"># Make a nice space after the command prompt.</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Looks like you haven't set up your source of cookies yet."</span>
   n=0                   <span class="hljs-comment">#  Make sure the counter</span>
                         <span class="hljs-comment">#+ doesn't contain random values.</span>
   <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span>; <span class="hljs-keyword">do</span>
      Cookies[<span class="hljs-variable">$n</span>]=<span class="hljs-variable">$REPLY</span> <span class="hljs-comment"># Put the cookie files we found into an array.</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$n</span>) <span class="hljs-variable">${Cookies[$n]}</span>"</span>  <span class="hljs-comment"># Create a menu.</span>
      n=$(( n + <span class="hljs-number">1</span> ))     <span class="hljs-comment"># Increment the counter.</span>
   <span class="hljs-keyword">done</span> &lt; <span class="hljs-variable">$Cookie_List</span>   <span class="hljs-comment"># Feed the read statement.</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Enter the number of the cookie file you want to use."</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"If you won't be using cookies, just press RETURN."</span>
   <span class="hljs-built_in">echo</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"I won't be asking this again. Edit <span class="hljs-variable">$Config</span>"</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"If you decide to change at a later date"</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"or use the -<span class="hljs-variable">${cook}</span> option for per session changes."</span>
   <span class="hljs-built_in">read</span>
   <span class="hljs-keyword">if</span> [ ! -z <span class="hljs-variable">$REPLY</span> ]; <span class="hljs-keyword">then</span>   <span class="hljs-comment"># User didn't just press return.</span>
      Cookie=<span class="hljs-string">" --load-cookies <span class="hljs-variable">${Cookies[$REPLY]}</span>"</span>
      <span class="hljs-comment"># Set the variable here as well as in the config file.</span>

      <span class="hljs-built_in">echo</span> <span class="hljs-string">"Cookie=\" --load-cookies <span class="hljs-variable">${Cookies[$REPLY]}</span>\""</span> &gt;&gt; <span class="hljs-variable">$Config</span>
   <span class="hljs-keyword">fi</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"cFlag=1"</span> &gt;&gt; <span class="hljs-variable">$Config</span>  <span class="hljs-comment"># So we know not to ask again.</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># end added section end added section end added section end added section</span>
<span class="hljs-comment"># +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>



<span class="hljs-comment"># Another variable.</span>
<span class="hljs-comment"># This one may or may not be subject to variation.</span>
<span class="hljs-comment"># A bit like the small print.</span>
CookiesON=<span class="hljs-variable">$Cookie</span>
<span class="hljs-comment"># echo "cookie file is $CookiesON" # For debugging.</span>
<span class="hljs-comment"># echo "home is ${home}"           # For debugging.</span>
                                   <span class="hljs-comment"># Got caught with this one!</span>


<span class="hljs-function"><span class="hljs-title">wopts</span></span>()
{
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Enter options to pass to wget."</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"It is assumed you know what you're doing."</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"You can pass their arguments here too."</span>
<span class="hljs-comment"># That is to say, everything passed here is passed to wget.</span>

<span class="hljs-built_in">read</span> Wopts
<span class="hljs-comment"># Read in the options to be passed to wget.</span>

Woptions=<span class="hljs-string">" <span class="hljs-variable">$Wopts</span>"</span>
<span class="hljs-comment">#         ^  Why the leading space?</span>
<span class="hljs-comment"># Assign to another variable.</span>
<span class="hljs-comment"># Just for fun, or something . . .</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"passing options <span class="hljs-variable">${Wopts}</span> to wget"</span>
<span class="hljs-comment"># Mainly for debugging.</span>
<span class="hljs-comment"># Is cute.</span>

<span class="hljs-built_in">return</span>
}


<span class="hljs-function"><span class="hljs-title">save_func</span></span>()
{
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Settings will be saved."</span>
<span class="hljs-keyword">if</span> [ ! -d <span class="hljs-variable">$savePath</span> ]; <span class="hljs-keyword">then</span>  <span class="hljs-comment">#  See if directory exists.</span>
   mkdir <span class="hljs-variable">$savePath</span>           <span class="hljs-comment">#  Create the directory to save things in</span>
                             <span class="hljs-comment">#+ if it isn't already there.</span>
<span class="hljs-keyword">fi</span>

Flag=S
<span class="hljs-comment"># Tell the final bit of code what to do.</span>
<span class="hljs-comment"># Set a flag since stuff is done in main.</span>

<span class="hljs-built_in">return</span>
}


usage() <span class="hljs-comment"># Tell them how it works.</span>
{
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Welcome to wgetter.  This is a front end to wget."</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"It will always run wget with these options:"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$CommandA</span>"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"and the pattern to match: <span class="hljs-variable">$pattern</span> \
(which you can change at the top of this script)."</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"It will also ask you for recursion depth, \
and if you want to use a referring page."</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Wgetter accepts the following options:"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"-<span class="hljs-variable">$help</span> : Display this help."</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"-<span class="hljs-variable">$save</span> : Save the command to a file <span class="hljs-variable">$savePath</span>/wget-(<span class="hljs-variable">$today</span>) \
instead of running it."</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"-<span class="hljs-variable">$runn</span> : Run saved wget commands instead of starting a new one -"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Enter filename as argument to this option."</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"-<span class="hljs-variable">$inpu</span> : Run saved wget commands interactively --"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"The script will ask you for the filename."</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"-<span class="hljs-variable">$cook</span> : Change the cookies file for this session."</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"-<span class="hljs-variable">$list</span> : Tell wget to use URL's from a list instead of \
from the command-line."</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"-<span class="hljs-variable">$wopt</span> : Pass any other options direct to wget."</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"See the wget man page for additional options \
you can pass to wget."</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>

    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_USAGE</span>  <span class="hljs-comment"># End here. Don't process anything else.</span>
}



list_func() <span class="hljs-comment">#  Gives the user the option to use the -i option to wget,</span>
            <span class="hljs-comment">#+ and a list of URLs.</span>
{
<span class="hljs-keyword">while</span> [ 1 ]; <span class="hljs-keyword">do</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Enter the name of the file containing URL's (press q to change
your mind)."</span>
   <span class="hljs-built_in">read</span> urlfile
   <span class="hljs-keyword">if</span> [ ! -e <span class="hljs-string">"<span class="hljs-variable">$urlfile</span>"</span> ] &amp;&amp; [ <span class="hljs-string">"<span class="hljs-variable">$urlfile</span>"</span> != q ]; <span class="hljs-keyword">then</span>
       <span class="hljs-comment"># Look for a file, or the quit option.</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"That file does not exist!"</span>
   <span class="hljs-keyword">elif</span> [ <span class="hljs-string">"<span class="hljs-variable">$urlfile</span>"</span> = q ]; <span class="hljs-keyword">then</span> <span class="hljs-comment"># Check quit option.</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"Not using a url list."</span>
       <span class="hljs-built_in">return</span>
   <span class="hljs-keyword">else</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"using <span class="hljs-variable">$urlfile</span>."</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"If you gave url's on the command-line, I'll use those first."</span>
                            <span class="hljs-comment"># Report wget standard behaviour to the user.</span>
      lister=<span class="hljs-string">" -i <span class="hljs-variable">$urlfile</span>"</span> <span class="hljs-comment"># This is what we want to pass to wget.</span>
      <span class="hljs-built_in">return</span>
   <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
}


cookie_func() <span class="hljs-comment"># Give the user the option to use a different cookie file.</span>
{
<span class="hljs-keyword">while</span> [ 1 ]; <span class="hljs-keyword">do</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Change the cookies file. Press return if you don't want to change 
it."</span>
   <span class="hljs-built_in">read</span> Cookies
   <span class="hljs-comment"># NB: this is not the same as Cookie, earlier.</span>
   <span class="hljs-comment"># There is an 's' on the end.</span>
   <span class="hljs-comment"># Bit like chocolate chips.</span>
   <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$Cookies</span>"</span> ]; <span class="hljs-keyword">then</span>                 <span class="hljs-comment"># Escape clause for wusses.</span>
      <span class="hljs-built_in">return</span>
   <span class="hljs-keyword">elif</span> [ ! -e <span class="hljs-string">"<span class="hljs-variable">$Cookies</span>"</span> ]; <span class="hljs-keyword">then</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"File does not exist.  Try again."</span> <span class="hljs-comment"># Keep em going . . .</span>
   <span class="hljs-keyword">else</span>
       CookiesON=<span class="hljs-string">" --load-cookies <span class="hljs-variable">$Cookies</span>"</span>   <span class="hljs-comment"># File is good -- use it!</span>
       <span class="hljs-built_in">return</span>
   <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
}



<span class="hljs-function"><span class="hljs-title">run_func</span></span>()
{
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$OPTARG</span>"</span> ]; <span class="hljs-keyword">then</span>
<span class="hljs-comment"># Test to see if we used the in-line option or the query one.</span>
   <span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">"<span class="hljs-variable">$savePath</span>"</span> ]; <span class="hljs-keyword">then</span>      <span class="hljs-comment"># If directory doesn't exist . . .</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$savePath</span> does not appear to exist."</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"Please supply path and filename of saved wget commands:"</span>
      <span class="hljs-built_in">read</span> newFile
         until [ -f <span class="hljs-string">"<span class="hljs-variable">$newFile</span>"</span> ]; <span class="hljs-keyword">do</span>  <span class="hljs-comment"># Keep going till we get something.</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"Sorry, that file does not exist.  Please try again."</span>
            <span class="hljs-comment"># Try really hard to get something.</span>
            <span class="hljs-built_in">read</span> newFile
         <span class="hljs-keyword">done</span>


<span class="hljs-comment"># -----------------------------------------------------------------------</span>
<span class="hljs-comment">#       if [ -z ( grep wget ${newfile} ) ]; then</span>
        <span class="hljs-comment"># Assume they haven't got the right file and bail out.</span>
<span class="hljs-comment">#       echo "Sorry, that file does not contain wget commands.  Aborting."</span>
<span class="hljs-comment">#       exit</span>
<span class="hljs-comment">#       fi</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># This is bogus code.</span>
<span class="hljs-comment"># It doesn't actually work.</span>
<span class="hljs-comment"># If anyone wants to fix it, feel free!</span>
<span class="hljs-comment"># -----------------------------------------------------------------------</span>


      filePath=<span class="hljs-string">"<span class="hljs-variable">${newFile}</span>"</span>
   <span class="hljs-keyword">else</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Save path is <span class="hljs-variable">$savePath</span>"</span>
     <span class="hljs-built_in">echo</span> <span class="hljs-string">"Please enter name of the file which you want to use."</span>
     <span class="hljs-built_in">echo</span> <span class="hljs-string">"You have a choice of:"</span>
     ls <span class="hljs-variable">$savePath</span>                                    <span class="hljs-comment"># Give them a choice.</span>
     <span class="hljs-built_in">read</span> inFile
       until [ -f <span class="hljs-string">"<span class="hljs-variable">$savePath</span>/<span class="hljs-variable">$inFile</span>"</span> ]; <span class="hljs-keyword">do</span>         <span class="hljs-comment">#  Keep going till</span>
                                                    <span class="hljs-comment">#+ we get something.</span>
          <span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">"<span class="hljs-variable">${savePath}</span>/<span class="hljs-variable">${inFile}</span>"</span> ]; <span class="hljs-keyword">then</span> <span class="hljs-comment"># If file doesn't exist.</span>
             <span class="hljs-built_in">echo</span> <span class="hljs-string">"Sorry, that file does not exist.  Please choose from:"</span>
             ls <span class="hljs-variable">$savePath</span>                           <span class="hljs-comment"># If a mistake is made.</span>
             <span class="hljs-built_in">read</span> inFile
          <span class="hljs-keyword">fi</span>
         <span class="hljs-keyword">done</span>
      filePath=<span class="hljs-string">"<span class="hljs-variable">${savePath}</span>/<span class="hljs-variable">${inFile}</span>"</span>  <span class="hljs-comment"># Make one variable . . .</span>
   <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">else</span> filePath=<span class="hljs-string">"<span class="hljs-variable">${savePath}</span>/<span class="hljs-variable">${OPTARG}</span>"</span>   <span class="hljs-comment"># Which can be many things . . .</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">"<span class="hljs-variable">$filePath</span>"</span> ]; <span class="hljs-keyword">then</span>           <span class="hljs-comment"># If a bogus file got through.</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"You did not specify a suitable file."</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Run this script with the -<span class="hljs-variable">${save}</span> option first."</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Aborting."</span>
   <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NO_SAVEFILE</span>
<span class="hljs-keyword">fi</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Using: <span class="hljs-variable">$filePath</span>"</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">eval</span> <span class="hljs-variable">$REPLY</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Completed: <span class="hljs-variable">$REPLY</span>"</span>
<span class="hljs-keyword">done</span> &lt; <span class="hljs-variable">$filePath</span>  <span class="hljs-comment"># Feed the actual file we are using into a 'while' loop.</span>

<span class="hljs-built_in">exit</span>
}



<span class="hljs-comment"># Fish out any options we are using for the script.</span>
<span class="hljs-comment"># This is based on the demo in "Learning The Bash Shell" (O'Reilly).</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">getopts</span> <span class="hljs-string">":<span class="hljs-variable">$save</span><span class="hljs-variable">$cook</span><span class="hljs-variable">$help</span><span class="hljs-variable">$list</span><span class="hljs-variable">$runn</span>:<span class="hljs-variable">$inpu</span><span class="hljs-variable">$wopt</span>"</span> opt
<span class="hljs-keyword">do</span>
  <span class="hljs-keyword">case</span> <span class="hljs-variable">$opt</span> <span class="hljs-keyword">in</span>
     <span class="hljs-variable">$save</span>) save_func;;   <span class="hljs-comment">#  Save some wgetter sessions for later.</span>
     <span class="hljs-variable">$cook</span>) cookie_func;; <span class="hljs-comment">#  Change cookie file.</span>
     <span class="hljs-variable">$help</span>) usage;;       <span class="hljs-comment">#  Get help.</span>
     <span class="hljs-variable">$list</span>) list_func;;   <span class="hljs-comment">#  Allow wget to use a list of URLs.</span>
     <span class="hljs-variable">$runn</span>) run_func;;    <span class="hljs-comment">#  Useful if you are calling wgetter from,</span>
                          <span class="hljs-comment">#+ for example, a cron script.</span>
     <span class="hljs-variable">$inpu</span>) run_func;;    <span class="hljs-comment">#  When you don't know what your files are named.</span>
     <span class="hljs-variable">$wopt</span>) wopts;;       <span class="hljs-comment">#  Pass options directly to wget.</span>
        \?) <span class="hljs-built_in">echo</span> <span class="hljs-string">"Not a valid option."</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"Use -<span class="hljs-variable">${wopt}</span> to pass options directly to wget,"</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"or -<span class="hljs-variable">${help}</span> for help"</span>;;      <span class="hljs-comment"># Catch anything else.</span>
  <span class="hljs-keyword">esac</span>
<span class="hljs-keyword">done</span>
<span class="hljs-built_in">shift</span> $((OPTIND - <span class="hljs-number">1</span>))     <span class="hljs-comment"># Do funky magic stuff with $#.</span>


<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ] &amp;&amp; [ -z <span class="hljs-string">"<span class="hljs-variable">$lister</span>"</span> ]; <span class="hljs-keyword">then</span>
                          <span class="hljs-comment">#  We should be left with at least one URL</span>
                          <span class="hljs-comment">#+ on the command-line, unless a list is </span>
                          <span class="hljs-comment">#+ being used -- catch empty CL's.</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"No URL's given! You must enter them on the same line as wgetter2."</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"E.g.,  wgetter2 http://somesite http://anothersite."</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Use <span class="hljs-variable">$help</span> option for more information."</span>
   <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NO_URLS</span>        <span class="hljs-comment"># Bail out, with appropriate error code.</span>
<span class="hljs-keyword">fi</span>

URLS=<span class="hljs-string">" <span class="hljs-variable">$@</span>"</span>
<span class="hljs-comment"># Use this so that URL list can be changed if we stay in the option loop.</span>

<span class="hljs-keyword">while</span> [ 1 ]; <span class="hljs-keyword">do</span>
   <span class="hljs-comment"># This is where we ask for the most used options.</span>
   <span class="hljs-comment"># (Mostly unchanged from version 1 of wgetter)</span>
   <span class="hljs-keyword">if</span> [ -z <span class="hljs-variable">$curDepth</span> ]; <span class="hljs-keyword">then</span>
      Current=<span class="hljs-string">""</span>
   <span class="hljs-keyword">else</span> Current=<span class="hljs-string">" Current value is <span class="hljs-variable">$curDepth</span>"</span>
   <span class="hljs-keyword">fi</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"How deep should I go? \
(integer: Default is <span class="hljs-variable">$depthDefault</span>.<span class="hljs-variable">$Current</span>)"</span>
       <span class="hljs-built_in">read</span> Depth   <span class="hljs-comment"># Recursion -- how far should we go?</span>
       inputB=<span class="hljs-string">""</span>    <span class="hljs-comment"># Reset this to blank on each pass of the loop.</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"Enter the name of the referring page (default is none)."</span>
       <span class="hljs-built_in">read</span> inputB  <span class="hljs-comment"># Need this for some sites.</span>

       <span class="hljs-built_in">echo</span> <span class="hljs-string">"Do you want to have the output logged to the terminal"</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"(y/n, default is yes)?"</span>
       <span class="hljs-built_in">read</span> noHide  <span class="hljs-comment"># Otherwise wget will just log it to a file.</span>

       <span class="hljs-keyword">case</span> <span class="hljs-variable">$noHide</span> <span class="hljs-keyword">in</span>    <span class="hljs-comment"># Now you see me, now you don't.</span>
          y|Y ) hide=<span class="hljs-string">""</span>;;
          n|N ) hide=<span class="hljs-string">" -b"</span>;;
            * ) hide=<span class="hljs-string">""</span>;;
       <span class="hljs-keyword">esac</span>

       <span class="hljs-keyword">if</span> [ -z <span class="hljs-variable">${Depth}</span> ]; <span class="hljs-keyword">then</span>
       <span class="hljs-comment">#  User accepted either default or current depth,</span>
       <span class="hljs-comment">#+ in which case Depth is now empty.</span>
          <span class="hljs-keyword">if</span> [ -z <span class="hljs-variable">${curDepth}</span> ]; <span class="hljs-keyword">then</span>
          <span class="hljs-comment">#  See if a depth was set on a previous iteration.</span>
             Depth=<span class="hljs-string">"<span class="hljs-variable">$depthDefault</span>"</span>
             <span class="hljs-comment">#  Set the default recursion depth if nothing</span>
             <span class="hljs-comment">#+ else to use.</span>
          <span class="hljs-keyword">else</span> Depth=<span class="hljs-string">"<span class="hljs-variable">$curDepth</span>"</span> <span class="hljs-comment">#  Otherwise, set the one we used before.</span>
          <span class="hljs-keyword">fi</span>
       <span class="hljs-keyword">fi</span>
   Recurse=<span class="hljs-string">" -l <span class="hljs-variable">$Depth</span>"</span>          <span class="hljs-comment"># Set how deep we want to go.</span>
   curDepth=<span class="hljs-variable">$Depth</span>               <span class="hljs-comment"># Remember setting for next time.</span>

       <span class="hljs-keyword">if</span> [ ! -z <span class="hljs-variable">$inputB</span> ]; <span class="hljs-keyword">then</span>
          RefA=<span class="hljs-string">" --referer=<span class="hljs-variable">$inputB</span>"</span>   <span class="hljs-comment"># Option to use referring page.</span>
       <span class="hljs-keyword">fi</span>

   WGETTER=<span class="hljs-string">"<span class="hljs-variable">${CommandA}</span><span class="hljs-variable">${pattern}</span><span class="hljs-variable">${hide}</span><span class="hljs-variable">${RefA}</span><span class="hljs-variable">${Recurse}</span>\
<span class="hljs-variable">${CookiesON}</span><span class="hljs-variable">${lister}</span><span class="hljs-variable">${Woptions}</span><span class="hljs-variable">${URLS}</span>"</span>
   <span class="hljs-comment">#  Just string the whole lot together . . .</span>
   <span class="hljs-comment">#  NB: no embedded spaces.</span>
   <span class="hljs-comment">#  They are in the individual elements so that if any are empty,</span>
   <span class="hljs-comment">#+ we don't get an extra space.</span>

   <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">${CookiesON}</span>"</span> ] &amp;&amp; [ <span class="hljs-string">"<span class="hljs-variable">$cFlag</span>"</span> = <span class="hljs-string">"1"</span> ] ; <span class="hljs-keyword">then</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning -- can't find cookie file"</span>
       <span class="hljs-comment">#  This should be changed,</span>
       <span class="hljs-comment">#+ in case the user has opted to not use cookies.</span>
   <span class="hljs-keyword">fi</span>

   <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$Flag</span>"</span> = <span class="hljs-string">"S"</span> ]; <span class="hljs-keyword">then</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$WGETTER</span>"</span> &gt;&gt; <span class="hljs-variable">$savePath</span>/wget-<span class="hljs-variable">${today}</span>
      <span class="hljs-comment">#  Create a unique filename for today, or append to it if it exists.</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$inputB</span>"</span> &gt;&gt; <span class="hljs-variable">$savePath</span>/site-list-<span class="hljs-variable">${today}</span>
      <span class="hljs-comment">#  Make a list, so it's easy to refer back to,</span>
      <span class="hljs-comment">#+ since the whole command is a bit confusing to look at.</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"Command saved to the file <span class="hljs-variable">$savePath</span>/wget-<span class="hljs-variable">${today}</span>"</span>
           <span class="hljs-comment"># Tell the user.</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"Referring page URL saved to the file$ \
savePath/site-list-<span class="hljs-variable">${today}</span>"</span>
           <span class="hljs-comment"># Tell the user.</span>
      Saver=<span class="hljs-string">" with save option"</span>
      <span class="hljs-comment"># Stick this somewhere, so it appears in the loop if set.</span>
   <span class="hljs-keyword">else</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"*****************"</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"*****Getting*****"</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"*****************"</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$WGETTER</span>"</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"*****************"</span>
       <span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-variable">$WGETTER</span>"</span>
   <span class="hljs-keyword">fi</span>

       <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"Starting over<span class="hljs-variable">$Saver</span>."</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"If you want to stop, press q."</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"Otherwise, enter some URL's:"</span>
       <span class="hljs-comment"># Let them go again. Tell about save option being set.</span>

       <span class="hljs-built_in">read</span>
       <span class="hljs-keyword">case</span> <span class="hljs-variable">$REPLY</span> <span class="hljs-keyword">in</span>
       <span class="hljs-comment"># Need to change this to a 'trap' clause.</span>
          q|Q ) <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_USER_EXIT</span>;;  <span class="hljs-comment"># Exercise for the reader?</span>
            * ) URLS=<span class="hljs-string">" <span class="hljs-variable">$REPLY</span>"</span>;;
       <span class="hljs-keyword">esac</span>

       <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-keyword">done</span>


<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="BASHPODDER" id="BASHPODDER"></a>
        <p>
          <b>Example A-31. A <i class="FIRSTTERM">podcasting</i> script</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment">#  bashpodder.sh:</span>
<span class="hljs-comment">#  By Linc 10/1/2004</span>
<span class="hljs-comment">#  Find the latest script at</span>
<span class="hljs-comment">#+ http://linc.homeunix.org:8080/scripts/bashpodder</span>
<span class="hljs-comment">#  Last revision 12/14/2004 - Many Contributors!</span>
<span class="hljs-comment">#  If you use this and have made improvements or have comments</span>
<span class="hljs-comment">#+ drop me an email at linc dot fessenden at gmail dot com</span>
<span class="hljs-comment">#  I'd appreciate it!</span>

<span class="hljs-comment"># ==&gt;  ABS Guide extra comments.</span>

<span class="hljs-comment"># ==&gt;  Author of this script has kindly granted permission</span>
<span class="hljs-comment"># ==&gt;+ for inclusion in ABS Guide.</span>


<span class="hljs-comment"># ==&gt; ################################################################</span>
<span class="hljs-comment"># </span>
<span class="hljs-comment"># ==&gt; What is "podcasting"?</span>

<span class="hljs-comment"># ==&gt; It's broadcasting "radio shows" over the Internet.</span>
<span class="hljs-comment"># ==&gt; These shows can be played on iPods and other music file players.</span>

<span class="hljs-comment"># ==&gt; This script makes it possible.</span>
<span class="hljs-comment"># ==&gt; See documentation at the script author's site, above.</span>

<span class="hljs-comment"># ==&gt; ################################################################</span>


<span class="hljs-comment"># Make script crontab friendly:</span>
<span class="hljs-built_in">cd</span> $(dirname <span class="hljs-variable">$0</span>)
<span class="hljs-comment"># ==&gt; Change to directory where this script lives.</span>

<span class="hljs-comment"># datadir is the directory you want podcasts saved to:</span>
datadir=$(date +%Y-%m-%d)
<span class="hljs-comment"># ==&gt; Will create a date-labeled directory, named: YYYY-MM-DD</span>

<span class="hljs-comment"># Check for and create datadir if necessary:</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> ! -d <span class="hljs-variable">$datadir</span>
        <span class="hljs-keyword">then</span>
        mkdir <span class="hljs-variable">$datadir</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Delete any temp file:</span>
rm -f temp.log

<span class="hljs-comment">#  Read the bp.conf file and wget any url not already</span>
<span class="hljs-comment">#+ in the podcast.log file:</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> podcast
  <span class="hljs-keyword">do</span> <span class="hljs-comment"># ==&gt; Main action follows.</span>
  file=$(wget -q <span class="hljs-variable">$podcast</span> -O - | tr <span class="hljs-string">'\r'</span> <span class="hljs-string">'\n'</span> | tr \<span class="hljs-string">' \" | \
sed -n '</span>s/.*url=<span class="hljs-string">"\([^"</span>]*\)<span class="hljs-string">".*/\1/p')
  for url in <span class="hljs-variable">$file</span>
                do
                echo <span class="hljs-variable">$url</span> &gt;&gt; temp.log
                if ! grep "</span><span class="hljs-variable">$url</span><span class="hljs-string">" podcast.log &gt; /dev/null
                        then
                        wget -q -P <span class="hljs-variable">$datadir</span> "</span><span class="hljs-variable">$url</span><span class="hljs-string">"
                fi
                done
    done &lt; bp.conf

# Move dynamically created log file to permanent log file:
cat podcast.log &gt;&gt; temp.log
sort temp.log | uniq &gt; podcast.log
rm temp.log
# Create an m3u playlist:
ls <span class="hljs-variable">$datadir</span> | grep -v m3u &gt; <span class="hljs-variable">$datadir</span>/podcast.m3u


exit 0

#################################################
For a different scripting approach to Podcasting,
see Phil Salkie's article, 
"</span>Internet Radio to Podcast with Shell Tools<span class="hljs-string">"
in the September, 2005 issue of LINUX JOURNAL,
http://www.linuxjournal.com/article/8171
#################################################</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="NIGHTLYBACKUP" id="NIGHTLYBACKUP"></a>
        <p><b>Example A-32. Nightly backup to a firewire HD</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># nightly-backup.sh</span>
<span class="hljs-comment"># http://www.richardneill.org/source.php#nightly-backup-rsync</span>
<span class="hljs-comment"># Copyright (c) 2005 Richard Neill &lt;backup@richardneill.org&gt;.</span>
<span class="hljs-comment"># This is Free Software licensed under the GNU GPL.</span>
<span class="hljs-comment"># ==&gt; Included in ABS Guide with script author's kind permission.</span>
<span class="hljs-comment"># ==&gt; (Thanks!)</span>

<span class="hljs-comment">#  This does a backup from the host computer to a locally connected</span>
<span class="hljs-comment">#+ firewire HDD using rsync and ssh.</span>
<span class="hljs-comment">#  (Script should work with USB-connected device (see lines 40-43).</span>
<span class="hljs-comment">#  It then rotates the backups.</span>
<span class="hljs-comment">#  Run it via cron every night at 5am.</span>
<span class="hljs-comment">#  This only backs up the home directory.</span>
<span class="hljs-comment">#  If ownerships (other than the user's) should be preserved,</span>
<span class="hljs-comment">#+ then run the rsync process as root (and re-instate the -o).</span>
<span class="hljs-comment">#  We save every day for 7 days, then every week for 4 weeks,</span>
<span class="hljs-comment">#+ then every month for 3 months.</span>

<span class="hljs-comment">#  See: http://www.mikerubel.org/computers/rsync_snapshots/</span>
<span class="hljs-comment">#+ for more explanation of the theory.</span>
<span class="hljs-comment">#  Save as: $HOME/bin/nightly-backup_firewire-hdd.sh</span>

<span class="hljs-comment">#  Known bugs:</span>
<span class="hljs-comment">#  ----------</span>
<span class="hljs-comment">#  i)  Ideally, we want to exclude ~/.tmp and the browser caches.</span>

<span class="hljs-comment">#  ii) If the user is sitting at the computer at 5am,</span>
<span class="hljs-comment">#+     and files are modified while the rsync is occurring,</span>
<span class="hljs-comment">#+     then the BACKUP_JUSTINCASE branch gets triggered.</span>
<span class="hljs-comment">#      To some extent, this is a </span>
<span class="hljs-comment">#+     feature, but it also causes a "disk-space leak".</span>





<span class="hljs-comment">##### BEGIN CONFIGURATION SECTION ############################################</span>
LOCAL_USER=rjn                <span class="hljs-comment"># User whose home directory should be backed up.</span>
MOUNT_POINT=/backup           <span class="hljs-comment"># Mountpoint of backup drive.</span>
                              <span class="hljs-comment"># NO trailing slash!</span>
                              <span class="hljs-comment"># This must be unique (eg using a udev symlink)</span>
<span class="hljs-comment"># MOUNT_POINT=/media/disk     # For USB-connected device.</span>
SOURCE_DIR=/home/<span class="hljs-variable">$LOCAL_USER</span>  <span class="hljs-comment"># NO trailing slash - it DOES matter to rsync.</span>
BACKUP_DEST_DIR=<span class="hljs-variable">$MOUNT_POINT</span>/backup/`hostname -s`.<span class="hljs-variable">${LOCAL_USER}</span>.nightly_backup
DRY_RUN=<span class="hljs-literal">false</span>                 <span class="hljs-comment">#If true, invoke rsync with -n, to do a dry run.</span>
                              <span class="hljs-comment"># Comment out or set to false for normal use.</span>
VERBOSE=<span class="hljs-literal">false</span>                 <span class="hljs-comment"># If true, make rsync verbose.</span>
                              <span class="hljs-comment"># Comment out or set to false otherwise.</span>
COMPRESS=<span class="hljs-literal">false</span>                <span class="hljs-comment"># If true, compress.</span>
                              <span class="hljs-comment"># Good for internet, bad on LAN.</span>
                              <span class="hljs-comment"># Comment out or set to false otherwise.</span>

<span class="hljs-comment">### Exit Codes ###</span>
E_VARS_NOT_SET=64
E_COMMANDLINE=65
E_MOUNT_FAIL=70
E_NOSOURCEDIR=71
E_UNMOUNTED=72
E_BACKUP=73
<span class="hljs-comment">##### END CONFIGURATION SECTION ##############################################</span>


<span class="hljs-comment"># Check that all the important variables have been set:</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$LOCAL_USER</span>"</span> ] ||
   [ -z <span class="hljs-string">"<span class="hljs-variable">$SOURCE_DIR</span>"</span> ] ||
   [ -z <span class="hljs-string">"<span class="hljs-variable">$MOUNT_POINT</span>"</span> ]  ||
   [ -z <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DEST_DIR</span>"</span> ]
<span class="hljs-keyword">then</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">'One of the variables is not set! Edit the file: $0. BACKUP FAILED.'</span>
   <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_VARS_NOT_SET</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$#</span>"</span> != 0 ]  <span class="hljs-comment"># If command-line param(s) . . .</span>
<span class="hljs-keyword">then</span>              <span class="hljs-comment"># Here document(ation).</span>
  cat &lt;&lt;-ENDOFTEXT
    Automatic Nightly backup run from cron.
    Read the <span class="hljs-built_in">source</span> <span class="hljs-keyword">for</span> more details: <span class="hljs-variable">$0</span>
    The backup directory is <span class="hljs-variable">$BACKUP_DEST_DIR</span> .
    It will be created <span class="hljs-keyword">if</span> necessary; initialisation is no longer required.

    WARNING: Contents of <span class="hljs-variable">$BACKUP_DEST_DIR</span> are rotated.
    Directories named <span class="hljs-string">'backup.\$i'</span> will eventually be DELETED.
    We keep backups from every day <span class="hljs-keyword">for</span> 7 days (1-8),
    <span class="hljs-keyword">then</span> every week <span class="hljs-keyword">for</span> 4 weeks (9-12),
    <span class="hljs-keyword">then</span> every month <span class="hljs-keyword">for</span> 3 months (13-15).

    You may wish to add this to your crontab using <span class="hljs-string">'crontab -e'</span>
    <span class="hljs-comment">#  Back up files: $SOURCE_DIR to $BACKUP_DEST_DIR</span>
    <span class="hljs-comment">#+ every night at 3:15 am</span>
         15 03 * * * /home/<span class="hljs-variable">$LOCAL_USER</span>/bin/nightly-backup_firewire-hdd.sh

    Don<span class="hljs-string">'t forget to verify the backups are working,
    especially if you don'</span>t <span class="hljs-built_in">read</span> cron<span class="hljs-string">'s mail!"
        ENDOFTEXT
   exit $E_COMMANDLINE
fi


# Parse the options.
# ==================

if [ "$DRY_RUN" == "true" ]; then
  DRY_RUN="-n"
  echo "WARNING:"
  echo "THIS IS A '</span>DRY RUN<span class="hljs-string">'!"
  echo "No data will actually be transferred!"
else
  DRY_RUN=""
fi

if [ "$VERBOSE" == "true" ]; then
  VERBOSE="-v"
else
  VERBOSE=""
fi

if [ "$COMPRESS" == "true" ]; then
  COMPRESS="-z"
else
  COMPRESS=""
fi


#  Every week (actually of 8 days) and every month,
#+ extra backups are preserved.
DAY_OF_MONTH=`date +%d`            # Day of month (01..31).
if [ $DAY_OF_MONTH = 01 ]; then    # First of month.
  MONTHSTART=true
elif [ $DAY_OF_MONTH = 08 \
    -o $DAY_OF_MONTH = 16 \
    -o $DAY_OF_MONTH = 24 ]; then
    # Day 8,16,24  (use 8, not 7 to better handle 31-day months)
      WEEKSTART=true
fi



#  Check that the HDD is mounted.
#  At least, check that *something* is mounted here!
#  We can use something unique to the device, rather than just guessing
#+ the scsi-id by having an appropriate udev rule in
#+ /etc/udev/rules.d/10-rules.local
#+ and by putting a relevant entry in /etc/fstab.
#  Eg: this udev rule:
# BUS="scsi", KERNEL="sd*", SYSFS{vendor}="WDC WD16",
# SYSFS{model}="00JB-00GVA0     ", NAME="%k", SYMLINK="lacie_1394d%n"

if mount | grep $MOUNT_POINT &gt;/dev/null; then
  echo "Mount point $MOUNT_POINT is indeed mounted. OK"
else
  echo -n "Attempting to mount $MOUNT_POINT..." 
           # If it isn'</span>t mounted, try to mount it.
  sudo mount <span class="hljs-variable">$MOUNT_POINT</span> 2&gt;/dev/null

  <span class="hljs-keyword">if</span> mount | grep <span class="hljs-variable">$MOUNT_POINT</span> &gt;/dev/null; <span class="hljs-keyword">then</span>
    UNMOUNT_LATER=TRUE
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"OK"</span>
    <span class="hljs-comment">#  Note: Ensure that this is also unmounted</span>
    <span class="hljs-comment">#+ if we exit prematurely with failure.</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"FAILED"</span>
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"Nothing is mounted at <span class="hljs-variable">$MOUNT_POINT</span>. BACKUP FAILED!"</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_MOUNT_FAIL</span>
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>


<span class="hljs-comment"># Check that source dir exists and is readable.</span>
<span class="hljs-keyword">if</span> [ ! -r  <span class="hljs-variable">$SOURCE_DIR</span> ] ; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$SOURCE_DIR</span> does not exist, or cannot be read. BACKUP FAILED."</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOSOURCEDIR</span>
<span class="hljs-keyword">fi</span>


<span class="hljs-comment"># Check that the backup directory structure is as it should be.</span>
<span class="hljs-comment"># If not, create it.</span>
<span class="hljs-comment"># Create the subdirectories.</span>
<span class="hljs-comment"># Note that backup.0 will be created as needed by rsync.</span>

<span class="hljs-keyword">for</span> ((i=1;i&lt;=15;i++)); <span class="hljs-keyword">do</span>
  <span class="hljs-keyword">if</span> [ ! -d <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.<span class="hljs-variable">$i</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">if</span> /bin/mkdir -p <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.<span class="hljs-variable">$i</span> ; <span class="hljs-keyword">then</span>
    <span class="hljs-comment">#  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^  No [ ] test brackets. Why?</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: directory <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.<span class="hljs-variable">$i</span> is missing,"</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"or was not initialised. (Re-)creating it."</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"ERROR: directory <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.<span class="hljs-variable">$i</span>"</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"is missing and could not be created."</span>
    <span class="hljs-keyword">if</span>  [ <span class="hljs-string">"<span class="hljs-variable">$UNMOUNT_LATER</span>"</span> == <span class="hljs-string">"TRUE"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-comment"># Before we exit, unmount the mount point if necessary.</span>
        <span class="hljs-built_in">cd</span>
        sudo umount <span class="hljs-variable">$MOUNT_POINT</span> &amp;&amp;
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Unmounted <span class="hljs-variable">$MOUNT_POINT</span> again. Giving up."</span>
    <span class="hljs-keyword">fi</span>
      <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_UNMOUNTED</span>
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>


<span class="hljs-comment">#  Set the permission to 700 for security</span>
<span class="hljs-comment">#+ on an otherwise permissive multi-user system.</span>
<span class="hljs-keyword">if</span> ! /bin/chmod 700 <span class="hljs-variable">$BACKUP_DEST_DIR</span> ; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"ERROR: Could not set permissions on <span class="hljs-variable">$BACKUP_DEST_DIR</span> to 700."</span>

  <span class="hljs-keyword">if</span>  [ <span class="hljs-string">"<span class="hljs-variable">$UNMOUNT_LATER</span>"</span> == <span class="hljs-string">"TRUE"</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-comment"># Before we exit, unmount the mount point if necessary.</span>
     <span class="hljs-built_in">cd</span> ; sudo umount <span class="hljs-variable">$MOUNT_POINT</span> \
     &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">"Unmounted <span class="hljs-variable">$MOUNT_POINT</span> again. Giving up."</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_UNMOUNTED</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Create the symlink: current -&gt; backup.1 if required.</span>
<span class="hljs-comment"># A failure here is not critical.</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$BACKUP_DEST_DIR</span>
<span class="hljs-keyword">if</span> [ ! -h current ] ; <span class="hljs-keyword">then</span>
  <span class="hljs-keyword">if</span> ! /bin/ln -s backup.1 current ; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"WARNING: could not create symlink current -&gt; backup.1"</span>
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>


<span class="hljs-comment"># Now, do the rsync.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Now doing backup with rsync..."</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Source dir: <span class="hljs-variable">$SOURCE_DIR</span>"</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"Backup destination dir: <span class="hljs-variable">$BACKUP_DEST_DIR</span>\n"</span>


/usr/bin/rsync <span class="hljs-variable">$DRY_RUN</span> <span class="hljs-variable">$VERBOSE</span> -a -S --delete --modify-window=60 \
--link-dest=../backup.1 <span class="hljs-variable">$SOURCE_DIR</span> <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.0/

<span class="hljs-comment">#  Only warn, rather than exit if the rsync failed,</span>
<span class="hljs-comment">#+ since it may only be a minor problem.</span>
<span class="hljs-comment">#  E.g., if one file is not readable, rsync will fail.</span>
<span class="hljs-comment">#  This shouldn't prevent the rotation.</span>
<span class="hljs-comment">#  Not using, e.g., `date +%a`  since these directories</span>
<span class="hljs-comment">#+ are just full of links and don't consume *that much* space.</span>

<span class="hljs-keyword">if</span> [ $? != 0 ]; <span class="hljs-keyword">then</span>
  BACKUP_JUSTINCASE=backup.`date +%F_%T`.justincase
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"WARNING: the rsync process did not entirely succeed."</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Something might be wrong."</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Saving an extra copy at: <span class="hljs-variable">$BACKUP_JUSTINCASE</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"WARNING: if this occurs regularly, a LOT of space will be consumed,"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"even though these are just hard-links!"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Save a readme in the backup parent directory.</span>
<span class="hljs-comment"># Save another one in the recent subdirectory.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Backup of <span class="hljs-variable">$SOURCE_DIR</span> on `hostname` was last run on \
`date`"</span> &gt; <span class="hljs-variable">$BACKUP_DEST_DIR</span>/README.txt
<span class="hljs-built_in">echo</span> <span class="hljs-string">"This backup of <span class="hljs-variable">$SOURCE_DIR</span> on `hostname` was created on \
`date`"</span> &gt; <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.0/README.txt

<span class="hljs-comment"># If we are not in a dry run, rotate the backups.</span>
[ -z <span class="hljs-string">"<span class="hljs-variable">$DRY_RUN</span>"</span> ] &amp;&amp;

  <span class="hljs-comment">#  Check how full the backup disk is.</span>
  <span class="hljs-comment">#  Warn if 90%. if 98% or more, we'll probably fail, so give up.</span>
  <span class="hljs-comment">#  (Note: df can output to more than one line.)</span>
  <span class="hljs-comment">#  We test this here, rather than before</span>
  <span class="hljs-comment">#+ so that rsync may possibly have a chance.</span>
  DISK_FULL_PERCENT=`/bin/df <span class="hljs-variable">$BACKUP_DEST_DIR</span> |
  tr <span class="hljs-string">"\n"</span> <span class="hljs-string">' '</span> | awk <span class="hljs-string">'{print $12}'</span> | grep -oE [0-9]+ `
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Disk space check on backup partition \
  <span class="hljs-variable">$MOUNT_POINT</span> <span class="hljs-variable">$DISK_FULL_PERCENT</span>% full."</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$DISK_FULL_PERCENT</span> -gt 90 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: Disk is greater than 90% full."</span>
  <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$DISK_FULL_PERCENT</span> -gt 98 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error: Disk is full! Giving up."</span>
      <span class="hljs-keyword">if</span>  [ <span class="hljs-string">"<span class="hljs-variable">$UNMOUNT_LATER</span>"</span> == <span class="hljs-string">"TRUE"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-comment"># Before we exit, unmount the mount point if necessary.</span>
        <span class="hljs-built_in">cd</span>; sudo umount <span class="hljs-variable">$MOUNT_POINT</span> &amp;&amp;
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Unmounted <span class="hljs-variable">$MOUNT_POINT</span> again. Giving up."</span>
      <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_UNMOUNTED</span>
  <span class="hljs-keyword">fi</span>


 <span class="hljs-comment"># Create an extra backup.</span>
 <span class="hljs-comment"># If this copy fails, give up.</span>
 <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$BACKUP_JUSTINCASE</span>"</span> ]; <span class="hljs-keyword">then</span>
   <span class="hljs-keyword">if</span> ! /bin/cp -al <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.0 \
      <span class="hljs-variable">$BACKUP_DEST_DIR</span>/<span class="hljs-variable">$BACKUP_JUSTINCASE</span>
   <span class="hljs-keyword">then</span>
     <span class="hljs-built_in">echo</span> <span class="hljs-string">"ERROR: Failed to create extra copy \
     <span class="hljs-variable">$BACKUP_DEST_DIR</span>/<span class="hljs-variable">$BACKUP_JUSTINCASE</span>"</span>
     <span class="hljs-keyword">if</span>  [ <span class="hljs-string">"<span class="hljs-variable">$UNMOUNT_LATER</span>"</span> == <span class="hljs-string">"TRUE"</span> ]; <span class="hljs-keyword">then</span>
       <span class="hljs-comment"># Before we exit, unmount the mount point if necessary.</span>
       <span class="hljs-built_in">cd</span> ;sudo umount <span class="hljs-variable">$MOUNT_POINT</span> &amp;&amp;
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"Unmounted <span class="hljs-variable">$MOUNT_POINT</span> again. Giving up."</span>
     <span class="hljs-keyword">fi</span>
     <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_UNMOUNTED</span>
   <span class="hljs-keyword">fi</span>
 <span class="hljs-keyword">fi</span>


 <span class="hljs-comment"># At start of month, rotate the oldest 8.</span>
 <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$MONTHSTART</span>"</span> == <span class="hljs-string">"true"</span> ]; <span class="hljs-keyword">then</span>
   <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\nStart of month. \
   Removing oldest backup: <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.15"</span>  &amp;&amp;
   /bin/rm -rf  <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.15  &amp;&amp;
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Rotating monthly,weekly backups: \
   <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.[8-14] -&gt; <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.[9-15]"</span>  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.14 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.15  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.13 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.14  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.12 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.13  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.11 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.12  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.10 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.11  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.9 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.10  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.8 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.9

 <span class="hljs-comment"># At start of week, rotate the second-oldest 4.</span>
 <span class="hljs-keyword">elif</span> [ <span class="hljs-string">"<span class="hljs-variable">$WEEKSTART</span>"</span> == <span class="hljs-string">"true"</span> ]; <span class="hljs-keyword">then</span>
   <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\nStart of week. \
   Removing oldest weekly backup: <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.12"</span>  &amp;&amp;
   /bin/rm -rf  <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.12  &amp;&amp;

   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Rotating weekly backups: \
   <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.[8-11] -&gt; <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.[9-12]"</span>  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.11 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.12  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.10 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.11  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.9 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.10  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.8 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.9

 <span class="hljs-keyword">else</span>
   <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\nRemoving oldest daily backup: <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.8"</span>  &amp;&amp;
     /bin/rm -rf  <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.8

 <span class="hljs-keyword">fi</span>  &amp;&amp;

 <span class="hljs-comment"># Every day, rotate the newest 8.</span>
 <span class="hljs-built_in">echo</span> <span class="hljs-string">"Rotating daily backups: \
 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.[1-7] -&gt; <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.[2-8]"</span>  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.7 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.8  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.6 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.7  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.5 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.6  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.4 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.5  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.3 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.4  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.2 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.3  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.1 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.2  &amp;&amp;
     /bin/mv <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.0 <span class="hljs-variable">$BACKUP_DEST_DIR</span>/backup.1  &amp;&amp;

 SUCCESS=<span class="hljs-literal">true</span>


<span class="hljs-keyword">if</span>  [ <span class="hljs-string">"<span class="hljs-variable">$UNMOUNT_LATER</span>"</span> == <span class="hljs-string">"TRUE"</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-comment"># Unmount the mount point if it wasn't mounted to begin with.</span>
  <span class="hljs-built_in">cd</span> ; sudo umount <span class="hljs-variable">$MOUNT_POINT</span> &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">"Unmounted <span class="hljs-variable">$MOUNT_POINT</span> again."</span>
<span class="hljs-keyword">fi</span>


<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$SUCCESS</span>"</span> == <span class="hljs-string">"true"</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">'SUCCESS!'</span>
  <span class="hljs-built_in">exit</span> 0
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Should have already exited if backup worked.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'BACKUP FAILED! Is this just a dry run? Is the disk full?) '</span>
<span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BACKUP</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="CDLL" id="CDLL"></a>
        <p>
          <b>Example A-33. An expanded <i class="FIRSTTERM">cd</i> command</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-comment">###########################################################################</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       cdll</span>
<span class="hljs-comment">#       by Phil Braham</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       ############################################</span>
<span class="hljs-comment">#       Latest version of this script available from</span>
<span class="hljs-comment">#       http://freshmeat.net/projects/cd/</span>
<span class="hljs-comment">#       ############################################</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       .cd_new</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       An enhancement of the Unix cd command</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       There are unlimited stack entries and special entries. The stack</span>
<span class="hljs-comment">#       entries keep the last cd_maxhistory</span>
<span class="hljs-comment">#       directories that have been used. The special entries can be</span>
<span class="hljs-comment">#       assigned to commonly used directories.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       The special entries may be pre-assigned by setting the environment</span>
<span class="hljs-comment">#       variables CDSn or by using the -u or -U command.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       The following is a suggestion for the .profile file:</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#               . cdll              #  Set up the cd command</span>
<span class="hljs-comment">#       alias cd='cd_new'           #  Replace the cd command</span>
<span class="hljs-comment">#               cd -U               #  Upload pre-assigned entries for</span>
<span class="hljs-comment">#                                   #+ the stack and special entries</span>
<span class="hljs-comment">#               cd -D               #  Set non-default mode</span>
<span class="hljs-comment">#               alias @="cd_new @"  #  Allow @ to be used to get history</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       For help type:</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#               cd -h or</span>
<span class="hljs-comment">#               cd -H</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">###########################################################################</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       Version 1.2.1</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#       Written by Phil Braham - Realtime Software Pty Ltd</span>
<span class="hljs-comment">#       (realtime@mpx.com.au)</span>
<span class="hljs-comment">#       Please send any suggestions or enhancements to the author (also at</span>
<span class="hljs-comment">#       phil@braham.net)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">############################################################################</span>

<span class="hljs-function"><span class="hljs-title">cd_hm</span></span> ()
{
        <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"%s"</span> <span class="hljs-string">"cd [dir] [0-9] [@[s|h] [-g [&lt;dir&gt;]] [-d] \
[-D] [-r&lt;n&gt;] [dir|0-9] [-R&lt;n&gt;] [&lt;dir&gt;|0-9]
   [-s&lt;n&gt;] [-S&lt;n&gt;] [-u] [-U] [-f] [-F] [-h] [-H] [-v]
    &lt;dir&gt; Go to directory
    0-n         Go to previous directory (0 is previous, 1 is last but 1 etc)
                n is up to max history (default is 50)
    @           List history and special entries
    @h          List history entries
    @s          List special entries
    -g [&lt;dir&gt;]  Go to literal name (bypass special names)
                This is to allow access to dirs called '0','1','-h' etc
    -d          Change default action - verbose. (See note)
    -D          Change default action - silent. (See note)
    -s&lt;n&gt; Go to the special entry &lt;n&gt;*
    -S&lt;n&gt; Go to the special entry &lt;n&gt;
                and replace it with the current dir*
    -r&lt;n&gt; [&lt;dir&gt;] Go to directory &lt;dir&gt;
                              and then put it on special entry &lt;n&gt;*
    -R&lt;n&gt; [&lt;dir&gt;] Go to directory &lt;dir&gt;
                              and put current dir on special entry &lt;n&gt;*
    -a&lt;n&gt;       Alternative suggested directory. See note below.
    -f [&lt;file&gt;] File entries to &lt;file&gt;.
    -u [&lt;file&gt;] Update entries from &lt;file&gt;.
                If no filename supplied then default file
                (<span class="hljs-variable">${CDPath}</span><span class="hljs-variable">${2:-"$CDFile"}</span>) is used
                -F and -U are silent versions
    -v          Print version number
    -h          Help
    -H          Detailed help

    *The special entries (0 - 9) are held until log off, replaced by another
     entry or updated with the -u command

    Alternative suggested directories:
    If a directory is not found then CD will suggest any
    possibilities. These are directories starting with the same letters
    and if any are found they are listed prefixed with -a&lt;n&gt;
    where &lt;n&gt; is a number.
    It's possible to go to the directory by entering cd -a&lt;n&gt;
    on the command line.
    
    The directory for -r&lt;n&gt; or -R&lt;n&gt; may be a number.
    For example:
        $ cd -r3 4  Go to history entry 4 and put it on special entry 3
        $ cd -R3 4  Put current dir on the special entry 3
                    and go to history entry 4
        $ cd -s3    Go to special entry 3
    
    Note that commands R,r,S and s may be used without a number
    and refer to 0:
        $ cd -s     Go to special entry 0
        $ cd -S     Go to special entry 0 and make special
                    entry 0 current dir
        $ cd -r 1   Go to history entry 1 and put it on special entry 0
        $ cd -r     Go to history entry 0 and put it on special entry 0
    "</span>
        <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-string">"<span class="hljs-variable">$CD_MODE</span>"</span> = <span class="hljs-string">"PREV"</span>
        <span class="hljs-keyword">then</span>
                <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"<span class="hljs-variable">$cd_mnset</span>"</span>
        <span class="hljs-keyword">else</span>
                <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"<span class="hljs-variable">$cd_mset</span>"</span>
        <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">cd_Hm</span></span> ()
{
        cd_hm
        <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"%s"</span> <span class="hljs-string">"
        The previous directories (0-<span class="hljs-variable">$cd_maxhistory</span>) are stored in the
        environment variables CD[0] - CD[<span class="hljs-variable">$cd_maxhistory</span>]
        Similarly the special directories S0 - <span class="hljs-variable">$cd_maxspecial</span> are in
        the environment variable CDS[0] - CDS[<span class="hljs-variable">$cd_maxspecial</span>]
        and may be accessed from the command line

        The default pathname for the -f and -u commands is <span class="hljs-variable">$CDPath</span>
        The default filename for the -f and -u commands is <span class="hljs-variable">$CDFile</span>

        Set the following environment variables:
            CDL_PROMPTLEN  - Set to the length of prompt you require.
                Prompt string is set to the right characters of the
                current directory.
                If not set then prompt is left unchanged
            CDL_PROMPT_PRE - Set to the string to prefix the prompt.
                Default is:
                    non-root:  \"\\[\\e[01;34m\\]\"  (sets colour to blue).
                    root:      \"\\[\\e[01;31m\\]\"  (sets colour to red).
            CDL_PROMPT_POST    - Set to the string to suffix the prompt.
                Default is:
                    non-root:  \"\\[\\e[00m\\]$\"
                                (resets colour and displays $).
                    root:      \"\\[\\e[00m\\]#\"
                                (resets colour and displays #).
            CDPath - Set the default path for the -f &amp; -u options.
                     Default is home directory
            CDFile - Set the default filename for the -f &amp; -u options.
                     Default is cdfile
        
"</span>
    cd_version

}

<span class="hljs-function"><span class="hljs-title">cd_version</span></span> ()
{
 <span class="hljs-built_in">printf</span> <span class="hljs-string">"Version: <span class="hljs-variable">${VERSION_MAJOR}</span>.<span class="hljs-variable">${VERSION_MINOR}</span> Date: <span class="hljs-variable">${VERSION_DATE}</span>\n"</span>
}

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Truncate right.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># params:</span>
<span class="hljs-comment">#   p1 - string</span>
<span class="hljs-comment">#   p2 - length to truncate to</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># returns string in tcd</span>
<span class="hljs-comment">#</span>
<span class="hljs-function"><span class="hljs-title">cd_right_trunc</span></span> ()
{
    <span class="hljs-built_in">local</span> tlen=<span class="hljs-variable">${2}</span>
    <span class="hljs-built_in">local</span> plen=<span class="hljs-variable">${#1}</span>
    <span class="hljs-built_in">local</span> str=<span class="hljs-string">"<span class="hljs-variable">${1}</span>"</span>
    <span class="hljs-built_in">local</span> diff
    <span class="hljs-built_in">local</span> filler=<span class="hljs-string">"&lt;--"</span>
    <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">${plen}</span> -le <span class="hljs-variable">${tlen}</span>
    <span class="hljs-keyword">then</span>
        tcd=<span class="hljs-string">"<span class="hljs-variable">${str}</span>"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">let</span> diff=<span class="hljs-variable">${plen}</span>-<span class="hljs-variable">${tlen}</span>
        elen=3
        <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">${diff}</span> -le 2
        <span class="hljs-keyword">then</span>
            <span class="hljs-built_in">let</span> elen=<span class="hljs-variable">${diff}</span>
        <span class="hljs-keyword">fi</span>
        tlen=-<span class="hljs-variable">${tlen}</span>
        <span class="hljs-built_in">let</span> tlen=<span class="hljs-variable">${tlen}</span>+<span class="hljs-variable">${elen}</span>
        tcd=<span class="hljs-variable">${filler:0:elen}</span><span class="hljs-variable">${str:tlen}</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Three versions of do history:</span>
<span class="hljs-comment">#    cd_dohistory  - packs history and specials side by side</span>
<span class="hljs-comment">#    cd_dohistoryH - Shows only hstory</span>
<span class="hljs-comment">#    cd_dohistoryS - Shows only specials</span>
<span class="hljs-comment">#</span>
<span class="hljs-function"><span class="hljs-title">cd_dohistory</span></span> ()
{
    cd_getrc
        <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"History:\n"</span>
    <span class="hljs-built_in">local</span> -i count=<span class="hljs-variable">${cd_histcount}</span>
    <span class="hljs-keyword">while</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">${count}</span> -ge 0
    <span class="hljs-keyword">do</span>
        cd_right_trunc <span class="hljs-string">"<span class="hljs-variable">${CD[count]}</span>"</span> <span class="hljs-variable">${cd_lchar}</span>
            <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"%2d %-<span class="hljs-variable">${cd_lchar}</span>.<span class="hljs-variable">${cd_lchar}</span>s "</span> <span class="hljs-variable">${count}</span> <span class="hljs-string">"<span class="hljs-variable">${tcd}</span>"</span>

        cd_right_trunc <span class="hljs-string">"<span class="hljs-variable">${CDS[count]}</span>"</span> <span class="hljs-variable">${cd_rchar}</span>
            <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"S%d %-<span class="hljs-variable">${cd_rchar}</span>.<span class="hljs-variable">${cd_rchar}</span>s\n"</span> <span class="hljs-variable">${count}</span> <span class="hljs-string">"<span class="hljs-variable">${tcd}</span>"</span>
        count=<span class="hljs-variable">${count}</span>-1
    <span class="hljs-keyword">done</span>
}

<span class="hljs-function"><span class="hljs-title">cd_dohistoryH</span></span> ()
{
    cd_getrc
        <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"History:\n"</span>
        <span class="hljs-built_in">local</span> -i count=<span class="hljs-variable">${cd_maxhistory}</span>
        <span class="hljs-keyword">while</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">${count}</span> -ge 0
        <span class="hljs-keyword">do</span>
          <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"<span class="hljs-variable">${count}</span> %-<span class="hljs-variable">${cd_flchar}</span>.<span class="hljs-variable">${cd_flchar}</span>s\n"</span> <span class="hljs-variable">${CD[$count]}</span>
          count=<span class="hljs-variable">${count}</span>-1
        <span class="hljs-keyword">done</span>
}

<span class="hljs-function"><span class="hljs-title">cd_dohistoryS</span></span> ()
{
    cd_getrc
        <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"Specials:\n"</span>
        <span class="hljs-built_in">local</span> -i count=<span class="hljs-variable">${cd_maxspecial}</span>
        <span class="hljs-keyword">while</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">${count}</span> -ge 0
        <span class="hljs-keyword">do</span>
          <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"S<span class="hljs-variable">${count}</span> %-<span class="hljs-variable">${cd_flchar}</span>.<span class="hljs-variable">${cd_flchar}</span>s\n"</span> <span class="hljs-variable">${CDS[$count]}</span>
          count=<span class="hljs-variable">${count}</span>-1
        <span class="hljs-keyword">done</span>
}

<span class="hljs-function"><span class="hljs-title">cd_getrc</span></span> ()
{
    cd_flchar=$(stty -a | awk -F \;
    <span class="hljs-string">'/rows/ { print $2 $3 }'</span> | awk -F \  <span class="hljs-string">'{ print $4 }'</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">${cd_flchar}</span> -ne 0
    <span class="hljs-keyword">then</span>
        cd_lchar=<span class="hljs-variable">${cd_flchar}</span>/2-5
        cd_rchar=<span class="hljs-variable">${cd_flchar}</span>/2-5
            cd_flchar=<span class="hljs-variable">${cd_flchar}</span>-5
    <span class="hljs-keyword">else</span>
            cd_flchar=<span class="hljs-variable">${FLCHAR:=75}</span>
            <span class="hljs-comment"># cd_flchar is used for for the @s &amp; @h history</span>
            cd_lchar=<span class="hljs-variable">${LCHAR:=35}</span>
            cd_rchar=<span class="hljs-variable">${RCHAR:=35}</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">cd_doselection</span></span> ()
{
        <span class="hljs-built_in">local</span> -i nm=0
        cd_doflag=<span class="hljs-string">"TRUE"</span>
        <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-string">"<span class="hljs-variable">${CD_MODE}</span>"</span> = <span class="hljs-string">"PREV"</span>
        <span class="hljs-keyword">then</span>
                <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> -z <span class="hljs-string">"<span class="hljs-variable">$cd_npwd</span>"</span>
                <span class="hljs-keyword">then</span>
                        cd_npwd=0
                <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">fi</span>
        tm=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${cd_npwd}</span>"</span> | cut -b 1)
    <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-string">"<span class="hljs-variable">${tm}</span>"</span> = <span class="hljs-string">"-"</span>
    <span class="hljs-keyword">then</span>
        pm=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${cd_npwd}</span>"</span> | cut -b 2)
        nm=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${cd_npwd}</span>"</span> | cut -d <span class="hljs-variable">$pm</span> -f2)
        <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">${pm}</span>"</span> <span class="hljs-keyword">in</span>
             a) cd_npwd=<span class="hljs-variable">${cd_sugg[$nm]}</span> ;;
             s) cd_npwd=<span class="hljs-string">"<span class="hljs-variable">${CDS[$nm]}</span>"</span> ;;
             S) cd_npwd=<span class="hljs-string">"<span class="hljs-variable">${CDS[$nm]}</span>"</span> ; CDS[<span class="hljs-variable">$nm</span>]=`<span class="hljs-built_in">pwd</span>` ;;
             r) cd_npwd=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ; cd_specDir=<span class="hljs-variable">$nm</span> ; cd_doselection <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>;;
             R) cd_npwd=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ; CDS[<span class="hljs-variable">$nm</span>]=`<span class="hljs-built_in">pwd</span>` ; cd_doselection <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>;;
        <span class="hljs-keyword">esac</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-string">"<span class="hljs-variable">${cd_npwd}</span>"</span> != <span class="hljs-string">"."</span> -a <span class="hljs-string">"<span class="hljs-variable">${cd_npwd}</span>"</span> \
!= <span class="hljs-string">".."</span> -a <span class="hljs-string">"<span class="hljs-variable">${cd_npwd}</span>"</span> -le <span class="hljs-variable">${cd_maxhistory}</span> &gt;&gt;/dev/null 2&gt;&amp;1
    <span class="hljs-keyword">then</span>
      cd_npwd=<span class="hljs-variable">${CD[$cd_npwd]}</span>
     <span class="hljs-keyword">else</span>
       <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$cd_npwd</span>"</span> <span class="hljs-keyword">in</span>
                @)  cd_dohistory ; cd_doflag=<span class="hljs-string">"FALSE"</span> ;;
               @h) cd_dohistoryH ; cd_doflag=<span class="hljs-string">"FALSE"</span> ;;
               @s) cd_dohistoryS ; cd_doflag=<span class="hljs-string">"FALSE"</span> ;;
               -h) cd_hm ; cd_doflag=<span class="hljs-string">"FALSE"</span> ;;
               -H) cd_Hm ; cd_doflag=<span class="hljs-string">"FALSE"</span> ;;
               -f) cd_fsave <span class="hljs-string">"SHOW"</span> <span class="hljs-variable">$2</span> ; cd_doflag=<span class="hljs-string">"FALSE"</span> ;;
               -u) cd_upload <span class="hljs-string">"SHOW"</span> <span class="hljs-variable">$2</span> ; cd_doflag=<span class="hljs-string">"FALSE"</span> ;;
               -F) cd_fsave <span class="hljs-string">"NOSHOW"</span> <span class="hljs-variable">$2</span> ; cd_doflag=<span class="hljs-string">"FALSE"</span> ;;
               -U) cd_upload <span class="hljs-string">"NOSHOW"</span> <span class="hljs-variable">$2</span> ; cd_doflag=<span class="hljs-string">"FALSE"</span> ;;
               -g) cd_npwd=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ;;
               -d) cd_chdefm 1; cd_doflag=<span class="hljs-string">"FALSE"</span> ;;
               -D) cd_chdefm 0; cd_doflag=<span class="hljs-string">"FALSE"</span> ;;
               -r) cd_npwd=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ; cd_specDir=0 ; cd_doselection <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>;;
               -R) cd_npwd=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ; CDS[0]=`<span class="hljs-built_in">pwd</span>` ; cd_doselection <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>;;
               -s) cd_npwd=<span class="hljs-string">"<span class="hljs-variable">${CDS[0]}</span>"</span> ;;
               -S) cd_npwd=<span class="hljs-string">"<span class="hljs-variable">${CDS[0]}</span>"</span>  ; CDS[0]=`<span class="hljs-built_in">pwd</span>` ;;
               -v) cd_version ; cd_doflag=<span class="hljs-string">"FALSE"</span>;;
       <span class="hljs-keyword">esac</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">cd_chdefm</span></span> ()
{
        <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-string">"<span class="hljs-variable">${CD_MODE}</span>"</span> = <span class="hljs-string">"PREV"</span>
        <span class="hljs-keyword">then</span>
                CD_MODE=<span class="hljs-string">""</span>
                <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">$1</span> -eq 1
                <span class="hljs-keyword">then</span>
                        <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"<span class="hljs-variable">${cd_mset}</span>"</span>
                <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">else</span>
                CD_MODE=<span class="hljs-string">"PREV"</span>
                <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">$1</span> -eq 1
                <span class="hljs-keyword">then</span>
                        <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"<span class="hljs-variable">${cd_mnset}</span>"</span>
                <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">cd_fsave</span></span> ()
{
        <span class="hljs-built_in">local</span> sfile=<span class="hljs-variable">${CDPath}</span><span class="hljs-variable">${2:-"$CDFile"}</span>
        <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> = <span class="hljs-string">"SHOW"</span>
        <span class="hljs-keyword">then</span>
                <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"Saved to %s\n"</span> <span class="hljs-variable">$sfile</span>
        <span class="hljs-keyword">fi</span>
        <span class="hljs-variable">${RM}</span> -f <span class="hljs-variable">${sfile}</span>
        <span class="hljs-built_in">local</span> -i count=0
        <span class="hljs-keyword">while</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">${count}</span> -le <span class="hljs-variable">${cd_maxhistory}</span>
        <span class="hljs-keyword">do</span>
                <span class="hljs-built_in">echo</span> <span class="hljs-string">"CD[<span class="hljs-variable">$count</span>]=\"<span class="hljs-variable">${CD[$count]}</span>\""</span> &gt;&gt; <span class="hljs-variable">${sfile}</span>
                count=<span class="hljs-variable">${count}</span>+1
        <span class="hljs-keyword">done</span>
        count=0
        <span class="hljs-keyword">while</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">${count}</span> -le <span class="hljs-variable">${cd_maxspecial}</span>
        <span class="hljs-keyword">do</span>
                <span class="hljs-built_in">echo</span> <span class="hljs-string">"CDS[<span class="hljs-variable">$count</span>]=\"<span class="hljs-variable">${CDS[$count]}</span>\""</span> &gt;&gt; <span class="hljs-variable">${sfile}</span>
                count=<span class="hljs-variable">${count}</span>+1
        <span class="hljs-keyword">done</span>
}

<span class="hljs-function"><span class="hljs-title">cd_upload</span></span> ()
{
        <span class="hljs-built_in">local</span> sfile=<span class="hljs-variable">${CDPath}</span><span class="hljs-variable">${2:-"$CDFile"}</span>
        <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-string">"<span class="hljs-variable">${1}</span>"</span> = <span class="hljs-string">"SHOW"</span>
        <span class="hljs-keyword">then</span>
                <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"Loading from %s\n"</span> <span class="hljs-variable">${sfile}</span>
        <span class="hljs-keyword">fi</span>
        . <span class="hljs-variable">${sfile}</span>
}

<span class="hljs-function"><span class="hljs-title">cd_new</span></span> ()
{
    <span class="hljs-built_in">local</span> -i count
    <span class="hljs-built_in">local</span> -i choose=0

        cd_npwd=<span class="hljs-string">"<span class="hljs-variable">${1}</span>"</span>
        cd_specDir=-1
        cd_doselection <span class="hljs-string">"<span class="hljs-variable">${1}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${2}</span>"</span>

        <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">${cd_doflag}</span> = <span class="hljs-string">"TRUE"</span>
        <span class="hljs-keyword">then</span>
                <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-string">"<span class="hljs-variable">${CD[0]}</span>"</span> != <span class="hljs-string">"`pwd`"</span>
                <span class="hljs-keyword">then</span>
                        count=<span class="hljs-variable">$cd_maxhistory</span>
                        <span class="hljs-keyword">while</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">$count</span> -gt 0
                        <span class="hljs-keyword">do</span>
                                CD[<span class="hljs-variable">$count</span>]=<span class="hljs-variable">${CD[$count-1]}</span>
                                count=<span class="hljs-variable">${count}</span>-1
                        <span class="hljs-keyword">done</span>
                        CD[0]=`<span class="hljs-built_in">pwd</span>`
                <span class="hljs-keyword">fi</span>
                <span class="hljs-built_in">command</span> <span class="hljs-built_in">cd</span> <span class="hljs-string">"<span class="hljs-variable">${cd_npwd}</span>"</span> 2&gt;/dev/null
        <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> $? -eq 1
        <span class="hljs-keyword">then</span>
            <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"Unknown dir: %s\n"</span> <span class="hljs-string">"<span class="hljs-variable">${cd_npwd}</span>"</span>
            <span class="hljs-built_in">local</span> -i ftflag=0
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${cd_npwd}</span>"</span>*
            <span class="hljs-keyword">do</span>
                <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> -d <span class="hljs-string">"<span class="hljs-variable">${i}</span>"</span>
                <span class="hljs-keyword">then</span>
                    <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">${ftflag}</span> -eq 0
                    <span class="hljs-keyword">then</span>
                        <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"Suggest:\n"</span>
                        ftflag=1
                <span class="hljs-keyword">fi</span>
                    <span class="hljs-variable">${PRINTF}</span> <span class="hljs-string">"\t-a<span class="hljs-variable">${choose}</span> %s\n"</span> <span class="hljs-string">"<span class="hljs-variable">$i</span>"</span>
                                        cd_sugg[<span class="hljs-variable">$choose</span>]=<span class="hljs-string">"<span class="hljs-variable">${i}</span>"</span>
                    choose=<span class="hljs-variable">${choose}</span>+1
        <span class="hljs-keyword">fi</span>
            <span class="hljs-keyword">done</span>
        <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">fi</span>

        <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">${cd_specDir}</span> -ne -1
        <span class="hljs-keyword">then</span>
                CDS[<span class="hljs-variable">${cd_specDir}</span>]=`<span class="hljs-built_in">pwd</span>`
        <span class="hljs-keyword">fi</span>

        <span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> ! -z <span class="hljs-string">"<span class="hljs-variable">${CDL_PROMPTLEN}</span>"</span>
        <span class="hljs-keyword">then</span>
        cd_right_trunc <span class="hljs-string">"<span class="hljs-variable">${PWD}</span>"</span> <span class="hljs-variable">${CDL_PROMPTLEN}</span>
            cd_rp=<span class="hljs-variable">${CDL_PROMPT_PRE}</span><span class="hljs-variable">${tcd}</span><span class="hljs-variable">${CDL_PROMPT_POST}</span>
                <span class="hljs-built_in">export</span> PS1=<span class="hljs-string">"<span class="hljs-subst">$(echo -ne ${cd_rp})</span>"</span>
        <span class="hljs-keyword">fi</span>
}
<span class="hljs-comment">#########################################################################</span>
<span class="hljs-comment">#                                                                       #</span>
<span class="hljs-comment">#                        Initialisation here                            #</span>
<span class="hljs-comment">#                                                                       #</span>
<span class="hljs-comment">#########################################################################</span>
<span class="hljs-comment">#</span>
VERSION_MAJOR=<span class="hljs-string">"1"</span>
VERSION_MINOR=<span class="hljs-string">"2.1"</span>
VERSION_DATE=<span class="hljs-string">"24-MAY-2003"</span>
<span class="hljs-comment">#</span>
<span class="hljs-built_in">alias</span> <span class="hljs-built_in">cd</span>=cd_new
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Set up commands</span>
RM=/bin/rm
TEST=<span class="hljs-built_in">test</span>
PRINTF=<span class="hljs-built_in">printf</span>              <span class="hljs-comment"># Use builtin printf</span>

<span class="hljs-comment">#########################################################################</span>
<span class="hljs-comment">#                                                                       #</span>
<span class="hljs-comment"># Change this to modify the default pre- and post prompt strings.       #</span>
<span class="hljs-comment"># These only come into effect if CDL_PROMPTLEN is set.                  #</span>
<span class="hljs-comment">#                                                                       #</span>
<span class="hljs-comment">#########################################################################</span>
<span class="hljs-keyword">if</span> <span class="hljs-variable">${TEST}</span> <span class="hljs-variable">${EUID}</span> -eq 0
<span class="hljs-keyword">then</span>
<span class="hljs-comment">#   CDL_PROMPT_PRE=${CDL_PROMPT_PRE:="$HOSTNAME@"}</span>
    CDL_PROMPT_PRE=<span class="hljs-variable">${CDL_PROMPT_PRE:="\\[\\e[01;31m\\]"}</span>  <span class="hljs-comment"># Root is in red</span>
    CDL_PROMPT_POST=<span class="hljs-variable">${CDL_PROMPT_POST:="\\[\\e[00m\\]#"}</span>
<span class="hljs-keyword">else</span>
    CDL_PROMPT_PRE=<span class="hljs-variable">${CDL_PROMPT_PRE:="\\[\\e[01;34m\\]"}</span>  <span class="hljs-comment"># Users in blue</span>
    CDL_PROMPT_POST=<span class="hljs-variable">${CDL_PROMPT_POST:="\\[\\e[00m\\]$"}</span>
<span class="hljs-keyword">fi</span>
<span class="hljs-comment">#########################################################################</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># cd_maxhistory defines the max number of history entries allowed.</span>
<span class="hljs-built_in">typeset</span> -i cd_maxhistory=50

<span class="hljs-comment">#########################################################################</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># cd_maxspecial defines the number of special entries.</span>
<span class="hljs-built_in">typeset</span> -i cd_maxspecial=9
<span class="hljs-comment">#</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#########################################################################</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  cd_histcount defines the number of entries displayed in</span>
<span class="hljs-comment">#+ the history command.</span>
<span class="hljs-built_in">typeset</span> -i cd_histcount=9
<span class="hljs-comment">#</span>
<span class="hljs-comment">#########################################################################</span>
<span class="hljs-built_in">export</span> CDPath=<span class="hljs-variable">${HOME}</span>/
<span class="hljs-comment">#  Change these to use a different                                      #</span>
<span class="hljs-comment">#+ default path and filename                                            #</span>
<span class="hljs-built_in">export</span> CDFile=<span class="hljs-variable">${CDFILE:=cdfile}</span>           <span class="hljs-comment"># for the -u and -f commands  #</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#########################################################################</span>
                                                                        <span class="hljs-comment">#</span>
<span class="hljs-built_in">typeset</span> -i cd_lchar cd_rchar cd_flchar
                        <span class="hljs-comment">#  This is the number of chars to allow for the #</span>
cd_flchar=<span class="hljs-variable">${FLCHAR:=75}</span> <span class="hljs-comment">#+ cd_flchar is used for for the @s &amp; @h history#</span>

<span class="hljs-built_in">typeset</span> -ax CD CDS
<span class="hljs-comment">#</span>
cd_mset=<span class="hljs-string">"\n\tDefault mode is now set - entering cd with no parameters \
has the default action\n\tUse cd -d or -D for cd to go to \
previous directory with no parameters\n"</span>
cd_mnset=<span class="hljs-string">"\n\tNon-default mode is now set - entering cd with no \
parameters is the same as entering cd 0\n\tUse cd -d or \
-D to change default cd action\n"</span>

<span class="hljs-comment"># ==================================================================== #</span>



: &lt;&lt;DOCUMENTATION

Written by Phil Braham. Realtime Software Pty Ltd.
Released under GNU license. Free to use. Please pass any modifications
or comments to the author Phil Braham:

realtime@mpx.com.au
=======================================================================

cdll is a replacement <span class="hljs-keyword">for</span> <span class="hljs-built_in">cd</span> and incorporates similar functionality to
the bash <span class="hljs-built_in">pushd</span> and <span class="hljs-built_in">popd</span> commands but is independent of them.

This version of cdll has been tested on Linux using Bash. It will work
on most Linux versions but will probably not work on other shells without
modification.

Introduction
============

cdll allows easy moving about between directories. When changing to a new
directory the current one is automatically put onto a stack. By default
50 entries are kept, but this is configurable. Special directories can be
kept <span class="hljs-keyword">for</span> easy access - by default up to 10, but this is configurable. The
most recent stack entries and the special entries can be easily viewed.

The directory stack and special entries can be saved to, and loaded from,
a file. This allows them to be <span class="hljs-built_in">set</span> up on login, saved before logging out
or changed when moving project to project.

In addition, cdll provides a flexible <span class="hljs-built_in">command</span> prompt facility that allows,
<span class="hljs-keyword">for</span> example, a directory name <span class="hljs-keyword">in</span> colour that is truncated from the left
<span class="hljs-keyword">if</span> it gets too long.


Setting up cdll
===============

Copy cdll to either your <span class="hljs-built_in">local</span> home directory or a central directory
such as /usr/bin (this will require root access).

Copy the file cdfile to your home directory. It will require <span class="hljs-built_in">read</span> and
write access. This a default file that contains a directory stack and
special entries.

To replace the <span class="hljs-built_in">cd</span> <span class="hljs-built_in">command</span> you must add commands to your login script.
The login script is one or more of:

    /etc/profile
    ~/.bash_profile
    ~/.bash_login
    ~/.profile
    ~/.bashrc
    /etc/bash.bashrc.local
    
To setup your login, ~/.bashrc is recommended, <span class="hljs-keyword">for</span> global (and root) setup
add the commands to /etc/bash.bashrc.local
    
To <span class="hljs-built_in">set</span> up on login, add the <span class="hljs-built_in">command</span>:
    . &lt;dir&gt;/cdll
For example <span class="hljs-keyword">if</span> cdll is <span class="hljs-keyword">in</span> your <span class="hljs-built_in">local</span> home directory:
    . ~/cdll
If <span class="hljs-keyword">in</span> /usr/bin <span class="hljs-keyword">then</span>:
    . /usr/bin/cdll

If you want to use this instead of the buitin <span class="hljs-built_in">cd</span> <span class="hljs-built_in">command</span> <span class="hljs-keyword">then</span> add:
    <span class="hljs-built_in">alias</span> <span class="hljs-built_in">cd</span>=<span class="hljs-string">'cd_new'</span>
We would also recommend the following commands:
    <span class="hljs-built_in">alias</span> @=<span class="hljs-string">'cd_new @'</span>
    <span class="hljs-built_in">cd</span> -U
    <span class="hljs-built_in">cd</span> -D

If you want to use cdll<span class="hljs-string">'s prompt facilty then add the following:
    CDL_PROMPTLEN=nn
Where nn is a number described below. Initially 99 would be suitable
number.

Thus the script looks something like this:

    ######################################################################
    # CD Setup
    ######################################################################
    CDL_PROMPTLEN=21        # Allow a prompt length of up to 21 characters
    . /usr/bin/cdll         # Initialise cdll
    alias cd='</span>cd_new<span class="hljs-string">'       # Replace the built in cd command
    alias @='</span>cd_new @<span class="hljs-string">'      # Allow @ at the prompt to display history
    cd -U                   # Upload directories
    cd -D                   # Set default action to non-posix
    ######################################################################

The full meaning of these commands will become clear later.

There are a couple of caveats. If another program changes the directory
without calling cdll, then the directory won'</span>t be put on the stack and
also <span class="hljs-keyword">if</span> the prompt facility is used <span class="hljs-keyword">then</span> this will not be updated. Two
programs that can <span class="hljs-keyword">do</span> this are <span class="hljs-built_in">pushd</span> and <span class="hljs-built_in">popd</span>. To update the prompt and
stack simply enter:

    <span class="hljs-built_in">cd</span> .
    
Note that <span class="hljs-keyword">if</span> the previous entry on the stack is the current directory
<span class="hljs-keyword">then</span> the stack is not updated.

Usage
=====  
<span class="hljs-built_in">cd</span> [dir] [0-9] [@[s|h] [-g &lt;dir&gt;] [-d] [-D] [-r&lt;n&gt;]
   [dir|0-9] [-R&lt;n&gt;] [&lt;dir&gt;|0-9] [-s&lt;n&gt;] [-S&lt;n&gt;]
   [-u] [-U] [-f] [-F] [-h] [-H] [-v]

    &lt;dir&gt;       Go to directory
    0-n         Goto previous directory (0 is previous,
                1 is last but 1, etc.)
                n is up to max <span class="hljs-built_in">history</span> (default is 50)
    @           List <span class="hljs-built_in">history</span> and special entries (Usually available as $ @)
    @h          List <span class="hljs-built_in">history</span> entries
    @s          List special entries
    -g [&lt;dir&gt;]  Go to literal name (bypass special names)
                This is to allow access to <span class="hljs-built_in">dirs</span> called <span class="hljs-string">'0'</span>,<span class="hljs-string">'1'</span>,<span class="hljs-string">'-h'</span> etc
    -d          Change default action - verbose. (See note)
    -D          Change default action - silent. (See note)
    -s&lt;n&gt;       Go to the special entry &lt;n&gt;
    -S&lt;n&gt;       Go to the special entry &lt;n&gt;
                      and replace it with the current dir
    -r&lt;n&gt; [&lt;dir&gt;] Go to directory &lt;dir&gt;
                              and <span class="hljs-keyword">then</span> put it on special entry &lt;n&gt;
    -R&lt;n&gt; [&lt;dir&gt;] Go to directory &lt;dir&gt;
                              and put current dir on special entry &lt;n&gt;
    -a&lt;n&gt;       Alternative suggested directory. See note below.
    -f [&lt;file&gt;] File entries to &lt;file&gt;.
    -u [&lt;file&gt;] Update entries from &lt;file&gt;.
                If no filename supplied <span class="hljs-keyword">then</span> default file (~/cdfile) is used
                -F and -U are silent versions
    -v          Print version number
    -h          Help
    -H          Detailed <span class="hljs-built_in">help</span>



Examples
========

These examples assume non-default mode is <span class="hljs-built_in">set</span> (that is, <span class="hljs-built_in">cd</span> with no
parameters will go to the most recent stack directory), that aliases
have been <span class="hljs-built_in">set</span> up <span class="hljs-keyword">for</span> <span class="hljs-built_in">cd</span> and @ as described above and that <span class="hljs-built_in">cd</span><span class="hljs-string">'s prompt
facility is active and the prompt length is 21 characters.

    /home/phil$ @
    # List the entries with the @
    History:
    # Output of the @ command
    .....
    # Skipped these entries for brevity
    1 /home/phil/ummdev               S1 /home/phil/perl
    # Most recent two history entries
    0 /home/phil/perl/eg              S0 /home/phil/umm/ummdev
    # and two special entries are shown
    
    /home/phil$ cd /home/phil/utils/Cdll
    # Now change directories
    /home/phil/utils/Cdll$ @
    # Prompt reflects the directory.
    History:
    # New history
    .....   
    1 /home/phil/perl/eg              S1 /home/phil/perl
    # History entry 0 has moved to 1
    0 /home/phil                      S0 /home/phil/umm/ummdev
    # and the most recent has entered
       
To go to a history entry:

    /home/phil/utils/Cdll$ cd 1
    # Go to history entry 1.
    /home/phil/perl/eg$
    # Current directory is now what was 1
    
To go to a special entry:

    /home/phil/perl/eg$ cd -s1
    # Go to special entry 1
    /home/phil/umm/ummdev$
    # Current directory is S1

To go to a directory called, for example, 1:

    /home/phil$ cd -g 1
    # -g ignores the special meaning of 1
    /home/phil/1$
    
To put current directory on the special list as S1:
    cd -r1 .        #  OR
    cd -R1 .        #  These have the same effect if the directory is
                    #+ . (the current directory)

To go to a directory and add it as a special  
  The directory for -r&lt;n&gt; or -R&lt;n&gt; may be a number.
  For example:
        $ cd -r3 4  Go to history entry 4 and put it on special entry 3
        $ cd -R3 4  Put current dir on the special entry 3 and go to
                    history entry 4
        $ cd -s3    Go to special entry 3

    Note that commands R,r,S and s may be used without a number and
    refer to 0:
        $ cd -s     Go to special entry 0
        $ cd -S     Go to special entry 0 and make special entry 0
                    current dir
        $ cd -r 1   Go to history entry 1 and put it on special entry 0
        $ cd -r     Go to history entry 0 and put it on special entry 0


    Alternative suggested directories:

    If a directory is not found, then CD will suggest any
    possibilities. These are directories starting with the same letters
    and if any are found they are listed prefixed with -a&lt;n&gt;
    where &lt;n&gt; is a number. It'</span>s possible to go to the directory
    by entering <span class="hljs-built_in">cd</span> -a&lt;n&gt; on the <span class="hljs-built_in">command</span> line.

        Use <span class="hljs-built_in">cd</span> -d or -D to change default <span class="hljs-built_in">cd</span> action. <span class="hljs-built_in">cd</span> -H will show
        current action.

        The <span class="hljs-built_in">history</span> entries (0-n) are stored <span class="hljs-keyword">in</span> the environment variables
        CD[0] - CD[n]
        Similarly the special directories S0 - 9 are <span class="hljs-keyword">in</span> the environment
        variable CDS[0] - CDS[9]
        and may be accessed from the <span class="hljs-built_in">command</span> line, <span class="hljs-keyword">for</span> example:
        
            ls -l <span class="hljs-variable">${CDS[3]}</span>
            cat <span class="hljs-variable">${CD[8]}</span>/file.txt

        The default pathname <span class="hljs-keyword">for</span> the -f and -u commands is ~
        The default filename <span class="hljs-keyword">for</span> the -f and -u commands is cdfile


Configuration
=============

    The following environment variables can be <span class="hljs-built_in">set</span>:
    
        CDL_PROMPTLEN  - Set to the length of prompt you require.
            Prompt string is <span class="hljs-built_in">set</span> to the right characters of the current
            directory. If not <span class="hljs-built_in">set</span>, <span class="hljs-keyword">then</span> prompt is left unchanged. Note
            that this is the number of characters that the directory is
            shortened to, not the total characters <span class="hljs-keyword">in</span> the prompt.

            CDL_PROMPT_PRE - Set to the string to prefix the prompt.
                Default is:
                    non-root:  <span class="hljs-string">"\\[\\e[01;34m\\]"</span>  (sets colour to blue).
                    root:      <span class="hljs-string">"\\[\\e[01;31m\\]"</span>  (sets colour to red).

            CDL_PROMPT_POST    - Set to the string to suffix the prompt.
                Default is:
                    non-root:  <span class="hljs-string">"\\[\\e[00m\\]$"</span>
                               (resets colour and displays $).
                    root:      <span class="hljs-string">"\\[\\e[00m\\]#"</span>
                               (resets colour and displays <span class="hljs-comment">#).</span>

        Note:
            CDL_PROMPT_PRE &amp; _POST only t

        CDPath - Set the default path <span class="hljs-keyword">for</span> the -f &amp; -u options.
                 Default is home directory
        CDFile - Set the default filename <span class="hljs-keyword">for</span> the -f &amp; -u options.
                 Default is cdfile


    There are three variables defined <span class="hljs-keyword">in</span> the file cdll <span class="hljs-built_in">which</span> control the
    number of entries stored or displayed. They are <span class="hljs-keyword">in</span> the section labeled
    <span class="hljs-string">'Initialisation here'</span> towards the end of the file.

        cd_maxhistory       - The number of <span class="hljs-built_in">history</span> entries stored.
                              Default is 50.
        cd_maxspecial       - The number of special entries allowed.
                              Default is 9.
        cd_histcount        - The number of <span class="hljs-built_in">history</span> and special entries
                              displayed. Default is 9.

    Note that cd_maxspecial should be &gt;= cd_histcount to avoid displaying
    special entries that can<span class="hljs-string">'t be set.


Version: 1.2.1 Date: 24-MAY-2003

DOCUMENTATION</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="SOUNDCARDON" id="SOUNDCARDON"></a>
        <p><b>Example A-34. A soundcard setup script</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># soundcard-on.sh</span>

<span class="hljs-comment">#  Script author: Mkarcher</span>
<span class="hljs-comment">#  http://www.thinkwiki.org/wiki  ...</span>
<span class="hljs-comment">#  /Script_for_configuring_the_CS4239_sound_chip_in_PnP_mode</span>
<span class="hljs-comment">#  ABS Guide author made minor changes and added comments.</span>
<span class="hljs-comment">#  Couldn't contact script author to ask for permission to use, but ...</span>
<span class="hljs-comment">#+ the script was released under the FDL,</span>
<span class="hljs-comment">#+ so its use here should be both legal and ethical.</span>

<span class="hljs-comment">#  Sound-via-pnp-script for Thinkpad 600E</span>
<span class="hljs-comment">#+ and possibly other computers with onboard CS4239/CS4610</span>
<span class="hljs-comment">#+ that do not work with the PCI driver</span>
<span class="hljs-comment">#+ and are not recognized by the PnP code of snd-cs4236.</span>
<span class="hljs-comment">#  Also for some 770-series Thinkpads, such as the 770x.</span>
<span class="hljs-comment">#  Run as root user, of course.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  These are old and very obsolete laptop computers,</span>
<span class="hljs-comment">#+ but this particular script is very instructive,</span>
<span class="hljs-comment">#+ as it shows how to set up and hack device files.</span>



<span class="hljs-comment">#  Search for sound card pnp device:</span>

<span class="hljs-keyword">for</span> dev <span class="hljs-keyword">in</span> /sys/bus/pnp/devices/*
<span class="hljs-keyword">do</span>
  grep CSC0100 <span class="hljs-variable">$dev</span>/id &gt; /dev/null &amp;&amp; WSSDEV=<span class="hljs-variable">$dev</span>
  grep CSC0110 <span class="hljs-variable">$dev</span>/id &gt; /dev/null &amp;&amp; CTLDEV=<span class="hljs-variable">$dev</span>
<span class="hljs-keyword">done</span>
<span class="hljs-comment"># On 770x:</span>
<span class="hljs-comment"># WSSDEV = /sys/bus/pnp/devices/00:07</span>
<span class="hljs-comment"># CTLDEV = /sys/bus/pnp/devices/00:06</span>
<span class="hljs-comment"># These are symbolic links to /sys/devices/pnp0/ ...</span>


<span class="hljs-comment">#  Activate devices:</span>
<span class="hljs-comment">#  Thinkpad boots with devices disabled unless "fast boot" is turned off</span>
<span class="hljs-comment">#+ (in BIOS).</span>

<span class="hljs-built_in">echo</span> activate &gt; <span class="hljs-variable">$WSSDEV</span>/resources
<span class="hljs-built_in">echo</span> activate &gt; <span class="hljs-variable">$CTLDEV</span>/resources


<span class="hljs-comment"># Parse resource settings.</span>

{ <span class="hljs-built_in">read</span> <span class="hljs-comment"># Discard "state = active" (see below).</span>
  <span class="hljs-built_in">read</span> bla port1
  <span class="hljs-built_in">read</span> bla port2
  <span class="hljs-built_in">read</span> bla port3
  <span class="hljs-built_in">read</span> bla irq
  <span class="hljs-built_in">read</span> bla dma1
  <span class="hljs-built_in">read</span> bla dma2
 <span class="hljs-comment"># The "bla's" are labels in the first field: "io," "state," etc.</span>
 <span class="hljs-comment"># These are discarded.</span>

 <span class="hljs-comment">#  Hack: with PnPBIOS: ports are: port1: WSS, port2:</span>
 <span class="hljs-comment">#+ OPL, port3: sb (unneeded)</span>
 <span class="hljs-comment">#       with ACPI-PnP:ports are: port1: OPL, port2: sb, port3: WSS</span>
 <span class="hljs-comment">#  (ACPI bios seems to be wrong here, the PnP-card-code in snd-cs4236.c</span>
 <span class="hljs-comment">#+  uses the PnPBIOS port order)</span>
 <span class="hljs-comment">#  Detect port order using the fixed OPL port as reference.</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${port2%%-*}</span> = 0x388 ]
 <span class="hljs-comment">#            ^^^^  Strip out everything following hyphen in port address.</span>
 <span class="hljs-comment">#                  So, if port1 is 0x530-0x537</span>
 <span class="hljs-comment">#+                 we're left with 0x530 -- the start address of the port.</span>
 <span class="hljs-keyword">then</span>
   <span class="hljs-comment"># PnPBIOS: usual order</span>
   port=<span class="hljs-variable">${port1%%-*}</span>
   oplport=<span class="hljs-variable">${port2%%-*}</span>
 <span class="hljs-keyword">else</span>
   <span class="hljs-comment"># ACPI: mixed-up order</span>
   port=<span class="hljs-variable">${port3%%-*}</span>
   oplport=<span class="hljs-variable">${port1%%-*}</span>
 <span class="hljs-keyword">fi</span>
 } &lt; <span class="hljs-variable">$WSSDEV</span>/resources
<span class="hljs-comment"># To see what's going on here:</span>
<span class="hljs-comment"># ---------------------------</span>
<span class="hljs-comment">#   cat /sys/devices/pnp0/00:07/resources</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#   state = active</span>
<span class="hljs-comment">#   io 0x530-0x537</span>
<span class="hljs-comment">#   io 0x388-0x38b</span>
<span class="hljs-comment">#   io 0x220-0x233</span>
<span class="hljs-comment">#   irq 5</span>
<span class="hljs-comment">#   dma 1</span>
<span class="hljs-comment">#   dma 0</span>
<span class="hljs-comment">#   ^^^   "bla" labels in first field (discarded). </span>


{ <span class="hljs-built_in">read</span> <span class="hljs-comment"># Discard first line, as above.</span>
  <span class="hljs-built_in">read</span> bla port1
  cport=<span class="hljs-variable">${port1%%-*}</span>
  <span class="hljs-comment">#            ^^^^</span>
  <span class="hljs-comment"># Just want _start_ address of port.</span>
} &lt; <span class="hljs-variable">$CTLDEV</span>/resources


<span class="hljs-comment"># Load the module:</span>

modprobe --ignore-install snd-cs4236 port=<span class="hljs-variable">$port</span> cport=<span class="hljs-variable">$cport</span>\
fm_port=<span class="hljs-variable">$oplport</span> irq=<span class="hljs-variable">$irq</span> dma1=<span class="hljs-variable">$dma1</span> dma2=<span class="hljs-variable">$dma2</span> isapnp=0 index=0
<span class="hljs-comment"># See the modprobe manpage.</span>

<span class="hljs-built_in">exit</span> $?</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p><a name="FINDSPLIT0" id="FINDSPLIT0"></a></p>
      <div class="EXAMPLE">
        <a name="FINDSPLIT" id="FINDSPLIT"></a>
        <p><b>Example A-35. Locating split paragraphs in a text file</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># find-splitpara.sh</span>
<span class="hljs-comment">#  Finds split paragraphs in a text file,</span>
<span class="hljs-comment">#+ and tags the line numbers.</span>


ARGCOUNT=1       <span class="hljs-comment"># Expect one arg.</span>
OFF=0            <span class="hljs-comment"># Flag states.</span>
ON=1
E_WRONGARGS=85

file=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>        <span class="hljs-comment"># Target filename.</span>
lineno=1         <span class="hljs-comment"># Line number. Start at 1.</span>
Flag=<span class="hljs-variable">$OFF</span>        <span class="hljs-comment"># Blank line flag.</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ne <span class="hljs-string">"<span class="hljs-variable">$ARGCOUNT</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: `basename <span class="hljs-variable">$0</span>` FILENAME"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_WRONGARGS</span>
<span class="hljs-keyword">fi</span>  

file_read ()     <span class="hljs-comment"># Scan file for pattern, then print line.</span>
{
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line
<span class="hljs-keyword">do</span>

  <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> =~ ^[a-z] &amp;&amp; <span class="hljs-variable">$Flag</span> -eq <span class="hljs-variable">$ON</span> ]]
     <span class="hljs-keyword">then</span>  <span class="hljs-comment"># Line begins with lowercase character, following blank line.</span>
     <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$lineno</span>::   "</span>
     <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>
  <span class="hljs-keyword">fi</span>


  <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> =~ ^$ ]]
     <span class="hljs-keyword">then</span>       <span class="hljs-comment">#  If blank line,</span>
     Flag=<span class="hljs-variable">$ON</span>   <span class="hljs-comment">#+ set flag.</span>
  <span class="hljs-keyword">else</span>
     Flag=<span class="hljs-variable">$OFF</span>
  <span class="hljs-keyword">fi</span>

  ((lineno++))

<span class="hljs-keyword">done</span>
} &lt; <span class="hljs-variable">$file</span>  <span class="hljs-comment"># Redirect file into function's stdin.</span>

file_read


<span class="hljs-built_in">exit</span> $?


<span class="hljs-comment"># ----------------------------------------------------------------</span>
This is line one of an example paragraph, bla, bla, bla.
This is line two, and line three should follow on next line, but

there is a blank line separating the two parts of the paragraph.
<span class="hljs-comment"># ----------------------------------------------------------------</span>

Running this script on a file containing the above paragraph
yields:

4::   there is a blank line separating the two parts of the paragraph.


There will be additional output <span class="hljs-keyword">for</span> all the other split paragraphs
<span class="hljs-keyword">in</span> the target file.</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p><a name="INSERTIONSORT0" id="INSERTIONSORT0"></a></p>
      <div class="EXAMPLE">
        <a name="INSERTIONSORT" id="INSERTIONSORT"></a>
        <p><b>Example A-36. Insertion sort</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># insertion-sort.bash: Insertion sort implementation in Bash</span>
<span class="hljs-comment">#                      Heavy use of Bash array features:</span>
<span class="hljs-comment">#+                     (string) slicing, merging, etc</span>
<span class="hljs-comment"># URL: http://www.lugmen.org.ar/~jjo/jjotip/insertion-sort.bash.d</span>
<span class="hljs-comment">#+          /insertion-sort.bash.sh</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Author: JuanJo Ciarlante &lt;jjo@irrigacion.gov.ar&gt;</span>
<span class="hljs-comment"># Lightly reformatted by ABS Guide author.</span>
<span class="hljs-comment"># License: GPLv2</span>
<span class="hljs-comment"># Used in ABS Guide with author's permission (thanks!).</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Test with:   ./insertion-sort.bash -t</span>
<span class="hljs-comment"># Or:          bash insertion-sort.bash -t</span>
<span class="hljs-comment"># The following *doesn't* work:</span>
<span class="hljs-comment">#              sh insertion-sort.bash -t</span>
<span class="hljs-comment">#  Why not? Hint: which Bash-specific features are disabled</span>
<span class="hljs-comment">#+ when running a script by 'sh script.sh'?</span>
<span class="hljs-comment">#</span>
: <span class="hljs-variable">${DEBUG:=0}</span>  <span class="hljs-comment"># Debug, override with:  DEBUG=1 ./scriptname . . .</span>
<span class="hljs-comment"># Parameter substitution -- set DEBUG to 0 if not previously set.</span>

<span class="hljs-comment"># Global array: "list"</span>
<span class="hljs-built_in">typeset</span> -a list
<span class="hljs-comment"># Load whitespace-separated numbers from stdin.</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> = <span class="hljs-string">"-t"</span> ]; <span class="hljs-keyword">then</span>
DEBUG=1
        <span class="hljs-built_in">read</span> -a list &lt; &lt;( od -Ad -w24 -t u2 /dev/urandom ) <span class="hljs-comment"># Random list.</span>
<span class="hljs-comment">#                    ^ ^  process substition</span>
<span class="hljs-keyword">else</span>
        <span class="hljs-built_in">read</span> -a list
<span class="hljs-keyword">fi</span>
numelem=<span class="hljs-variable">${#list[*]}</span>

<span class="hljs-comment">#  Shows the list, marking the element whose index is $1</span>
<span class="hljs-comment">#+ by surrounding it with the two chars passed as $2.</span>
<span class="hljs-comment">#  Whole line prefixed with $3.</span>
<span class="hljs-function"><span class="hljs-title">showlist</span></span>()
  {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$3</span>"</span><span class="hljs-variable">${list[@]:0:$1}</span> <span class="hljs-variable">${2:0:1}</span><span class="hljs-variable">${list[$1]}</span><span class="hljs-variable">${2:1:1}</span> <span class="hljs-variable">${list[@]:$1+1}</span>;
  }

<span class="hljs-comment"># Loop _pivot_ -- from second element to end of list.</span>
<span class="hljs-keyword">for</span>(( i=1; i&lt;numelem; i++ )) <span class="hljs-keyword">do</span>
        ((DEBUG))&amp;&amp;showlist i <span class="hljs-string">"[]"</span> <span class="hljs-string">" "</span>
        <span class="hljs-comment"># From current _pivot_, back to first element.</span>
        <span class="hljs-keyword">for</span>(( j=i; j; j-- )) <span class="hljs-keyword">do</span>
                <span class="hljs-comment"># Search for the 1st elem. less than current "pivot" . . .</span>
                [[ <span class="hljs-string">"<span class="hljs-variable">${list[j-1]}</span>"</span> -le <span class="hljs-string">"<span class="hljs-variable">${list[i]}</span>"</span> ]] &amp;&amp; <span class="hljs-built_in">break</span>
        <span class="hljs-keyword">done</span>
        (( i==j )) &amp;&amp; <span class="hljs-built_in">continue</span> <span class="hljs-comment">## No insertion was needed for this element.</span>
        <span class="hljs-comment"># . . . Move list[i] (pivot) to the left of list[j]:</span>
        list=(<span class="hljs-variable">${list[@]:0:j}</span> <span class="hljs-variable">${list[i]}</span> <span class="hljs-variable">${list[j]}</span>\
        <span class="hljs-comment">#         {0,j-1}        {i}       {j}</span>
              <span class="hljs-variable">${list[@]:j+1:i-(j+1)}</span> <span class="hljs-variable">${list[@]:i+1}</span>)
        <span class="hljs-comment">#         {j+1,i-1}              {i+1,last}</span>
        ((DEBUG))&amp;&amp;showlist j <span class="hljs-string">"&lt;&gt;"</span> <span class="hljs-string">"*"</span>
<span class="hljs-keyword">done</span>


<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span>  <span class="hljs-string">"------"</span>
<span class="hljs-built_in">echo</span> $<span class="hljs-string">'Result:\n'</span><span class="hljs-variable">${list[@]}</span>

<span class="hljs-built_in">exit</span> $?</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="STDDEV" id="STDDEV"></a>
        <p><b>Example A-37. Standard Deviation</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># sd.sh: Standard Deviation</span>

<span class="hljs-comment">#  The Standard Deviation indicates how consistent a set of data is.</span>
<span class="hljs-comment">#  It shows to what extent the individual data points deviate from the</span>
<span class="hljs-comment">#+ arithmetic mean, i.e., how much they "bounce around" (or cluster).</span>
<span class="hljs-comment">#  It is essentially the average deviation-distance of the</span>
<span class="hljs-comment">#+ data points from the mean.</span>

<span class="hljs-comment"># =========================================================== #</span>
<span class="hljs-comment">#    To calculate the Standard Deviation:</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># 1  Find the arithmetic mean (average) of all the data points.</span>
<span class="hljs-comment"># 2  Subtract each data point from the arithmetic mean,</span>
<span class="hljs-comment">#    and square that difference.</span>
<span class="hljs-comment"># 3  Add all of the individual difference-squares in # 2.</span>
<span class="hljs-comment"># 4  Divide the sum in # 3 by the number of data points.</span>
<span class="hljs-comment">#    This is known as the "variance."</span>
<span class="hljs-comment"># 5  The square root of # 4 gives the Standard Deviation.</span>
<span class="hljs-comment"># =========================================================== #</span>

count=0         <span class="hljs-comment"># Number of data points; global.</span>
SC=9            <span class="hljs-comment"># Scale to be used by bc. Nine decimal places.</span>
E_DATAFILE=90   <span class="hljs-comment"># Data file error.</span>

<span class="hljs-comment"># ----------------- Set data file ---------------------</span>
<span class="hljs-keyword">if</span> [ ! -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]  <span class="hljs-comment"># Specify filename as cmd-line arg?</span>
<span class="hljs-keyword">then</span>
  datafile=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-comment">#  ASCII text file,</span>
<span class="hljs-keyword">else</span>            <span class="hljs-comment">#+ one (numerical) data point per line!</span>
  datafile=sample.dat
<span class="hljs-keyword">fi</span>              <span class="hljs-comment">#  See example data file, below.</span>

<span class="hljs-keyword">if</span> [ ! -e <span class="hljs-string">"<span class="hljs-variable">$datafile</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"\""</span><span class="hljs-variable">$datafile</span><span class="hljs-string">"\" does not exist!"</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_DATAFILE</span>
<span class="hljs-keyword">fi</span>
<span class="hljs-comment"># -----------------------------------------------------</span>


<span class="hljs-function"><span class="hljs-title">arith_mean</span></span> ()
{
  <span class="hljs-built_in">local</span> rt=0         <span class="hljs-comment"># Running total.</span>
  <span class="hljs-built_in">local</span> am=0         <span class="hljs-comment"># Arithmetic mean.</span>
  <span class="hljs-built_in">local</span> ct=0         <span class="hljs-comment"># Number of data points.</span>

  <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> value   <span class="hljs-comment"># Read one data point at a time.</span>
  <span class="hljs-keyword">do</span>
    rt=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"scale=<span class="hljs-variable">$SC</span>; <span class="hljs-variable">$rt</span> + <span class="hljs-variable">$value</span>"</span> | bc)
    (( ct++ ))
  <span class="hljs-keyword">done</span>

  am=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"scale=<span class="hljs-variable">$SC</span>; <span class="hljs-variable">$rt</span> / <span class="hljs-variable">$ct</span>"</span> | bc)

  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$am</span>; <span class="hljs-built_in">return</span> <span class="hljs-variable">$ct</span>   <span class="hljs-comment"># This function "returns" TWO values!</span>
  <span class="hljs-comment">#  Caution: This little trick will not work if $ct &gt; 255!</span>
  <span class="hljs-comment">#  To handle a larger number of data points,</span>
  <span class="hljs-comment">#+ simply comment out the "return $ct" above.</span>
} &lt;<span class="hljs-string">"<span class="hljs-variable">$datafile</span>"</span>   <span class="hljs-comment"># Feed in data file.</span>

<span class="hljs-function"><span class="hljs-title">sd</span></span> ()
{
  mean1=<span class="hljs-variable">$1</span>  <span class="hljs-comment"># Arithmetic mean (passed to function).</span>
  n=<span class="hljs-variable">$2</span>      <span class="hljs-comment"># How many data points.</span>
  sum2=0    <span class="hljs-comment"># Sum of squared differences ("variance").</span>
  avg2=0    <span class="hljs-comment"># Average of $sum2.</span>
  sdev=0    <span class="hljs-comment"># Standard Deviation.</span>

  <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> value   <span class="hljs-comment"># Read one line at a time.</span>
  <span class="hljs-keyword">do</span>
    diff=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"scale=<span class="hljs-variable">$SC</span>; <span class="hljs-variable">$mean1</span> - <span class="hljs-variable">$value</span>"</span> | bc)
    <span class="hljs-comment"># Difference between arith. mean and data point.</span>
    dif2=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"scale=<span class="hljs-variable">$SC</span>; <span class="hljs-variable">$diff</span> * <span class="hljs-variable">$diff</span>"</span> | bc) <span class="hljs-comment"># Squared.</span>
    sum2=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"scale=<span class="hljs-variable">$SC</span>; <span class="hljs-variable">$sum2</span> + <span class="hljs-variable">$dif2</span>"</span> | bc) <span class="hljs-comment"># Sum of squares.</span>
  <span class="hljs-keyword">done</span>

    avg2=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"scale=<span class="hljs-variable">$SC</span>; <span class="hljs-variable">$sum2</span> / <span class="hljs-variable">$n</span>"</span> | bc)  <span class="hljs-comment"># Avg. of sum of squares.</span>
    sdev=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"scale=<span class="hljs-variable">$SC</span>; sqrt(<span class="hljs-variable">$avg2</span>)"</span> | bc) <span class="hljs-comment"># Square root =</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$sdev</span>                                 <span class="hljs-comment"># Standard Deviation.</span>

} &lt;<span class="hljs-string">"<span class="hljs-variable">$datafile</span>"</span>   <span class="hljs-comment"># Rewinds data file.</span>


<span class="hljs-comment"># ======================================================= #</span>
mean=$(arith_mean); count=$?   <span class="hljs-comment"># Two returns from function!</span>
std_dev=$(sd <span class="hljs-variable">$mean</span> <span class="hljs-variable">$count</span>)

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Number of data points in \""</span><span class="hljs-variable">$datafile</span><span class="hljs-string">"\" = <span class="hljs-variable">$count</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Arithmetic mean (average) = <span class="hljs-variable">$mean</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Standard Deviation = <span class="hljs-variable">$std_dev</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-comment"># ======================================================= #</span>

<span class="hljs-built_in">exit</span>

<span class="hljs-comment">#  This script could stand some drastic streamlining,</span>
<span class="hljs-comment">#+ but not at the cost of reduced legibility, please.</span>


<span class="hljs-comment"># ++++++++++++++++++++++++++++++++++++++++ #</span>
<span class="hljs-comment"># A sample data file (sample1.dat):</span>

<span class="hljs-comment"># 18.35</span>
<span class="hljs-comment"># 19.0</span>
<span class="hljs-comment"># 18.88</span>
<span class="hljs-comment"># 18.91</span>
<span class="hljs-comment"># 18.64</span>


<span class="hljs-comment"># $ sh sd.sh sample1.dat</span>

<span class="hljs-comment"># Number of data points in "sample1.dat" = 5</span>
<span class="hljs-comment"># Arithmetic mean (average) = 18.756000000</span>
<span class="hljs-comment"># Standard Deviation = .235338054</span>
<span class="hljs-comment"># ++++++++++++++++++++++++++++++++++++++++ #</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="PADSW" id="PADSW"></a>
        <p>
          <b>Example A-38. A <i class="FIRSTTERM">pad</i> file generator for
            shareware authors</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># pad.sh</span>

<span class="hljs-comment">#######################################################</span>
<span class="hljs-comment">#               PAD (xml) file creator</span>
<span class="hljs-comment">#+ Written by Mendel Cooper &lt;thegrendel.abs@gmail.com&gt;.</span>
<span class="hljs-comment">#+ Released to the Public Domain.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  Generates a "PAD" descriptor file for shareware</span>
<span class="hljs-comment">#+ packages, according to the specifications</span>
<span class="hljs-comment">#+ of the ASP.</span>
<span class="hljs-comment">#  http://www.asp-shareware.org/pad</span>
<span class="hljs-comment">#######################################################</span>


<span class="hljs-comment"># Accepts (optional) save filename as a command-line argument.</span>
<span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
<span class="hljs-keyword">then</span>
  savefile=<span class="hljs-variable">$1</span>
<span class="hljs-keyword">else</span>
  savefile=save_file.xml               <span class="hljs-comment"># Default save_file name.</span>
<span class="hljs-keyword">fi</span>  


<span class="hljs-comment"># ===== PAD file headers =====</span>
HDR1=<span class="hljs-string">"&lt;?xml version=\"1.0\" encoding=\"Windows-1252\" ?&gt;"</span>
HDR2=<span class="hljs-string">"&lt;XML_DIZ_INFO&gt;"</span>
HDR3=<span class="hljs-string">"&lt;MASTER_PAD_VERSION_INFO&gt;"</span>
HDR4=<span class="hljs-string">"\t&lt;MASTER_PAD_VERSION&gt;1.15&lt;/MASTER_PAD_VERSION&gt;"</span>
HDR5=<span class="hljs-string">"\t&lt;MASTER_PAD_INFO&gt;Portable Application Description, or PAD
for short, is a data set that is used by shareware authors to
disseminate information to anyone interested in their software products.
To find out more go to http://www.asp-shareware.org/pad&lt;/MASTER_PAD_INFO&gt;"</span>
HDR6=<span class="hljs-string">"&lt;/MASTER_PAD_VERSION_INFO&gt;"</span>
<span class="hljs-comment"># ============================</span>


<span class="hljs-function"><span class="hljs-title">fill_in</span></span> ()
{
  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$1</span>? "</span>     <span class="hljs-comment"># Get user input.</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$1</span> <span class="hljs-variable">$2</span>? "</span>  <span class="hljs-comment"># Additional query?</span>
  <span class="hljs-keyword">fi</span>  

  <span class="hljs-built_in">read</span> var             <span class="hljs-comment"># May paste to fill in field.</span>
                       <span class="hljs-comment"># This shows how flexible "read" can be.</span>

  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$var</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\t\t&lt;<span class="hljs-variable">$1</span> /&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>    <span class="hljs-comment"># Indent with 2 tabs.</span>
    <span class="hljs-built_in">return</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\t\t&lt;<span class="hljs-variable">$1</span>&gt;<span class="hljs-variable">$var</span>&lt;/<span class="hljs-variable">$1</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">${#var}</span>     <span class="hljs-comment"># Return length of input string.</span>
  <span class="hljs-keyword">fi</span>
}    

check_field_length ()  <span class="hljs-comment"># Check length of program description fields.</span>
{
  <span class="hljs-comment"># $1 = maximum field length</span>
  <span class="hljs-comment"># $2 = actual field length</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> -gt <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: Maximum field length of <span class="hljs-variable">$1</span> characters exceeded!"</span>
  <span class="hljs-keyword">fi</span>
}  

clear                  <span class="hljs-comment"># Clear screen.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"PAD File Creator"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"--- ---- -------"</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># Write File Headers to file.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$HDR1</span> &gt;<span class="hljs-variable">$savefile</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$HDR2</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$HDR3</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-variable">$HDR4</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-variable">$HDR5</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$HDR6</span> &gt;&gt;<span class="hljs-variable">$savefile</span>


<span class="hljs-comment"># Company_Info</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"COMPANY INFO"</span>
CO_HDR=<span class="hljs-string">"Company_Info"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;<span class="hljs-variable">$CO_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>

fill_in Company_Name
fill_in Address_1
fill_in Address_2
fill_in City_Town 
fill_in State_Province
fill_in Zip_Postal_Code
fill_in Country

<span class="hljs-comment"># If applicable:</span>
<span class="hljs-comment"># fill_in ASP_Member "[Y/N]"</span>
<span class="hljs-comment"># fill_in ASP_Member_Number</span>
<span class="hljs-comment"># fill_in ESC_Member "[Y/N]"</span>

fill_in Company_WebSite_URL

clear   <span class="hljs-comment"># Clear screen between sections.</span>

   <span class="hljs-comment"># Contact_Info</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"CONTACT INFO"</span>
CONTACT_HDR=<span class="hljs-string">"Contact_Info"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;<span class="hljs-variable">$CONTACT_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
fill_in Author_First_Name
fill_in Author_Last_Name
fill_in Author_Email
fill_in Contact_First_Name
fill_in Contact_Last_Name
fill_in Contact_Email
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\t&lt;/<span class="hljs-variable">$CONTACT_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
   <span class="hljs-comment"># END Contact_Info</span>

clear

   <span class="hljs-comment"># Support_Info</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"SUPPORT INFO"</span>
SUPPORT_HDR=<span class="hljs-string">"Support_Info"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;<span class="hljs-variable">$SUPPORT_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
fill_in Sales_Email
fill_in Support_Email
fill_in General_Email
fill_in Sales_Phone
fill_in Support_Phone
fill_in General_Phone
fill_in Fax_Phone
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\t&lt;/<span class="hljs-variable">$SUPPORT_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
   <span class="hljs-comment"># END Support_Info</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;/<span class="hljs-variable">$CO_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
<span class="hljs-comment"># END Company_Info</span>

clear

<span class="hljs-comment"># Program_Info </span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"PROGRAM INFO"</span>
PROGRAM_HDR=<span class="hljs-string">"Program_Info"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;<span class="hljs-variable">$PROGRAM_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
fill_in Program_Name
fill_in Program_Version
fill_in Program_Release_Month
fill_in Program_Release_Day
fill_in Program_Release_Year
fill_in Program_Cost_Dollars
fill_in Program_Cost_Other
fill_in Program_Type <span class="hljs-string">"[Shareware/Freeware/GPL]"</span>
fill_in Program_Release_Status <span class="hljs-string">"[Beta, Major Upgrade, etc.]"</span>
fill_in Program_Install_Support
fill_in Program_OS_Support <span class="hljs-string">"[Win9x/Win2k/Linux/etc.]"</span>
fill_in Program_Language <span class="hljs-string">"[English/Spanish/etc.]"</span>

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>

  <span class="hljs-comment"># File_Info </span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"FILE INFO"</span>
FILEINFO_HDR=<span class="hljs-string">"File_Info"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;<span class="hljs-variable">$FILEINFO_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
fill_in Filename_Versioned
fill_in Filename_Previous
fill_in Filename_Generic
fill_in Filename_Long
fill_in File_Size_Bytes
fill_in File_Size_K
fill_in File_Size_MB
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\t&lt;/<span class="hljs-variable">$FILEINFO_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
  <span class="hljs-comment"># END File_Info </span>

clear

  <span class="hljs-comment"># Expire_Info </span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"EXPIRE INFO"</span>
EXPIRE_HDR=<span class="hljs-string">"Expire_Info"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;<span class="hljs-variable">$EXPIRE_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
fill_in Has_Expire_Info <span class="hljs-string">"Y/N"</span>
fill_in Expire_Count
fill_in Expire_Based_On
fill_in Expire_Other_Info
fill_in Expire_Month
fill_in Expire_Day
fill_in Expire_Year
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\t&lt;/<span class="hljs-variable">$EXPIRE_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
  <span class="hljs-comment"># END Expire_Info </span>

clear

  <span class="hljs-comment"># More Program_Info</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ADDITIONAL PROGRAM INFO"</span>
fill_in Program_Change_Info
fill_in Program_Specific_Category
fill_in Program_Categories
fill_in Includes_JAVA_VM <span class="hljs-string">"[Y/N]"</span>
fill_in Includes_VB_Runtime <span class="hljs-string">"[Y/N]"</span>
fill_in Includes_DirectX <span class="hljs-string">"[Y/N]"</span>
  <span class="hljs-comment"># END More Program_Info</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;/<span class="hljs-variable">$PROGRAM_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
<span class="hljs-comment"># END Program_Info </span>

clear

<span class="hljs-comment"># Program Description</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"PROGRAM DESCRIPTIONS"</span>
PROGDESC_HDR=<span class="hljs-string">"Program_Descriptions"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;<span class="hljs-variable">$PROGDESC_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>

LANG=<span class="hljs-string">"English"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;<span class="hljs-variable">$LANG</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>

fill_in Keywords <span class="hljs-string">"[comma + space separated]"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"45, 80, 250, 450, 2000 word program descriptions"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"(may cut and paste into field)"</span>
<span class="hljs-comment">#  It would be highly appropriate to compose the following</span>
<span class="hljs-comment">#+ "Char_Desc" fields with a text editor,</span>
<span class="hljs-comment">#+ then cut-and-paste the text into the answer fields.</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"              |---------------45 characters---------------|"</span>
fill_in Char_Desc_45
check_field_length 45 <span class="hljs-string">"$?"</span>
<span class="hljs-built_in">echo</span>
fill_in Char_Desc_80
check_field_length 80 <span class="hljs-string">"$?"</span>

fill_in Char_Desc_250
check_field_length 250 <span class="hljs-string">"$?"</span>

fill_in Char_Desc_450
fill_in Char_Desc_2000

<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;/<span class="hljs-variable">$LANG</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;/<span class="hljs-variable">$PROGDESC_HDR</span>&gt;"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
<span class="hljs-comment"># END Program Description</span>

clear
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Done."</span>; <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Save file is:  \""</span><span class="hljs-variable">$savefile</span><span class="hljs-string">"\""</span>

<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="MANED" id="MANED"></a>
        <p>
          <b>Example A-39. A <i class="FIRSTTERM">man page</i> editor</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># maned.sh</span>
<span class="hljs-comment"># A rudimentary man page editor</span>

<span class="hljs-comment"># Version: 0.1 (Alpha, probably buggy)</span>
<span class="hljs-comment"># Author: Mendel Cooper &lt;thegrendel.abs@gmail.com&gt;</span>
<span class="hljs-comment"># Reldate: 16 June 2008</span>
<span class="hljs-comment"># License: GPL3</span>


savefile=      <span class="hljs-comment"># Global, used in multiple functions.</span>
E_NOINPUT=90   <span class="hljs-comment"># User input missing (error). May or may not be critical.</span>

<span class="hljs-comment"># =========== Markup Tags ============ #</span>
TopHeader=<span class="hljs-string">".TH"</span>
NameHeader=<span class="hljs-string">".SH NAME"</span>
SyntaxHeader=<span class="hljs-string">".SH SYNTAX"</span>
SynopsisHeader=<span class="hljs-string">".SH SYNOPSIS"</span>
InstallationHeader=<span class="hljs-string">".SH INSTALLATION"</span>
DescHeader=<span class="hljs-string">".SH DESCRIPTION"</span>
OptHeader=<span class="hljs-string">".SH OPTIONS"</span>
FilesHeader=<span class="hljs-string">".SH FILES"</span>
EnvHeader=<span class="hljs-string">".SH ENVIRONMENT"</span>
AuthHeader=<span class="hljs-string">".SH AUTHOR"</span>
BugsHeader=<span class="hljs-string">".SH BUGS"</span>
SeeAlsoHeader=<span class="hljs-string">".SH SEE ALSO"</span>
BOLD=<span class="hljs-string">".B"</span>
<span class="hljs-comment"># Add more tags, as needed.</span>
<span class="hljs-comment"># See groff docs for markup meanings.</span>
<span class="hljs-comment"># ==================================== #</span>

<span class="hljs-function"><span class="hljs-title">start</span></span> ()
{
clear                  <span class="hljs-comment"># Clear screen.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ManEd"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"-----"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Simple man page creator"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Author: Mendel Cooper"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"License: GPL3"</span>
<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>
}

<span class="hljs-function"><span class="hljs-title">progname</span></span> ()
{
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Program name? "</span>
  <span class="hljs-built_in">read</span> name

  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Manpage section? [Hit RETURN for default (\"1\") ]  "</span>
  <span class="hljs-built_in">read</span> section
  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$section</span>"</span> ]
  <span class="hljs-keyword">then</span>
    section=1   <span class="hljs-comment"># Most man pages are in section 1.</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$name</span>"</span> ]
  <span class="hljs-keyword">then</span>
    savefile=<span class="hljs-string">""</span><span class="hljs-variable">$name</span><span class="hljs-string">"."</span><span class="hljs-variable">$section</span><span class="hljs-string">""</span>       <span class="hljs-comment">#  Filename suffix = section.</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$1</span> "</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
    name1=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$name</span>"</span> | tr a-z A-Z)  <span class="hljs-comment">#  Change to uppercase,</span>
                                        <span class="hljs-comment">#+ per man page convention.</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$name1</span>"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error! No input."</span>             <span class="hljs-comment"># Mandatory input.</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOINPUT</span>                     <span class="hljs-comment"># Critical!</span>
    <span class="hljs-comment">#  Exercise: The script-abort if no filename input is a bit clumsy.</span>
    <span class="hljs-comment">#            Rewrite this section so a default filename is used</span>
    <span class="hljs-comment">#+           if no input.</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"  \"<span class="hljs-variable">$section</span>\""</span>&gt;&gt;<span class="hljs-variable">$savefile</span>   <span class="hljs-comment"># Append, always append.</span>

  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Version? "</span>
  <span class="hljs-built_in">read</span> ver
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">" \"Version <span class="hljs-variable">$ver</span> \""</span>&gt;&gt;<span class="hljs-variable">$savefile</span>
  <span class="hljs-built_in">echo</span> &gt;&gt;<span class="hljs-variable">$savefile</span>

  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Short description [0 - 5 words]? "</span>
  <span class="hljs-built_in">read</span> sdesc
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$NameHeader</span>"</span>&gt;&gt;<span class="hljs-variable">$savefile</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span><span class="hljs-variable">$BOLD</span><span class="hljs-string">" "</span><span class="hljs-variable">$name</span><span class="hljs-string">""</span>&gt;&gt;<span class="hljs-variable">$savefile</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"\- "</span><span class="hljs-variable">$sdesc</span><span class="hljs-string">""</span>&gt;&gt;<span class="hljs-variable">$savefile</span>

}

<span class="hljs-function"><span class="hljs-title">fill_in</span></span> ()
{ <span class="hljs-comment"># This function more or less copied from "pad.sh" script.</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$2</span>? "</span>       <span class="hljs-comment"># Get user input.</span>
  <span class="hljs-built_in">read</span> var             <span class="hljs-comment"># May paste (a single line only!) to fill in field.</span>

  <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$var</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span> "</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$var</span>"</span> &gt;&gt;<span class="hljs-variable">$savefile</span>
  <span class="hljs-keyword">else</span>                 <span class="hljs-comment"># Don't append empty field to file.</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$E_NOINPUT</span>  <span class="hljs-comment"># Not critical here.</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-built_in">echo</span> &gt;&gt;<span class="hljs-variable">$savefile</span>

}    


<span class="hljs-function"><span class="hljs-title">end</span></span> ()
{
clear
<span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Would you like to view the saved man page (y/n)? "</span>
<span class="hljs-built_in">read</span> ans
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$ans</span>"</span> = <span class="hljs-string">"n"</span> -o <span class="hljs-string">"<span class="hljs-variable">$ans</span>"</span> = <span class="hljs-string">"N"</span> ]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">exit</span>; <span class="hljs-keyword">fi</span>
<span class="hljs-built_in">exec</span> less <span class="hljs-string">"<span class="hljs-variable">$savefile</span>"</span>  <span class="hljs-comment">#  Exit script and hand off control to "less" ...</span>
                       <span class="hljs-comment">#+ ... which formats for viewing man page source.</span>
}


<span class="hljs-comment"># ---------------------------------------- #</span>
start
progname <span class="hljs-string">"<span class="hljs-variable">$TopHeader</span>"</span>
fill_in <span class="hljs-string">"<span class="hljs-variable">$SynopsisHeader</span>"</span> <span class="hljs-string">"Synopsis"</span>
fill_in <span class="hljs-string">"<span class="hljs-variable">$DescHeader</span>"</span> <span class="hljs-string">"Long description"</span>
<span class="hljs-comment"># May paste in *single line* of text.</span>
fill_in <span class="hljs-string">"<span class="hljs-variable">$OptHeader</span>"</span> <span class="hljs-string">"Options"</span>
fill_in <span class="hljs-string">"<span class="hljs-variable">$FilesHeader</span>"</span> <span class="hljs-string">"Files"</span>
fill_in <span class="hljs-string">"<span class="hljs-variable">$AuthHeader</span>"</span> <span class="hljs-string">"Author"</span>
fill_in <span class="hljs-string">"<span class="hljs-variable">$BugsHeader</span>"</span> <span class="hljs-string">"Bugs"</span>
fill_in <span class="hljs-string">"<span class="hljs-variable">$SeeAlsoHeader</span>"</span> <span class="hljs-string">"See also"</span>
<span class="hljs-comment"># fill_in "$OtherHeader" ... as necessary.</span>
end    <span class="hljs-comment"># ... exit not needed.</span>
<span class="hljs-comment"># ---------------------------------------- #</span>

<span class="hljs-comment">#  Note that the generated man page will usually</span>
<span class="hljs-comment">#+ require manual fine-tuning with a text editor.</span>
<span class="hljs-comment">#  However, it's a distinct improvement upon</span>
<span class="hljs-comment">#+ writing man source from scratch</span>
<span class="hljs-comment">#+ or even editing a blank man page template.</span>

<span class="hljs-comment">#  The main deficiency of the script is that it permits</span>
<span class="hljs-comment">#+ pasting only a single text line into the input fields.</span>
<span class="hljs-comment">#  This may be a long, cobbled-together line, which groff</span>
<span class="hljs-comment">#  will automatically wrap and hyphenate.</span>
<span class="hljs-comment">#  However, if you want multiple (newline-separated) paragraphs,</span>
<span class="hljs-comment">#+ these must be inserted by manual text editing on the</span>
<span class="hljs-comment">#+ script-generated man page.</span>
<span class="hljs-comment">#  Exercise (difficult): Fix this!</span>

<span class="hljs-comment">#  This script is not nearly as elaborate as the</span>
<span class="hljs-comment">#+ full-featured "manedit" package</span>
<span class="hljs-comment">#+ http://freshmeat.net/projects/manedit/</span>
<span class="hljs-comment">#+ but it's much easier to use.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="PETALS" id="PETALS"></a>
        <p><b>Example A-40. Petals Around the Rose</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash -i</span>
<span class="hljs-comment"># petals.sh</span>

<span class="hljs-comment">#########################################################################</span>
<span class="hljs-comment"># Petals Around the Rose                                                #</span>
<span class="hljs-comment">#                                                                       #</span>
<span class="hljs-comment"># Version 0.1 Created by Serghey Rodin                                  #</span>
<span class="hljs-comment"># Version 0.2 Modded by ABS Guide Author                                #</span>
<span class="hljs-comment">#                                                                       #</span>
<span class="hljs-comment"># License: GPL3                                                         #</span>
<span class="hljs-comment"># Used in ABS Guide with permission.                                    #</span>
<span class="hljs-comment"># ##################################################################### #</span>

hits=0      <span class="hljs-comment"># Correct guesses.</span>
WIN=6       <span class="hljs-comment"># Mastered the game.</span>
ALMOST=5    <span class="hljs-comment"># One short of mastery.</span>
EXIT=<span class="hljs-built_in">exit</span>   <span class="hljs-comment"># Give up early?</span>

RANDOM=$$   <span class="hljs-comment"># Seeds the random number generator from PID of script.</span>


<span class="hljs-comment"># Bones (ASCII graphics for dice)</span>
bone1[1]=<span class="hljs-string">"|         |"</span>
bone1[2]=<span class="hljs-string">"|       o |"</span>
bone1[3]=<span class="hljs-string">"|       o |"</span>
bone1[4]=<span class="hljs-string">"| o     o |"</span>
bone1[5]=<span class="hljs-string">"| o     o |"</span>
bone1[6]=<span class="hljs-string">"| o     o |"</span>
bone2[1]=<span class="hljs-string">"|    o    |"</span>
bone2[2]=<span class="hljs-string">"|         |"</span>
bone2[3]=<span class="hljs-string">"|    o    |"</span>
bone2[4]=<span class="hljs-string">"|         |"</span>
bone2[5]=<span class="hljs-string">"|    o    |"</span>
bone2[6]=<span class="hljs-string">"| o     o |"</span>
bone3[1]=<span class="hljs-string">"|         |"</span>
bone3[2]=<span class="hljs-string">"| o       |"</span>
bone3[3]=<span class="hljs-string">"| o       |"</span>
bone3[4]=<span class="hljs-string">"| o     o |"</span>
bone3[5]=<span class="hljs-string">"| o     o |"</span>
bone3[6]=<span class="hljs-string">"| o     o |"</span>
bone=<span class="hljs-string">"+---------+"</span>



<span class="hljs-comment"># Functions</span>

<span class="hljs-function"><span class="hljs-title">instructions</span></span> () {

  clear
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Do you need instructions? (y/n) "</span>; <span class="hljs-built_in">read</span> ans
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$ans</span>"</span> = <span class="hljs-string">"y"</span> -o <span class="hljs-string">"<span class="hljs-variable">$ans</span>"</span> = <span class="hljs-string">"Y"</span> ]; <span class="hljs-keyword">then</span>
    clear
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">'\E[34;47m'</span>  <span class="hljs-comment"># Blue type.</span>

<span class="hljs-comment">#  "cat document"</span>
    cat &lt;&lt;INSTRUCTIONSZZZ
The name of the game is Petals Around the Rose,
and that name is significant.
Five dice will roll and you must guess the <span class="hljs-string">"answer"</span> <span class="hljs-keyword">for</span> each roll.
It will be zero or an even number.
After your guess, you will be told the answer <span class="hljs-keyword">for</span> the roll, but . . .
that<span class="hljs-string">'s ALL the information you will get.

Six consecutive correct guesses admits you to the
Fellowship of the Rose.
INSTRUCTIONSZZZ

    echo -e "\033[0m"    # Turn off blue.
    else clear
  fi

}


fortune ()
{
  RANGE=7
  FLOOR=0
  number=0
  while [ "$number" -le $FLOOR ]
  do
    number=$RANDOM
    let "number %= $RANGE"   # 1 - 6.
  done

  return $number
}



throw () { # Calculate each individual die.
  fortune; B1=$?
  fortune; B2=$?
  fortune; B3=$?
  fortune; B4=$?
  fortune; B5=$?

  calc () { # Function embedded within a function!
    case "$1" in
       3   ) rose=2;;
       5   ) rose=4;;
       *   ) rose=0;;
    esac    # Simplified algorithm.
            # Doesn'</span>t really get to the heart of the matter.
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$rose</span>
  }

  answer=0
  calc <span class="hljs-string">"<span class="hljs-variable">$B1</span>"</span>; answer=$(expr <span class="hljs-variable">$answer</span> + $(<span class="hljs-built_in">echo</span> $?))
  calc <span class="hljs-string">"<span class="hljs-variable">$B2</span>"</span>; answer=$(expr <span class="hljs-variable">$answer</span> + $(<span class="hljs-built_in">echo</span> $?))
  calc <span class="hljs-string">"<span class="hljs-variable">$B3</span>"</span>; answer=$(expr <span class="hljs-variable">$answer</span> + $(<span class="hljs-built_in">echo</span> $?))
  calc <span class="hljs-string">"<span class="hljs-variable">$B4</span>"</span>; answer=$(expr <span class="hljs-variable">$answer</span> + $(<span class="hljs-built_in">echo</span> $?))
  calc <span class="hljs-string">"<span class="hljs-variable">$B5</span>"</span>; answer=$(expr <span class="hljs-variable">$answer</span> + $(<span class="hljs-built_in">echo</span> $?))
}



<span class="hljs-function"><span class="hljs-title">game</span></span> ()
{ <span class="hljs-comment"># Generate graphic display of dice throw.</span>
  throw
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\033[1m"</span>    <span class="hljs-comment"># Bold.</span>
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n"</span>
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"<span class="hljs-variable">$bone</span>\t<span class="hljs-variable">$bone</span>\t<span class="hljs-variable">$bone</span>\t<span class="hljs-variable">$bone</span>\t<span class="hljs-variable">$bone</span>"</span>
  <span class="hljs-built_in">echo</span> -e \
 <span class="hljs-string">"<span class="hljs-variable">${bone1[$B1]}</span>\t<span class="hljs-variable">${bone1[$B2]}</span>\t<span class="hljs-variable">${bone1[$B3]}</span>\t<span class="hljs-variable">${bone1[$B4]}</span>\t<span class="hljs-variable">${bone1[$B5]}</span>"</span>
  <span class="hljs-built_in">echo</span> -e \
 <span class="hljs-string">"<span class="hljs-variable">${bone2[$B1]}</span>\t<span class="hljs-variable">${bone2[$B2]}</span>\t<span class="hljs-variable">${bone2[$B3]}</span>\t<span class="hljs-variable">${bone2[$B4]}</span>\t<span class="hljs-variable">${bone2[$B5]}</span>"</span>
  <span class="hljs-built_in">echo</span> -e \
 <span class="hljs-string">"<span class="hljs-variable">${bone3[$B1]}</span>\t<span class="hljs-variable">${bone3[$B2]}</span>\t<span class="hljs-variable">${bone3[$B3]}</span>\t<span class="hljs-variable">${bone3[$B4]}</span>\t<span class="hljs-variable">${bone3[$B5]}</span>"</span>
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"<span class="hljs-variable">$bone</span>\t<span class="hljs-variable">$bone</span>\t<span class="hljs-variable">$bone</span>\t<span class="hljs-variable">$bone</span>\t<span class="hljs-variable">$bone</span>"</span>
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n\n\t\t"</span>
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\033[0m"</span>    <span class="hljs-comment"># Turn off bold.</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"There are how many petals around the rose? "</span>
}



<span class="hljs-comment"># ============================================================== #</span>

instructions

<span class="hljs-keyword">while</span> [ <span class="hljs-string">"<span class="hljs-variable">$petal</span>"</span> != <span class="hljs-string">"<span class="hljs-variable">$EXIT</span>"</span> ]    <span class="hljs-comment"># Main loop.</span>
<span class="hljs-keyword">do</span>
  game
  <span class="hljs-built_in">read</span> petal
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$petal</span>"</span> | grep [0-9] &gt;/dev/null  <span class="hljs-comment"># Filter response for digit.</span>
                                         <span class="hljs-comment"># Otherwise just roll dice again.</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"$?"</span> -eq 0 ]   <span class="hljs-comment"># If-loop #1.</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$petal</span>"</span> == <span class="hljs-string">"<span class="hljs-variable">$answer</span>"</span> ]; <span class="hljs-keyword">then</span>    <span class="hljs-comment"># If-loop #2.</span>
        <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\nCorrect. There are <span class="hljs-variable">$petal</span> petals around the rose.\n"</span>
        (( hits++ ))

        <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$hits</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$WIN</span>"</span> ]; <span class="hljs-keyword">then</span>   <span class="hljs-comment"># If-loop #3.</span>
          <span class="hljs-built_in">echo</span> -e <span class="hljs-string">'\E[31;47m'</span>  <span class="hljs-comment"># Red type.</span>
          <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\033[1m"</span>    <span class="hljs-comment"># Bold.</span>
          <span class="hljs-built_in">echo</span> <span class="hljs-string">"You have unraveled the mystery of the Rose Petals!"</span>
          <span class="hljs-built_in">echo</span> <span class="hljs-string">"Welcome to the Fellowship of the Rose!!!"</span>
          <span class="hljs-built_in">echo</span> <span class="hljs-string">"(You are herewith sworn to secrecy.)"</span>; <span class="hljs-built_in">echo</span>
          <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\033[0m"</span>    <span class="hljs-comment"># Turn off red &amp; bold.</span>
          <span class="hljs-built_in">break</span>                <span class="hljs-comment"># Exit!</span>
        <span class="hljs-keyword">else</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"You have <span class="hljs-variable">$hits</span> correct so far."</span>; <span class="hljs-built_in">echo</span>

        <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$hits</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$ALMOST</span>"</span> ]; <span class="hljs-keyword">then</span>
          <span class="hljs-built_in">echo</span> <span class="hljs-string">"Just one more gets you to the heart of the mystery!"</span>; <span class="hljs-built_in">echo</span>
        <span class="hljs-keyword">fi</span>

      <span class="hljs-keyword">fi</span>                                  <span class="hljs-comment"># Close if-loop #3.</span>

    <span class="hljs-keyword">else</span>
      <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\nWrong. There are <span class="hljs-variable">$answer</span> petals around the rose.\n"</span>
      hits=0   <span class="hljs-comment"># Reset number of correct guesses.</span>
    <span class="hljs-keyword">fi</span>                                    <span class="hljs-comment"># Close if-loop #2.</span>

    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Hit ENTER for the next roll, or type \"exit\" to end. "</span>
    <span class="hljs-built_in">read</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$REPLY</span>"</span> = <span class="hljs-string">"<span class="hljs-variable">$EXIT</span>"</span> ]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">exit</span>
    <span class="hljs-keyword">fi</span>

  <span class="hljs-keyword">fi</span>                  <span class="hljs-comment"># Close if-loop #1.</span>

  clear
<span class="hljs-keyword">done</span>                  <span class="hljs-comment"># End of main (while) loop.</span>

<span class="hljs-comment">###</span>

<span class="hljs-built_in">exit</span> $?

<span class="hljs-comment"># Resources:</span>
<span class="hljs-comment"># ---------</span>
<span class="hljs-comment"># 1) http://en.wikipedia.org/wiki/Petals_Around_the_Rose</span>
<span class="hljs-comment">#    (Wikipedia entry.)</span>
<span class="hljs-comment"># 2) http://www.borrett.id.au/computing/petals-bg.htm</span>
<span class="hljs-comment">#    (How Bill Gates coped with the Petals Around the Rose challenge.)</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="QKY" id="QKY"></a>
        <p><b>Example A-41. Quacky: a Perquackey-type word game</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># qky.sh</span>

<span class="hljs-comment">##############################################################</span>
<span class="hljs-comment"># QUACKEY: a somewhat simplified version of Perquackey [TM]. #</span>
<span class="hljs-comment">#                                                            #</span>
<span class="hljs-comment"># Author: Mendel Cooper  &lt;thegrendel.abs@gmail.com&gt;          #</span>
<span class="hljs-comment"># version 0.1.02      03 May, 2008                           #</span>
<span class="hljs-comment"># License: GPL3                                              #</span>
<span class="hljs-comment">##############################################################</span>

WLIST=/usr/share/dict/word.lst
<span class="hljs-comment">#                     ^^^^^^^^  Word list file found here.</span>
<span class="hljs-comment">#  ASCII word list, one word per line, UNIX format.</span>
<span class="hljs-comment">#  A suggested list is the script author's "yawl" word list package.</span>
<span class="hljs-comment">#  http://bash.deta.in/yawl-0.3.2.tar.gz</span>
<span class="hljs-comment">#    or</span>
<span class="hljs-comment">#  http://ibiblio.org/pub/Linux/libs/yawl-0.3.2.tar.gz</span>

NONCONS=0     <span class="hljs-comment"># Word not constructable from letter set.</span>
CONS=1        <span class="hljs-comment"># Constructable.</span>
SUCCESS=0
NG=1
FAILURE=<span class="hljs-string">''</span>
NULL=0        <span class="hljs-comment"># Zero out value of letter (if found).</span>
MINWLEN=3     <span class="hljs-comment"># Minimum word length.</span>
MAXCAT=5      <span class="hljs-comment"># Maximum number of words in a given category.</span>
PENALTY=200   <span class="hljs-comment"># General-purpose penalty for unacceptable words.</span>
total=
E_DUP=70      <span class="hljs-comment"># Duplicate word error.</span>

TIMEOUT=10    <span class="hljs-comment"># Time for word input.</span>

NVLET=10      <span class="hljs-comment"># 10 letters for non-vulnerable.</span>
VULET=13      <span class="hljs-comment"># 13 letters for vulnerable (not yet implemented!).</span>

<span class="hljs-built_in">declare</span> -a Words
<span class="hljs-built_in">declare</span> -a Status
<span class="hljs-built_in">declare</span> -a Score=( 0 0 0 0 0 0 0 0 0 0 0 )


letters=( a n s r t m l k p r b c i d s i d z e w u e t f
e y e r e f e g t g h h i t r s c i t i d i j a t a o l a
m n a n o v n w o s e l n o s p a q e e r a b r s a o d s
t g t i t l u e u v n e o x y m r k )
<span class="hljs-comment">#  Letter distribution table shamelessly borrowed from "Wordy" game,</span>
<span class="hljs-comment">#+ ca. 1992, written by a certain fine fellow named Mendel Cooper.</span>

<span class="hljs-built_in">declare</span> -a LS

numelements=<span class="hljs-variable">${#letters[@]}</span>
randseed=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>

<span class="hljs-function"><span class="hljs-title">instructions</span></span> ()
{
  clear
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Welcome to QUACKEY, the anagramming word construction game."</span>; <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Do you need instructions? (y/n) "</span>; <span class="hljs-built_in">read</span> ans

   <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$ans</span>"</span> = <span class="hljs-string">"y"</span> -o <span class="hljs-string">"<span class="hljs-variable">$ans</span>"</span> = <span class="hljs-string">"Y"</span> ]; <span class="hljs-keyword">then</span>
     clear
     <span class="hljs-built_in">echo</span> -e <span class="hljs-string">'\E[31;47m'</span>  <span class="hljs-comment"># Red foreground. '\E[34;47m' for blue.</span>
     cat &lt;&lt;INSTRUCTION1

QUACKEY is a variant of Perquackey [TM].
The rules are the same, but the scoring is simplified
and plurals of previously played words are allowed.
<span class="hljs-string">"Vulnerable"</span> play is not yet implemented,
but it is otherwise feature-complete.

As the game begins, the player gets 10 letters.
The object is to construct valid dictionary words
of at least 3-letter length from the letterset.
Each word-length category
-- 3-letter, 4-letter, 5-letter, ... --
fills up with the fifth word entered,
and no further words <span class="hljs-keyword">in</span> that category are accepted.

The penalty <span class="hljs-keyword">for</span> too-short (two-letter), duplicate, unconstructable,
and invalid (not <span class="hljs-keyword">in</span> dictionary) words is -200. The same penalty applies
to attempts to enter a word <span class="hljs-keyword">in</span> a filled-up category.

INSTRUCTION1

  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Hit ENTER for next page of instructions. "</span>; <span class="hljs-built_in">read</span> az1

     cat &lt;&lt;INSTRUCTION2

The scoring mostly corresponds to classic Perquackey:
The first 3-letter word scores    60, plus   10 <span class="hljs-keyword">for</span> each additional one.
The first 4-letter word scores   120, plus   20 <span class="hljs-keyword">for</span> each additional one.
The first 5-letter word scores   200, plus   50 <span class="hljs-keyword">for</span> each additional one.
The first 6-letter word scores   300, plus  100 <span class="hljs-keyword">for</span> each additional one.
The first 7-letter word scores   500, plus  150 <span class="hljs-keyword">for</span> each additional one.
The first 8-letter word scores   750, plus  250 <span class="hljs-keyword">for</span> each additional one.
The first 9-letter word scores  1000, plus  500 <span class="hljs-keyword">for</span> each additional one.
The first 10-letter word scores 2000, plus 2000 <span class="hljs-keyword">for</span> each additional one.

Category completion bonuses are:
3-letter words   100
4-letter words   200
5-letter words   400
6-letter words   800
7-letter words  2000
8-letter words 10000
This is a simplification of the absurdly baroque Perquackey bonus
scoring system.

INSTRUCTION2

  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Hit ENTER for final page of instructions. "</span>; <span class="hljs-built_in">read</span> az1

     cat &lt;&lt;INSTRUCTION3


Hitting just ENTER <span class="hljs-keyword">for</span> a word entry ends the game.

Individual word entry is timed to a maximum of 10 seconds.
*** Timing out on an entry ends the game. ***
Aside from that, the game is untimed.

--------------------------------------------------
Game statistics are automatically saved to a file.
--------------------------------------------------

For competitive (<span class="hljs-string">"duplicate"</span>) play, a previous letterset
may be duplicated by repeating the script<span class="hljs-string">'s random seed,
command-line parameter \$1.
For example, "qky 7633" specifies the letterset 
c a d i f r h u s k ...
INSTRUCTION3

  echo; echo -n "Hit ENTER to begin game. "; read az1

       echo -e "\033[0m"    # Turn off red.
     else clear
  fi

  clear

}



seed_random ()
{                         #  Seed random number generator.
  if [ -n "$randseed" ]   #  Can specify random seed.
  then                    #+ for play in competitive mode.
#   RANDOM="$randseed"
    echo "RANDOM seed set to "$randseed""
  else
    randseed="$$"         # Or get random seed from process ID.
    echo "RANDOM seed not specified, set to Process ID of script ($$)."
  fi

  RANDOM="$randseed"

  echo
}


get_letset ()
{
  element=0
  echo -n "Letterset:"

  for lset in $(seq $NVLET)
  do  # Pick random letters to fill out letterset.
    LS[element]="${letters[$((RANDOM%numelements))]}"
    ((element++))
  done

  echo
  echo "${LS[@]}"

}


add_word ()
{
  wrd="$1"
  local idx=0

  Status[0]=""
  Status[3]=""
  Status[4]=""

  while [ "${Words[idx]}" != '</span><span class="hljs-string">' ]
  do
    if [ "${Words[idx]}" = "$wrd" ]
    then
      Status[3]="Duplicate-word-PENALTY"
      let "Score[0]= 0 - $PENALTY"
      let "Score[1]-=$PENALTY"
      return $E_DUP
    fi

    ((idx++))
  done

  Words[idx]="$wrd"
  get_score

}

get_score()
{
  local wlen=0
  local score=0
  local bonus=0
  local first_word=0
  local add_word=0
  local numwords=0

  wlen=${#wrd}
  numwords=${Score[wlen]}
  Score[2]=0
  Status[4]=""   # Initialize "bonus" to 0.

  case "$wlen" in
    3) first_word=60
       add_word=10;;
    4) first_word=120
       add_word=20;;
    5) first_word=200
       add_word=50;;
    6) first_word=300
       add_word=100;;
    7) first_word=500
       add_word=150;;
    8) first_word=750
       add_word=250;;
    9) first_word=1000
       add_word=500;;
   10) first_word=2000
       add_word=2000;;   # This category modified from original rules!
      esac

  ((Score[wlen]++))
  if [ ${Score[wlen]} -eq $MAXCAT ]
  then   # Category completion bonus scoring simplified!
    case $wlen in
      3 ) bonus=100;;
      4 ) bonus=200;;
      5 ) bonus=400;;
      6 ) bonus=800;;
      7 ) bonus=2000;;
      8 ) bonus=10000;;
    esac  # Needn'</span>t worry about 9<span class="hljs-string">'s and 10'</span>s.
    Status[4]=<span class="hljs-string">"Category-<span class="hljs-variable">$wlen</span>-completion***BONUS***"</span>
    Score[2]=<span class="hljs-variable">$bonus</span>
  <span class="hljs-keyword">else</span>
    Status[4]=<span class="hljs-string">""</span>   <span class="hljs-comment"># Erase it.</span>
  <span class="hljs-keyword">fi</span>


    <span class="hljs-built_in">let</span> <span class="hljs-string">"score =  <span class="hljs-variable">$first_word</span> +   <span class="hljs-variable">$add_word</span> * <span class="hljs-variable">$numwords</span>"</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$numwords</span>"</span> -eq 0 ]
    <span class="hljs-keyword">then</span>
      Score[0]=<span class="hljs-variable">$score</span>
    <span class="hljs-keyword">else</span>
      Score[0]=<span class="hljs-variable">$add_word</span>
    <span class="hljs-keyword">fi</span>   <span class="hljs-comment">#  All this to distinguish last-word score</span>
         <span class="hljs-comment">#+ from total running score.</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"Score[1] += <span class="hljs-variable">${Score[0]}</span>"</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"Score[1] += <span class="hljs-variable">${Score[2]}</span>"</span>

}



<span class="hljs-function"><span class="hljs-title">get_word</span></span> ()
{
  <span class="hljs-built_in">local</span> wrd=<span class="hljs-string">''</span>
  <span class="hljs-built_in">read</span> -t <span class="hljs-variable">$TIMEOUT</span> wrd   <span class="hljs-comment"># Timed read.</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$wrd</span>
}

<span class="hljs-function"><span class="hljs-title">is_constructable</span></span> ()
{ <span class="hljs-comment"># This is the most complex and difficult-to-write function.</span>
  <span class="hljs-built_in">local</span> -a local_LS=( <span class="hljs-string">"<span class="hljs-variable">${LS[@]}</span>"</span> )  <span class="hljs-comment"># Local copy of letter set.</span>
  <span class="hljs-built_in">local</span> is_found=0
  <span class="hljs-built_in">local</span> idx=0
  <span class="hljs-built_in">local</span> pos
  <span class="hljs-built_in">local</span> strlen
  <span class="hljs-built_in">local</span> local_word=( <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> )
  strlen=<span class="hljs-variable">${#local_word}</span>

  <span class="hljs-keyword">while</span> [ <span class="hljs-string">"<span class="hljs-variable">$idx</span>"</span> -lt <span class="hljs-string">"<span class="hljs-variable">$strlen</span>"</span> ]
  <span class="hljs-keyword">do</span>
    is_found=$(expr index <span class="hljs-string">"<span class="hljs-variable">${local_LS[*]}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${local_word:idx:1}</span>"</span>)
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$is_found</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$NONCONS</span>"</span> ] <span class="hljs-comment"># Not constructable!</span>
    <span class="hljs-keyword">then</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$FAILURE</span>"</span>; <span class="hljs-built_in">return</span>
    <span class="hljs-keyword">else</span>
      ((pos = (<span class="hljs-variable">$is_found</span> - 1) / 2))   <span class="hljs-comment"># Compensate for spaces betw. letters!</span>
      local_LS[pos]=<span class="hljs-variable">$NULL</span>             <span class="hljs-comment"># Zero out used letters.</span>
      ((idx++))                       <span class="hljs-comment"># Bump index.</span>
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>

  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$SUCCESS</span>"</span>
  <span class="hljs-built_in">return</span>
}

<span class="hljs-function"><span class="hljs-title">is_valid</span></span> ()
{ <span class="hljs-comment"># Surprisingly easy to check if word in dictionary ...</span>
  fgrep -qw <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$WLIST</span>"</span>   <span class="hljs-comment"># ... courtesy of 'grep' ...</span>
  <span class="hljs-built_in">echo</span> $?
}

<span class="hljs-function"><span class="hljs-title">check_word</span></span> ()
{
  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">return</span>
  <span class="hljs-keyword">fi</span>

  Status[1]=<span class="hljs-string">""</span>
  Status[2]=<span class="hljs-string">""</span>
  Status[3]=<span class="hljs-string">""</span>
  Status[4]=<span class="hljs-string">""</span>

  iscons=$(is_constructable <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>)
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$iscons</span>"</span> ]
  <span class="hljs-keyword">then</span>
    Status[1]=<span class="hljs-string">"constructable"</span> 
    v=$(is_valid <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>)
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$v</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$SUCCESS</span>"</span> ]
    <span class="hljs-keyword">then</span>
      Status[2]=<span class="hljs-string">"valid"</span> 
      strlen=<span class="hljs-variable">${#1}</span>

      <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${Score[strlen]}</span> -eq <span class="hljs-string">"<span class="hljs-variable">$MAXCAT</span>"</span> ]   <span class="hljs-comment"># Category full!</span>
      <span class="hljs-keyword">then</span>
        Status[3]=<span class="hljs-string">"Category-<span class="hljs-variable">$strlen</span>-overflow-PENALTY"</span>
        <span class="hljs-built_in">return</span> <span class="hljs-variable">$NG</span>
      <span class="hljs-keyword">fi</span>

      <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$strlen</span>"</span> <span class="hljs-keyword">in</span>
        1 | 2 )
        Status[3]=<span class="hljs-string">"Two-letter-word-PENALTY"</span>
        <span class="hljs-built_in">return</span> <span class="hljs-variable">$NG</span>;;
        * ) 
        Status[3]=<span class="hljs-string">""</span>
        <span class="hljs-built_in">return</span> <span class="hljs-variable">$SUCCESS</span>;;
      <span class="hljs-keyword">esac</span>
    <span class="hljs-keyword">else</span>
      Status[3]=<span class="hljs-string">"Not-valid-PENALTY"</span>
      <span class="hljs-built_in">return</span> <span class="hljs-variable">$NG</span>
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">else</span>
    Status[3]=<span class="hljs-string">"Not-constructable-PENALTY"</span> 
      <span class="hljs-built_in">return</span> <span class="hljs-variable">$NG</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-comment">### <span class="hljs-doctag">FIXME:</span> Streamline the above code block.</span>

}


<span class="hljs-function"><span class="hljs-title">display_words</span></span> ()
{
  <span class="hljs-built_in">local</span> idx=0
  <span class="hljs-built_in">local</span> wlen0

  clear
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Letterset:   <span class="hljs-variable">${LS[@]}</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Threes:    Fours:    Fives:     Sixes:    Sevens:    Eights:"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"------------------------------------------------------------"</span>


   
  <span class="hljs-keyword">while</span> [ <span class="hljs-string">"<span class="hljs-variable">${Words[idx]}</span>"</span> != <span class="hljs-string">''</span> ]
  <span class="hljs-keyword">do</span>
   wlen0=<span class="hljs-variable">${#Words[idx]}</span>
   <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$wlen0</span>"</span> <span class="hljs-keyword">in</span>
     3) ;;
     4) <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"           "</span> ;;
     5) <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"                     "</span> ;;
     6) <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"                                "</span> ;;
     7) <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"                                          "</span> ;;
     8) <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"                                                     "</span> ;;
   <span class="hljs-keyword">esac</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${Words[idx]}</span>"</span>
   ((idx++))
  <span class="hljs-keyword">done</span>

  <span class="hljs-comment">### <span class="hljs-doctag">FIXME:</span> The word display is pretty crude.</span>
}


<span class="hljs-function"><span class="hljs-title">play</span></span> ()
{
  word=<span class="hljs-string">"Start game"</span>   <span class="hljs-comment"># Dummy word, to start ...</span>

  <span class="hljs-keyword">while</span> [ <span class="hljs-string">"<span class="hljs-variable">$word</span>"</span> ]   <span class="hljs-comment">#  If player just hits return (null word),</span>
  <span class="hljs-keyword">do</span>                  <span class="hljs-comment">#+ then game ends.</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$word</span>: "</span><span class="hljs-variable">${Status[@]}</span><span class="hljs-string">""</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Last score: [<span class="hljs-variable">${Score[0]}</span>]   TOTAL score: [<span class="hljs-variable">${Score[1]}</span>]:     Next word: "</span>
    total=<span class="hljs-variable">${Score[1]}</span>
    word=$(get_word)
    check_word <span class="hljs-string">"<span class="hljs-variable">$word</span>"</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"$?"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$SUCCESS</span>"</span> ]
    <span class="hljs-keyword">then</span>
      add_word <span class="hljs-string">"<span class="hljs-variable">$word</span>"</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-built_in">let</span> <span class="hljs-string">"Score[0]= 0 - <span class="hljs-variable">$PENALTY</span>"</span>
      <span class="hljs-built_in">let</span> <span class="hljs-string">"Score[1]-=<span class="hljs-variable">$PENALTY</span>"</span>
    <span class="hljs-keyword">fi</span>

  display_words
  <span class="hljs-keyword">done</span>   <span class="hljs-comment"># Exit game.</span>

  <span class="hljs-comment">### <span class="hljs-doctag">FIXME:</span> The play () function calls too many other functions.</span>
  <span class="hljs-comment">### This verges on "spaghetti code" !!!</span>
}

<span class="hljs-function"><span class="hljs-title">end_of_game</span></span> ()
{ <span class="hljs-comment"># Save and display stats.</span>

  <span class="hljs-comment">#######################Autosave##########################</span>
  savefile=qky.save.$$
  <span class="hljs-comment">#                 ^^ PID of script</span>
  <span class="hljs-built_in">echo</span> `date` &gt;&gt; <span class="hljs-variable">$savefile</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Letterset # <span class="hljs-variable">$randseed</span>  (random seed) "</span>&gt;&gt; <span class="hljs-variable">$savefile</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Letterset: "</span> &gt;&gt; <span class="hljs-variable">$savefile</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${LS[@]}</span>"</span> &gt;&gt; <span class="hljs-variable">$savefile</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"---------"</span> &gt;&gt; <span class="hljs-variable">$savefile</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Words constructed:"</span> &gt;&gt; <span class="hljs-variable">$savefile</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${Words[@]}</span>"</span> &gt;&gt; <span class="hljs-variable">$savefile</span>
  <span class="hljs-built_in">echo</span> &gt;&gt; <span class="hljs-variable">$savefile</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Score: <span class="hljs-variable">$total</span>"</span> &gt;&gt; <span class="hljs-variable">$savefile</span>

  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Statistics for this round saved in \""</span><span class="hljs-variable">$savefile</span><span class="hljs-string">"\""</span>
  <span class="hljs-comment">#########################################################</span>

  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Score for this round: <span class="hljs-variable">$total</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Words:  <span class="hljs-variable">${Words[@]}</span>"</span>
}

<span class="hljs-comment"># ---------#</span>
instructions
seed_random
get_letset
play
end_of_game
<span class="hljs-comment"># ---------#</span>

<span class="hljs-built_in">exit</span> $?

<span class="hljs-comment"># <span class="hljs-doctag">TODO:</span></span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># 1) Clean up code!</span>
<span class="hljs-comment"># 2) Prettify the display_words () function (maybe with widgets?).</span>
<span class="hljs-comment"># 3) Improve the time-out ... maybe change to untimed entry,</span>
<span class="hljs-comment">#+   but with a time limit for the overall round.   </span>
<span class="hljs-comment"># 4) An on-screen countdown timer would be nice.</span>
<span class="hljs-comment"># 5) Implement "vulnerable" mode of play for compatibility with classic</span>
<span class="hljs-comment">#+   version of the game.</span>
<span class="hljs-comment"># 6) Improve save-to-file capability (and maybe make it optional).</span>
<span class="hljs-comment"># 7) Fix bugs!!!</span>

<span class="hljs-comment"># For more info, reference:</span>
<span class="hljs-comment"># http://bash.deta.in/qky.README.html</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="NIM" id="NIM"></a>
        <p><b>Example A-42. Nim</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># nim.sh: Game of Nim</span>

<span class="hljs-comment"># Author: Mendel Cooper</span>
<span class="hljs-comment"># Reldate: 15 July 2008</span>
<span class="hljs-comment"># License: GPL3</span>

ROWS=5     <span class="hljs-comment"># Five rows of pegs (or matchsticks).</span>
WON=91     <span class="hljs-comment"># Exit codes to keep track of wins/losses.</span>
LOST=92    <span class="hljs-comment"># Possibly useful if running in batch mode.  </span>
QUIT=99
peg_msg=   <span class="hljs-comment"># Peg/Pegs?</span>
Rows=( 0 5 4 3 2 1 )   <span class="hljs-comment"># Array holding play info.</span>
<span class="hljs-comment"># ${Rows[0]} holds total number of pegs, updated after each turn.</span>
<span class="hljs-comment"># Other array elements hold number of pegs in corresponding row.</span>

<span class="hljs-function"><span class="hljs-title">instructions</span></span> ()
{
  clear
  tput bold
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Welcome to the game of Nim."</span>; <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Do you need instructions? (y/n) "</span>; <span class="hljs-built_in">read</span> ans

   <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$ans</span>"</span> = <span class="hljs-string">"y"</span> -o <span class="hljs-string">"<span class="hljs-variable">$ans</span>"</span> = <span class="hljs-string">"Y"</span> ]; <span class="hljs-keyword">then</span>
     clear
     <span class="hljs-built_in">echo</span> -e <span class="hljs-string">'\E[33;41m'</span>  <span class="hljs-comment"># Yellow fg., over red bg.; bold.</span>
     cat &lt;&lt;INSTRUCTIONS

Nim is a game with roots <span class="hljs-keyword">in</span> the distant past.
This particular variant starts with five rows of pegs.

1:    | | | | | 
2:     | | | | 
3:      | | | 
4:       | | 
5:        | 

The number at the left identifies the row.

The human player moves first, and alternates turns with the bot.
A turn consists of removing at least one peg from a single row.
It is permissable to remove ALL the pegs from a row.
For example, <span class="hljs-keyword">in</span> row 2, above, the player can remove 1, 2, 3, or 4 pegs.
The player who removes the last peg loses.

The strategy consists of trying to be the one who removes
the next-to-last peg(s), leaving the loser with the final peg.

To <span class="hljs-built_in">exit</span> the game early, hit ENTER during your turn.
INSTRUCTIONS

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Hit ENTER to begin game. "</span>; <span class="hljs-built_in">read</span> azx

      <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\033[0m"</span>    <span class="hljs-comment"># Restore display.</span>
      <span class="hljs-keyword">else</span> tput sgr0; clear
  <span class="hljs-keyword">fi</span>

clear

}


<span class="hljs-function"><span class="hljs-title">tally_up</span></span> ()
{
  <span class="hljs-built_in">let</span> <span class="hljs-string">"Rows[0] = <span class="hljs-variable">${Rows[1]}</span> + <span class="hljs-variable">${Rows[2]}</span> + <span class="hljs-variable">${Rows[3]}</span> + <span class="hljs-variable">${Rows[4]}</span> + \
  <span class="hljs-variable">${Rows[5]}</span>"</span>    <span class="hljs-comment"># Add up how many pegs remaining.</span>
}


<span class="hljs-function"><span class="hljs-title">display</span></span> ()
{
  index=1   <span class="hljs-comment"># Start with top row.</span>
  <span class="hljs-built_in">echo</span>

  <span class="hljs-keyword">while</span> [ <span class="hljs-string">"<span class="hljs-variable">$index</span>"</span> -le <span class="hljs-string">"<span class="hljs-variable">$ROWS</span>"</span> ]
  <span class="hljs-keyword">do</span>
    p=<span class="hljs-variable">${Rows[index]}</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$index</span>:   "</span>          <span class="hljs-comment"># Show row number.</span>

  <span class="hljs-comment"># ------------------------------------------------</span>
  <span class="hljs-comment"># Two concurrent inner loops.</span>

      indent=<span class="hljs-variable">$index</span>
      <span class="hljs-keyword">while</span> [ <span class="hljs-string">"<span class="hljs-variable">$indent</span>"</span> -gt 0 ]
      <span class="hljs-keyword">do</span>
        <span class="hljs-built_in">echo</span> -n <span class="hljs-string">" "</span>               <span class="hljs-comment"># Staggered rows.</span>
        ((indent--))              <span class="hljs-comment"># Spacing between pegs.</span>
      <span class="hljs-keyword">done</span>

    <span class="hljs-keyword">while</span> [ <span class="hljs-string">"<span class="hljs-variable">$p</span>"</span> -gt 0 ]
    <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"| "</span>
      ((p--))
    <span class="hljs-keyword">done</span>
  <span class="hljs-comment"># -----------------------------------------------</span>

  <span class="hljs-built_in">echo</span>
  ((index++))
  <span class="hljs-keyword">done</span>  

  tally_up

  rp=<span class="hljs-variable">${Rows[0]}</span>

  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$rp</span>"</span> -eq 1 ]
  <span class="hljs-keyword">then</span>
    peg_msg=peg
    final_msg=<span class="hljs-string">"Game over."</span>
  <span class="hljs-keyword">else</span>             <span class="hljs-comment"># Game not yet over . . .</span>
    peg_msg=pegs
    final_msg=<span class="hljs-string">""</span>   <span class="hljs-comment"># . . . So "final message" is blank.</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-built_in">echo</span> <span class="hljs-string">"      <span class="hljs-variable">$rp</span> <span class="hljs-variable">$peg_msg</span> remaining."</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"      "</span><span class="hljs-variable">$final_msg</span><span class="hljs-string">""</span>


  <span class="hljs-built_in">echo</span>
}

<span class="hljs-function"><span class="hljs-title">player_move</span></span> ()
{

  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Your move:"</span>

  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Which row? "</span>
  <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> idx
  <span class="hljs-keyword">do</span>                   <span class="hljs-comment"># Validity check, etc.</span>

    <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$idx</span>"</span> ]   <span class="hljs-comment"># Hitting return quits.</span>
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Premature exit."</span>; <span class="hljs-built_in">echo</span>
        tput sgr0      <span class="hljs-comment"># Restore display.</span>
        <span class="hljs-built_in">exit</span> <span class="hljs-variable">$QUIT</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$idx</span>"</span> -gt <span class="hljs-string">"<span class="hljs-variable">$ROWS</span>"</span> -o <span class="hljs-string">"<span class="hljs-variable">$idx</span>"</span> -lt 1 ]   <span class="hljs-comment"># Bounds check.</span>
    <span class="hljs-keyword">then</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"Invalid row number!"</span>
      <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Which row? "</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-built_in">break</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span></span>
    <span class="hljs-comment"># Add check for non-numeric input.</span>
    <span class="hljs-comment"># Also, script crashes on input outside of range of long double.</span>
    <span class="hljs-comment"># Fix this.</span>

  <span class="hljs-keyword">done</span>

  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Remove how many? "</span>
  <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> num
  <span class="hljs-keyword">do</span>                   <span class="hljs-comment"># Validity check.</span>

  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$num</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Premature exit."</span>; <span class="hljs-built_in">echo</span>
    tput sgr0          <span class="hljs-comment"># Restore display.</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$QUIT</span>
  <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$num</span>"</span> -gt <span class="hljs-variable">${Rows[idx]}</span> -o <span class="hljs-string">"<span class="hljs-variable">$num</span>"</span> -lt 1 ]
    <span class="hljs-keyword">then</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"Cannot remove <span class="hljs-variable">$num</span>!"</span>
      <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Remove how many? "</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-built_in">break</span>
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>
  <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span></span>
  <span class="hljs-comment"># Add check for non-numeric input.</span>
  <span class="hljs-comment"># Also, script crashes on input outside of range of long double.</span>
  <span class="hljs-comment"># Fix this.</span>

  <span class="hljs-built_in">let</span> <span class="hljs-string">"Rows[idx] -= <span class="hljs-variable">$num</span>"</span>

  display
  tally_up

  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${Rows[0]}</span> -eq 1 ]
  <span class="hljs-keyword">then</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"      Human wins!"</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"      Congratulations!"</span>
   tput sgr0   <span class="hljs-comment"># Restore display.</span>
   <span class="hljs-built_in">echo</span>
   <span class="hljs-built_in">exit</span> <span class="hljs-variable">$WON</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${Rows[0]}</span> -eq 0 ]
  <span class="hljs-keyword">then</span>          <span class="hljs-comment"># Snatching defeat from the jaws of victory . . .</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"      Fool!"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"      You just removed the last peg!"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"      Bot wins!"</span>
    tput sgr0   <span class="hljs-comment"># Restore display.</span>
    <span class="hljs-built_in">echo</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$LOST</span>
  <span class="hljs-keyword">fi</span>
}


<span class="hljs-function"><span class="hljs-title">bot_move</span></span> ()
{

  row_b=0
  <span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$row_b</span> -eq 0 || <span class="hljs-variable">${Rows[row_b]}</span> -eq 0 ]]
  <span class="hljs-keyword">do</span>
    row_b=<span class="hljs-variable">$RANDOM</span>          <span class="hljs-comment"># Choose random row.</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"row_b %= <span class="hljs-variable">$ROWS</span>"</span>
  <span class="hljs-keyword">done</span>


  num_b=0
  r0=<span class="hljs-variable">${Rows[row_b]}</span>

  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$r0</span>"</span> -eq 1 ]
  <span class="hljs-keyword">then</span>
    num_b=1
  <span class="hljs-keyword">else</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"num_b = <span class="hljs-variable">$r0</span> - 1"</span>
         <span class="hljs-comment">#  Leave only a single peg in the row.</span>
  <span class="hljs-keyword">fi</span>     <span class="hljs-comment">#  Not a very strong strategy,</span>
         <span class="hljs-comment">#+ but probably a bit better than totally random.</span>

  <span class="hljs-built_in">let</span> <span class="hljs-string">"Rows[row_b] -= <span class="hljs-variable">$num_b</span>"</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Bot:  "</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Removing from row <span class="hljs-variable">$row_b</span> ... "</span>

  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$num_b</span>"</span> -eq 1 ]
  <span class="hljs-keyword">then</span>
    peg_msg=peg
  <span class="hljs-keyword">else</span>
    peg_msg=pegs
  <span class="hljs-keyword">fi</span>

  <span class="hljs-built_in">echo</span> <span class="hljs-string">"      <span class="hljs-variable">$num_b</span> <span class="hljs-variable">$peg_msg</span>."</span>

  display
  tally_up

  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${Rows[0]}</span> -eq 1 ]
  <span class="hljs-keyword">then</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"      Bot wins!"</span>
   tput sgr0   <span class="hljs-comment"># Restore display.</span>
   <span class="hljs-built_in">exit</span> <span class="hljs-variable">$WON</span>
  <span class="hljs-keyword">fi</span>

}


<span class="hljs-comment"># ================================================== #</span>
instructions     <span class="hljs-comment"># If human player needs them . . .</span>
tput bold        <span class="hljs-comment"># Bold characters for easier viewing.</span>
display          <span class="hljs-comment"># Show game board.</span>

<span class="hljs-keyword">while</span> [ <span class="hljs-literal">true</span> ]   <span class="hljs-comment"># Main loop.</span>
<span class="hljs-keyword">do</span>               <span class="hljs-comment"># Alternate human and bot turns.</span>
  player_move
  bot_move
<span class="hljs-keyword">done</span>
<span class="hljs-comment"># ================================================== #</span>

<span class="hljs-comment"># Exercise:</span>
<span class="hljs-comment"># --------</span>
<span class="hljs-comment"># Improve the bot's strategy.</span>
<span class="hljs-comment"># There is, in fact, a Nim strategy that can force a win.</span>
<span class="hljs-comment"># See the Wikipedia article on Nim:  http://en.wikipedia.org/wiki/Nim</span>
<span class="hljs-comment"># Recode the bot to use this strategy (rather difficult).</span>

<span class="hljs-comment">#  Curiosities:</span>
<span class="hljs-comment">#  -----------</span>
<span class="hljs-comment">#  Nim played a prominent role in Alain Resnais' 1961 New Wave film,</span>
<span class="hljs-comment">#+ Last Year at Marienbad.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  In 1978, Leo Christopherson wrote an animated version of Nim,</span>
<span class="hljs-comment">#+ Android Nim, for the TRS-80 Model I.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="STOPWATCH" id="STOPWATCH"></a>
        <p><b>Example A-43. A command-line stopwatch</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/sh</span>
<span class="hljs-comment"># sw.sh</span>
<span class="hljs-comment"># A command-line Stopwatch</span>

<span class="hljs-comment"># Author: Padraig Brady</span>
<span class="hljs-comment">#    http://www.pixelbeat.org/scripts/sw</span>
<span class="hljs-comment">#    (Minor reformatting by ABS Guide author.)</span>
<span class="hljs-comment">#    Used in ABS Guide with script author's permission.</span>
<span class="hljs-comment"># Notes:</span>
<span class="hljs-comment">#    This script starts a few processes per lap, in addition to</span>
<span class="hljs-comment">#    the shell loop processing, so the assumption is made that</span>
<span class="hljs-comment">#    this takes an insignificant amount of time compared to</span>
<span class="hljs-comment">#    the response time of humans (~.1s) (or the keyboard</span>
<span class="hljs-comment">#    interrupt rate (~.05s)).</span>
<span class="hljs-comment">#    '?' for splits must be entered twice if characters</span>
<span class="hljs-comment">#    (erroneously) entered before it (on the same line).</span>
<span class="hljs-comment">#    '?' since not generating a signal may be slightly delayed</span>
<span class="hljs-comment">#    on heavily loaded systems.</span>
<span class="hljs-comment">#    Lap timings on ubuntu may be slightly delayed due to:</span>
<span class="hljs-comment">#    https://bugs.launchpad.net/bugs/62511</span>
<span class="hljs-comment"># Changes:</span>
<span class="hljs-comment">#    V1.0, 23 Aug 2005, Initial release</span>
<span class="hljs-comment">#    V1.1, 26 Jul 2007, Allow both splits and laps from single invocation.</span>
<span class="hljs-comment">#                       Only start timer after a key is pressed.</span>
<span class="hljs-comment">#                       Indicate lap number</span>
<span class="hljs-comment">#                       Cache programs at startup so there is less error</span>
<span class="hljs-comment">#                       due to startup delays.</span>
<span class="hljs-comment">#    V1.2, 01 Aug 2007, Work around `date` commands that don't have</span>
<span class="hljs-comment">#                       nanoseconds.</span>
<span class="hljs-comment">#                       Use stty to change interrupt keys to space for</span>
<span class="hljs-comment">#                       laps etc.</span>
<span class="hljs-comment">#                       Ignore other input as it causes problems.</span>
<span class="hljs-comment">#    V1.3, 01 Aug 2007, Testing release.</span>
<span class="hljs-comment">#    V1.4, 02 Aug 2007, Various tweaks to get working under ubuntu</span>
<span class="hljs-comment">#                       and Mac OS X.</span>
<span class="hljs-comment">#    V1.5, 27 Jun 2008, set LANG=C as got vague bug report about it.</span>

<span class="hljs-built_in">export</span> LANG=C

<span class="hljs-built_in">ulimit</span> -c 0   <span class="hljs-comment"># No coredumps from SIGQUIT.</span>
<span class="hljs-built_in">trap</span> <span class="hljs-string">''</span> TSTP  <span class="hljs-comment"># Ignore Ctrl-Z just in case.</span>
save_tty=`stty -g` &amp;&amp; <span class="hljs-built_in">trap</span> <span class="hljs-string">"stty <span class="hljs-variable">$save_tty</span>"</span> EXIT  <span class="hljs-comment"># Restore tty on exit.</span>
stty quit <span class="hljs-string">' '</span> <span class="hljs-comment"># Space for laps rather than Ctrl-\.</span>
stty eof  <span class="hljs-string">'?'</span> <span class="hljs-comment"># ? for splits rather than Ctrl-D.</span>
stty -<span class="hljs-built_in">echo</span>    <span class="hljs-comment"># Don't echo input.</span>

<span class="hljs-function"><span class="hljs-title">cache_progs</span></span>() {
    stty &gt; /dev/null
    date &gt; /dev/null
    grep . &lt; /dev/null
    (<span class="hljs-built_in">echo</span> <span class="hljs-string">"import time"</span> | python) 2&gt; /dev/null
    bc &lt; /dev/null
    sed <span class="hljs-string">''</span> &lt; /dev/null
    <span class="hljs-built_in">printf</span> <span class="hljs-string">'1'</span> &gt; /dev/null
    /usr/bin/time <span class="hljs-literal">false</span> 2&gt; /dev/null
    cat &lt; /dev/null
}
cache_progs   <span class="hljs-comment"># To minimise startup delay.</span>

date +%s.%N | grep -qF <span class="hljs-string">'N'</span> &amp;&amp; use_python=1 <span class="hljs-comment"># If `date` lacks nanoseconds.</span>
<span class="hljs-function"><span class="hljs-title">now</span></span>() {
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$use_python</span>"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"import time; print time.time()"</span> 2&gt;/dev/null | python
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">printf</span> <span class="hljs-string">"%.2f"</span> `date +%s.%N`
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">fmt_seconds</span></span>() {
    seconds=<span class="hljs-variable">$1</span>
    mins=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$seconds</span>/60 | bc`
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$mins</span>"</span> != <span class="hljs-string">"0"</span> ]; <span class="hljs-keyword">then</span>
        seconds=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$seconds</span> - (<span class="hljs-variable">$mins</span>*60)"</span> | bc`
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$mins</span>:<span class="hljs-variable">$seconds</span>"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$seconds</span>"</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">total</span></span>() {
    end=`now`
    total=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$end</span> - <span class="hljs-variable">$start</span>"</span> | bc`
    fmt_seconds <span class="hljs-variable">$total</span>
}

<span class="hljs-function"><span class="hljs-title">stop</span></span>() {
    [ <span class="hljs-string">"<span class="hljs-variable">$lapped</span>"</span> ] &amp;&amp; lap <span class="hljs-string">"<span class="hljs-variable">$laptime</span>"</span> <span class="hljs-string">"display"</span>
    total
    <span class="hljs-built_in">exit</span>
}

<span class="hljs-function"><span class="hljs-title">lap</span></span>() {
    laptime=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> | sed -n <span class="hljs-string">'s/.*real[^0-9.]*\(.*\)/\1/p'</span>`
    [ ! <span class="hljs-string">"<span class="hljs-variable">$laptime</span>"</span> -o <span class="hljs-string">"<span class="hljs-variable">$laptime</span>"</span> = <span class="hljs-string">"0.00"</span> ] &amp;&amp; <span class="hljs-built_in">return</span>
    <span class="hljs-comment"># Signals too frequent.</span>
    laptotal=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$laptime</span>+0<span class="hljs-variable">$laptotal</span> | bc`
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> = <span class="hljs-string">"display"</span> ]; <span class="hljs-keyword">then</span>
        lapcount=`<span class="hljs-built_in">echo</span> 0<span class="hljs-variable">$lapcount</span>+1 | bc`
        laptime=`fmt_seconds <span class="hljs-variable">$laptotal</span>`
        <span class="hljs-built_in">echo</span> <span class="hljs-variable">$laptime</span> <span class="hljs-string">"(<span class="hljs-variable">$lapcount</span>)"</span>
        lapped=<span class="hljs-string">"true"</span>
        laptotal=<span class="hljs-string">"0"</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Space for lap | ? for split | Ctrl-C to stop | Space to start..."</span>&gt;&amp;2

<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">trap</span> <span class="hljs-literal">true</span> INT QUIT  <span class="hljs-comment"># Set signal handlers.</span>
    laptime=`/usr/bin/time -p 2&gt;&amp;1 cat &gt;/dev/null`
    ret=$?
    <span class="hljs-built_in">trap</span> <span class="hljs-string">''</span> INT QUIT    <span class="hljs-comment"># Ignore signals within this script.</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$ret</span> -eq 1 -o <span class="hljs-variable">$ret</span> -eq 2 -o <span class="hljs-variable">$ret</span> -eq 130 ]; <span class="hljs-keyword">then</span> <span class="hljs-comment"># SIGINT = stop</span>
        [ ! <span class="hljs-string">"<span class="hljs-variable">$start</span>"</span> ] &amp;&amp; { <span class="hljs-built_in">echo</span> &gt;&amp;2; <span class="hljs-built_in">exit</span>; }
        stop
    <span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$ret</span> -eq 3 -o <span class="hljs-variable">$ret</span> -eq 131 ]; <span class="hljs-keyword">then</span>             <span class="hljs-comment"># SIGQUIT = lap</span>
        <span class="hljs-keyword">if</span> [ ! <span class="hljs-string">"<span class="hljs-variable">$start</span>"</span> ]; <span class="hljs-keyword">then</span>
            start=`now` || <span class="hljs-built_in">exit</span> 1
            <span class="hljs-built_in">echo</span> &gt;&amp;2
            <span class="hljs-built_in">continue</span>
        <span class="hljs-keyword">fi</span>
        lap <span class="hljs-string">"<span class="hljs-variable">$laptime</span>"</span> <span class="hljs-string">"display"</span>
    <span class="hljs-keyword">else</span>                <span class="hljs-comment"># eof = split</span>
        [ ! <span class="hljs-string">"<span class="hljs-variable">$start</span>"</span> ] &amp;&amp; <span class="hljs-built_in">continue</span>
        total
        lap <span class="hljs-string">"<span class="hljs-variable">$laptime</span>"</span>  <span class="hljs-comment"># Update laptotal.</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">exit</span> $?</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="HOMEWORK" id="HOMEWORK"></a>
        <p>
          <b>Example A-44. An all-purpose shell scripting homework assignment
            solution</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment">#  homework.sh: All-purpose homework assignment solution.</span>
<span class="hljs-comment">#  Author: M. Leo Cooper</span>
<span class="hljs-comment">#  If you substitute your own name as author, then it is plagiarism,</span>
<span class="hljs-comment">#+ possibly a lesser sin than cheating on your homework!</span>
<span class="hljs-comment">#  License: Public Domain</span>

<span class="hljs-comment">#  This script may be turned in to your instructor</span>
<span class="hljs-comment">#+ in fulfillment of ALL shell scripting homework assignments.</span>
<span class="hljs-comment">#  It's sparsely commented, but you, the student, can easily remedy that.</span>
<span class="hljs-comment">#  The script author repudiates all responsibility!</span>

DLA=1
P1=2
P2=4
P3=7
PP1=0
PP2=8
MAXL=9
E_LZY=99

<span class="hljs-built_in">declare</span> -a L
L[0]=<span class="hljs-string">"3 4 0 17 29 8 13 18 19 17 20 2 19 14 17 28"</span>
L[1]=<span class="hljs-string">"8 29 12 14 18 19 29 4 12 15 7 0 19 8 2 0 11 11 24 29 17 4 6 17 4 19"</span>
L[2]=<span class="hljs-string">"29 19 7 0 19 29 8 29 7 0 21 4 29 13 4 6 11 4 2 19 4 3"</span>
L[3]=<span class="hljs-string">"19 14 29 2 14 12 15 11 4 19 4 29 19 7 8 18 29"</span>
L[4]=<span class="hljs-string">"18 2 7 14 14 11 22 14 17 10 29 0 18 18 8 6 13 12 4 13 19 26"</span>
L[5]=<span class="hljs-string">"15 11 4 0 18 4 29 0 2 2 4 15 19 29 12 24 29 7 20 12 1 11 4 29"</span>
L[6]=<span class="hljs-string">"4 23 2 20 18 4 29 14 5 29 4 6 17 4 6 8 14 20 18 29"</span>
L[7]=<span class="hljs-string">"11 0 25 8 13 4 18 18 27"</span>
L[8]=<span class="hljs-string">"0 13 3 29 6 17 0 3 4 29 12 4 29 0 2 2 14 17 3 8 13 6 11 24 26"</span>
L[9]=<span class="hljs-string">"19 7 0 13 10 29 24 14 20 26"</span>

<span class="hljs-built_in">declare</span> -a \
alph=( A B C D E F G H I J K L M N O P Q R S T U V W X Y Z . , : <span class="hljs-string">' '</span> )


<span class="hljs-function"><span class="hljs-title">pt_lt</span></span> ()
{
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">${alph[$1]}</span>"</span>
  <span class="hljs-built_in">echo</span> -n -e <span class="hljs-string">"\a"</span>
  sleep <span class="hljs-variable">$DLA</span>
}

<span class="hljs-function"><span class="hljs-title">b_r</span></span> ()
{
 <span class="hljs-built_in">echo</span> -e <span class="hljs-string">'\E[31;48m\033[1m'</span>
}

<span class="hljs-function"><span class="hljs-title">cr</span></span> ()
{
 <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\a"</span>
 sleep <span class="hljs-variable">$DLA</span>
}

<span class="hljs-function"><span class="hljs-title">restore</span></span> ()
{
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">'\033[0m'</span>            <span class="hljs-comment"># Bold off.</span>
  tput sgr0                    <span class="hljs-comment"># Normal.</span>
}


<span class="hljs-function"><span class="hljs-title">p_l</span></span> ()
{
  <span class="hljs-keyword">for</span> ltr <span class="hljs-keyword">in</span> <span class="hljs-variable">$1</span>
  <span class="hljs-keyword">do</span>
    pt_lt <span class="hljs-string">"<span class="hljs-variable">$ltr</span>"</span>
  <span class="hljs-keyword">done</span>
}

<span class="hljs-comment"># ----------------------</span>
b_r

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(seq 0 <span class="hljs-variable">$MAXL</span>)
<span class="hljs-keyword">do</span>
  p_l <span class="hljs-string">"<span class="hljs-variable">${L[i]}</span>"</span>
  <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$i</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$P1</span>"</span> || <span class="hljs-string">"<span class="hljs-variable">$i</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$P2</span>"</span> || <span class="hljs-string">"<span class="hljs-variable">$i</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$P3</span>"</span> ]]
  <span class="hljs-keyword">then</span>
    cr
  <span class="hljs-keyword">elif</span> [[ <span class="hljs-string">"<span class="hljs-variable">$i</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$PP1</span>"</span> || <span class="hljs-string">"<span class="hljs-variable">$i</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$PP2</span>"</span> ]]
  <span class="hljs-keyword">then</span>
    cr; cr
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>

restore
<span class="hljs-comment"># ----------------------</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_LZY</span>

<span class="hljs-comment">#  A typical example of an obfuscated script that is difficult</span>
<span class="hljs-comment">#+ to understand, and frustrating to maintain.</span>
<span class="hljs-comment">#  In your career as a sysadmin, you'll run into these critters</span>
<span class="hljs-comment">#+ all too often.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p><a name="KTOUR0" id="KTOUR0"></a></p>
      <div class="EXAMPLE">
        <a name="KTOUR" id="KTOUR"></a>
        <p><b>Example A-45. The Knight's Tour</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># ktour.sh</span>

<span class="hljs-comment"># author: mendel cooper</span>
<span class="hljs-comment"># reldate: 12 Jan 2009</span>
<span class="hljs-comment"># license: public domain</span>
<span class="hljs-comment"># (Not much sense GPLing something that's pretty much in the common</span>
<span class="hljs-comment">#+ domain anyhow.)</span>

<span class="hljs-comment">###################################################################</span>
<span class="hljs-comment">#             The Knight's Tour, a classic problem.               #</span>
<span class="hljs-comment">#             =====================================               #</span>
<span class="hljs-comment">#  The knight must move onto every square of the chess board,     #</span>
<span class="hljs-comment">#  but cannot revisit any square he has already visited.          #</span>
<span class="hljs-comment">#                                                                 #</span>
<span class="hljs-comment">#  And just why is Sir Knight unwelcome for a return visit?       #</span>
<span class="hljs-comment">#  Could it be that he has a habit of partying into the wee hours #</span>
<span class="hljs-comment">#+ of the morning?                                                #</span>
<span class="hljs-comment">#  Possibly he leaves pizza crusts in the bed, empty beer bottles #</span>
<span class="hljs-comment">#+ all over the floor, and clogs the plumbing. . . .              #</span>
<span class="hljs-comment">#                                                                 #</span>
<span class="hljs-comment">#  -------------------------------------------------------------  #</span>
<span class="hljs-comment">#                                                                 #</span>
<span class="hljs-comment">#  Usage: ktour.sh [start-square] [stupid]                        #</span>
<span class="hljs-comment">#                                                                 #</span>
<span class="hljs-comment">#  Note that start-square can be a square number                  #</span>
<span class="hljs-comment">#+ in the range 0 - 63 ... or                                     #</span>
<span class="hljs-comment">#  a square designator in conventional chess notation,            #</span>
<span class="hljs-comment">#  such as a1, f5, h3, etc.                                       #</span>
<span class="hljs-comment">#                                                                 #</span>
<span class="hljs-comment">#  If start-square-number not supplied,                           #</span>
<span class="hljs-comment">#+ then starts on a random square somewhere on the board.         #</span>
<span class="hljs-comment">#                                                                 #</span>
<span class="hljs-comment"># "stupid" as second parameter sets the stupid strategy.          #</span>
<span class="hljs-comment">#                                                                 #</span>
<span class="hljs-comment">#  Examples:                                                      #</span>
<span class="hljs-comment">#  ktour.sh 23          starts on square #23 (h3)                 #</span>
<span class="hljs-comment">#  ktour.sh g6 stupid   starts on square #46,                     #</span>
<span class="hljs-comment">#                       using "stupid" (non-Warnsdorff) strategy. #</span>
<span class="hljs-comment">###################################################################</span>

DEBUG=      <span class="hljs-comment"># Set this to echo debugging info to stdout.</span>
SUCCESS=0
FAIL=99
BADMOVE=-999
FAILURE=1
LINELEN=21  <span class="hljs-comment"># How many moves to display per line.</span>
<span class="hljs-comment"># ---------------------------------------- #</span>
<span class="hljs-comment"># Board array params</span>
ROWS=8   <span class="hljs-comment"># 8 x 8 board.</span>
COLS=8
<span class="hljs-built_in">let</span> <span class="hljs-string">"SQUARES = <span class="hljs-variable">$ROWS</span> * <span class="hljs-variable">$COLS</span>"</span>
<span class="hljs-built_in">let</span> <span class="hljs-string">"MAX = <span class="hljs-variable">$SQUARES</span> - 1"</span>
MIN=0
<span class="hljs-comment"># 64 squares on board, indexed from 0 to 63.</span>

VISITED=1
UNVISITED=-1
UNVSYM=<span class="hljs-string">"##"</span>
<span class="hljs-comment"># ---------------------------------------- #</span>
<span class="hljs-comment"># Global variables.</span>
startpos=    <span class="hljs-comment"># Starting position (square #, 0 - 63).</span>
currpos=     <span class="hljs-comment"># Current position.</span>
movenum=     <span class="hljs-comment"># Move number.</span>
CRITPOS=37   <span class="hljs-comment"># Have to patch for f5 starting position!</span>

<span class="hljs-built_in">declare</span> -i board
<span class="hljs-comment"># Use a one-dimensional array to simulate a two-dimensional one.</span>
<span class="hljs-comment"># This can make life difficult and result in ugly kludges; see below.</span>
<span class="hljs-built_in">declare</span> -i moves  <span class="hljs-comment"># Offsets from current knight position.</span>


<span class="hljs-function"><span class="hljs-title">initialize_board</span></span> ()
{
  <span class="hljs-built_in">local</span> idx

  <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> {0..63}
  <span class="hljs-keyword">do</span>
    board[<span class="hljs-variable">$idx</span>]=<span class="hljs-variable">$UNVISITED</span>
  <span class="hljs-keyword">done</span>
}



<span class="hljs-function"><span class="hljs-title">print_board</span></span> ()
{
  <span class="hljs-built_in">local</span> idx

  <span class="hljs-built_in">echo</span> <span class="hljs-string">"    _____________________________________"</span>
  <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> {7..0}               <span class="hljs-comment">#  Reverse order of rows ...</span>
  <span class="hljs-keyword">do</span>                              <span class="hljs-comment">#+ so it prints in chessboard order.</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"rownum = <span class="hljs-variable">$row</span> + 1"</span>       <span class="hljs-comment">#  Start numbering rows at 1.</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$rownum</span>  |"</span>          <span class="hljs-comment">#  Mark board edge with border and</span>
    <span class="hljs-keyword">for</span> column <span class="hljs-keyword">in</span> {0..7}          <span class="hljs-comment">#+ "algebraic notation."</span>
    <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">let</span> <span class="hljs-string">"idx = <span class="hljs-variable">$ROWS</span>*<span class="hljs-variable">$row</span> + <span class="hljs-variable">$column</span>"</span>
      <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${board[idx]}</span> -eq <span class="hljs-variable">$UNVISITED</span> ]
      <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$UNVSYM</span>   "</span>      <span class="hljs-comment">##</span>
      <span class="hljs-keyword">else</span>                        <span class="hljs-comment"># Mark square with move number.</span>
        <span class="hljs-built_in">printf</span> <span class="hljs-string">"%02d "</span> <span class="hljs-string">"<span class="hljs-variable">${board[idx]}</span>"</span>; <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"  "</span>
      <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>
    <span class="hljs-built_in">echo</span> -e -n <span class="hljs-string">"\b\b\b|"</span>  <span class="hljs-comment"># \b is a backspace.</span>
    <span class="hljs-built_in">echo</span>                  <span class="hljs-comment"># -e enables echoing escaped chars.</span>
  <span class="hljs-keyword">done</span>

  <span class="hljs-built_in">echo</span> <span class="hljs-string">"    -------------------------------------"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"     a    b    c    d    e    f    g    h"</span>
}



<span class="hljs-function"><span class="hljs-title">failure</span></span>()
{ <span class="hljs-comment"># Whine, then bail out.</span>
  <span class="hljs-built_in">echo</span>
  print_board
  <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">echo</span>    <span class="hljs-string">"   Waah!!! Ran out of squares to move to!"</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"   Knight's Tour attempt ended"</span>
  <span class="hljs-built_in">echo</span>    <span class="hljs-string">" on <span class="hljs-subst">$(to_algebraic $currpos)</span> [square #<span class="hljs-variable">$currpos</span>]"</span>
  <span class="hljs-built_in">echo</span>    <span class="hljs-string">"   after just <span class="hljs-variable">$movenum</span> moves!"</span>
  <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$FAIL</span>
}



xlat_coords ()   <span class="hljs-comment">#  Translate x/y coordinates to board position</span>
{                <span class="hljs-comment">#+ (board-array element #).</span>
  <span class="hljs-comment">#  For user input of starting board position as x/y coords.</span>
  <span class="hljs-comment">#  This function not used in initial release of ktour.sh.</span>
  <span class="hljs-comment">#  May be used in an updated version, for compatibility with</span>
  <span class="hljs-comment">#+ standard implementation of the Knight's Tour in C, Python, etc.</span>
  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> -o -z <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$FAIL</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-built_in">local</span> xc=<span class="hljs-variable">$1</span>
  <span class="hljs-built_in">local</span> yc=<span class="hljs-variable">$2</span>

  <span class="hljs-built_in">let</span> <span class="hljs-string">"board_index = <span class="hljs-variable">$xc</span> * <span class="hljs-variable">$ROWS</span> + yc"</span>

  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$board_index</span> -lt <span class="hljs-variable">$MIN</span> -o <span class="hljs-variable">$board_index</span> -gt <span class="hljs-variable">$MAX</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$FAIL</span>    <span class="hljs-comment"># Strayed off the board!</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$board_index</span>
  <span class="hljs-keyword">fi</span>
}



to_algebraic ()   <span class="hljs-comment">#  Translate board position (board-array element #)</span>
{                 <span class="hljs-comment">#+ to standard algebraic notation used by chess players.</span>
  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$FAIL</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-built_in">local</span> element_no=<span class="hljs-variable">$1</span>   <span class="hljs-comment"># Numerical board position.</span>
  <span class="hljs-built_in">local</span> col_arr=( a b c d e f g h )
  <span class="hljs-built_in">local</span> row_arr=( 1 2 3 4 5 6 7 8 )

  <span class="hljs-built_in">let</span> <span class="hljs-string">"row_no = <span class="hljs-variable">$element_no</span> / <span class="hljs-variable">$ROWS</span>"</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"col_no = <span class="hljs-variable">$element_no</span> % <span class="hljs-variable">$ROWS</span>"</span>
  t1=<span class="hljs-variable">${col_arr[col_no]}</span>; t2=<span class="hljs-variable">${row_arr[row_no]}</span>
  <span class="hljs-built_in">local</span> apos=<span class="hljs-variable">$t1</span><span class="hljs-variable">$t2</span>   <span class="hljs-comment"># Concatenate.</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$apos</span>
}



from_algebraic ()   <span class="hljs-comment">#  Translate standard algebraic chess notation</span>
{                   <span class="hljs-comment">#+ to numerical board position (board-array element #).</span>
                    <span class="hljs-comment">#  Or recognize numerical input &amp; return it unchanged.</span>
  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$FAIL</span>
  <span class="hljs-keyword">fi</span>   <span class="hljs-comment"># If no command-line arg, then will default to random start pos.</span>

  <span class="hljs-built_in">local</span> ix
  <span class="hljs-built_in">local</span> ix_count=0
  <span class="hljs-built_in">local</span> b_index     <span class="hljs-comment"># Board index [0-63]</span>
  <span class="hljs-built_in">local</span> alpos=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>

  arow=<span class="hljs-variable">${alpos:0:1}</span> <span class="hljs-comment"># position = 0, length = 1</span>
  acol=<span class="hljs-variable">${alpos:1:1}</span>

  <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$arow</span> =~ [[:digit:]] ]]   <span class="hljs-comment">#  Numerical input?</span>
  <span class="hljs-keyword">then</span>       <span class="hljs-comment">#  POSIX char class</span>
    <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$acol</span> =~ [[:alpha:]] ]] <span class="hljs-comment"># Number followed by a letter? Illegal!</span>
      <span class="hljs-keyword">then</span> <span class="hljs-built_in">return</span> <span class="hljs-variable">$FAIL</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$alpos</span> -gt <span class="hljs-variable">$MAX</span> ]   <span class="hljs-comment"># Off board?</span>
      <span class="hljs-keyword">then</span> <span class="hljs-built_in">return</span> <span class="hljs-variable">$FAIL</span>
    <span class="hljs-keyword">else</span> <span class="hljs-built_in">return</span> <span class="hljs-variable">$alpos</span>            <span class="hljs-comment">#  Return digit(s) unchanged . . .</span>
      <span class="hljs-keyword">fi</span>                          <span class="hljs-comment">#+ if within range.</span>
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$acol</span> -eq <span class="hljs-variable">$MIN</span> || <span class="hljs-variable">$acol</span> -gt <span class="hljs-variable">$ROWS</span> ]]
  <span class="hljs-keyword">then</span>        <span class="hljs-comment"># Outside of range 1 - 8?</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$FAIL</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-keyword">for</span> ix <span class="hljs-keyword">in</span> a b c d e f g h
  <span class="hljs-keyword">do</span>  <span class="hljs-comment"># Convert column letter to column number.</span>
   <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$arow</span>"</span> = <span class="hljs-string">"<span class="hljs-variable">$ix</span>"</span> ]
   <span class="hljs-keyword">then</span>
     <span class="hljs-built_in">break</span>
   <span class="hljs-keyword">fi</span>
  ((ix_count++))    <span class="hljs-comment"># Find index count.</span>
  <span class="hljs-keyword">done</span>

  ((acol--))        <span class="hljs-comment"># Decrementing converts to zero-based array.</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"b_index = <span class="hljs-variable">$ix_count</span> + <span class="hljs-variable">$acol</span> * <span class="hljs-variable">$ROWS</span>"</span>

  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$b_index</span> -gt <span class="hljs-variable">$MAX</span> ]   <span class="hljs-comment"># Off board?</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$FAIL</span>
  <span class="hljs-keyword">fi</span>
    
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$b_index</span>

}


generate_moves ()   <span class="hljs-comment">#  Calculate all valid knight moves,</span>
{                   <span class="hljs-comment">#+ relative to current position ($1),</span>
                    <span class="hljs-comment">#+ and store in ${moves} array.</span>
  <span class="hljs-built_in">local</span> kt_hop=1    <span class="hljs-comment">#  One square  :: short leg of knight move.</span>
  <span class="hljs-built_in">local</span> kt_skip=2   <span class="hljs-comment">#  Two squares :: long leg  of knight move.</span>
  <span class="hljs-built_in">local</span> valmov=0    <span class="hljs-comment">#  Valid moves.</span>
  <span class="hljs-built_in">local</span> row_pos; <span class="hljs-built_in">let</span> <span class="hljs-string">"row_pos = <span class="hljs-variable">$1</span> % <span class="hljs-variable">$COLS</span>"</span>


  <span class="hljs-built_in">let</span> <span class="hljs-string">"move1 = -<span class="hljs-variable">$kt_skip</span> + <span class="hljs-variable">$ROWS</span>"</span>           <span class="hljs-comment"># 2 sideways to-the-left,  1 up</span>
    <span class="hljs-keyword">if</span> [[ `expr <span class="hljs-variable">$row_pos</span> - <span class="hljs-variable">$kt_skip</span>` -lt <span class="hljs-variable">$MIN</span> ]]   <span class="hljs-comment"># An ugly, ugly kludge!</span>
    <span class="hljs-keyword">then</span>                                           <span class="hljs-comment"># Can't move off board.</span>
      move1=<span class="hljs-variable">$BADMOVE</span>                               <span class="hljs-comment"># Not even temporarily.</span>
    <span class="hljs-keyword">else</span>
      ((valmov++))
    <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"move2 = -<span class="hljs-variable">$kt_hop</span> + <span class="hljs-variable">$kt_skip</span> * <span class="hljs-variable">$ROWS</span>"</span> <span class="hljs-comment"># 1 sideways to-the-left,  2 up</span>
    <span class="hljs-keyword">if</span> [[ `expr <span class="hljs-variable">$row_pos</span> - <span class="hljs-variable">$kt_hop</span>` -lt <span class="hljs-variable">$MIN</span> ]]    <span class="hljs-comment"># Kludge continued ...</span>
    <span class="hljs-keyword">then</span>
      move2=<span class="hljs-variable">$BADMOVE</span>
    <span class="hljs-keyword">else</span>
      ((valmov++))
    <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"move3 =  <span class="hljs-variable">$kt_hop</span> + <span class="hljs-variable">$kt_skip</span> * <span class="hljs-variable">$ROWS</span>"</span> <span class="hljs-comment"># 1 sideways to-the-right, 2 up</span>
    <span class="hljs-keyword">if</span> [[ `expr <span class="hljs-variable">$row_pos</span> + <span class="hljs-variable">$kt_hop</span>` -ge <span class="hljs-variable">$COLS</span> ]]
    <span class="hljs-keyword">then</span>
      move3=<span class="hljs-variable">$BADMOVE</span>
    <span class="hljs-keyword">else</span>
      ((valmov++))
    <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"move4 =  <span class="hljs-variable">$kt_skip</span> + <span class="hljs-variable">$ROWS</span>"</span>           <span class="hljs-comment"># 2 sideways to-the-right, 1 up</span>
    <span class="hljs-keyword">if</span> [[ `expr <span class="hljs-variable">$row_pos</span> + <span class="hljs-variable">$kt_skip</span>` -ge <span class="hljs-variable">$COLS</span> ]]
    <span class="hljs-keyword">then</span>
      move4=<span class="hljs-variable">$BADMOVE</span>
    <span class="hljs-keyword">else</span>
      ((valmov++))
    <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"move5 =  <span class="hljs-variable">$kt_skip</span> - <span class="hljs-variable">$ROWS</span>"</span>           <span class="hljs-comment"># 2 sideways to-the-right, 1 dn</span>
    <span class="hljs-keyword">if</span> [[ `expr <span class="hljs-variable">$row_pos</span> + <span class="hljs-variable">$kt_skip</span>` -ge <span class="hljs-variable">$COLS</span> ]]
    <span class="hljs-keyword">then</span>
      move5=<span class="hljs-variable">$BADMOVE</span>
    <span class="hljs-keyword">else</span>
      ((valmov++))
    <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"move6 =  <span class="hljs-variable">$kt_hop</span> - <span class="hljs-variable">$kt_skip</span> * <span class="hljs-variable">$ROWS</span>"</span> <span class="hljs-comment"># 1 sideways to-the-right, 2 dn</span>
    <span class="hljs-keyword">if</span> [[ `expr <span class="hljs-variable">$row_pos</span> + <span class="hljs-variable">$kt_hop</span>` -ge <span class="hljs-variable">$COLS</span> ]]
    <span class="hljs-keyword">then</span>
      move6=<span class="hljs-variable">$BADMOVE</span>
    <span class="hljs-keyword">else</span>
      ((valmov++))
    <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"move7 = -<span class="hljs-variable">$kt_hop</span> - <span class="hljs-variable">$kt_skip</span> * <span class="hljs-variable">$ROWS</span>"</span> <span class="hljs-comment"># 1 sideways to-the-left,  2 dn</span>
    <span class="hljs-keyword">if</span> [[ `expr <span class="hljs-variable">$row_pos</span> - <span class="hljs-variable">$kt_hop</span>` -lt <span class="hljs-variable">$MIN</span> ]]
    <span class="hljs-keyword">then</span>
      move7=<span class="hljs-variable">$BADMOVE</span>
    <span class="hljs-keyword">else</span>
      ((valmov++))
    <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"move8 = -<span class="hljs-variable">$kt_skip</span> - <span class="hljs-variable">$ROWS</span>"</span>           <span class="hljs-comment"># 2 sideways to-the-left,  1 dn</span>
    <span class="hljs-keyword">if</span> [[ `expr <span class="hljs-variable">$row_pos</span> - <span class="hljs-variable">$kt_skip</span>` -lt <span class="hljs-variable">$MIN</span> ]]
    <span class="hljs-keyword">then</span>
      move8=<span class="hljs-variable">$BADMOVE</span>
    <span class="hljs-keyword">else</span>
      ((valmov++))
    <span class="hljs-keyword">fi</span>   <span class="hljs-comment"># There must be a better way to do this.</span>

  <span class="hljs-built_in">local</span> m=( <span class="hljs-variable">$valmov</span> <span class="hljs-variable">$move1</span> <span class="hljs-variable">$move2</span> <span class="hljs-variable">$move3</span> <span class="hljs-variable">$move4</span> <span class="hljs-variable">$move5</span> <span class="hljs-variable">$move6</span> <span class="hljs-variable">$move7</span> <span class="hljs-variable">$move8</span> )
  <span class="hljs-comment"># ${moves[0]} = number of valid moves.</span>
  <span class="hljs-comment"># ${moves[1]} ... ${moves[8]} = possible moves.</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${m[*]}</span>"</span>    <span class="hljs-comment"># Elements of array to stdout for capture in a var.</span>

}



is_on_board ()  <span class="hljs-comment"># Is position actually on the board?</span>
{
  <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> -lt <span class="hljs-string">"<span class="hljs-variable">$MIN</span>"</span> || <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> -gt <span class="hljs-string">"<span class="hljs-variable">$MAX</span>"</span> ]]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$FAILURE</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$SUCCESS</span>
  <span class="hljs-keyword">fi</span>
}



do_move ()      <span class="hljs-comment"># Move the knight!</span>
{
  <span class="hljs-built_in">local</span> valid_moves=0
  <span class="hljs-built_in">local</span> aapos
  currposl=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
  lmin=<span class="hljs-variable">$ROWS</span>
  iex=0
  squarel=
  mpm=
  mov=
  <span class="hljs-built_in">declare</span> -a p_moves

  <span class="hljs-comment">########################## DECIDE-MOVE #############################</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$startpos</span> -ne <span class="hljs-variable">$CRITPOS</span> ]
  <span class="hljs-keyword">then</span>   <span class="hljs-comment"># CRITPOS = square #37</span>
    decide_move
  <span class="hljs-keyword">else</span>                     <span class="hljs-comment"># Needs a special patch for startpos=37 !!!</span>
    decide_move_patched    <span class="hljs-comment"># Why this particular move and no other ???</span>
  <span class="hljs-keyword">fi</span>
  <span class="hljs-comment">####################################################################</span>

  (( ++movenum ))          <span class="hljs-comment"># Increment move count.</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"square = <span class="hljs-variable">$currposl</span> + <span class="hljs-variable">${moves[iex]}</span>"</span>

  <span class="hljs-comment">##################    DEBUG    ###############</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$DEBUG</span>"</span> ]
    <span class="hljs-keyword">then</span> debug   <span class="hljs-comment"># Echo debugging information.</span>
  <span class="hljs-keyword">fi</span>
  <span class="hljs-comment">##############################################</span>

  <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$square</span>"</span> -gt <span class="hljs-variable">$MAX</span> || <span class="hljs-string">"<span class="hljs-variable">$square</span>"</span> -lt <span class="hljs-variable">$MIN</span> ||
        <span class="hljs-variable">${board[square]}</span> -ne <span class="hljs-variable">$UNVISITED</span> ]]
  <span class="hljs-keyword">then</span>
    (( --movenum ))              <span class="hljs-comment">#  Decrement move count,</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"RAN OUT OF SQUARES!!!"</span> <span class="hljs-comment">#+ since previous one was invalid.</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$FAIL</span>
  <span class="hljs-keyword">fi</span>

  board[square]=<span class="hljs-variable">$movenum</span>
  currpos=<span class="hljs-variable">$square</span>       <span class="hljs-comment"># Update current position.</span>
  ((valid_moves++));    <span class="hljs-comment"># moves[0]=$valid_moves</span>
  aapos=$(to_algebraic <span class="hljs-variable">$square</span>)
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$aapos</span> "</span>
  <span class="hljs-built_in">test</span> $(( <span class="hljs-variable">$Moves</span> % <span class="hljs-variable">$LINELEN</span> )) -eq 0 &amp;&amp; <span class="hljs-built_in">echo</span>
  <span class="hljs-comment"># Print LINELEN=21 moves per line. A valid tour shows 3 complete lines.</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$valid_moves</span>   <span class="hljs-comment"># Found a square to move to!</span>
}



do_move_stupid()   <span class="hljs-comment">#  Dingbat algorithm,</span>
{                  <span class="hljs-comment">#+ courtesy of script author, *not* Warnsdorff.</span>
  <span class="hljs-built_in">local</span> valid_moves=0
  <span class="hljs-built_in">local</span> movloc
  <span class="hljs-built_in">local</span> squareloc
  <span class="hljs-built_in">local</span> aapos
  <span class="hljs-built_in">local</span> cposloc=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>

  <span class="hljs-keyword">for</span> movloc <span class="hljs-keyword">in</span> {1..8}
  <span class="hljs-keyword">do</span>       <span class="hljs-comment"># Move to first-found unvisited square.</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"squareloc = <span class="hljs-variable">$cposloc</span> + <span class="hljs-variable">${moves[movloc]}</span>"</span>
    is_on_board <span class="hljs-variable">$squareloc</span>
    <span class="hljs-keyword">if</span> [ $? -eq <span class="hljs-variable">$SUCCESS</span> ] &amp;&amp; [ <span class="hljs-variable">${board[squareloc]}</span> -eq <span class="hljs-variable">$UNVISITED</span> ]
    <span class="hljs-keyword">then</span>   <span class="hljs-comment"># Add conditions to above if-test to improve algorithm.</span>
      (( ++movenum ))
      board[squareloc]=<span class="hljs-variable">$movenum</span>
      currpos=<span class="hljs-variable">$squareloc</span>     <span class="hljs-comment"># Update current position.</span>
      ((valid_moves++));     <span class="hljs-comment"># moves[0]=$valid_moves</span>
      aapos=$(to_algebraic <span class="hljs-variable">$squareloc</span>)
      <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$aapos</span> "</span>
      <span class="hljs-built_in">test</span> $(( <span class="hljs-variable">$Moves</span> % <span class="hljs-variable">$LINELEN</span> )) -eq 0 &amp;&amp; <span class="hljs-built_in">echo</span>   <span class="hljs-comment"># Print 21 moves/line.</span>
      <span class="hljs-built_in">return</span> <span class="hljs-variable">$valid_moves</span>    <span class="hljs-comment"># Found a square to move to!</span>
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>

  <span class="hljs-built_in">return</span> <span class="hljs-variable">$FAIL</span>
  <span class="hljs-comment">#  If no square found in all 8 loop iterations,</span>
  <span class="hljs-comment">#+ then Knight's Tour attempt ends in failure.</span>

  <span class="hljs-comment">#  Dingbat algorithm will typically fail after about 30 - 40 moves,</span>
  <span class="hljs-comment">#+ but executes _much_ faster than Warnsdorff's in do_move() function.</span>
}



decide_move ()         <span class="hljs-comment">#  Which move will we make?</span>
{                      <span class="hljs-comment">#  But, fails on startpos=37 !!!</span>
  <span class="hljs-keyword">for</span> mov <span class="hljs-keyword">in</span> {1..8}
  <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"squarel = <span class="hljs-variable">$currposl</span> + <span class="hljs-variable">${moves[mov]}</span>"</span>
    is_on_board <span class="hljs-variable">$squarel</span>
    <span class="hljs-keyword">if</span> [[ $? -eq <span class="hljs-variable">$SUCCESS</span> &amp;&amp; <span class="hljs-variable">${board[squarel]}</span> -eq <span class="hljs-variable">$UNVISITED</span> ]]
    <span class="hljs-keyword">then</span>   <span class="hljs-comment">#  Find accessible square with least possible future moves.</span>
           <span class="hljs-comment">#  This is Warnsdorff's algorithm.</span>
           <span class="hljs-comment">#  What happens is that the knight wanders toward the outer edge</span>
           <span class="hljs-comment">#+ of the board, then pretty much spirals inward.</span>
           <span class="hljs-comment">#  Given two or more possible moves with same value of</span>
           <span class="hljs-comment">#+ least-possible-future-moves, this implementation chooses</span>
           <span class="hljs-comment">#+ the _first_ of those moves.</span>
           <span class="hljs-comment">#  This means that there is not necessarily a unique solution</span>
           <span class="hljs-comment">#+ for any given starting position.</span>

      possible_moves <span class="hljs-variable">$squarel</span>
      mpm=$?
      p_moves[mov]=<span class="hljs-variable">$mpm</span>
      
      <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$mpm</span> -lt <span class="hljs-variable">$lmin</span> ]  <span class="hljs-comment"># If less than previous minimum ...</span>
      <span class="hljs-keyword">then</span> <span class="hljs-comment">#     ^^</span>
        lmin=<span class="hljs-variable">$mpm</span>            <span class="hljs-comment"># Update minimum.</span>
        iex=<span class="hljs-variable">$mov</span>             <span class="hljs-comment"># Save index.</span>
      <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>
}



decide_move_patched ()         <span class="hljs-comment">#  Decide which move to make,</span>
{  <span class="hljs-comment">#        ^^^^^^^            #+ but only if startpos=37 !!!</span>
  <span class="hljs-keyword">for</span> mov <span class="hljs-keyword">in</span> {1..8}
  <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"squarel = <span class="hljs-variable">$currposl</span> + <span class="hljs-variable">${moves[mov]}</span>"</span>
    is_on_board <span class="hljs-variable">$squarel</span>
    <span class="hljs-keyword">if</span> [[ $? -eq <span class="hljs-variable">$SUCCESS</span> &amp;&amp; <span class="hljs-variable">${board[squarel]}</span> -eq <span class="hljs-variable">$UNVISITED</span> ]]
    <span class="hljs-keyword">then</span>
      possible_moves <span class="hljs-variable">$squarel</span>
      mpm=$?
      p_moves[mov]=<span class="hljs-variable">$mpm</span>
      
      <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$mpm</span> -le <span class="hljs-variable">$lmin</span> ]  <span class="hljs-comment"># If less-than-or equal to prev. minimum!</span>
      <span class="hljs-keyword">then</span> <span class="hljs-comment">#     ^^</span>
        lmin=<span class="hljs-variable">$mpm</span>
        iex=<span class="hljs-variable">$mov</span>
      <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>                       <span class="hljs-comment"># There has to be a better way to do this.</span>
}



possible_moves ()            <span class="hljs-comment">#  Calculate number of possible moves,</span>
{                            <span class="hljs-comment">#+ given the current position.</span>

  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$FAIL</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-built_in">local</span> curr_pos=<span class="hljs-variable">$1</span>
  <span class="hljs-built_in">local</span> valid_movl=0
  <span class="hljs-built_in">local</span> icx=0
  <span class="hljs-built_in">local</span> movl
  <span class="hljs-built_in">local</span> sq
  <span class="hljs-built_in">declare</span> -a movesloc

  movesloc=( $(generate_moves <span class="hljs-variable">$curr_pos</span>) )

  <span class="hljs-keyword">for</span> movl <span class="hljs-keyword">in</span> {1..8}
  <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"sq = <span class="hljs-variable">$curr_pos</span> + <span class="hljs-variable">${movesloc[movl]}</span>"</span>
    is_on_board <span class="hljs-variable">$sq</span>
    <span class="hljs-keyword">if</span> [ $? -eq <span class="hljs-variable">$SUCCESS</span> ] &amp;&amp; [ <span class="hljs-variable">${board[sq]}</span> -eq <span class="hljs-variable">$UNVISITED</span> ]
    <span class="hljs-keyword">then</span>
      ((valid_movl++));
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>

  <span class="hljs-built_in">return</span> <span class="hljs-variable">$valid_movl</span>         <span class="hljs-comment"># Found a square to move to!</span>
}


<span class="hljs-function"><span class="hljs-title">strategy</span></span> ()
{
  <span class="hljs-built_in">echo</span>

  <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$STUPID</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">for</span> Moves <span class="hljs-keyword">in</span> {1..63}
    <span class="hljs-keyword">do</span>
      cposl=<span class="hljs-variable">$1</span>
      moves=( $(generate_moves <span class="hljs-variable">$currpos</span>) )
      do_move_stupid <span class="hljs-string">"<span class="hljs-variable">$currpos</span>"</span>
      <span class="hljs-keyword">if</span> [ $? -eq <span class="hljs-variable">$FAIL</span> ]
      <span class="hljs-keyword">then</span>
        failure
      <span class="hljs-keyword">fi</span>
      <span class="hljs-keyword">done</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-comment">#  Don't need an "else" clause here,</span>
  <span class="hljs-comment">#+ because Stupid Strategy will always fail and exit!</span>
  <span class="hljs-keyword">for</span> Moves <span class="hljs-keyword">in</span> {1..63}
  <span class="hljs-keyword">do</span>
    cposl=<span class="hljs-variable">$1</span>
    moves=( $(generate_moves <span class="hljs-variable">$currpos</span>) )
    do_move <span class="hljs-string">"<span class="hljs-variable">$currpos</span>"</span>
    <span class="hljs-keyword">if</span> [ $? -eq <span class="hljs-variable">$FAIL</span> ]
    <span class="hljs-keyword">then</span>
      failure
    <span class="hljs-keyword">fi</span>

  <span class="hljs-keyword">done</span>
        <span class="hljs-comment">#  Could have condensed above two do-loops into a single one,</span>
  <span class="hljs-built_in">echo</span>  <span class="hljs-comment">#+ but this would have slowed execution.</span>

  print_board
  <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Knight's Tour ends on <span class="hljs-subst">$(to_algebraic $currpos)</span> [square #<span class="hljs-variable">$currpos</span>]."</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$SUCCESS</span>
}

<span class="hljs-function"><span class="hljs-title">debug</span></span> ()
{       <span class="hljs-comment"># Enable this by setting DEBUG=1 near beginning of script.</span>
  <span class="hljs-built_in">local</span> n

  <span class="hljs-built_in">echo</span> <span class="hljs-string">"================================="</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"  At move number  <span class="hljs-variable">$movenum</span>:"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">" *** possible moves = <span class="hljs-variable">$mpm</span> ***"</span>
<span class="hljs-comment"># echo "### square = $square ###"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"lmin = <span class="hljs-variable">$lmin</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${moves[@]}</span>"</span>

  <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> {1..8}
  <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"(<span class="hljs-variable">$n</span>):<span class="hljs-variable">${p_moves[n]}</span> "</span>
  <span class="hljs-keyword">done</span>

  <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"iex = <span class="hljs-variable">$iex</span> :: moves[iex] = <span class="hljs-variable">${moves[iex]}</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"square = <span class="hljs-variable">$square</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"================================="</span>
  <span class="hljs-built_in">echo</span>
} <span class="hljs-comment"># Gives pretty complete status after ea. move.</span>



<span class="hljs-comment"># =============================================================== #</span>
<span class="hljs-comment"># int main () {</span>
from_algebraic <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
startpos=$?
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$startpos</span>"</span> -eq <span class="hljs-string">"<span class="hljs-variable">$FAIL</span>"</span> ]          <span class="hljs-comment"># Okay even if no $1.</span>
<span class="hljs-keyword">then</span>   <span class="hljs-comment">#         ^^^^^^^^^^^              Okay even if input -lt 0.</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"No starting square specified (or illegal input)."</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"startpos = <span class="hljs-variable">$RANDOM</span> % <span class="hljs-variable">$SQUARES</span>"</span>   <span class="hljs-comment"># 0 - 63 permissable range.</span>
<span class="hljs-keyword">fi</span>


<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> = <span class="hljs-string">"stupid"</span> ]
<span class="hljs-keyword">then</span>
  STUPID=1
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"     ### Stupid Strategy ###"</span>
<span class="hljs-keyword">else</span>
  STUPID=<span class="hljs-string">''</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"  *** Warnsdorff's Algorithm ***"</span>
<span class="hljs-keyword">fi</span>


initialize_board

movenum=0
board[startpos]=<span class="hljs-variable">$movenum</span>   <span class="hljs-comment"># Mark each board square with move number.</span>
currpos=<span class="hljs-variable">$startpos</span>
algpos=$(to_algebraic <span class="hljs-variable">$startpos</span>)

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"Starting from <span class="hljs-variable">$algpos</span> [square #<span class="hljs-variable">$startpos</span>] ..."</span>; <span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-string">"Moves:"</span>

strategy <span class="hljs-string">"<span class="hljs-variable">$currpos</span>"</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">exit</span> 0   <span class="hljs-comment"># return 0;</span>

<span class="hljs-comment"># }      # End of main() pseudo-function.</span>
<span class="hljs-comment"># =============================================================== #</span>


<span class="hljs-comment"># Exercises:</span>
<span class="hljs-comment"># ---------</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># 1) Extend this example to a 10 x 10 board or larger.</span>
<span class="hljs-comment"># 2) Improve the "stupid strategy" by modifying the</span>
<span class="hljs-comment">#    do_move_stupid function.</span>
<span class="hljs-comment">#    Hint: Prevent straying into corner squares in early moves</span>
<span class="hljs-comment">#          (the exact opposite of Warnsdorff's algorithm!).</span>
<span class="hljs-comment"># 3) This script could stand considerable improvement and</span>
<span class="hljs-comment">#    streamlining, especially in the poorly-written</span>
<span class="hljs-comment">#    generate_moves() function</span>
<span class="hljs-comment">#    and in the DECIDE-MOVE patch in the do_move() function.</span>
<span class="hljs-comment">#    Must figure out why standard algorithm fails for startpos=37 ...</span>
<span class="hljs-comment">#+   but _not_ on any other, including symmetrical startpos=26.</span>
<span class="hljs-comment">#    Possibly, when calculating possible moves, counts the move back</span>
<span class="hljs-comment">#+   to the originating square. If so, it might be a relatively easy fix.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="MSQUARE" id="MSQUARE"></a>
        <p><b>Example A-46. Magic Squares</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># msquare.sh</span>
<span class="hljs-comment"># Magic Square generator (odd-order squares only!)</span>

<span class="hljs-comment"># Author: mendel cooper</span>
<span class="hljs-comment"># reldate: 19 Jan. 2009</span>
<span class="hljs-comment"># License: Public Domain</span>
<span class="hljs-comment"># A C-program by the very talented Kwon Young Shin inspired this script.</span>
<span class="hljs-comment">#     http://user.chollian.net/~brainstm/MagicSquare.htm</span>

<span class="hljs-comment"># Definition: A "magic square" is a two-dimensional array</span>
<span class="hljs-comment">#             of integers in which all the rows, columns,</span>
<span class="hljs-comment">#             and *long* diagonals add up to the same number.</span>
<span class="hljs-comment">#             Being "square," the array has the same number</span>
<span class="hljs-comment">#             of rows and columns. That number is the "order."</span>
<span class="hljs-comment"># An example of a magic square of order 3 is:</span>
<span class="hljs-comment">#   8  1  6   </span>
<span class="hljs-comment">#   3  5  7   </span>
<span class="hljs-comment">#   4  9  2   </span>
<span class="hljs-comment"># All the rows, columns, and the two long diagonals add up to 15.</span>


<span class="hljs-comment"># Globals</span>
EVEN=2
MAXSIZE=31   <span class="hljs-comment"># 31 rows x 31 cols.</span>
E_usage=90   <span class="hljs-comment"># Invocation error.</span>
dimension=
<span class="hljs-built_in">declare</span> -i square

<span class="hljs-function"><span class="hljs-title">usage_message</span></span> ()
{
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$0</span> order"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"   ... where \"order\" (square size) is an ODD integer"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"       in the range 3 - 31."</span>
  <span class="hljs-comment">#  Actually works for squares up to order 159,</span>
  <span class="hljs-comment">#+ but large squares will not display pretty-printed in a term window.</span>
  <span class="hljs-comment">#  Try increasing MAXSIZE, above.</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_usage</span>
}


calculate ()       <span class="hljs-comment"># Here's where the actual work gets done.</span>
{
  <span class="hljs-built_in">local</span> row col index dimadj j k cell_val=1
  dimension=<span class="hljs-variable">$1</span>

  <span class="hljs-built_in">let</span> <span class="hljs-string">"dimadj = <span class="hljs-variable">$dimension</span> * 3"</span>; <span class="hljs-built_in">let</span> <span class="hljs-string">"dimadj /= 2"</span>   <span class="hljs-comment"># x 1.5, then truncate.</span>

  <span class="hljs-keyword">for</span> ((j=0; j &lt; dimension; j++))
  <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">for</span> ((k=0; k &lt; dimension; k++))
    <span class="hljs-keyword">do</span>  <span class="hljs-comment"># Calculate indices, then convert to 1-dim. array index.</span>
        <span class="hljs-comment"># Bash doesn't support multidimensional arrays. Pity.</span>
      <span class="hljs-built_in">let</span> <span class="hljs-string">"col = <span class="hljs-variable">$k</span> - <span class="hljs-variable">$j</span> + <span class="hljs-variable">$dimadj</span>"</span>; <span class="hljs-built_in">let</span> <span class="hljs-string">"col %= <span class="hljs-variable">$dimension</span>"</span>
      <span class="hljs-built_in">let</span> <span class="hljs-string">"row = <span class="hljs-variable">$j</span> * 2 - <span class="hljs-variable">$k</span> + <span class="hljs-variable">$dimension</span>"</span>; <span class="hljs-built_in">let</span> <span class="hljs-string">"row %= <span class="hljs-variable">$dimension</span>"</span>
      <span class="hljs-built_in">let</span> <span class="hljs-string">"index = <span class="hljs-variable">$row</span>*(<span class="hljs-variable">$dimension</span>) + <span class="hljs-variable">$col</span>"</span>
      square[<span class="hljs-variable">$index</span>]=cell_val; ((cell_val++))
    <span class="hljs-keyword">done</span>
  <span class="hljs-keyword">done</span>
}     <span class="hljs-comment"># Plain math, visualization not required.</span>


print_square ()               <span class="hljs-comment"># Output square, one row at a time.</span>
{
  <span class="hljs-built_in">local</span> row col idx d1
  <span class="hljs-built_in">let</span> <span class="hljs-string">"d1 = <span class="hljs-variable">$dimension</span> - 1"</span>   <span class="hljs-comment"># Adjust for zero-indexed array.</span>
 
  <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> $(seq 0 <span class="hljs-variable">$d1</span>)
  <span class="hljs-keyword">do</span>

    <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> $(seq 0 <span class="hljs-variable">$d1</span>)
    <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">let</span> <span class="hljs-string">"idx = <span class="hljs-variable">$row</span> * <span class="hljs-variable">$dimension</span> + <span class="hljs-variable">$col</span>"</span>
      <span class="hljs-built_in">printf</span> <span class="hljs-string">"%3d "</span> <span class="hljs-string">"<span class="hljs-variable">${square[idx]}</span>"</span>; <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"  "</span>
    <span class="hljs-keyword">done</span>   <span class="hljs-comment"># Displays up to 13th order neatly in 80-column term window.</span>

    <span class="hljs-built_in">echo</span>   <span class="hljs-comment"># Newline after each row.</span>
  <span class="hljs-keyword">done</span>
}


<span class="hljs-comment">#################################################</span>
<span class="hljs-keyword">if</span> [[ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]] || [[ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> -gt <span class="hljs-variable">$MAXSIZE</span> ]]
<span class="hljs-keyword">then</span>
  usage_message
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">let</span> <span class="hljs-string">"test_even = <span class="hljs-variable">$1</span> % <span class="hljs-variable">$EVEN</span>"</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$test_even</span> -eq 0 ]
<span class="hljs-keyword">then</span>           <span class="hljs-comment"># Can't handle even-order squares.</span>
  usage_message
<span class="hljs-keyword">fi</span>

calculate <span class="hljs-variable">$1</span>
print_square   <span class="hljs-comment"># echo "${square[@]}"   # DEBUG</span>

<span class="hljs-built_in">exit</span> $?
<span class="hljs-comment">#################################################</span>


<span class="hljs-comment"># Exercises:</span>
<span class="hljs-comment"># ---------</span>
<span class="hljs-comment"># 1) Add a function to calculate the sum of each row, column,</span>
<span class="hljs-comment">#    and *long* diagonal. The sums must match.</span>
<span class="hljs-comment">#    This is the "magic constant" of that particular order square.</span>
<span class="hljs-comment"># 2) Have the print_square function auto-calculate how much space</span>
<span class="hljs-comment">#    to allot between square elements for optimized display.</span>
<span class="hljs-comment">#    This might require parameterizing the "printf" line.</span>
<span class="hljs-comment"># 3) Add appropriate functions for generating magic squares</span>
<span class="hljs-comment">#    with an *even* number of rows/columns.</span>
<span class="hljs-comment">#    This is non-trivial(!).</span>
<span class="hljs-comment">#    See the URL for Kwon Young Shin, above, for help.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="FIFTEEN" id="FIFTEEN"></a>
        <p><b>Example A-47. Fifteen Puzzle</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># fifteen.sh</span>

<span class="hljs-comment"># Classic "Fifteen Puzzle"</span>
<span class="hljs-comment"># Author: Antonio Macchi</span>
<span class="hljs-comment"># Lightly edited and commented by ABS Guide author.</span>
<span class="hljs-comment"># Used in ABS Guide with permission. (Thanks!)</span>

<span class="hljs-comment">#  The invention of the Fifteen Puzzle is attributed to either</span>
<span class="hljs-comment">#+ Sam Loyd or Noyes Palmer Chapman.</span>
<span class="hljs-comment">#  The puzzle was wildly popular in the late 19th-century.</span>

<span class="hljs-comment">#  Object: Rearrange the numbers so they read in order,</span>
<span class="hljs-comment">#+ from 1 - 15:   ________________</span>
<span class="hljs-comment">#                |  1   2   3   4 |</span>
<span class="hljs-comment">#                |  5   6   7   8 |</span>
<span class="hljs-comment">#                |  9  10  11  12 |</span>
<span class="hljs-comment">#                | 13  14  15     |</span>
<span class="hljs-comment">#                 ----------------</span>


<span class="hljs-comment">#######################</span>
<span class="hljs-comment"># Constants           #</span>
  SQUARES=16          <span class="hljs-comment">#</span>
  FAIL=70             <span class="hljs-comment">#</span>
  E_PREMATURE_EXIT=80 <span class="hljs-comment">#</span>
<span class="hljs-comment">#######################</span>


<span class="hljs-comment">########</span>
<span class="hljs-comment"># Data #</span>
<span class="hljs-comment">########</span>

Puzzle=( 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <span class="hljs-string">" "</span> )


<span class="hljs-comment">#############</span>
<span class="hljs-comment"># Functions #</span>
<span class="hljs-comment">#############</span>

<span class="hljs-keyword">function</span> swap
{
  <span class="hljs-built_in">local</span> tmp

  tmp=<span class="hljs-variable">${Puzzle[$1]}</span>
  Puzzle[<span class="hljs-variable">$1</span>]=<span class="hljs-variable">${Puzzle[$2]}</span>
  Puzzle[<span class="hljs-variable">$2</span>]=<span class="hljs-variable">$tmp</span>
}


<span class="hljs-keyword">function</span> Jumble
{ <span class="hljs-comment"># Scramble the pieces at beginning of round.</span>
  <span class="hljs-built_in">local</span> i pos1 pos2

  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {1..100}
  <span class="hljs-keyword">do</span>
    pos1=$(( <span class="hljs-variable">$RANDOM</span> % <span class="hljs-variable">$SQUARES</span>))
    pos2=$(( <span class="hljs-variable">$RANDOM</span> % <span class="hljs-variable">$SQUARES</span> ))
    swap <span class="hljs-variable">$pos1</span> <span class="hljs-variable">$pos2</span>
  <span class="hljs-keyword">done</span>
}


<span class="hljs-keyword">function</span> PrintPuzzle
{
  <span class="hljs-built_in">local</span> i1 i2 puzpos
  puzpos=0

  clear
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Enter  quit  to exit."</span>; <span class="hljs-built_in">echo</span>   <span class="hljs-comment"># Better that than Ctl-C.</span>

  <span class="hljs-built_in">echo</span> <span class="hljs-string">",----.----.----.----."</span>   <span class="hljs-comment"># Top border.</span>
  <span class="hljs-keyword">for</span> i1 <span class="hljs-keyword">in</span> {1..4}
  <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">for</span> i2 <span class="hljs-keyword">in</span> {1..4} 
    <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">printf</span> <span class="hljs-string">"| %2s "</span> <span class="hljs-string">"<span class="hljs-variable">${Puzzle[$puzpos]}</span>"</span>
      (( puzpos++ ))
    <span class="hljs-keyword">done</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"|"</span>                     <span class="hljs-comment"># Right-side border.</span>
    <span class="hljs-built_in">test</span> <span class="hljs-variable">$i1</span> = 4 || <span class="hljs-built_in">echo</span> <span class="hljs-string">"+----+----+----+----+"</span>
  <span class="hljs-keyword">done</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"'----'----'----'----'"</span>   <span class="hljs-comment"># Bottom border.</span>
}


<span class="hljs-keyword">function</span> GetNum
{ <span class="hljs-comment"># Test for valid input.</span>
  <span class="hljs-built_in">local</span> puznum garbage

  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">do</span> 
          <span class="hljs-built_in">echo</span> <span class="hljs-string">"Moves: <span class="hljs-variable">$moves</span>"</span> <span class="hljs-comment"># Also counts invalid moves.</span>
    <span class="hljs-built_in">read</span> -p <span class="hljs-string">"Number to move: "</span> puznum garbage
      <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$puznum</span>"</span> = <span class="hljs-string">"quit"</span> ]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_PREMATURE_EXIT</span>; <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">test</span> -z <span class="hljs-string">"<span class="hljs-variable">$puznum</span>"</span> -o -n <span class="hljs-string">"<span class="hljs-variable">${puznum//[0-9]/}</span>"</span> &amp;&amp; <span class="hljs-built_in">continue</span>
    <span class="hljs-built_in">test</span> <span class="hljs-variable">$puznum</span> -gt 0 -a <span class="hljs-variable">$puznum</span> -lt <span class="hljs-variable">$SQUARES</span> &amp;&amp; <span class="hljs-built_in">break</span>
  <span class="hljs-keyword">done</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$puznum</span>
}


<span class="hljs-keyword">function</span> GetPosFromNum
{ <span class="hljs-comment"># $1 = puzzle-number</span>
  <span class="hljs-built_in">local</span> puzpos

  <span class="hljs-keyword">for</span> puzpos <span class="hljs-keyword">in</span> {0..15}
  <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">test</span> <span class="hljs-string">"<span class="hljs-variable">${Puzzle[$puzpos]}</span>"</span> = <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> &amp;&amp; <span class="hljs-built_in">break</span>
  <span class="hljs-keyword">done</span>
  <span class="hljs-built_in">return</span> <span class="hljs-variable">$puzpos</span>
}


<span class="hljs-keyword">function</span> Move
{ <span class="hljs-comment"># $1=Puzzle-pos</span>
  <span class="hljs-built_in">test</span> <span class="hljs-variable">$1</span> -gt 3 &amp;&amp; <span class="hljs-built_in">test</span> <span class="hljs-string">"<span class="hljs-variable">${Puzzle[$(( $1 - 4 ))]}</span>"</span> = <span class="hljs-string">" "</span>\
       &amp;&amp; swap <span class="hljs-variable">$1</span> $(( <span class="hljs-variable">$1</span> - <span class="hljs-number">4</span> )) &amp;&amp; <span class="hljs-built_in">return</span> 0
  <span class="hljs-built_in">test</span> $(( <span class="hljs-variable">$1</span>%<span class="hljs-number">4</span> )) -ne 3 &amp;&amp; <span class="hljs-built_in">test</span> <span class="hljs-string">"<span class="hljs-variable">${Puzzle[$(( $1 + 1 ))]}</span>"</span> = <span class="hljs-string">" "</span>\
       &amp;&amp; swap <span class="hljs-variable">$1</span> $(( <span class="hljs-variable">$1</span> + <span class="hljs-number">1</span> )) &amp;&amp; <span class="hljs-built_in">return</span> 0
  <span class="hljs-built_in">test</span> <span class="hljs-variable">$1</span> -lt 12 &amp;&amp; <span class="hljs-built_in">test</span> <span class="hljs-string">"<span class="hljs-variable">${Puzzle[$(( $1 + 4 ))]}</span>"</span> = <span class="hljs-string">" "</span>\
       &amp;&amp; swap <span class="hljs-variable">$1</span> $(( <span class="hljs-variable">$1</span> + <span class="hljs-number">4</span> )) &amp;&amp; <span class="hljs-built_in">return</span> 0
  <span class="hljs-built_in">test</span> $(( <span class="hljs-variable">$1</span>%<span class="hljs-number">4</span> )) -ne 0 &amp;&amp; <span class="hljs-built_in">test</span> <span class="hljs-string">"<span class="hljs-variable">${Puzzle[$(( $1 - 1 ))]}</span>"</span> = <span class="hljs-string">" "</span> &amp;&amp;\
       swap <span class="hljs-variable">$1</span> $(( <span class="hljs-variable">$1</span> - <span class="hljs-number">1</span> )) &amp;&amp; <span class="hljs-built_in">return</span> 0
  <span class="hljs-built_in">return</span> 1
}


<span class="hljs-keyword">function</span> Solved
{
  <span class="hljs-built_in">local</span> pos

  <span class="hljs-keyword">for</span> pos <span class="hljs-keyword">in</span> {0..14}
  <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">test</span> <span class="hljs-string">"<span class="hljs-variable">${Puzzle[$pos]}</span>"</span> = $(( <span class="hljs-variable">$pos</span> + <span class="hljs-number">1</span> )) || <span class="hljs-built_in">return</span> <span class="hljs-variable">$FAIL</span>
    <span class="hljs-comment"># Check whether number in each square = square number.</span>
  <span class="hljs-keyword">done</span>
  <span class="hljs-built_in">return</span> 0   <span class="hljs-comment"># Successful solution.</span>
}


<span class="hljs-comment">################### MAIN () #######################{</span>
moves=0
Jumble

<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>   <span class="hljs-comment"># Loop continuously until puzzle solved.</span>
<span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>
  PrintPuzzle
  <span class="hljs-built_in">echo</span>
  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">do</span>
    GetNum
    puznum=$?
    GetPosFromNum <span class="hljs-variable">$puznum</span>
    puzpos=$?
    ((moves++))
    Move <span class="hljs-variable">$puzpos</span> &amp;&amp; <span class="hljs-built_in">break</span>
  <span class="hljs-keyword">done</span>
  Solved &amp;&amp; <span class="hljs-built_in">break</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span>;<span class="hljs-built_in">echo</span>
PrintPuzzle
<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"BRAVO!"</span>; <span class="hljs-built_in">echo</span>

<span class="hljs-built_in">exit</span> 0
<span class="hljs-comment">###################################################}</span>

<span class="hljs-comment">#  Exercise:</span>
<span class="hljs-comment">#  --------</span>
<span class="hljs-comment">#  Rewrite the script to display the letters A - O,</span>
<span class="hljs-comment">#+ rather than the numbers 1 - 15.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p><a name="HANOI2REF" id="HANOI2REF"></a></p>
      <div class="EXAMPLE">
        <a name="HANOI2" id="HANOI2"></a>
        <p>
          <b>Example A-48.
            <i class="FIRSTTERM">The Towers of Hanoi, graphic version</i></b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#! /bin/bash</span>
<span class="hljs-comment"># The Towers Of Hanoi</span>
<span class="hljs-comment"># Original script (hanoi.bash) copyright (C) 2000 Amit Singh.</span>
<span class="hljs-comment"># All Rights Reserved.</span>
<span class="hljs-comment"># http://hanoi.kernelthread.com</span>

<span class="hljs-comment">#  hanoi2.bash</span>
<span class="hljs-comment">#  Version 2.00: modded for ASCII-graphic display.</span>
<span class="hljs-comment">#  Version 2.01: fixed no command-line param bug.</span>
<span class="hljs-comment">#  Uses code contributed by Antonio Macchi,</span>
<span class="hljs-comment">#+ with heavy editing by ABS Guide author.</span>
<span class="hljs-comment">#  This variant falls under the original copyright, see above.</span>
<span class="hljs-comment">#  Used in ABS Guide with Amit Singh's permission (thanks!).</span>


<span class="hljs-comment">###   Variables &amp;&amp; sanity check   ###</span>

E_NOPARAM=86
E_BADPARAM=87            <span class="hljs-comment"># Illegal no. of disks passed to script.</span>
E_NOEXIT=88

DISKS=<span class="hljs-variable">${1:-<span class="hljs-variable">$E_NOPARAM</span>}</span>   <span class="hljs-comment"># Must specify how many disks.</span>
Moves=0

MWIDTH=7
MARGIN=2
<span class="hljs-comment"># Arbitrary "magic" constants; work okay for relatively small # of disks.</span>
<span class="hljs-comment"># BASEWIDTH=51   # Original code.</span>
<span class="hljs-built_in">let</span> <span class="hljs-string">"basewidth = <span class="hljs-variable">$MWIDTH</span> * <span class="hljs-variable">$DISKS</span> + <span class="hljs-variable">$MARGIN</span>"</span>       <span class="hljs-comment"># "Base" beneath rods.</span>
<span class="hljs-comment"># Above "algorithm" could likely stand improvement.</span>

<span class="hljs-comment">###   Display variables   ###</span>
<span class="hljs-built_in">let</span> <span class="hljs-string">"disks1 = <span class="hljs-variable">$DISKS</span> - 1"</span>
<span class="hljs-built_in">let</span> <span class="hljs-string">"spaces1 = <span class="hljs-variable">$DISKS</span>"</span> 
<span class="hljs-built_in">let</span> <span class="hljs-string">"spaces2 = 2 * <span class="hljs-variable">$DISKS</span>"</span> 

<span class="hljs-built_in">let</span> <span class="hljs-string">"lastmove_t = <span class="hljs-variable">$DISKS</span> - 1"</span>                      <span class="hljs-comment"># Final move?</span>


<span class="hljs-built_in">declare</span> -a Rod1 Rod2 Rod3

<span class="hljs-comment">###   #########################   ###</span>


<span class="hljs-keyword">function</span> repeat  {  <span class="hljs-comment"># $1=char $2=number of repetitions</span>
  <span class="hljs-built_in">local</span> n           <span class="hljs-comment"># Repeat-print a character.</span>
  
  <span class="hljs-keyword">for</span> (( n=0; n&lt;<span class="hljs-variable">$2</span>; n++ )); <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
  <span class="hljs-keyword">done</span>
}

<span class="hljs-keyword">function</span> FromRod  {
  <span class="hljs-built_in">local</span> rod summit weight sequence

  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    rod=<span class="hljs-variable">$1</span>
    <span class="hljs-built_in">test</span> <span class="hljs-variable">${rod/[^123]/}</span> || <span class="hljs-built_in">continue</span>

    sequence=$(<span class="hljs-built_in">echo</span> $(seq 0 <span class="hljs-variable">$disks1</span> | tac))
    <span class="hljs-keyword">for</span> summit <span class="hljs-keyword">in</span> <span class="hljs-variable">$sequence</span>; <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">eval</span> weight=\<span class="hljs-variable">${Rod${rod}</span>[<span class="hljs-variable">$summit</span>]}
      <span class="hljs-built_in">test</span> <span class="hljs-variable">$weight</span> -ne 0 &amp;&amp;
           { <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$rod</span> <span class="hljs-variable">$summit</span> <span class="hljs-variable">$weight</span>"</span>; <span class="hljs-built_in">return</span>; }
    <span class="hljs-keyword">done</span>
  <span class="hljs-keyword">done</span>
}


<span class="hljs-keyword">function</span> ToRod  { <span class="hljs-comment"># $1=previous (FromRod) weight</span>
  <span class="hljs-built_in">local</span> rod firstfree weight sequence
  
  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    rod=<span class="hljs-variable">$2</span>
    <span class="hljs-built_in">test</span> <span class="hljs-variable">${rod/[^123]}</span> || <span class="hljs-built_in">continue</span>

    sequence=$(<span class="hljs-built_in">echo</span> $(seq 0 <span class="hljs-variable">$disks1</span> | tac))
    <span class="hljs-keyword">for</span> firstfree <span class="hljs-keyword">in</span> <span class="hljs-variable">$sequence</span>; <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">eval</span> weight=\<span class="hljs-variable">${Rod${rod}</span>[<span class="hljs-variable">$firstfree</span>]}
      <span class="hljs-built_in">test</span> <span class="hljs-variable">$weight</span> -gt 0 &amp;&amp; { (( firstfree++ )); <span class="hljs-built_in">break</span>; }
    <span class="hljs-keyword">done</span>
    <span class="hljs-built_in">test</span> <span class="hljs-variable">$weight</span> -gt <span class="hljs-variable">$1</span> -o <span class="hljs-variable">$firstfree</span> = 0 &amp;&amp;
         { <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$rod</span> <span class="hljs-variable">$firstfree</span>"</span>; <span class="hljs-built_in">return</span>; }
  <span class="hljs-keyword">done</span>
}


<span class="hljs-keyword">function</span> PrintRods  {
  <span class="hljs-built_in">local</span> disk rod empty fill sp sequence


  repeat <span class="hljs-string">" "</span> <span class="hljs-variable">$spaces1</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"|"</span>
  repeat <span class="hljs-string">" "</span> <span class="hljs-variable">$spaces2</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"|"</span>
  repeat <span class="hljs-string">" "</span> <span class="hljs-variable">$spaces2</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"|"</span>

  sequence=$(<span class="hljs-built_in">echo</span> $(seq 0 <span class="hljs-variable">$disks1</span> | tac))
  <span class="hljs-keyword">for</span> disk <span class="hljs-keyword">in</span> <span class="hljs-variable">$sequence</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">for</span> rod <span class="hljs-keyword">in</span> {1..3}; <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">eval</span> empty=$(( <span class="hljs-variable">$DISKS</span> - (Rod<span class="hljs-variable">${rod}</span>[<span class="hljs-variable">$disk</span>] / <span class="hljs-number">2</span>) ))
      <span class="hljs-built_in">eval</span> fill=\<span class="hljs-variable">${Rod${rod}</span>[<span class="hljs-variable">$disk</span>]}
      repeat <span class="hljs-string">" "</span> <span class="hljs-variable">$empty</span>
      <span class="hljs-built_in">test</span> <span class="hljs-variable">$fill</span> -gt 0 &amp;&amp; repeat <span class="hljs-string">"*"</span> <span class="hljs-variable">$fill</span> || <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"|"</span>
      repeat <span class="hljs-string">" "</span> <span class="hljs-variable">$empty</span>
    <span class="hljs-keyword">done</span>
    <span class="hljs-built_in">echo</span>
  <span class="hljs-keyword">done</span>
  repeat <span class="hljs-string">"="</span> <span class="hljs-variable">$basewidth</span>   <span class="hljs-comment"># Print "base" beneath rods.</span>
  <span class="hljs-built_in">echo</span>
}


<span class="hljs-function"><span class="hljs-title">display</span></span> ()
{
  <span class="hljs-built_in">echo</span>
  PrintRods

  <span class="hljs-comment"># Get rod-number, summit and weight</span>
  first=( `FromRod <span class="hljs-variable">$1</span>` )
  <span class="hljs-built_in">eval</span> Rod<span class="hljs-variable">${first[0]}</span>[<span class="hljs-variable">${first[1]}</span>]=0

  <span class="hljs-comment"># Get rod-number and first-free position</span>
  second=( `ToRod <span class="hljs-variable">${first[2]}</span> <span class="hljs-variable">$2</span>` )
  <span class="hljs-built_in">eval</span> Rod<span class="hljs-variable">${second[0]}</span>[<span class="hljs-variable">${second[1]}</span>]=<span class="hljs-variable">${first[2]}</span>


<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">${Rod3[lastmove_t]}</span>"</span> = 1 ]
<span class="hljs-keyword">then</span>   <span class="hljs-comment"># Last move? If yes, then display final position.</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"+  Final Position: <span class="hljs-variable">$Moves</span> moves"</span>; <span class="hljs-built_in">echo</span>
    PrintRods
  <span class="hljs-keyword">fi</span>
}


<span class="hljs-comment"># From here down, almost the same as original (hanoi.bash) script.</span>

<span class="hljs-function"><span class="hljs-title">dohanoi</span></span>() {   <span class="hljs-comment"># Recursive function.</span>
    <span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span>
    0)
        ;;
    *)
        dohanoi <span class="hljs-string">"<span class="hljs-subst">$(($1-1)</span>)"</span> <span class="hljs-variable">$2</span> <span class="hljs-variable">$4</span> <span class="hljs-variable">$3</span>
        <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$Moves</span>"</span> -ne 0 ]
        <span class="hljs-keyword">then</span>
          <span class="hljs-built_in">echo</span> <span class="hljs-string">"+  Position after move <span class="hljs-variable">$Moves</span>"</span>
        <span class="hljs-keyword">fi</span>
        ((Moves++))
        <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"   Next move will be:  "</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-variable">$2</span> <span class="hljs-string">"--&gt;"</span> <span class="hljs-variable">$3</span>
          display <span class="hljs-variable">$2</span> <span class="hljs-variable">$3</span>
        dohanoi <span class="hljs-string">"<span class="hljs-subst">$(($1-1)</span>)"</span> <span class="hljs-variable">$4</span> <span class="hljs-variable">$3</span> <span class="hljs-variable">$2</span>
        ;;
    <span class="hljs-keyword">esac</span>
}


<span class="hljs-function"><span class="hljs-title">setup_arrays</span></span> ()
{
  <span class="hljs-built_in">local</span> dim n elem

  <span class="hljs-built_in">let</span> <span class="hljs-string">"dim1 = <span class="hljs-variable">$1</span> - 1"</span>
  elem=<span class="hljs-variable">$dim1</span>

  <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> $(seq 0 <span class="hljs-variable">$dim1</span>)
  <span class="hljs-keyword">do</span>
   <span class="hljs-built_in">let</span> <span class="hljs-string">"Rod1[<span class="hljs-variable">$elem</span>] = 2 * <span class="hljs-variable">$n</span> + 1"</span>
   Rod2[<span class="hljs-variable">$n</span>]=0
   Rod3[<span class="hljs-variable">$n</span>]=0
   ((elem--))
  <span class="hljs-keyword">done</span>
}


<span class="hljs-comment">###   Main   ###</span>

setup_arrays <span class="hljs-variable">$DISKS</span>
<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"+  Start Position"</span>

<span class="hljs-keyword">case</span> <span class="hljs-variable">$#</span> <span class="hljs-keyword">in</span>
    1) <span class="hljs-keyword">case</span> $((<span class="hljs-variable">$1</span>&gt;<span class="hljs-number">0</span>)) <span class="hljs-keyword">in</span>     <span class="hljs-comment"># Must have at least one disk.</span>
       1)
           disks=<span class="hljs-variable">$1</span>
           dohanoi <span class="hljs-variable">$1</span> 1 3 2
<span class="hljs-comment">#          Total moves = 2^n - 1, where n = number of disks.</span>
           <span class="hljs-built_in">echo</span>
           <span class="hljs-built_in">exit</span> 0;
           ;;
       *)
           <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$0</span>: Illegal value for number of disks"</span>;
           <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BADPARAM</span>;
           ;;
       <span class="hljs-keyword">esac</span>
    ;;
    *)
       clear
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"usage: <span class="hljs-variable">$0</span> N"</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"       Where \"N\" is the number of disks."</span>
       <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOPARAM</span>;
       ;;
<span class="hljs-keyword">esac</span>

<span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOEXIT</span>   <span class="hljs-comment"># Shouldn't exit here.</span>

<span class="hljs-comment"># Note:</span>
<span class="hljs-comment"># Redirect script output to a file, otherwise it scrolls off display.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p><a name="HANOI2AREF" id="HANOI2AREF"></a></p>
      <div class="EXAMPLE">
        <a name="HANOI2A" id="HANOI2A"></a>
        <p>
          <b>Example A-49.
            <i class="FIRSTTERM">The Towers of Hanoi, alternate graphic version</i></b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#! /bin/bash</span>
<span class="hljs-comment"># The Towers Of Hanoi</span>
<span class="hljs-comment"># Original script (hanoi.bash) copyright (C) 2000 Amit Singh.</span>
<span class="hljs-comment"># All Rights Reserved.</span>
<span class="hljs-comment"># http://hanoi.kernelthread.com</span>

<span class="hljs-comment">#  hanoi2.bash</span>
<span class="hljs-comment">#  Version 2: modded for ASCII-graphic display.</span>
<span class="hljs-comment">#  Uses code contributed by Antonio Macchi,</span>
<span class="hljs-comment">#+ with heavy editing by ABS Guide author.</span>
<span class="hljs-comment">#  This variant also falls under the original copyright, see above.</span>
<span class="hljs-comment">#  Used in ABS Guide with Amit Singh's permission (thanks!).</span>


<span class="hljs-comment">#   Variables   #</span>
E_NOPARAM=86
E_BADPARAM=87   <span class="hljs-comment"># Illegal no. of disks passed to script.</span>
E_NOEXIT=88
DELAY=2         <span class="hljs-comment"># Interval, in seconds, between moves. Change, if desired.</span>
DISKS=<span class="hljs-variable">$1</span>
Moves=0

MWIDTH=7
MARGIN=2
<span class="hljs-comment"># Arbitrary "magic" constants, work okay for relatively small # of disks.</span>
<span class="hljs-comment"># BASEWIDTH=51   # Original code.</span>
<span class="hljs-built_in">let</span> <span class="hljs-string">"basewidth = <span class="hljs-variable">$MWIDTH</span> * <span class="hljs-variable">$DISKS</span> + <span class="hljs-variable">$MARGIN</span>"</span> <span class="hljs-comment"># "Base" beneath rods.</span>
<span class="hljs-comment"># Above "algorithm" could likely stand improvement.</span>

<span class="hljs-comment"># Display variables.</span>
<span class="hljs-built_in">let</span> <span class="hljs-string">"disks1 = <span class="hljs-variable">$DISKS</span> - 1"</span>
<span class="hljs-built_in">let</span> <span class="hljs-string">"spaces1 = <span class="hljs-variable">$DISKS</span>"</span> 
<span class="hljs-built_in">let</span> <span class="hljs-string">"spaces2 = 2 * <span class="hljs-variable">$DISKS</span>"</span> 

<span class="hljs-built_in">let</span> <span class="hljs-string">"lastmove_t = <span class="hljs-variable">$DISKS</span> - 1"</span>                <span class="hljs-comment"># Final move?</span>


<span class="hljs-built_in">declare</span> -a Rod1 Rod2 Rod3

<span class="hljs-comment">#################</span>


<span class="hljs-keyword">function</span> repeat  {  <span class="hljs-comment"># $1=char $2=number of repetitions</span>
  <span class="hljs-built_in">local</span> n           <span class="hljs-comment"># Repeat-print a character.</span>
  
  <span class="hljs-keyword">for</span> (( n=0; n&lt;<span class="hljs-variable">$2</span>; n++ )); <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
  <span class="hljs-keyword">done</span>
}

<span class="hljs-keyword">function</span> FromRod  {
  <span class="hljs-built_in">local</span> rod summit weight sequence

  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    rod=<span class="hljs-variable">$1</span>
    <span class="hljs-built_in">test</span> <span class="hljs-variable">${rod/[^123]/}</span> || <span class="hljs-built_in">continue</span>

    sequence=$(<span class="hljs-built_in">echo</span> $(seq 0 <span class="hljs-variable">$disks1</span> | tac))
    <span class="hljs-keyword">for</span> summit <span class="hljs-keyword">in</span> <span class="hljs-variable">$sequence</span>; <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">eval</span> weight=\<span class="hljs-variable">${Rod${rod}</span>[<span class="hljs-variable">$summit</span>]}
      <span class="hljs-built_in">test</span> <span class="hljs-variable">$weight</span> -ne 0 &amp;&amp;
           { <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$rod</span> <span class="hljs-variable">$summit</span> <span class="hljs-variable">$weight</span>"</span>; <span class="hljs-built_in">return</span>; }
    <span class="hljs-keyword">done</span>
  <span class="hljs-keyword">done</span>
}


<span class="hljs-keyword">function</span> ToRod  { <span class="hljs-comment"># $1=previous (FromRod) weight</span>
  <span class="hljs-built_in">local</span> rod firstfree weight sequence
  
  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    rod=<span class="hljs-variable">$2</span>
    <span class="hljs-built_in">test</span> <span class="hljs-variable">${rod/[^123]}</span> || <span class="hljs-built_in">continue</span>

    sequence=$(<span class="hljs-built_in">echo</span> $(seq 0 <span class="hljs-variable">$disks1</span> | tac))
    <span class="hljs-keyword">for</span> firstfree <span class="hljs-keyword">in</span> <span class="hljs-variable">$sequence</span>; <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">eval</span> weight=\<span class="hljs-variable">${Rod${rod}</span>[<span class="hljs-variable">$firstfree</span>]}
      <span class="hljs-built_in">test</span> <span class="hljs-variable">$weight</span> -gt 0 &amp;&amp; { (( firstfree++ )); <span class="hljs-built_in">break</span>; }
    <span class="hljs-keyword">done</span>
    <span class="hljs-built_in">test</span> <span class="hljs-variable">$weight</span> -gt <span class="hljs-variable">$1</span> -o <span class="hljs-variable">$firstfree</span> = 0 &amp;&amp;
         { <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$rod</span> <span class="hljs-variable">$firstfree</span>"</span>; <span class="hljs-built_in">return</span>; }
  <span class="hljs-keyword">done</span>
}


<span class="hljs-keyword">function</span> PrintRods  {
  <span class="hljs-built_in">local</span> disk rod empty fill sp sequence

  tput cup 5 0

  repeat <span class="hljs-string">" "</span> <span class="hljs-variable">$spaces1</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"|"</span>
  repeat <span class="hljs-string">" "</span> <span class="hljs-variable">$spaces2</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"|"</span>
  repeat <span class="hljs-string">" "</span> <span class="hljs-variable">$spaces2</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"|"</span>

  sequence=$(<span class="hljs-built_in">echo</span> $(seq 0 <span class="hljs-variable">$disks1</span> | tac))
  <span class="hljs-keyword">for</span> disk <span class="hljs-keyword">in</span> <span class="hljs-variable">$sequence</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">for</span> rod <span class="hljs-keyword">in</span> {1..3}; <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">eval</span> empty=$(( <span class="hljs-variable">$DISKS</span> - (Rod<span class="hljs-variable">${rod}</span>[<span class="hljs-variable">$disk</span>] / <span class="hljs-number">2</span>) ))
      <span class="hljs-built_in">eval</span> fill=\<span class="hljs-variable">${Rod${rod}</span>[<span class="hljs-variable">$disk</span>]}
      repeat <span class="hljs-string">" "</span> <span class="hljs-variable">$empty</span>
      <span class="hljs-built_in">test</span> <span class="hljs-variable">$fill</span> -gt 0 &amp;&amp; repeat <span class="hljs-string">"*"</span> <span class="hljs-variable">$fill</span> || <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"|"</span>
      repeat <span class="hljs-string">" "</span> <span class="hljs-variable">$empty</span>
    <span class="hljs-keyword">done</span>
    <span class="hljs-built_in">echo</span>
  <span class="hljs-keyword">done</span>
  repeat <span class="hljs-string">"="</span> <span class="hljs-variable">$basewidth</span>   <span class="hljs-comment"># Print "base" beneath rods.</span>
  <span class="hljs-built_in">echo</span>
}


<span class="hljs-function"><span class="hljs-title">display</span></span> ()
{
  <span class="hljs-built_in">echo</span>
  PrintRods

  <span class="hljs-comment"># Get rod-number, summit and weight</span>
  first=( `FromRod <span class="hljs-variable">$1</span>` )
  <span class="hljs-built_in">eval</span> Rod<span class="hljs-variable">${first[0]}</span>[<span class="hljs-variable">${first[1]}</span>]=0

  <span class="hljs-comment"># Get rod-number and first-free position</span>
  second=( `ToRod <span class="hljs-variable">${first[2]}</span> <span class="hljs-variable">$2</span>` )
  <span class="hljs-built_in">eval</span> Rod<span class="hljs-variable">${second[0]}</span>[<span class="hljs-variable">${second[1]}</span>]=<span class="hljs-variable">${first[2]}</span>


  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">${Rod3[lastmove_t]}</span>"</span> = 1 ]
  <span class="hljs-keyword">then</span>   <span class="hljs-comment"># Last move? If yes, then display final position.</span>
    tput cup 0 0
    <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"+  Final Position: <span class="hljs-variable">$Moves</span> moves"</span>
    PrintRods
  <span class="hljs-keyword">fi</span>

  sleep <span class="hljs-variable">$DELAY</span>
}

<span class="hljs-comment"># From here down, almost the same as original (hanoi.bash) script.</span>

<span class="hljs-function"><span class="hljs-title">dohanoi</span></span>() {   <span class="hljs-comment"># Recursive function.</span>
    <span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span>
    0)
        ;;
    *)
        dohanoi <span class="hljs-string">"<span class="hljs-subst">$(($1-1)</span>)"</span> <span class="hljs-variable">$2</span> <span class="hljs-variable">$4</span> <span class="hljs-variable">$3</span>
        <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$Moves</span>"</span> -ne 0 ]
        <span class="hljs-keyword">then</span>
          tput cup 0 0
          <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"+  Position after move <span class="hljs-variable">$Moves</span>"</span>
        <span class="hljs-keyword">fi</span>
        ((Moves++))
        <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"   Next move will be:  "</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-variable">$2</span> <span class="hljs-string">"--&gt;"</span> <span class="hljs-variable">$3</span>
        display <span class="hljs-variable">$2</span> <span class="hljs-variable">$3</span>
        dohanoi <span class="hljs-string">"<span class="hljs-subst">$(($1-1)</span>)"</span> <span class="hljs-variable">$4</span> <span class="hljs-variable">$3</span> <span class="hljs-variable">$2</span>
        ;;
    <span class="hljs-keyword">esac</span>
}

<span class="hljs-function"><span class="hljs-title">setup_arrays</span></span> ()
{
  <span class="hljs-built_in">local</span> dim n elem

  <span class="hljs-built_in">let</span> <span class="hljs-string">"dim1 = <span class="hljs-variable">$1</span> - 1"</span>
  elem=<span class="hljs-variable">$dim1</span>

  <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> $(seq 0 <span class="hljs-variable">$dim1</span>)
  <span class="hljs-keyword">do</span>
   <span class="hljs-built_in">let</span> <span class="hljs-string">"Rod1[<span class="hljs-variable">$elem</span>] = 2 * <span class="hljs-variable">$n</span> + 1"</span>
   Rod2[<span class="hljs-variable">$n</span>]=0
   Rod3[<span class="hljs-variable">$n</span>]=0
   ((elem--))
  <span class="hljs-keyword">done</span>
}


<span class="hljs-comment">###   Main   ###</span>

<span class="hljs-built_in">trap</span> <span class="hljs-string">"tput cnorm"</span> 0
tput civis
clear

setup_arrays <span class="hljs-variable">$DISKS</span>

tput cup 0 0
<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"+  Start Position"</span>

<span class="hljs-keyword">case</span> <span class="hljs-variable">$#</span> <span class="hljs-keyword">in</span>
    1) <span class="hljs-keyword">case</span> $((<span class="hljs-variable">$1</span>&gt;<span class="hljs-number">0</span>)) <span class="hljs-keyword">in</span>     <span class="hljs-comment"># Must have at least one disk.</span>
       1)
           disks=<span class="hljs-variable">$1</span>
           dohanoi <span class="hljs-variable">$1</span> 1 3 2
<span class="hljs-comment">#          Total moves = 2^n - 1, where n = # of disks.</span>
           <span class="hljs-built_in">echo</span>
           <span class="hljs-built_in">exit</span> 0;
           ;;
       *)
           <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$0</span>: Illegal value for number of disks"</span>;
           <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BADPARAM</span>;
           ;;
       <span class="hljs-keyword">esac</span>
    ;;
    *)
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"usage: <span class="hljs-variable">$0</span> N"</span>
       <span class="hljs-built_in">echo</span> <span class="hljs-string">"       Where \"N\" is the number of disks."</span>
       <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOPARAM</span>;
       ;;
<span class="hljs-keyword">esac</span>

<span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOEXIT</span>   <span class="hljs-comment"># Shouldn't exit here.</span>

<span class="hljs-comment">#  Exercise:</span>
<span class="hljs-comment">#  --------</span>
<span class="hljs-comment">#  There is a minor bug in the script that causes the display of</span>
<span class="hljs-comment">#+ the next-to-last move to be skipped.</span>
<span class="hljs-comment">#+ Fix this.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="USEGETOPT" id="USEGETOPT"></a>
        <p>
          <b>Example A-50. An alternate version of the
            <a href="string-manipulation.html#GETOPTSIMPLE">getopt-simple.sh</a>
            script</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># UseGetOpt.sh</span>

<span class="hljs-comment"># Author: Peggy Russell &lt;prusselltechgroup@gmail.com&gt;</span>

<span class="hljs-function"><span class="hljs-title">UseGetOpt</span></span> () {
  <span class="hljs-built_in">declare</span> inputOptions
  <span class="hljs-built_in">declare</span> -r E_OPTERR=85
  <span class="hljs-built_in">declare</span> -r ScriptName=<span class="hljs-variable">${0##*/}</span>
  <span class="hljs-built_in">declare</span> -r ShortOpts=<span class="hljs-string">"adf:hlt"</span>
  <span class="hljs-built_in">declare</span> -r LongOpts=<span class="hljs-string">"aoption,debug,file:,help,log,test"</span>

<span class="hljs-function"><span class="hljs-title">DoSomething</span></span> () {
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"The function name is '<span class="hljs-variable">${FUNCNAME}</span>'"</span>
    <span class="hljs-comment">#  Recall that $FUNCNAME is an internal variable</span>
    <span class="hljs-comment">#+ holding the name of the function it is in.</span>
  }

  inputOptions=$(getopt -o <span class="hljs-string">"<span class="hljs-variable">${ShortOpts}</span>"</span> --long \
              <span class="hljs-string">"<span class="hljs-variable">${LongOpts}</span>"</span> --name <span class="hljs-string">"<span class="hljs-variable">${ScriptName}</span>"</span> -- <span class="hljs-string">"<span class="hljs-variable">${@}</span>"</span>)

  <span class="hljs-keyword">if</span> [[ ($? -ne 0) || (<span class="hljs-variable">$#</span> -eq 0) ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">${ScriptName}</span> [-dhlt] {OPTION...}"</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_OPTERR</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-built_in">eval</span> <span class="hljs-built_in">set</span> -- <span class="hljs-string">"<span class="hljs-variable">${inputOptions}</span>"</span>

  <span class="hljs-comment"># Only for educational purposes. Can be removed.</span>
  <span class="hljs-comment">#-----------------------------------------------</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"++ Test: Number of arguments: [<span class="hljs-variable">$#</span>]"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">'++ Test: Looping through "$@"'</span>
  <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"  ++ [<span class="hljs-variable">$a</span>]"</span>
  <span class="hljs-keyword">done</span>
  <span class="hljs-comment">#-----------------------------------------------</span>

  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">${1}</span>"</span> <span class="hljs-keyword">in</span>
      --aoption | -a)  <span class="hljs-comment"># Argument found.</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>]"</span>
        ;;

      --debug | -d)    <span class="hljs-comment"># Enable informational messages.</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Debugging enabled"</span>
        ;;

      --file | -f)     <span class="hljs-comment">#  Check for optional argument.</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> <span class="hljs-keyword">in</span>   <span class="hljs-comment">#+ Double colon is optional argument.</span>
          <span class="hljs-string">""</span>)          <span class="hljs-comment">#  Not there.</span>
              <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Use default"</span>
              <span class="hljs-built_in">shift</span>
              ;;

          *) <span class="hljs-comment"># Got it</span>
             <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Using input [<span class="hljs-variable">$2</span>]"</span>
             <span class="hljs-built_in">shift</span>
             ;;

        <span class="hljs-keyword">esac</span>
        DoSomething
        ;;

      --<span class="hljs-built_in">log</span> | -l) <span class="hljs-comment"># Enable Logging.</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Logging enabled"</span>
        ;;

      --<span class="hljs-built_in">test</span> | -t) <span class="hljs-comment"># Enable testing.</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Testing enabled"</span>
        ;;

      --<span class="hljs-built_in">help</span> | -h)
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Display help"</span>
        <span class="hljs-built_in">break</span>
        ;;

      --)   <span class="hljs-comment"># Done! $# is argument number for "--", $@ is "--"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Dash Dash"</span>
        <span class="hljs-built_in">break</span>
        ;;

       *)
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Major internal error!"</span>
        <span class="hljs-built_in">exit</span> 8
        ;;

    <span class="hljs-keyword">esac</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Number of arguments: [<span class="hljs-variable">$#</span>]"</span>
    <span class="hljs-built_in">shift</span>
  <span class="hljs-keyword">done</span>

  <span class="hljs-built_in">shift</span>
  <span class="hljs-comment"># Only for educational purposes. Can be removed.</span>
  <span class="hljs-comment">#----------------------------------------------------------------------</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"++ Test: Number of arguments after \"--\" is [<span class="hljs-variable">$#</span>] They are: [<span class="hljs-variable">$@</span>]"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">'++ Test: Looping through "$@"'</span>
  <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"  ++ [<span class="hljs-variable">$a</span>]"</span>
  <span class="hljs-keyword">done</span>
  <span class="hljs-comment">#----------------------------------------------------------------------</span>
  
}

<span class="hljs-comment">################################### M A I N ########################</span>
<span class="hljs-comment">#  If you remove "function UseGetOpt () {" and corresponding "}",</span>
<span class="hljs-comment">#+ you can uncomment the "exit 0" line below, and invoke this script</span>
<span class="hljs-comment">#+ with the various options from the command-line.</span>
<span class="hljs-comment">#-------------------------------------------------------------------</span>
<span class="hljs-comment"># exit 0</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Test 1"</span>
UseGetOpt -f myfile one <span class="hljs-string">"two three"</span> four

<span class="hljs-built_in">echo</span>;<span class="hljs-built_in">echo</span> <span class="hljs-string">"Test 2"</span>
UseGetOpt -h

<span class="hljs-built_in">echo</span>;<span class="hljs-built_in">echo</span> <span class="hljs-string">"Test 3 - Short Options"</span>
UseGetOpt -adltf myfile  anotherfile

<span class="hljs-built_in">echo</span>;<span class="hljs-built_in">echo</span> <span class="hljs-string">"Test 4 - Long Options"</span>
UseGetOpt --aoption --debug --<span class="hljs-built_in">log</span> --<span class="hljs-built_in">test</span> --file myfile anotherfile

<span class="hljs-built_in">exit</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="USEGETOPT2" id="USEGETOPT2"></a>
        <p>
          <b>Example A-51. The version of the
            <i class="FIRSTTERM">UseGetOpt.sh</i> example used in the
            <a href="tabexpansion.html">Tab Expansion appendix</a></b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment">#  UseGetOpt-2.sh</span>
<span class="hljs-comment">#  Modified version of the script for illustrating tab-expansion</span>
<span class="hljs-comment">#+ of command-line options.</span>
<span class="hljs-comment">#  See the "Introduction to Tab Expansion" appendix.</span>

<span class="hljs-comment">#  Possible options: -a -d -f -l -t -h</span>
<span class="hljs-comment">#+                   --aoption, --debug --file --log --test -- help --</span>

<span class="hljs-comment">#  Author of original script: Peggy Russell &lt;prusselltechgroup@gmail.com&gt;</span>


<span class="hljs-comment"># UseGetOpt () {</span>
  <span class="hljs-built_in">declare</span> inputOptions
  <span class="hljs-built_in">declare</span> -r E_OPTERR=85
  <span class="hljs-built_in">declare</span> -r ScriptName=<span class="hljs-variable">${0##*/}</span>
  <span class="hljs-built_in">declare</span> -r ShortOpts=<span class="hljs-string">"adf:hlt"</span>
  <span class="hljs-built_in">declare</span> -r LongOpts=<span class="hljs-string">"aoption,debug,file:,help,log,test"</span>

<span class="hljs-function"><span class="hljs-title">DoSomething</span></span> () {
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"The function name is '<span class="hljs-variable">${FUNCNAME}</span>'"</span>
  }

  inputOptions=$(getopt -o <span class="hljs-string">"<span class="hljs-variable">${ShortOpts}</span>"</span> --long \
              <span class="hljs-string">"<span class="hljs-variable">${LongOpts}</span>"</span> --name <span class="hljs-string">"<span class="hljs-variable">${ScriptName}</span>"</span> -- <span class="hljs-string">"<span class="hljs-variable">${@}</span>"</span>)

  <span class="hljs-keyword">if</span> [[ ($? -ne 0) || (<span class="hljs-variable">$#</span> -eq 0) ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">${ScriptName}</span> [-dhlt] {OPTION...}"</span>
    <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_OPTERR</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-built_in">eval</span> <span class="hljs-built_in">set</span> -- <span class="hljs-string">"<span class="hljs-variable">${inputOptions}</span>"</span>


  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">${1}</span>"</span> <span class="hljs-keyword">in</span>
      --aoption | -a)  <span class="hljs-comment"># Argument found.</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>]"</span>
        ;;

      --debug | -d)    <span class="hljs-comment"># Enable informational messages.</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Debugging enabled"</span>
        ;;

      --file | -f)     <span class="hljs-comment">#  Check for optional argument.</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> <span class="hljs-keyword">in</span>   <span class="hljs-comment">#+ Double colon is optional argument.</span>
          <span class="hljs-string">""</span>)          <span class="hljs-comment">#  Not there.</span>
              <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Use default"</span>
              <span class="hljs-built_in">shift</span>
              ;;

          *) <span class="hljs-comment"># Got it</span>
             <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Using input [<span class="hljs-variable">$2</span>]"</span>
             <span class="hljs-built_in">shift</span>
             ;;

        <span class="hljs-keyword">esac</span>
        DoSomething
        ;;

      --<span class="hljs-built_in">log</span> | -l) <span class="hljs-comment"># Enable Logging.</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Logging enabled"</span>
        ;;

      --<span class="hljs-built_in">test</span> | -t) <span class="hljs-comment"># Enable testing.</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Testing enabled"</span>
        ;;

      --<span class="hljs-built_in">help</span> | -h)
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Display help"</span>
        <span class="hljs-built_in">break</span>
        ;;

      --)   <span class="hljs-comment"># Done! $# is argument number for "--", $@ is "--"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Option [<span class="hljs-variable">$1</span>] Dash Dash"</span>
        <span class="hljs-built_in">break</span>
        ;;

       *)
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Major internal error!"</span>
        <span class="hljs-built_in">exit</span> 8
        ;;

    <span class="hljs-keyword">esac</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Number of arguments: [<span class="hljs-variable">$#</span>]"</span>
    <span class="hljs-built_in">shift</span>
  <span class="hljs-keyword">done</span>

  <span class="hljs-built_in">shift</span>
  
<span class="hljs-comment">#  }</span>

<span class="hljs-built_in">exit</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="SHOWALLC" id="SHOWALLC"></a>
        <p>
          <b>Example A-52. Cycling through all the possible color backgrounds</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># show-all-colors.sh</span>
<span class="hljs-comment"># Displays all 256 possible background colors, using ANSI escape sequences.</span>
<span class="hljs-comment"># Author: Chetankumar Phulpagare</span>
<span class="hljs-comment"># Used in ABS Guide with permission.</span>

T1=8
T2=6
T3=36
offset=0

<span class="hljs-keyword">for</span> num1 <span class="hljs-keyword">in</span> {0..7}
<span class="hljs-keyword">do</span> {
   <span class="hljs-keyword">for</span> num2 <span class="hljs-keyword">in</span> {0,1}
       <span class="hljs-keyword">do</span> {
          shownum=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$offset</span> + <span class="hljs-variable">$T1</span> * <span class="hljs-variable">${num2}</span> + <span class="hljs-variable">$num1</span>"</span> | bc`
          <span class="hljs-built_in">echo</span> -en <span class="hljs-string">"\E[0;48;5;<span class="hljs-variable">${shownum}</span>m color <span class="hljs-variable">${shownum}</span> \E[0m"</span>
          }
       <span class="hljs-keyword">done</span>
   <span class="hljs-built_in">echo</span>
   }
<span class="hljs-keyword">done</span>

offset=16
<span class="hljs-keyword">for</span> num1 <span class="hljs-keyword">in</span> {0..5}
<span class="hljs-keyword">do</span> {
   <span class="hljs-keyword">for</span> num2 <span class="hljs-keyword">in</span> {0..5}
       <span class="hljs-keyword">do</span> {
          <span class="hljs-keyword">for</span> num3 <span class="hljs-keyword">in</span> {0..5}
              <span class="hljs-keyword">do</span> {
                 shownum=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$offset</span> + <span class="hljs-variable">$T2</span> * <span class="hljs-variable">${num3}</span> \
                 + <span class="hljs-variable">$num2</span> + <span class="hljs-variable">$T3</span> * <span class="hljs-variable">${num1}</span>"</span> | bc`
                 <span class="hljs-built_in">echo</span> -en <span class="hljs-string">"\E[0;48;5;<span class="hljs-variable">${shownum}</span>m color <span class="hljs-variable">${shownum}</span> \E[0m"</span>
                 }
               <span class="hljs-keyword">done</span>
          <span class="hljs-built_in">echo</span>
          }
       <span class="hljs-keyword">done</span>
}
<span class="hljs-keyword">done</span>

offset=232
<span class="hljs-keyword">for</span> num1 <span class="hljs-keyword">in</span> {0..23}
<span class="hljs-keyword">do</span> {
   shownum=`expr <span class="hljs-variable">$offset</span> + <span class="hljs-variable">$num1</span>`
   <span class="hljs-built_in">echo</span> -en <span class="hljs-string">"\E[0;48;5;<span class="hljs-variable">${shownum}</span>m <span class="hljs-variable">${shownum}</span>\E[0m"</span>
}
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="SAMORSE" id="SAMORSE"></a>
        <p><b>Example A-53. Morse Code Practice</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># sam.sh, v. .01a</span>
<span class="hljs-comment"># Still Another Morse (code training script)</span>
<span class="hljs-comment"># With profuse apologies to Sam (F.B.) Morse.</span>
<span class="hljs-comment"># Author: Mendel Cooper</span>
<span class="hljs-comment"># License: GPL3</span>
<span class="hljs-comment"># Reldate: 05/25/11</span>

<span class="hljs-comment"># Morse code training script.</span>
<span class="hljs-comment"># Converts arguments to audible dots and dashes.</span>
<span class="hljs-comment"># Note: lowercase input only at this time.</span>



<span class="hljs-comment"># Get the wav files from the source tarball:</span>
<span class="hljs-comment"># http://bash.deta.in/abs-guide-latest.tar.bz2</span>
DOT=<span class="hljs-string">'soundfiles/dot.wav'</span>
DASH=<span class="hljs-string">'soundfiles/dash.wav'</span>
<span class="hljs-comment"># Maybe move soundfiles to /usr/local/sounds?</span>

LETTERSPACE=300000  <span class="hljs-comment"># Microseconds.</span>
WORDSPACE=980000
<span class="hljs-comment"># Nice and slow, for beginners. Maybe 5 wpm?</span>

EXIT_MSG=<span class="hljs-string">"May the Morse be with you!"</span>
E_NOARGS=75         <span class="hljs-comment"># No command-line args?</span>



<span class="hljs-built_in">declare</span> -A morse    <span class="hljs-comment"># Associative array!</span>
<span class="hljs-comment"># ======================================= #</span>
morse[a]=<span class="hljs-string">"dot; dash"</span>
morse[b]=<span class="hljs-string">"dash; dot; dot; dot"</span>
morse[c]=<span class="hljs-string">"dash; dot; dash; dot"</span>
morse[d]=<span class="hljs-string">"dash; dot; dot"</span>
morse[e]=<span class="hljs-string">"dot"</span>
morse[f]=<span class="hljs-string">"dot; dot; dash; dot"</span>
morse[g]=<span class="hljs-string">"dash; dash; dot"</span>
morse[h]=<span class="hljs-string">"dot; dot; dot; dot"</span>
morse[i]=<span class="hljs-string">"dot; dot;"</span>
morse[j]=<span class="hljs-string">"dot; dash; dash; dash"</span>
morse[k]=<span class="hljs-string">"dash; dot; dash"</span>
morse[l]=<span class="hljs-string">"dot; dash; dot; dot"</span>
morse[m]=<span class="hljs-string">"dash; dash"</span>
morse[n]=<span class="hljs-string">"dash; dot"</span>
morse[o]=<span class="hljs-string">"dash; dash; dash"</span>
morse[p]=<span class="hljs-string">"dot; dash; dash; dot"</span>
morse[q]=<span class="hljs-string">"dash; dash; dot; dash"</span>
morse[r]=<span class="hljs-string">"dot; dash; dot"</span>
morse[s]=<span class="hljs-string">"dot; dot; dot"</span>
morse[t]=<span class="hljs-string">"dash"</span>
morse[u]=<span class="hljs-string">"dot; dot; dash"</span>
morse[v]=<span class="hljs-string">"dot; dot; dot; dash"</span>
morse[w]=<span class="hljs-string">"dot; dash; dash"</span>
morse[x]=<span class="hljs-string">"dash; dot; dot; dash"</span>
morse[y]=<span class="hljs-string">"dash; dot; dash; dash"</span>
morse[z]=<span class="hljs-string">"dash; dash; dot; dot"</span>
morse[0]=<span class="hljs-string">"dash; dash; dash; dash; dash"</span>
morse[1]=<span class="hljs-string">"dot; dash; dash; dash; dash"</span>
morse[2]=<span class="hljs-string">"dot; dot; dash; dash; dash"</span>
morse[3]=<span class="hljs-string">"dot; dot; dot; dash; dash"</span>
morse[4]=<span class="hljs-string">"dot; dot; dot; dot; dash"</span>
morse[5]=<span class="hljs-string">"dot; dot; dot; dot; dot"</span>
morse[6]=<span class="hljs-string">"dash; dot; dot; dot; dot"</span>
morse[7]=<span class="hljs-string">"dash; dash; dot; dot; dot"</span>
morse[8]=<span class="hljs-string">"dash; dash; dash; dot; dot"</span>
morse[9]=<span class="hljs-string">"dash; dash; dash; dash; dot"</span>
<span class="hljs-comment"># The following must be escaped or quoted.</span>
morse[?]=<span class="hljs-string">"dot; dot; dash; dash; dot; dot"</span>
morse[.]=<span class="hljs-string">"dot; dash; dot; dash; dot; dash"</span>
morse[,]=<span class="hljs-string">"dash; dash; dot; dot; dash; dash"</span>
morse[/]=<span class="hljs-string">"dash; dot; dot; dash; dot"</span>
morse[\@]=<span class="hljs-string">"dot; dash; dash; dot; dash; dot"</span>
<span class="hljs-comment"># ======================================= #</span>

<span class="hljs-function"><span class="hljs-title">play_letter</span></span> ()
{
  <span class="hljs-built_in">eval</span> <span class="hljs-variable">${morse[$1]}</span>   <span class="hljs-comment"># Play dots, dashes from appropriate sound files.</span>
  <span class="hljs-comment"># Why is 'eval' necessary here?</span>
  usleep <span class="hljs-variable">$LETTERSPACE</span> <span class="hljs-comment"># Pause in between letters.</span>
}

<span class="hljs-function"><span class="hljs-title">extract_letters</span></span> ()
{                     <span class="hljs-comment"># Slice string apart, letter by letter.</span>
  <span class="hljs-built_in">local</span> pos=0         <span class="hljs-comment"># Starting at left end of string.</span>
  <span class="hljs-built_in">local</span> len=1         <span class="hljs-comment"># One letter at a time.</span>
  strlen=<span class="hljs-variable">${#1}</span>

  <span class="hljs-keyword">while</span> [ <span class="hljs-variable">$pos</span> -lt <span class="hljs-variable">$strlen</span> ]
  <span class="hljs-keyword">do</span>
    letter=<span class="hljs-variable">${1:pos:len}</span>
    <span class="hljs-comment">#      ^^^^^^^^^^^^    See Chapter 10.1.</span>
    play_letter <span class="hljs-variable">$letter</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"*"</span>       <span class="hljs-comment">#    Mark letter just played.</span>
    ((pos++))
  <span class="hljs-keyword">done</span>
}

<span class="hljs-comment">######### Play the sounds ############</span>
<span class="hljs-function"><span class="hljs-title">dot</span></span>()  { aplay <span class="hljs-string">"<span class="hljs-variable">$DOT</span>"</span> 2&amp;&gt;/dev/null;  }
<span class="hljs-function"><span class="hljs-title">dash</span></span>() { aplay <span class="hljs-string">"<span class="hljs-variable">$DASH</span>"</span> 2&amp;&gt;/dev/null; }
<span class="hljs-comment">######################################</span>

<span class="hljs-function"><span class="hljs-title">no_args</span></span> ()
{
    <span class="hljs-built_in">declare</span> -a usage
    usage=( <span class="hljs-variable">$0</span> word1 word2 ... )

    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage:"</span>; <span class="hljs-built_in">echo</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-variable">${usage[*]}</span>
    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> 0 1 2 3
    <span class="hljs-keyword">do</span>
      extract_letters <span class="hljs-variable">${usage[index]}</span>     
      usleep <span class="hljs-variable">$WORDSPACE</span>
      <span class="hljs-built_in">echo</span> -n <span class="hljs-string">" "</span>     <span class="hljs-comment"># Print space between words.</span>
    <span class="hljs-keyword">done</span>
<span class="hljs-comment">#   echo "Usage: $0 word1 word2 ... "</span>
    <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>
}


<span class="hljs-comment"># int main()</span>
<span class="hljs-comment"># {</span>

clear                 <span class="hljs-comment"># Clear the terminal screen.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"            SAM"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Still Another Morse code trainer"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"    Author: Mendel Cooper"</span>
<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>;

<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
<span class="hljs-keyword">then</span>
  no_args
  <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$EXIT_MSG</span>"</span>; <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOARGS</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"$*"</span>       <span class="hljs-comment"># Print text that will be played.</span>

until [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
<span class="hljs-keyword">do</span>
  extract_letters <span class="hljs-variable">$1</span>
  <span class="hljs-built_in">shift</span>           <span class="hljs-comment"># On to next word.</span>
  usleep <span class="hljs-variable">$WORDSPACE</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">" "</span>     <span class="hljs-comment"># Print space between words.</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$EXIT_MSG</span>"</span>; <span class="hljs-built_in">echo</span>

<span class="hljs-built_in">exit</span> 0
<span class="hljs-comment"># }</span>

<span class="hljs-comment">#  Exercises:</span>
<span class="hljs-comment">#  ---------</span>
<span class="hljs-comment">#  1) Have the script accept either lowercase or uppercase words</span>
<span class="hljs-comment">#+    as arguments. Hint: Use 'tr' . . .</span>
<span class="hljs-comment">#  2) Have the script optionally accept input from a text file.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="BASE64" id="BASE64"></a>
        <p><b>Example A-54. Base64 encoding/decoding</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># base64.sh: Bash implementation of Base64 encoding and decoding.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Copyright (c) 2011 vladz &lt;vladz@devzero.fr&gt;</span>
<span class="hljs-comment"># Used in ABSG with permission (thanks!).</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  Encode or decode original Base64 (and also Base64url)</span>
<span class="hljs-comment">#+ from STDIN to STDOUT.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#    Usage:</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#    Encode</span>
<span class="hljs-comment">#    $ ./base64.sh &lt; binary-file &gt; binary-file.base64</span>
<span class="hljs-comment">#    Decode</span>
<span class="hljs-comment">#    $ ./base64.sh -d &lt; binary-file.base64 &gt; binary-file</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Reference:</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#    [1]  RFC4648 - "The Base16, Base32, and Base64 Data Encodings"</span>
<span class="hljs-comment">#         http://tools.ietf.org/html/rfc4648#section-5</span>


<span class="hljs-comment"># The base64_charset[] array contains entire base64 charset,</span>
<span class="hljs-comment"># and additionally the character "=" ...</span>
base64_charset=( {A..Z} {a..z} {0..9} + / = )
                <span class="hljs-comment"># Nice illustration of brace expansion.</span>

<span class="hljs-comment">#  Uncomment the ### line below to use base64url encoding instead of</span>
<span class="hljs-comment">#+ original base64.</span>
<span class="hljs-comment">### base64_charset=( {A..Z} {a..z} {0..9} - _ = )</span>

<span class="hljs-comment">#  Output text width when encoding</span>
<span class="hljs-comment">#+ (64 characters, just like openssl output).</span>
text_width=64

<span class="hljs-keyword">function</span> display_base64_char {
<span class="hljs-comment">#  Convert a 6-bit number (between 0 and 63) into its corresponding values</span>
<span class="hljs-comment">#+ in Base64, then display the result with the specified text width.</span>
  <span class="hljs-built_in">printf</span> <span class="hljs-string">"<span class="hljs-variable">${base64_charset[$1]}</span>"</span>; (( width++ ))
  (( width % text_width == 0 )) &amp;&amp; <span class="hljs-built_in">printf</span> <span class="hljs-string">"\n"</span>
}

<span class="hljs-keyword">function</span> encode_base64 {
<span class="hljs-comment"># Encode three 8-bit hexadecimal codes into four 6-bit numbers.</span>
  <span class="hljs-comment">#    We need two local int array variables:</span>
  <span class="hljs-comment">#    c8[]: to store the codes of the 8-bit characters to encode</span>
  <span class="hljs-comment">#    c6[]: to store the corresponding encoded values on 6-bit</span>
  <span class="hljs-built_in">declare</span> -a -i c8 c6

  <span class="hljs-comment">#  Convert hexadecimal to decimal.</span>
  c8=( $(<span class="hljs-built_in">printf</span> <span class="hljs-string">"ibase=16; <span class="hljs-variable">${1:0:2}</span>\n<span class="hljs-variable">${1:2:2}</span>\n<span class="hljs-variable">${1:4:2}</span>\n"</span> | bc) )

  <span class="hljs-comment">#  Let's play with bitwise operators</span>
  <span class="hljs-comment">#+ (3x8-bit into 4x6-bits conversion).</span>
  (( c6[0] = c8[0] &gt;&gt; 2 ))
  (( c6[1] = ((c8[0] &amp;  3) &lt;&lt; 4) | (c8[1] &gt;&gt; 4) ))

  <span class="hljs-comment"># The following operations depend on the c8 element number.</span>
  <span class="hljs-keyword">case</span> <span class="hljs-variable">${#c8[*]}</span> <span class="hljs-keyword">in</span> 
    3) (( c6[2] = ((c8[1] &amp; 15) &lt;&lt; 2) | (c8[2] &gt;&gt; 6) ))
       (( c6[3] = c8[2] &amp; 63 )) ;;
    2) (( c6[2] = (c8[1] &amp; 15) &lt;&lt; 2 ))
       (( c6[3] = 64 )) ;;
    1) (( c6[2] = c6[3] = 64 )) ;;
  <span class="hljs-keyword">esac</span>

  <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> <span class="hljs-variable">${c6[@]}</span>; <span class="hljs-keyword">do</span>
    display_base64_char <span class="hljs-variable">${char}</span>
  <span class="hljs-keyword">done</span>
}

<span class="hljs-keyword">function</span> decode_base64 {
<span class="hljs-comment"># Decode four base64 characters into three hexadecimal ASCII characters.</span>
  <span class="hljs-comment">#  c8[]: to store the codes of the 8-bit characters</span>
  <span class="hljs-comment">#  c6[]: to store the corresponding Base64 values on 6-bit</span>
  <span class="hljs-built_in">declare</span> -a -i c8 c6

  <span class="hljs-comment"># Find decimal value corresponding to the current base64 character.</span>
  <span class="hljs-keyword">for</span> current_char <span class="hljs-keyword">in</span> <span class="hljs-variable">${1:0:1}</span> <span class="hljs-variable">${1:1:1}</span> <span class="hljs-variable">${1:2:1}</span> <span class="hljs-variable">${1:3:1}</span>; <span class="hljs-keyword">do</span>
     [ <span class="hljs-string">"<span class="hljs-variable">${current_char}</span>"</span> = <span class="hljs-string">"="</span> ] &amp;&amp; <span class="hljs-built_in">break</span>

     position=0
     <span class="hljs-keyword">while</span> [ <span class="hljs-string">"<span class="hljs-variable">${current_char}</span>"</span> != <span class="hljs-string">"<span class="hljs-variable">${base64_charset[${position}</span>]}"</span> ]; <span class="hljs-keyword">do</span>
        (( position++ ))
     <span class="hljs-keyword">done</span>

     c6=( <span class="hljs-variable">${c6[*]}</span> <span class="hljs-variable">${position}</span> )
  <span class="hljs-keyword">done</span>

  <span class="hljs-comment">#  Let's play with bitwise operators</span>
  <span class="hljs-comment">#+ (4x8-bit into 3x6-bits conversion).</span>
  (( c8[0] = (c6[0] &lt;&lt; 2) | (c6[1] &gt;&gt; 4) ))

  <span class="hljs-comment"># The next operations depends on the c6 elements number.</span>
  <span class="hljs-keyword">case</span> <span class="hljs-variable">${#c6[*]}</span> <span class="hljs-keyword">in</span>
    3) (( c8[1] = ( (c6[1] &amp; 15) &lt;&lt; 4) | (c6[2] &gt;&gt; 2) ))
       (( c8[2] = (c6[2] &amp; 3) &lt;&lt; 6 )); <span class="hljs-built_in">unset</span> c8[2] ;;
    4) (( c8[1] = ( (c6[1] &amp; 15) &lt;&lt; 4) | (c6[2] &gt;&gt; 2) ))
       (( c8[2] = ( (c6[2] &amp;  3) &lt;&lt; 6) |  c6[3] )) ;;
  <span class="hljs-keyword">esac</span>

  <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> <span class="hljs-variable">${c8[*]}</span>; <span class="hljs-keyword">do</span>
     <span class="hljs-built_in">printf</span> <span class="hljs-string">"\x<span class="hljs-subst">$(printf <span class="hljs-string">"%x"</span> ${char})</span>"</span>
  <span class="hljs-keyword">done</span>
}


<span class="hljs-comment"># main ()</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> = <span class="hljs-string">"-d"</span> ]; <span class="hljs-keyword">then</span>   <span class="hljs-comment"># decode</span>

  <span class="hljs-comment"># Reformat STDIN in pseudo 4x6-bit groups.</span>
  content=$(cat - | tr -d <span class="hljs-string">"\n"</span> | sed -r <span class="hljs-string">"s/(.{4})/\1 /g"</span>)

  <span class="hljs-keyword">for</span> chars <span class="hljs-keyword">in</span> <span class="hljs-variable">${content}</span>; <span class="hljs-keyword">do</span> decode_base64 <span class="hljs-variable">${chars}</span>; <span class="hljs-keyword">done</span>

<span class="hljs-keyword">else</span>
  <span class="hljs-comment"># Make a hexdump of stdin and reformat in 3-byte groups.</span>
  content=$(cat - | xxd -ps -u | sed -r <span class="hljs-string">"s/(\w{6})/\1 /g"</span> |
            tr -d <span class="hljs-string">"\n"</span>)

  <span class="hljs-keyword">for</span> chars <span class="hljs-keyword">in</span> <span class="hljs-variable">${content}</span>; <span class="hljs-keyword">do</span> encode_base64 <span class="hljs-variable">${chars}</span>; <span class="hljs-keyword">done</span>

  <span class="hljs-built_in">echo</span>

<span class="hljs-keyword">fi</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="SEDAPPEND" id="SEDAPPEND"></a>
        <p>
          <b>Example A-55. Inserting text in a file using
            <i class="FIRSTTERM">sed</i></b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment">#  Prepends a string at a specified line</span>
<span class="hljs-comment">#+ in files with names ending in "sample"</span>
<span class="hljs-comment">#+ in the current working directory.</span>
<span class="hljs-comment">#  000000000000000000000000000000000000</span>
<span class="hljs-comment">#  This script overwrites files!</span>
<span class="hljs-comment">#  Be careful running it in a directory</span>
<span class="hljs-comment">#+ where you have important files!!!</span>
<span class="hljs-comment">#  000000000000000000000000000000000000</span>

<span class="hljs-comment">#  Create a couple of files to operate on ...</span>
<span class="hljs-comment">#  01sample</span>
<span class="hljs-comment">#  02sample</span>
<span class="hljs-comment">#  ... etc.</span>
<span class="hljs-comment">#  These files must not be empty, else the prepend will not work.</span>

lineno=1            <span class="hljs-comment"># Append at line 1 (prepend).</span>
filespec=<span class="hljs-string">"*sample"</span>  <span class="hljs-comment"># Filename pattern to operate on.</span>

string=$(whoami)    <span class="hljs-comment"># Will set your username as string to insert.</span>
                    <span class="hljs-comment"># It could just as easily be any other string.</span>

<span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> <span class="hljs-variable">$filespec</span> <span class="hljs-comment"># Specify which files to alter.</span>
<span class="hljs-keyword">do</span> <span class="hljs-comment">#        ^^^^^^^^^</span>
 sed -i <span class="hljs-string">""</span><span class="hljs-variable">$lineno</span><span class="hljs-string">"i "</span><span class="hljs-variable">$string</span><span class="hljs-string">""</span> <span class="hljs-variable">$file</span>
<span class="hljs-comment">#    ^^ -i option edits files in-place.</span>
<span class="hljs-comment">#                 ^ Insert (i) command.</span>
 <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span><span class="hljs-variable">$file</span><span class="hljs-string">" altered!"</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: files possibly clobbered!"</span>

<span class="hljs-built_in">exit</span> 0

<span class="hljs-comment"># Exercise:</span>
<span class="hljs-comment"># Add error checking to this script.</span>
<span class="hljs-comment"># It needs it badly.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="GRONSFELD" id="GRONSFELD"></a>
        <p><b>Example A-56. The Gronsfeld Cipher</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># gronsfeld.bash</span>

<span class="hljs-comment"># License: GPL3</span>
<span class="hljs-comment"># Reldate 06/23/11</span>

<span class="hljs-comment">#  This is an implementation of the Gronsfeld Cipher.</span>
<span class="hljs-comment">#  It's essentially a stripped-down variant of the </span>
<span class="hljs-comment">#+ polyalphabetic Vigencre Tableau, but with only 10 alphabets.</span>
<span class="hljs-comment">#  The classic Gronsfeld has a numeric sequence as the key word,</span>
<span class="hljs-comment">#+ but here we substitute a letter string, for ease of use.</span>
<span class="hljs-comment">#  Allegedly, this cipher was invented by the eponymous Count Gronsfeld</span>
<span class="hljs-comment">#+ in the 17th Century. It was at one time considered to be unbreakable.</span>
<span class="hljs-comment">#  Note that this is ###not### a secure cipher by modern standards.</span>

<span class="hljs-comment">#  Global Variables  #</span>
Enc_suffix=<span class="hljs-string">"29379"</span>   <span class="hljs-comment">#  Encrypted text output with this 5-digit suffix. </span>
                     <span class="hljs-comment">#  This functions as a decryption flag,</span>
                     <span class="hljs-comment">#+ and when used to generate passwords adds security.</span>
Default_key=<span class="hljs-string">"gronsfeldk"</span>
                     <span class="hljs-comment">#  The script uses this if key not entered below</span>
                     <span class="hljs-comment">#  (at "Keychain").</span>
                     <span class="hljs-comment">#  Change the above two values frequently</span>
                     <span class="hljs-comment">#+ for added security.</span>

GROUPLEN=5           <span class="hljs-comment">#  Output in groups of 5 letters, per tradition.</span>
alpha1=( abcdefghijklmnopqrstuvwxyz )
alpha2=( {A..Z} )    <span class="hljs-comment">#  Output in all caps, per tradition.</span>
                     <span class="hljs-comment">#  Use   alpha2=( {a..z} )   for password generator.</span>
wraplen=26           <span class="hljs-comment">#  Wrap around if past end of alphabet.</span>
dflag=               <span class="hljs-comment">#  Decrypt flag (set if $Enc_suffix present).</span>
E_NOARGS=76          <span class="hljs-comment">#  Missing command-line args?</span>
DEBUG=77             <span class="hljs-comment">#  Debugging flag.</span>
<span class="hljs-built_in">declare</span> -a offsets   <span class="hljs-comment">#  This array holds the numeric shift values for</span>
                     <span class="hljs-comment">#+ encryption/decryption.</span>

<span class="hljs-comment">########Keychain#########</span>
key=  <span class="hljs-comment">### Put key here!!!</span>
      <span class="hljs-comment"># 10 characters!</span>
<span class="hljs-comment">#########################</span>



<span class="hljs-comment"># Function</span>
: ()
{ <span class="hljs-comment"># Encrypt or decrypt, depending on whether $dflag is set.</span>
  <span class="hljs-comment"># Why ": ()" as a function name? Just to prove that it can be done.</span>

  <span class="hljs-built_in">local</span> idx keydx mlen off1 shft
  <span class="hljs-built_in">local</span> plaintext=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
  <span class="hljs-built_in">local</span> mlen=<span class="hljs-variable">${#plaintext}</span>

<span class="hljs-keyword">for</span> (( idx=0; idx&lt;<span class="hljs-variable">$mlen</span>; idx++ ))
<span class="hljs-keyword">do</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"keydx = <span class="hljs-variable">$idx</span> % <span class="hljs-variable">$keylen</span>"</span>
  shft=<span class="hljs-variable">${offsets[keydx]}</span>

  <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$dflag</span>"</span> ]
  <span class="hljs-keyword">then</span>                  <span class="hljs-comment"># Decrypt!</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"off1 = <span class="hljs-subst">$(expr index <span class="hljs-string">"<span class="hljs-variable">${alpha1[*]}</span>"</span> ${plaintext:idx:1})</span> - <span class="hljs-variable">$shft</span>"</span>
    <span class="hljs-comment"># Shift backward to decrypt.</span>
  <span class="hljs-keyword">else</span>                  <span class="hljs-comment"># Encrypt!</span>
    <span class="hljs-built_in">let</span> <span class="hljs-string">"off1 = <span class="hljs-subst">$(expr index <span class="hljs-string">"<span class="hljs-variable">${alpha1[*]}</span>"</span> ${plaintext:idx:1})</span> + <span class="hljs-variable">$shft</span>"</span>
    <span class="hljs-comment"># Shift forward to encrypt.</span>
    <span class="hljs-built_in">test</span> $(( <span class="hljs-variable">$idx</span> % <span class="hljs-variable">$GROUPLEN</span>)) = 0 &amp;&amp; <span class="hljs-built_in">echo</span> -n <span class="hljs-string">" "</span>  <span class="hljs-comment"># Groups of 5 letters.</span>
    <span class="hljs-comment">#  Comment out above line for output as a string without whitespace,</span>
    <span class="hljs-comment">#+ for example, if using the script as a password generator.</span>
  <span class="hljs-keyword">fi</span>

  ((off1--))   <span class="hljs-comment"># Normalize. Why is this necessary?</span>

      <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$off1</span> -lt 0 ]
      <span class="hljs-keyword">then</span>     <span class="hljs-comment"># Catch negative indices.</span>
        <span class="hljs-built_in">let</span> <span class="hljs-string">"off1 += <span class="hljs-variable">$wraplen</span>"</span>
      <span class="hljs-keyword">fi</span>

  ((off1 %= <span class="hljs-variable">$wraplen</span>))   <span class="hljs-comment"># Wrap around if past end of alphabet.</span>

  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">${alpha2[off1]}</span>"</span>

<span class="hljs-keyword">done</span>

  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$dflag</span>"</span> ]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">" <span class="hljs-variable">$Enc_suffix</span>"</span>
<span class="hljs-comment">#   echo "$Enc_suffix"  # For password generator.</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span>
  <span class="hljs-keyword">fi</span>
} <span class="hljs-comment"># End encrypt/decrypt function.</span>



<span class="hljs-comment"># int main () {</span>

<span class="hljs-comment"># Check for command-line args.</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
<span class="hljs-keyword">then</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$0</span> TEXT TO ENCODE/DECODE"</span>
   <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_NOARGS</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">${!#}</span> == <span class="hljs-string">"<span class="hljs-variable">$Enc_suffix</span>"</span> ]
<span class="hljs-comment">#    ^^^^^ Final command-line arg.</span>
<span class="hljs-keyword">then</span>
  dflag=ON
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"+"</span>           <span class="hljs-comment"># Flag decrypted text with a "+" for easy ID.</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$key</span>"</span> ]
<span class="hljs-keyword">then</span>
  key=<span class="hljs-string">"<span class="hljs-variable">$Default_key</span>"</span>    <span class="hljs-comment"># "gronsfeldk" per above.</span>
<span class="hljs-keyword">fi</span>

keylen=<span class="hljs-variable">${#key}</span>

<span class="hljs-keyword">for</span> (( idx=0; idx&lt;<span class="hljs-variable">$keylen</span>; idx++ ))
<span class="hljs-keyword">do</span>  <span class="hljs-comment"># Calculate shift values for encryption/decryption.</span>
  offsets[idx]=$(expr index <span class="hljs-string">"<span class="hljs-variable">${alpha1[*]}</span>"</span> <span class="hljs-variable">${key:idx:1}</span>)   <span class="hljs-comment"># Normalize.</span>
  ((offsets[idx]--))  <span class="hljs-comment">#  Necessary because "expr index" starts at 1,</span>
                      <span class="hljs-comment">#+ whereas array count starts at 0.</span>
  <span class="hljs-comment"># Generate array of numerical offsets corresponding to the key.</span>
  <span class="hljs-comment"># There are simpler ways to accomplish this.</span>
<span class="hljs-keyword">done</span>

args=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"$*"</span> | sed -e <span class="hljs-string">'s/ //g'</span> | tr A-Z a-z | sed -e <span class="hljs-string">'s/[0-9]//g'</span>)
<span class="hljs-comment"># Remove whitespace and digits from command-line args.</span>
<span class="hljs-comment"># Can modify to also remove punctuation characters, if desired.</span>

         <span class="hljs-comment"># Debug:</span>
         <span class="hljs-comment"># echo "$args"; exit $DEBUG</span>

: <span class="hljs-string">"<span class="hljs-variable">$args</span>"</span>               <span class="hljs-comment"># Call the function named ":".</span>
<span class="hljs-comment"># : is a null operator, except . . . when it's a function name!</span>

<span class="hljs-built_in">exit</span> $?    <span class="hljs-comment"># } End-of-script</span>


<span class="hljs-comment">#   **************************************************************   #</span>
<span class="hljs-comment">#   This script can function as a  password generator,</span>
<span class="hljs-comment">#+  with several minor mods, see above.</span>
<span class="hljs-comment">#   That would allow an easy-to-remember password, even the word</span>
<span class="hljs-comment">#+ "password" itself, which encrypts to vrgfotvo29379</span>
<span class="hljs-comment">#+  a fairly secure password not susceptible to a dictionary attack.</span>
<span class="hljs-comment">#   Or, you could use your own name (surely that's easy to remember!).</span>
<span class="hljs-comment">#   For example, Bozo Bozeman encrypts to hfnbttdppkt29379.</span>
<span class="hljs-comment">#   **************************************************************   #</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="BINGO" id="BINGO"></a>
        <p><b>Example A-57. Bingo Number Generator</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># bingo.sh</span>
<span class="hljs-comment"># Bingo number generator</span>
<span class="hljs-comment"># Reldate 20Aug12, License: Public Domain</span>

<span class="hljs-comment">#######################################################################</span>
<span class="hljs-comment"># This script generates bingo numbers.</span>
<span class="hljs-comment"># Hitting a key generates a new number.</span>
<span class="hljs-comment"># Hitting 'q' terminates the script.</span>
<span class="hljs-comment"># In a given run of the script, there will be no duplicate numbers.</span>
<span class="hljs-comment"># When the script terminates, it prints a log of the numbers generated.</span>
<span class="hljs-comment">#######################################################################</span>

MIN=1       <span class="hljs-comment"># Lowest allowable bingo number.</span>
MAX=75      <span class="hljs-comment"># Highest allowable bingo number.</span>
COLS=15     <span class="hljs-comment"># Numbers in each column (B I N G O).</span>
SINGLE_DIGIT_MAX=9

<span class="hljs-built_in">declare</span> -a Numbers
Prefix=(B I N G O)

<span class="hljs-function"><span class="hljs-title">initialize_Numbers</span></span> ()
{  <span class="hljs-comment"># Zero them out to start.</span>
   <span class="hljs-comment"># They'll be incremented if chosen.</span>
   <span class="hljs-built_in">local</span> index=0
   until [ <span class="hljs-string">"<span class="hljs-variable">$index</span>"</span> -gt <span class="hljs-variable">$MAX</span> ]
   <span class="hljs-keyword">do</span>
     Numbers[index]=0
     ((index++))
   <span class="hljs-keyword">done</span>

   Numbers[0]=1   <span class="hljs-comment"># Flag zero, so it won't be selected.</span>
}


<span class="hljs-function"><span class="hljs-title">generate_number</span></span> ()
{
   <span class="hljs-built_in">local</span> number

   <span class="hljs-keyword">while</span> [ 1 ]
   <span class="hljs-keyword">do</span>
     <span class="hljs-built_in">let</span> <span class="hljs-string">"number = <span class="hljs-subst">$(expr $RANDOM % $MAX)</span>"</span>
     <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${Numbers[number]}</span> -eq 0 ]    <span class="hljs-comment"># Number not yet called.</span>
     <span class="hljs-keyword">then</span>
       <span class="hljs-built_in">let</span> <span class="hljs-string">"Numbers[number]+=1"</span>         <span class="hljs-comment"># Flag it in the array.</span>
       <span class="hljs-built_in">break</span>                            <span class="hljs-comment"># And terminate loop.</span>
     <span class="hljs-keyword">fi</span>   <span class="hljs-comment"># Else if already called, loop and generate another number.</span>
   <span class="hljs-keyword">done</span>
   <span class="hljs-comment"># Exercise: Rewrite this more elegantly as an until-loop.</span>

   <span class="hljs-built_in">return</span> <span class="hljs-variable">$number</span>
}


<span class="hljs-function"><span class="hljs-title">print_numbers_called</span></span> ()
{   <span class="hljs-comment"># Print out the called number log in neat columns.</span>
    <span class="hljs-comment"># echo ${Numbers[@]}</span>

<span class="hljs-built_in">local</span> pre2=0                <span class="hljs-comment">#  Prefix a zero, so columns will align</span>
                            <span class="hljs-comment">#+ on single-digit numbers.</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Number Stats"</span>

<span class="hljs-keyword">for</span> (( index=1; index&lt;=MAX; index++))
<span class="hljs-keyword">do</span>
  count=<span class="hljs-variable">${Numbers[index]}</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"t = <span class="hljs-variable">$index</span> - 1"</span>      <span class="hljs-comment"># Normalize, since array begins with index 0.</span>
  <span class="hljs-built_in">let</span> <span class="hljs-string">"column = <span class="hljs-subst">$(expr $t / $COLS)</span>"</span>
  pre=<span class="hljs-variable">${Prefix[column]}</span>
<span class="hljs-comment"># echo -n "${Prefix[column]} "</span>

<span class="hljs-keyword">if</span> [ $(expr <span class="hljs-variable">$t</span> % <span class="hljs-variable">$COLS</span>) -eq 0 ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span>   <span class="hljs-comment"># Newline at end of row.</span>
<span class="hljs-keyword">fi</span>

  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$index</span>"</span> -gt <span class="hljs-variable">$SINGLE_DIGIT_MAX</span> ]  <span class="hljs-comment"># Check for single-digit number.</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$pre</span><span class="hljs-variable">$index</span>#<span class="hljs-variable">$count</span> "</span>
  <span class="hljs-keyword">else</span>    <span class="hljs-comment"># Prefix a zero.</span>
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$pre</span><span class="hljs-variable">$pre2</span><span class="hljs-variable">$index</span>#<span class="hljs-variable">$count</span> "</span>
  <span class="hljs-keyword">fi</span>

<span class="hljs-keyword">done</span>
}



<span class="hljs-comment"># main () {</span>
RANDOM=$$   <span class="hljs-comment"># Seed random number generator.</span>

initialize_Numbers   <span class="hljs-comment"># Zero out the number tracking array.</span>

clear
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Bingo Number Caller"</span>; <span class="hljs-built_in">echo</span>

<span class="hljs-keyword">while</span> [[ <span class="hljs-string">"<span class="hljs-variable">$key</span>"</span> != <span class="hljs-string">"q"</span> ]]   <span class="hljs-comment"># Main loop.</span>
<span class="hljs-keyword">do</span>
  <span class="hljs-built_in">read</span> -s -n1 -p <span class="hljs-string">"Hit a key for the next number [q to exit] "</span> key
  <span class="hljs-comment"># Usually 'q' exits, but not always.</span>
  <span class="hljs-comment"># Can always hit Ctl-C if q fails.</span>
  <span class="hljs-built_in">echo</span>

  generate_number; new_number=$?

  <span class="hljs-built_in">let</span> <span class="hljs-string">"column = <span class="hljs-subst">$(expr $new_number / $COLS)</span>"</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">${Prefix[column]}</span> "</span>   <span class="hljs-comment"># B-I-N-G-O</span>

  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$new_number</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>

<span class="hljs-comment"># Game over ...</span>
print_numbers_called
<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"[#0 = not called . . . #1 = called]"</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">exit</span> 0
<span class="hljs-comment"># }</span>


<span class="hljs-comment"># Certainly, this script could stand some improvement.</span>
<span class="hljs-comment">#See also the author's Instructable:</span>
<span class="hljs-comment">#www.instructables.com/id/Binguino-An-Arduino-based-Bingo-Number-Generato/</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>
        <a name="BASICSREV0" id="BASICSREV0"></a>To end this section, a review
        of the basics . . . and more.
      </p>
      <div class="EXAMPLE">
        <a name="BASICSREVIEWED" id="BASICSREVIEWED"></a>
        <p><b>Example A-58. Basics Reviewed</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># basics-reviewed.bash</span>

<span class="hljs-comment"># File extension == *.bash == specific to Bash</span>

<span class="hljs-comment">#   Copyright (c) Michael S. Zick, 2003; All rights reserved.</span>
<span class="hljs-comment">#   License: Use in any form, for any purpose.</span>
<span class="hljs-comment">#   Revision: $ID$</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#              Edited for layout by M.C.</span>
<span class="hljs-comment">#   (author of the "Advanced Bash Scripting Guide")</span>
<span class="hljs-comment">#   Fixes and updates (04/08) by Cliff Bamford.</span>


<span class="hljs-comment">#  This script tested under Bash versions 2.04, 2.05a and 2.05b.</span>
<span class="hljs-comment">#  It may not work with earlier versions.</span>
<span class="hljs-comment">#  This demonstration script generates one --intentional--</span>
<span class="hljs-comment">#+ "command not found" error message. See line 436.</span>

<span class="hljs-comment">#  The current Bash maintainer, Chet Ramey, has fixed the items noted</span>
<span class="hljs-comment">#+ for later versions of Bash.</span>



        <span class="hljs-comment">###-------------------------------------------###</span>
        <span class="hljs-comment">###  Pipe the output of this script to 'more' ###</span>
        <span class="hljs-comment">###+ else it will scroll off the page.        ###</span>
        <span class="hljs-comment">###                                           ###</span>
        <span class="hljs-comment">###  You may also redirect its output         ###</span>
        <span class="hljs-comment">###+ to a file for examination.               ###  </span>
        <span class="hljs-comment">###-------------------------------------------###</span>



<span class="hljs-comment">#  Most of the following points are described at length in</span>
<span class="hljs-comment">#+ the text of the foregoing "Advanced Bash Scripting Guide."</span>
<span class="hljs-comment">#  This demonstration script is mostly just a reorganized presentation.</span>
<span class="hljs-comment">#      -- msz</span>

<span class="hljs-comment"># Variables are not typed unless otherwise specified.</span>

<span class="hljs-comment">#  Variables are named. Names must contain a non-digit.</span>
<span class="hljs-comment">#  File descriptor names (as in, for example: 2&gt;&amp;1)</span>
<span class="hljs-comment">#+ contain ONLY digits.</span>

<span class="hljs-comment"># Parameters and Bash array elements are numbered.</span>
<span class="hljs-comment"># (Parameters are very similar to Bash arrays.)</span>

<span class="hljs-comment"># A variable name may be undefined (null reference).</span>
<span class="hljs-built_in">unset</span> VarNull

<span class="hljs-comment"># A variable name may be defined but empty (null contents).</span>
VarEmpty=<span class="hljs-string">''</span>                         <span class="hljs-comment"># Two, adjacent, single quotes.</span>

<span class="hljs-comment"># A variable name may be defined and non-empty.</span>
VarSomething=<span class="hljs-string">'Literal'</span>

<span class="hljs-comment"># A variable may contain:</span>
<span class="hljs-comment">#   * A whole number as a signed 32-bit (or larger) integer</span>
<span class="hljs-comment">#   * A string</span>
<span class="hljs-comment"># A variable may also be an array.</span>

<span class="hljs-comment">#  A string may contain embedded blanks and may be treated</span>
<span class="hljs-comment">#+ as if it where a function name with optional arguments.</span>

<span class="hljs-comment">#  The names of variables and the names of functions</span>
<span class="hljs-comment">#+ are in different namespaces.</span>


<span class="hljs-comment">#  A variable may be defined as a Bash array either explicitly or</span>
<span class="hljs-comment">#+ implicitly by the syntax of the assignment statement.</span>
<span class="hljs-comment">#  Explicit:</span>
<span class="hljs-built_in">declare</span> -a ArrayVar



<span class="hljs-comment"># The echo command is a builtin.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$VarSomething</span>

<span class="hljs-comment"># The printf command is a builtin.</span>
<span class="hljs-comment"># Translate %s as: String-Format</span>
<span class="hljs-built_in">printf</span> %s <span class="hljs-variable">$VarSomething</span>         <span class="hljs-comment"># No linebreak specified, none output.</span>
<span class="hljs-built_in">echo</span>                            <span class="hljs-comment"># Default, only linebreak output.</span>




<span class="hljs-comment"># The Bash parser word breaks on whitespace.</span>
<span class="hljs-comment"># Whitespace, or the lack of it is significant.</span>
<span class="hljs-comment"># (This holds true in general; there are, of course, exceptions.)</span>




<span class="hljs-comment"># Translate the DOLLAR_SIGN character as: Content-Of.</span>

<span class="hljs-comment"># Extended-Syntax way of writing Content-Of:</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarSomething}</span>

<span class="hljs-comment">#  The ${ ... } Extended-Syntax allows more than just the variable</span>
<span class="hljs-comment">#+ name to be specified.</span>
<span class="hljs-comment">#  In general, $VarSomething can always be written as: ${VarSomething}.</span>

<span class="hljs-comment"># Call this script with arguments to see the following in action.</span>



<span class="hljs-comment">#  Outside of double-quotes, the special characters @ and *</span>
<span class="hljs-comment">#+ specify identical behavior.</span>
<span class="hljs-comment">#  May be pronounced as: All-Elements-Of.</span>

<span class="hljs-comment">#  Without specification of a name, they refer to the</span>
<span class="hljs-comment">#+ pre-defined parameter Bash-Array.</span>



<span class="hljs-comment"># Glob-Pattern references</span>
<span class="hljs-built_in">echo</span> $*                         <span class="hljs-comment"># All parameters to script or function</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${*}</span>                       <span class="hljs-comment"># Same</span>

<span class="hljs-comment"># Bash disables filename expansion for Glob-Patterns.</span>
<span class="hljs-comment"># Only character matching is active.</span>


<span class="hljs-comment"># All-Elements-Of references</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$@</span>                         <span class="hljs-comment"># Same as above</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${@}</span>                       <span class="hljs-comment"># Same as above</span>




<span class="hljs-comment">#  Within double-quotes, the behavior of Glob-Pattern references</span>
<span class="hljs-comment">#+ depends on the setting of IFS (Input Field Separator).</span>
<span class="hljs-comment">#  Within double-quotes, All-Elements-Of references behave the same.</span>


<span class="hljs-comment">#  Specifying only the name of a variable holding a string refers</span>
<span class="hljs-comment">#+ to all elements (characters) of a string.</span>


<span class="hljs-comment">#  To specify an element (character) of a string,</span>
<span class="hljs-comment">#+ the Extended-Syntax reference notation (see below) MAY be used.</span>




<span class="hljs-comment">#  Specifying only the name of a Bash array references</span>
<span class="hljs-comment">#+ the subscript zero element,</span>
<span class="hljs-comment">#+ NOT the FIRST DEFINED nor the FIRST WITH CONTENTS element.</span>

<span class="hljs-comment">#  Additional qualification is needed to reference other elements,</span>
<span class="hljs-comment">#+ which means that the reference MUST be written in Extended-Syntax.</span>
<span class="hljs-comment">#  The general form is: ${name[subscript]}.</span>

<span class="hljs-comment">#  The string forms may also be used: ${name:subscript}</span>
<span class="hljs-comment">#+ for Bash-Arrays when referencing the subscript zero element.</span>


<span class="hljs-comment"># Bash-Arrays are implemented internally as linked lists,</span>
<span class="hljs-comment">#+ not as a fixed area of storage as in some programming languages.</span>


<span class="hljs-comment">#   Characteristics of Bash arrays (Bash-Arrays):</span>
<span class="hljs-comment">#   --------------------------------------------</span>

<span class="hljs-comment">#   If not otherwise specified, Bash-Array subscripts begin with</span>
<span class="hljs-comment">#+  subscript number zero. Literally: [0]</span>
<span class="hljs-comment">#   This is called zero-based indexing.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#   If not otherwise specified, Bash-Arrays are subscript packed</span>
<span class="hljs-comment">#+  (sequential subscripts without subscript gaps).</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#   Negative subscripts are not allowed.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#   Elements of a Bash-Array need not all be of the same type.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#   Elements of a Bash-Array may be undefined (null reference).</span>
<span class="hljs-comment">#       That is, a Bash-Array may be "subscript sparse."</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#   Elements of a Bash-Array may be defined and empty (null contents).</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#   Elements of a Bash-Array may contain:</span>
<span class="hljs-comment">#     * A whole number as a signed 32-bit (or larger) integer</span>
<span class="hljs-comment">#     * A string</span>
<span class="hljs-comment">#     * A string formated so that it appears to be a function name</span>
<span class="hljs-comment">#     + with optional arguments</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#   Defined elements of a Bash-Array may be undefined (unset).</span>
<span class="hljs-comment">#       That is, a subscript packed Bash-Array may be changed</span>
<span class="hljs-comment">#   +   into a subscript sparse Bash-Array.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#   Elements may be added to a Bash-Array by defining an element</span>
<span class="hljs-comment">#+  not previously defined.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment"># For these reasons, I have been calling them "Bash-Arrays".</span>
<span class="hljs-comment"># I'll return to the generic term "array" from now on.</span>
<span class="hljs-comment">#     -- msz</span>


<span class="hljs-built_in">echo</span> <span class="hljs-string">"========================================================="</span>

<span class="hljs-comment">#  Lines 202 - 334 supplied by Cliff Bamford. (Thanks!)</span>
<span class="hljs-comment">#  Demo --- Interaction with Arrays, quoting, IFS, echo, * and @   ---  </span>
<span class="hljs-comment">#+ all affect how things work</span>

ArrayVar[0]=<span class="hljs-string">'zero'</span>                    <span class="hljs-comment"># 0 normal</span>
ArrayVar[1]=one                       <span class="hljs-comment"># 1 unquoted literal</span>
ArrayVar[2]=<span class="hljs-string">'two'</span>                     <span class="hljs-comment"># 2 normal</span>
ArrayVar[3]=<span class="hljs-string">'three'</span>                   <span class="hljs-comment"># 3 normal</span>
ArrayVar[4]=<span class="hljs-string">'I am four'</span>               <span class="hljs-comment"># 4 normal with spaces</span>
ArrayVar[5]=<span class="hljs-string">'five'</span>                    <span class="hljs-comment"># 5 normal</span>
<span class="hljs-built_in">unset</span> ArrayVar[6]                     <span class="hljs-comment"># 6 undefined</span>
ArrayValue[7]=<span class="hljs-string">'seven'</span>                 <span class="hljs-comment"># 7 normal</span>
ArrayValue[8]=<span class="hljs-string">''</span>                      <span class="hljs-comment"># 8 defined but empty</span>
ArrayValue[9]=<span class="hljs-string">'nine'</span>                  <span class="hljs-comment"># 9 normal</span>


<span class="hljs-built_in">echo</span> <span class="hljs-string">'--- Here is the array we are using for this test'</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ArrayVar[0]='zero'             # 0 normal"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ArrayVar[1]=one                # 1 unquoted literal"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ArrayVar[2]='two'              # 2 normal"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ArrayVar[3]='three'            # 3 normal"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ArrayVar[4]='I am four'        # 4 normal with spaces"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ArrayVar[5]='five'             # 5 normal"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"unset ArrayVar[6]              # 6 undefined"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ArrayValue[7]='seven'          # 7 normal"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ArrayValue[8]=''               # 8 defined but empty"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ArrayValue[9]='nine'           # 9 normal"</span>
<span class="hljs-built_in">echo</span>


<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'---Case0: No double-quotes, Default IFS of space,tab,newline ---'</span>
IFS=$<span class="hljs-string">'\x20'</span>$<span class="hljs-string">'\x09'</span>$<span class="hljs-string">'\x0A'</span>            <span class="hljs-comment"># In exactly this order.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q {${ArrayVar[*]}'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-variable">${ArrayVar[*]}</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q {${ArrayVar[@]}'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-variable">${ArrayVar[@]}</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo ${ArrayVar[*]}'</span>
<span class="hljs-built_in">echo</span>  <span class="hljs-variable">${ArrayVar[@]}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo {${ArrayVar[@]}'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${ArrayVar[@]}</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'---Case1: Within double-quotes - Default IFS of space-tab- 
newline ---'</span>
IFS=$<span class="hljs-string">'\x20'</span>$<span class="hljs-string">'\x09'</span>$<span class="hljs-string">'\x0A'</span>           <span class="hljs-comment">#  These three bytes,</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q "{${ArrayVar[*]}"'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[*]}</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q "{${ArrayVar[@]}"'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo "${ArrayVar[*]}"'</span>
<span class="hljs-built_in">echo</span>  <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo "{${ArrayVar[@]}"'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'---Case2: Within double-quotes - IFS is q'</span>
IFS=<span class="hljs-string">'q'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q "{${ArrayVar[*]}"'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[*]}</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q "{${ArrayVar[@]}"'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo "${ArrayVar[*]}"'</span>
<span class="hljs-built_in">echo</span>  <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo "{${ArrayVar[@]}"'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'---Case3: Within double-quotes - IFS is ^'</span>
IFS=<span class="hljs-string">'^'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q "{${ArrayVar[*]}"'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[*]}</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q "{${ArrayVar[@]}"'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo "${ArrayVar[*]}"'</span>
<span class="hljs-built_in">echo</span>  <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo "{${ArrayVar[@]}"'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'---Case4: Within double-quotes - IFS is ^ followed by  
space,tab,newline'</span>
IFS=$<span class="hljs-string">'^'</span>$<span class="hljs-string">'\x20'</span>$<span class="hljs-string">'\x09'</span>$<span class="hljs-string">'\x0A'</span>       <span class="hljs-comment"># ^ + space tab newline</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q "{${ArrayVar[*]}"'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[*]}</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q "{${ArrayVar[@]}"'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo "${ArrayVar[*]}"'</span>
<span class="hljs-built_in">echo</span>  <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo "{${ArrayVar[@]}"'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'---Case6: Within double-quotes - IFS set and empty '</span>
IFS=<span class="hljs-string">''</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q "{${ArrayVar[*]}"'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[*]}</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q "{${ArrayVar[@]}"'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo "${ArrayVar[*]}"'</span>
<span class="hljs-built_in">echo</span>  <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo "{${ArrayVar[@]}"'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'---Case7: Within double-quotes - IFS is unset'</span>
<span class="hljs-built_in">unset</span> IFS
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q "{${ArrayVar[*]}"'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[*]}</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: printf %q "{${ArrayVar[@]}"'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo "${ArrayVar[*]}"'</span>
<span class="hljs-built_in">echo</span>  <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Here is: echo "{${ArrayVar[@]}"'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${ArrayVar[@]}</span>"</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'---End of Cases---'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"========================================================="</span>; <span class="hljs-built_in">echo</span>



<span class="hljs-comment"># Put IFS back to the default.</span>
<span class="hljs-comment"># Default is exactly these three bytes.</span>
IFS=$<span class="hljs-string">'\x20'</span>$<span class="hljs-string">'\x09'</span>$<span class="hljs-string">'\x0A'</span>           <span class="hljs-comment"># In exactly this order.</span>

<span class="hljs-comment"># Interpretation of the above outputs:</span>
<span class="hljs-comment">#   A Glob-Pattern is I/O; the setting of IFS matters.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#   An All-Elements-Of does not consider IFS settings.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#   Note the different output using the echo command and the</span>
<span class="hljs-comment">#+  quoted format operator of the printf command.</span>


<span class="hljs-comment">#  Recall:</span>
<span class="hljs-comment">#   Parameters are similar to arrays and have the similar behaviors.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  The above examples demonstrate the possible variations.</span>
<span class="hljs-comment">#  To retain the shape of a sparse array, additional script</span>
<span class="hljs-comment">#+ programming is required.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  The source code of Bash has a routine to output the</span>
<span class="hljs-comment">#+ [subscript]=value   array assignment format.</span>
<span class="hljs-comment">#  As of version 2.05b, that routine is not used,</span>
<span class="hljs-comment">#+ but that might change in future releases.</span>



<span class="hljs-comment"># The length of a string, measured in non-null elements (characters):</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Non-quoted references - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Non-Null character count: '</span><span class="hljs-variable">${#VarSomething}</span><span class="hljs-string">' characters.'</span>

<span class="hljs-comment"># test='Lit'$'\x00''eral'           # $'\x00' is a null character.</span>
<span class="hljs-comment"># echo ${#test}                     # See that?</span>



<span class="hljs-comment">#  The length of an array, measured in defined elements,</span>
<span class="hljs-comment">#+ including null content elements.</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Defined content count: '</span><span class="hljs-variable">${#ArrayVar[@]}</span><span class="hljs-string">' elements.'</span>
<span class="hljs-comment"># That is NOT the maximum subscript (4).</span>
<span class="hljs-comment"># That is NOT the range of the subscripts (1 . . 4 inclusive).</span>
<span class="hljs-comment"># It IS the length of the linked list.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  Both the maximum subscript and the range of the subscripts may</span>
<span class="hljs-comment">#+ be found with additional script programming.</span>

<span class="hljs-comment"># The length of a string, measured in non-null elements (characters):</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Quoted, Glob-Pattern references - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Non-Null character count: '</span><span class="hljs-string">"<span class="hljs-variable">${#VarSomething}</span>"</span><span class="hljs-string">' characters.'</span>

<span class="hljs-comment">#  The length of an array, measured in defined elements,</span>
<span class="hljs-comment">#+ including null-content elements.</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Defined element count: '</span><span class="hljs-string">"<span class="hljs-variable">${#ArrayVar[*]}</span>"</span><span class="hljs-string">' elements.'</span>

<span class="hljs-comment">#  Interpretation: Substitution does not effect the ${# ... } operation.</span>
<span class="hljs-comment">#  Suggestion:</span>
<span class="hljs-comment">#  Always use the All-Elements-Of character</span>
<span class="hljs-comment">#+ if that is what is intended (independence from IFS).</span>



<span class="hljs-comment">#  Define a simple function.</span>
<span class="hljs-comment">#  I include an underscore in the name</span>
<span class="hljs-comment">#+ to make it distinctive in the examples below.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  Bash separates variable names and function names</span>
<span class="hljs-comment">#+ in different namespaces.</span>
<span class="hljs-comment">#  The Mark-One eyeball isn't that advanced.</span>
<span class="hljs-comment">###</span>
<span class="hljs-function"><span class="hljs-title">_simple</span></span>() {
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">'SimpleFunc'</span><span class="hljs-variable">$@</span>          <span class="hljs-comment">#  Newlines are swallowed in</span>
}                                   <span class="hljs-comment">#+ result returned in any case.</span>


<span class="hljs-comment"># The ( ... ) notation invokes a command or function.</span>
<span class="hljs-comment"># The $( ... ) notation is pronounced: Result-Of.</span>


<span class="hljs-comment"># Invoke the function _simple</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Output of function _simple - -'</span>
_simple                             <span class="hljs-comment"># Try passing arguments.</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-comment"># or</span>
(_simple)                           <span class="hljs-comment"># Try passing arguments.</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Is there a variable of that name? -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$_simple</span> not defined           <span class="hljs-comment"># No variable by that name.</span>

<span class="hljs-comment"># Invoke the result of function _simple (Error msg intended)</span>

<span class="hljs-comment">###</span>
$(_simple)                          <span class="hljs-comment"># Gives an error message:</span>
<span class="hljs-comment">#                          line 436: SimpleFunc: command not found</span>
<span class="hljs-comment">#                          ---------------------------------------</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-comment">###</span>

<span class="hljs-comment">#  The first word of the result of function _simple</span>
<span class="hljs-comment">#+ is neither a valid Bash command nor the name of a defined function.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment"># This demonstrates that the output of _simple is subject to evaluation.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment"># Interpretation:</span>
<span class="hljs-comment">#   A function can be used to generate in-line Bash commands.</span>


<span class="hljs-comment"># A simple function where the first word of result IS a bash command:</span>
<span class="hljs-comment">###</span>
<span class="hljs-function"><span class="hljs-title">_print</span></span>() {
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">'printf %q '</span><span class="hljs-variable">$@</span>
}

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Outputs of function _print - -'</span>
_print parm1 parm2                  <span class="hljs-comment"># An Output NOT A Command.</span>
<span class="hljs-built_in">echo</span>

$(_print parm1 parm2)               <span class="hljs-comment">#  Executes: printf %q parm1 parm2</span>
                                    <span class="hljs-comment">#  See above IFS examples for the</span>
                                    <span class="hljs-comment">#+ various possibilities.</span>
<span class="hljs-built_in">echo</span>

$(_print <span class="hljs-variable">$VarSomething</span>)             <span class="hljs-comment"># The predictable result.</span>
<span class="hljs-built_in">echo</span>



<span class="hljs-comment"># Function variables</span>
<span class="hljs-comment"># ------------------</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Function variables - -'</span>
<span class="hljs-comment"># A variable may represent a signed integer, a string or an array.</span>
<span class="hljs-comment"># A string may be used like a function name with optional arguments.</span>

<span class="hljs-comment"># set -vx                           #  Enable if desired</span>
<span class="hljs-built_in">declare</span> -f funcVar                  <span class="hljs-comment">#+ in namespace of functions</span>

funcVar=_print                      <span class="hljs-comment"># Contains name of function.</span>
<span class="hljs-variable">$funcVar</span> parm1                      <span class="hljs-comment"># Same as _print at this point.</span>
<span class="hljs-built_in">echo</span>

funcVar=$(_print )                  <span class="hljs-comment"># Contains result of function.</span>
<span class="hljs-variable">$funcVar</span>                            <span class="hljs-comment"># No input, No output.</span>
<span class="hljs-variable">$funcVar</span> <span class="hljs-variable">$VarSomething</span>              <span class="hljs-comment"># The predictable result.</span>
<span class="hljs-built_in">echo</span>

funcVar=$(_print <span class="hljs-variable">$VarSomething</span>)     <span class="hljs-comment">#  $VarSomething replaced HERE.</span>
<span class="hljs-variable">$funcVar</span>                            <span class="hljs-comment">#  The expansion is part of the</span>
<span class="hljs-built_in">echo</span>                                <span class="hljs-comment">#+ variable contents.</span>

funcVar=<span class="hljs-string">"<span class="hljs-subst">$(_print $VarSomething)</span>"</span>   <span class="hljs-comment">#  $VarSomething replaced HERE.</span>
<span class="hljs-variable">$funcVar</span>                            <span class="hljs-comment">#  The expansion is part of the</span>
<span class="hljs-built_in">echo</span>                                <span class="hljs-comment">#+ variable contents.</span>

<span class="hljs-comment">#  The difference between the unquoted and the double-quoted versions</span>
<span class="hljs-comment">#+ above can be seen in the "protect_literal.sh" example.</span>
<span class="hljs-comment">#  The first case above is processed as two, unquoted, Bash-Words.</span>
<span class="hljs-comment">#  The second case above is processed as one, quoted, Bash-Word.</span>




<span class="hljs-comment"># Delayed replacement</span>
<span class="hljs-comment"># -------------------</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Delayed replacement - -'</span>
funcVar=<span class="hljs-string">"<span class="hljs-subst">$(_print '$VarSomething')</span>"</span> <span class="hljs-comment"># No replacement, single Bash-Word.</span>
<span class="hljs-built_in">eval</span> <span class="hljs-variable">$funcVar</span>                       <span class="hljs-comment"># $VarSomething replaced HERE.</span>
<span class="hljs-built_in">echo</span>

VarSomething=<span class="hljs-string">'NewThing'</span>
<span class="hljs-built_in">eval</span> <span class="hljs-variable">$funcVar</span>                       <span class="hljs-comment"># $VarSomething replaced HERE.</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># Restore the original setting trashed above.</span>
VarSomething=Literal

<span class="hljs-comment">#  There are a pair of functions demonstrated in the</span>
<span class="hljs-comment">#+ "protect_literal.sh" and "unprotect_literal.sh" examples.</span>
<span class="hljs-comment">#  These are general purpose functions for delayed replacement literals</span>
<span class="hljs-comment">#+ containing variables.</span>





<span class="hljs-comment"># REVIEW:</span>
<span class="hljs-comment"># ------</span>

<span class="hljs-comment">#  A string can be considered a Classic-Array of elements (characters).</span>
<span class="hljs-comment">#  A string operation applies to all elements (characters) of the string</span>
<span class="hljs-comment">#+ (in concept, anyway).</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  The notation: ${array_name[@]} represents all elements of the</span>
<span class="hljs-comment">#+ Bash-Array: array_name.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  The Extended-Syntax string operations can be applied to all</span>
<span class="hljs-comment">#+ elements of an array.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  This may be thought of as a For-Each operation on a vector of strings.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  Parameters are similar to an array.</span>
<span class="hljs-comment">#  The initialization of a parameter array for a script</span>
<span class="hljs-comment">#+ and a parameter array for a function only differ</span>
<span class="hljs-comment">#+ in the initialization of ${0}, which never changes its setting.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  Subscript zero of the script's parameter array contains</span>
<span class="hljs-comment">#+ the name of the script.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  Subscript zero of a function's parameter array DOES NOT contain</span>
<span class="hljs-comment">#+ the name of the function.</span>
<span class="hljs-comment">#  The name of the current function is accessed by the $FUNCNAME variable.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  A quick, review list follows (quick, not short).</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Test (but not change) - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- null reference -'</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarNull-'NotSet'}</span><span class="hljs-string">' '</span>          <span class="hljs-comment"># NotSet</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarNull}</span>                         <span class="hljs-comment"># NewLine only</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarNull:-'NotSet'}</span><span class="hljs-string">' '</span>         <span class="hljs-comment"># NotSet</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarNull}</span>                         <span class="hljs-comment"># Newline only</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- null contents -'</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarEmpty-'Empty'}</span><span class="hljs-string">' '</span>          <span class="hljs-comment"># Only the space</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarEmpty}</span>                        <span class="hljs-comment"># Newline only</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarEmpty:-'Empty'}</span><span class="hljs-string">' '</span>         <span class="hljs-comment"># Empty</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarEmpty}</span>                        <span class="hljs-comment"># Newline only</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- contents -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarSomething-'Content'}</span>          <span class="hljs-comment"># Literal</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarSomething:-'Content'}</span>         <span class="hljs-comment"># Literal</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Sparse Array -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${ArrayVar[@]-'not set'}</span>

<span class="hljs-comment"># ASCII-Art time</span>
<span class="hljs-comment"># State     Y==yes, N==no</span>
<span class="hljs-comment">#           -       :-</span>
<span class="hljs-comment"># Unset     Y       Y       ${# ... } == 0</span>
<span class="hljs-comment"># Empty     N       Y       ${# ... } == 0</span>
<span class="hljs-comment"># Contents  N       N       ${# ... } &gt; 0</span>

<span class="hljs-comment">#  Either the first and/or the second part of the tests</span>
<span class="hljs-comment">#+ may be a command or a function invocation string.</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Test 1 for undefined - -'</span>
<span class="hljs-built_in">declare</span> -i t
<span class="hljs-function"><span class="hljs-title">_decT</span></span>() {
    t=<span class="hljs-variable">$t</span>-1
}

<span class="hljs-comment"># Null reference, set: t == -1</span>
t=<span class="hljs-variable">${#VarNull}</span>                           <span class="hljs-comment"># Results in zero.</span>
<span class="hljs-variable">${VarNull- _decT }</span>                      <span class="hljs-comment"># Function executes, t now -1.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$t</span>

<span class="hljs-comment"># Null contents, set: t == 0</span>
t=<span class="hljs-variable">${#VarEmpty}</span>                          <span class="hljs-comment"># Results in zero.</span>
<span class="hljs-variable">${VarEmpty- _decT }</span>                     <span class="hljs-comment"># _decT function NOT executed.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$t</span>

<span class="hljs-comment"># Contents, set: t == number of non-null characters</span>
VarSomething=<span class="hljs-string">'_simple'</span>                  <span class="hljs-comment"># Set to valid function name.</span>
t=<span class="hljs-variable">${#VarSomething}</span>                      <span class="hljs-comment"># non-zero length</span>
<span class="hljs-variable">${VarSomething- _decT }</span>                 <span class="hljs-comment"># Function _simple executed.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$t</span>                                 <span class="hljs-comment"># Note the Append-To action.</span>

<span class="hljs-comment"># Exercise: clean up that example.</span>
<span class="hljs-built_in">unset</span> t
<span class="hljs-built_in">unset</span> _decT
VarSomething=Literal

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Test and Change - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Assignment if null reference -'</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarNull='NotSet'}</span><span class="hljs-string">' '</span>          <span class="hljs-comment"># NotSet NotSet</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarNull}</span>
<span class="hljs-built_in">unset</span> VarNull

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Assignment if null reference -'</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarNull:='NotSet'}</span><span class="hljs-string">' '</span>         <span class="hljs-comment"># NotSet NotSet</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarNull}</span>
<span class="hljs-built_in">unset</span> VarNull

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- No assignment if null contents -'</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarEmpty='Empty'}</span><span class="hljs-string">' '</span>          <span class="hljs-comment"># Space only</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarEmpty}</span>
VarEmpty=<span class="hljs-string">''</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Assignment if null contents -'</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarEmpty:='Empty'}</span><span class="hljs-string">' '</span>         <span class="hljs-comment"># Empty Empty</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarEmpty}</span>
VarEmpty=<span class="hljs-string">''</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- No change if already has contents -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarSomething='Content'}</span>          <span class="hljs-comment"># Literal</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarSomething:='Content'}</span>         <span class="hljs-comment"># Literal</span>


<span class="hljs-comment"># "Subscript sparse" Bash-Arrays</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  Bash-Arrays are subscript packed, beginning with</span>
<span class="hljs-comment">#+ subscript zero unless otherwise specified.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  The initialization of ArrayVar was one way</span>
<span class="hljs-comment">#+ to "otherwise specify".  Here is the other way:</span>
<span class="hljs-comment">###</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">declare</span> -a ArraySparse
ArraySparse=( [1]=one [2]=<span class="hljs-string">''</span> [4]=<span class="hljs-string">'four'</span> )
<span class="hljs-comment"># [0]=null reference, [2]=null content, [3]=null reference</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Array-Sparse List - -'</span>
<span class="hljs-comment"># Within double-quotes, default IFS, Glob-Pattern</span>

IFS=$<span class="hljs-string">'\x20'</span>$<span class="hljs-string">'\x09'</span>$<span class="hljs-string">'\x0A'</span>
<span class="hljs-built_in">printf</span> %q <span class="hljs-string">"<span class="hljs-variable">${ArraySparse[*]}</span>"</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-comment">#  Note that the output does not distinguish between "null content"</span>
<span class="hljs-comment">#+ and "null reference".</span>
<span class="hljs-comment">#  Both print as escaped whitespace.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  Note also that the output does NOT contain escaped whitespace</span>
<span class="hljs-comment">#+ for the "null reference(s)" prior to the first defined element.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment"># This behavior of 2.04, 2.05a and 2.05b has been reported</span>
<span class="hljs-comment">#+ and may change in a future version of Bash.</span>

<span class="hljs-comment">#  To output a sparse array and maintain the [subscript]=value</span>
<span class="hljs-comment">#+ relationship without change requires a bit of programming.</span>
<span class="hljs-comment">#  One possible code fragment:</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment"># local l=${#ArraySparse[@]}        # Count of defined elements</span>
<span class="hljs-comment"># local f=0                         # Count of found subscripts</span>
<span class="hljs-comment"># local i=0                         # Subscript to test</span>
(                                   <span class="hljs-comment"># Anonymous in-line function</span>
    <span class="hljs-keyword">for</span> (( l=<span class="hljs-variable">${#ArraySparse[@]}</span>, f = 0, i = 0 ; f &lt; l ; i++ ))
    <span class="hljs-keyword">do</span>
        <span class="hljs-comment"># 'if defined then...'</span>
        <span class="hljs-variable">${ArraySparse[$i]+ eval echo '\ ['$i']='${ArraySparse[$i]}</span> ; (( f++ )) }
    <span class="hljs-keyword">done</span>
)

<span class="hljs-comment"># The reader coming upon the above code fragment cold</span>
<span class="hljs-comment">#+ might want to review "command lists" and "multiple commands on a line"</span>
<span class="hljs-comment">#+ in the text of the foregoing "Advanced Bash Scripting Guide."</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  Note:</span>
<span class="hljs-comment">#  The "read -a array_name" version of the "read" command</span>
<span class="hljs-comment">#+ begins filling array_name at subscript zero.</span>
<span class="hljs-comment">#  ArraySparse does not define a value at subscript zero.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  The user needing to read/write a sparse array to either</span>
<span class="hljs-comment">#+ external storage or a communications socket must invent</span>
<span class="hljs-comment">#+ a read/write code pair suitable for their purpose.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment"># Exercise: clean it up.</span>

<span class="hljs-built_in">unset</span> ArraySparse

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Conditional alternate (But not change)- -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- No alternate if null reference -'</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarNull+'NotSet'}</span><span class="hljs-string">' '</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarNull}</span>
<span class="hljs-built_in">unset</span> VarNull

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- No alternate if null reference -'</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarNull:+'NotSet'}</span><span class="hljs-string">' '</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarNull}</span>
<span class="hljs-built_in">unset</span> VarNull

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Alternate if null contents -'</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarEmpty+'Empty'}</span><span class="hljs-string">' '</span>              <span class="hljs-comment"># Empty</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarEmpty}</span>
VarEmpty=<span class="hljs-string">''</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- No alternate if null contents -'</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarEmpty:+'Empty'}</span><span class="hljs-string">' '</span>             <span class="hljs-comment"># Space only</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarEmpty}</span>
VarEmpty=<span class="hljs-string">''</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Alternate if already has contents -'</span>

<span class="hljs-comment"># Alternate literal</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarSomething+'Content'}</span><span class="hljs-string">' '</span>        <span class="hljs-comment"># Content Literal</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarSomething}</span>

<span class="hljs-comment"># Invoke function</span>
<span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${VarSomething:+ $(_simple) }</span><span class="hljs-string">' '</span>    <span class="hljs-comment"># SimpleFunc Literal</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarSomething}</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Sparse Array - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${ArrayVar[@]+'Empty'}</span>                 <span class="hljs-comment"># An array of 'Empty'(ies)</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Test 2 for undefined - -'</span>

<span class="hljs-built_in">declare</span> -i t
<span class="hljs-function"><span class="hljs-title">_incT</span></span>() {
    t=<span class="hljs-variable">$t</span>+1
}

<span class="hljs-comment">#  Note:</span>
<span class="hljs-comment">#  This is the same test used in the sparse array</span>
<span class="hljs-comment">#+ listing code fragment.</span>

<span class="hljs-comment"># Null reference, set: t == -1</span>
t=<span class="hljs-variable">${#VarNull}</span>-1                     <span class="hljs-comment"># Results in minus-one.</span>
<span class="hljs-variable">${VarNull+ _incT }</span>                  <span class="hljs-comment"># Does not execute.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$t</span><span class="hljs-string">' Null reference'</span>

<span class="hljs-comment"># Null contents, set: t == 0</span>
t=<span class="hljs-variable">${#VarEmpty}</span>-1                    <span class="hljs-comment"># Results in minus-one.</span>
<span class="hljs-variable">${VarEmpty+ _incT }</span>                 <span class="hljs-comment"># Executes.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$t</span><span class="hljs-string">'  Null content'</span>

<span class="hljs-comment"># Contents, set: t == (number of non-null characters)</span>
t=<span class="hljs-variable">${#VarSomething}</span>-1                <span class="hljs-comment"># non-null length minus-one</span>
<span class="hljs-variable">${VarSomething+ _incT }</span>             <span class="hljs-comment"># Executes.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$t</span><span class="hljs-string">'  Contents'</span>

<span class="hljs-comment"># Exercise: clean up that example.</span>
<span class="hljs-built_in">unset</span> t
<span class="hljs-built_in">unset</span> _incT

<span class="hljs-comment"># ${name?err_msg} ${name:?err_msg}</span>
<span class="hljs-comment">#  These follow the same rules but always exit afterwards</span>
<span class="hljs-comment">#+ if an action is specified following the question mark.</span>
<span class="hljs-comment">#  The action following the question mark may be a literal</span>
<span class="hljs-comment">#+ or a function result.</span>
<span class="hljs-comment">###</span>
<span class="hljs-comment">#  ${name?} ${name:?} are test-only, the return can be tested.</span>




<span class="hljs-comment"># Element operations</span>
<span class="hljs-comment"># ------------------</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Trailing sub-element selection - -'</span>

<span class="hljs-comment">#  Strings, Arrays and Positional parameters</span>

<span class="hljs-comment">#  Call this script with multiple arguments</span>
<span class="hljs-comment">#+ to see the parameter selections.</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- All -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarSomething:0}</span>              <span class="hljs-comment"># all non-null characters</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${ArrayVar[@]:0}</span>               <span class="hljs-comment"># all elements with content</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${@:0}</span>                         <span class="hljs-comment"># all parameters with content;</span>
                                    <span class="hljs-comment"># ignoring parameter[0]</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- All after -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarSomething:1}</span>              <span class="hljs-comment"># all non-null after character[0]</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${ArrayVar[@]:1}</span>               <span class="hljs-comment"># all after element[0] with content</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${@:2}</span>                         <span class="hljs-comment"># all after param[1] with content</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Range after -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${VarSomething:4:3}</span>            <span class="hljs-comment"># ral</span>
                                    <span class="hljs-comment"># Three characters after</span>
                                    <span class="hljs-comment"># character[3]</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Sparse array gotch -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${ArrayVar[@]:1:2}</span>     <span class="hljs-comment">#  four - The only element with content.</span>
                            <span class="hljs-comment">#  Two elements after (if that many exist).</span>
                            <span class="hljs-comment">#  the FIRST WITH CONTENTS</span>
                            <span class="hljs-comment">#+ (the FIRST WITH  CONTENTS is being</span>
                            <span class="hljs-comment">#+ considered as if it</span>
                            <span class="hljs-comment">#+ were subscript zero).</span>
<span class="hljs-comment">#  Executed as if Bash considers ONLY array elements with CONTENT</span>
<span class="hljs-comment">#  printf %q "${ArrayVar[@]:0:3}"    # Try this one</span>

<span class="hljs-comment">#  In versions 2.04, 2.05a and 2.05b,</span>
<span class="hljs-comment">#+ Bash does not handle sparse arrays as expected using this notation.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  The current Bash maintainer, Chet Ramey, has corrected this.</span>


<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Non-sparse array -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${@:2:2}</span>               <span class="hljs-comment"># Two parameters following parameter[1]</span>

<span class="hljs-comment"># New victims for string vector examples:</span>
stringZ=abcABC123ABCabc
arrayZ=( abcabc ABCABC 123123 ABCABC abcabc )
sparseZ=( [1]=<span class="hljs-string">'abcabc'</span> [3]=<span class="hljs-string">'ABCABC'</span> [4]=<span class="hljs-string">''</span> [5]=<span class="hljs-string">'123123'</span> )

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">' - - Victim string - -'</span><span class="hljs-variable">$stringZ</span><span class="hljs-string">'- - '</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">' - - Victim array - -'</span><span class="hljs-variable">${arrayZ[@]}</span><span class="hljs-string">'- - '</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">' - - Sparse array - -'</span><span class="hljs-variable">${sparseZ[@]}</span><span class="hljs-string">'- - '</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">' - [0]==null ref, [2]==null ref, [4]==null content - '</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">' - [1]=abcabc [3]=ABCABC [5]=123123 - '</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">' - non-null-reference count: '</span><span class="hljs-variable">${#sparseZ[@]}</span><span class="hljs-string">' elements'</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Prefix sub-element removal - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Glob-Pattern match must include the first character. - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Glob-Pattern may be a literal or a function result. - -'</span>
<span class="hljs-built_in">echo</span>


<span class="hljs-comment"># Function returning a simple, Literal, Glob-Pattern</span>
<span class="hljs-function"><span class="hljs-title">_abc</span></span>() {
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">'abc'</span>
}

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Shortest prefix -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ#123}</span>                 <span class="hljs-comment"># Unchanged (not a prefix).</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ#$(_abc)}</span>             <span class="hljs-comment"># ABC123ABCabc</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]#abc}</span>               <span class="hljs-comment"># Applied to each element.</span>

<span class="hljs-comment"># echo ${sparseZ[@]#abc}            # Version-2.05b core dumps.</span>
<span class="hljs-comment"># Has since been fixed by Chet Ramey.</span>

<span class="hljs-comment"># The -it would be nice- First-Subscript-Of</span>
<span class="hljs-comment"># echo ${#sparseZ[@]#*}             # This is NOT valid Bash.</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Longest prefix -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ##1*3}</span>                <span class="hljs-comment"># Unchanged (not a prefix)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ##a*C}</span>                <span class="hljs-comment"># abc</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]##a*c}</span>              <span class="hljs-comment"># ABCABC 123123 ABCABC</span>

<span class="hljs-comment"># echo ${sparseZ[@]##a*c}           # Version-2.05b core dumps.</span>
<span class="hljs-comment"># Has since been fixed by Chet Ramey.</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Suffix sub-element removal - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Glob-Pattern match must include the last character. - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Glob-Pattern may be a literal or a function result. - -'</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Shortest suffix -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ%1*3}</span>                 <span class="hljs-comment"># Unchanged (not a suffix).</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ%$(_abc)}</span>             <span class="hljs-comment"># abcABC123ABC</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]%abc}</span>               <span class="hljs-comment"># Applied to each element.</span>

<span class="hljs-comment"># echo ${sparseZ[@]%abc}            # Version-2.05b core dumps.</span>
<span class="hljs-comment"># Has since been fixed by Chet Ramey.</span>

<span class="hljs-comment"># The -it would be nice- Last-Subscript-Of</span>
<span class="hljs-comment"># echo ${#sparseZ[@]%*}             # This is NOT valid Bash.</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Longest suffix -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ%%1*3}</span>                <span class="hljs-comment"># Unchanged (not a suffix)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ%%b*c}</span>                <span class="hljs-comment"># a</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]%%b*c}</span>              <span class="hljs-comment"># a ABCABC 123123 ABCABC a</span>

<span class="hljs-comment"># echo ${sparseZ[@]%%b*c}           # Version-2.05b core dumps.</span>
<span class="hljs-comment"># Has since been fixed by Chet Ramey.</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Sub-element replacement - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Sub-element at any location in string. - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - First specification is a Glob-Pattern - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Glob-Pattern may be a literal or Glob-Pattern function result. - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Second specification may be a literal or function result. - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Second specification may be unspecified. Pronounce that'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'    as: Replace-With-Nothing (Delete) - -'</span>
<span class="hljs-built_in">echo</span>



<span class="hljs-comment"># Function returning a simple, Literal, Glob-Pattern</span>
<span class="hljs-function"><span class="hljs-title">_123</span></span>() {
    <span class="hljs-built_in">echo</span> -n <span class="hljs-string">'123'</span>
}

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Replace first occurrence -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/$(_123)/999}</span>         <span class="hljs-comment"># Changed (123 is a component).</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/ABC/xyz}</span>             <span class="hljs-comment"># xyzABC123ABCabc</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]/ABC/xyz}</span>           <span class="hljs-comment"># Applied to each element.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${sparseZ[@]/ABC/xyz}</span>          <span class="hljs-comment"># Works as expected.</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Delete first occurrence -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/$(_123)/}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/ABC/}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]/ABC/}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${sparseZ[@]/ABC/}</span>

<span class="hljs-comment">#  The replacement need not be a literal,</span>
<span class="hljs-comment">#+ since the result of a function invocation is allowed.</span>
<span class="hljs-comment">#  This is general to all forms of replacement.</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Replace first occurrence with Result-Of -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/$(_123)/$(_simple)}</span>  <span class="hljs-comment"># Works as expected.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]/ca/$(_simple)}</span>     <span class="hljs-comment"># Applied to each element.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${sparseZ[@]/ca/$(_simple)}</span>    <span class="hljs-comment"># Works as expected.</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Replace all occurrences -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ//[b2]/X}</span>             <span class="hljs-comment"># X-out b's and 2's</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ//abc/xyz}</span>            <span class="hljs-comment"># xyzABC123ABCxyz</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]//abc/xyz}</span>          <span class="hljs-comment"># Applied to each element.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${sparseZ[@]//abc/xyz}</span>         <span class="hljs-comment"># Works as expected.</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Delete all occurrences -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ//[b2]/}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ//abc/}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]//abc/}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${sparseZ[@]//abc/}</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Prefix sub-element replacement - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Match must include the first character. - -'</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Replace prefix occurrences -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/#[b2]/X}</span>             <span class="hljs-comment"># Unchanged (neither is a prefix).</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/#$(_abc)/XYZ}</span>        <span class="hljs-comment"># XYZABC123ABCabc</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]/#abc/XYZ}</span>          <span class="hljs-comment"># Applied to each element.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${sparseZ[@]/#abc/XYZ}</span>         <span class="hljs-comment"># Works as expected.</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Delete prefix occurrences -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/#[b2]/}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/#$(_abc)/}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]/#abc/}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${sparseZ[@]/#abc/}</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Suffix sub-element replacement - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Match must include the last character. - -'</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Replace suffix occurrences -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/%[b2]/X}</span>             <span class="hljs-comment"># Unchanged (neither is a suffix).</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/%$(_abc)/XYZ}</span>        <span class="hljs-comment"># abcABC123ABCXYZ</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]/%abc/XYZ}</span>          <span class="hljs-comment"># Applied to each element.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${sparseZ[@]/%abc/XYZ}</span>         <span class="hljs-comment"># Works as expected.</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Delete suffix occurrences -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/%[b2]/}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/%$(_abc)/}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]/%abc/}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${sparseZ[@]/%abc/}</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Special cases of null Glob-Pattern - -'</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Prefix all -'</span>
<span class="hljs-comment"># null substring pattern means 'prefix'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/#/NEW}</span>               <span class="hljs-comment"># NEWabcABC123ABCabc</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]/#/NEW}</span>             <span class="hljs-comment"># Applied to each element.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${sparseZ[@]/#/NEW}</span>            <span class="hljs-comment"># Applied to null-content also.</span>
                                    <span class="hljs-comment"># That seems reasonable.</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- Suffix all -'</span>
<span class="hljs-comment"># null substring pattern means 'suffix'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ/%/NEW}</span>               <span class="hljs-comment"># abcABC123ABCabcNEW</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${arrayZ[@]/%/NEW}</span>             <span class="hljs-comment"># Applied to each element.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${sparseZ[@]/%/NEW}</span>            <span class="hljs-comment"># Applied to null-content also.</span>
                                    <span class="hljs-comment"># That seems reasonable.</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - Special case For-Each Glob-Pattern - -'</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'- - - - This is a nice-to-have dream - - - -'</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-function"><span class="hljs-title">_GenFunc</span></span>() {
    <span class="hljs-built_in">echo</span> -n <span class="hljs-variable">${0}</span>                    <span class="hljs-comment"># Illustration only.</span>
    <span class="hljs-comment"># Actually, that would be an arbitrary computation.</span>
}

<span class="hljs-comment"># All occurrences, matching the AnyThing pattern.</span>
<span class="hljs-comment"># Currently //*/ does not match null-content nor null-reference.</span>
<span class="hljs-comment"># /#/ and /%/ does match null-content but not null-reference.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${sparseZ[@]//*/$(_GenFunc)}</span>


<span class="hljs-comment">#  A possible syntax would be to make</span>
<span class="hljs-comment">#+ the parameter notation used within this construct mean:</span>
<span class="hljs-comment">#   ${1} - The full element</span>
<span class="hljs-comment">#   ${2} - The prefix, if any, to the matched sub-element</span>
<span class="hljs-comment">#   ${3} - The matched sub-element</span>
<span class="hljs-comment">#   ${4} - The suffix, if any, to the matched sub-element</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># echo ${sparseZ[@]//*/$(_GenFunc ${3})}   # Same as ${1} here.</span>
<span class="hljs-comment"># Perhaps it will be implemented in a future version of Bash.</span>


<span class="hljs-built_in">exit</span> 0</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="TESTEXECTIME" id="TESTEXECTIME"></a>
        <p><b>Example A-59. Testing execution times of various commands</b></p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment">#  test-execution-time.sh</span>
<span class="hljs-comment">#  Example by Erik Brandsberg, for testing execution time</span>
<span class="hljs-comment">#+ of certain operations.</span>
<span class="hljs-comment">#  Referenced in the "Optimizations" section of "Miscellany" chapter.</span>

count=50000
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Math tests"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Math via \$(( ))"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++))
<span class="hljs-keyword">do</span>
  result=$(( <span class="hljs-variable">$i</span>%<span class="hljs-number">2</span> ))
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Math via *expr*:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++))
<span class="hljs-keyword">do</span>
  result=`expr <span class="hljs-string">"<span class="hljs-variable">$i</span>%2"</span>`
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Math via *let*:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++))
<span class="hljs-keyword">do</span>
  <span class="hljs-built_in">let</span> result=<span class="hljs-variable">$i</span>%2
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Conditional testing tests"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Test via case:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++))
<span class="hljs-keyword">do</span>
  <span class="hljs-keyword">case</span> $(( <span class="hljs-variable">$i</span>%<span class="hljs-number">2</span> )) <span class="hljs-keyword">in</span>
    0) : ;;
    1) : ;;
  <span class="hljs-keyword">esac</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Test with if [], no quotes:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++))
<span class="hljs-keyword">do</span>
  <span class="hljs-keyword">if</span> [ $(( <span class="hljs-variable">$i</span>%<span class="hljs-number">2</span> )) = 0 ]; <span class="hljs-keyword">then</span>
     :
  <span class="hljs-keyword">else</span>
     :
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Test with if [], quotes:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++))
<span class="hljs-keyword">do</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-subst">$(( $i%2 )</span>)"</span> = <span class="hljs-string">"0"</span> ]; <span class="hljs-keyword">then</span>
     :
  <span class="hljs-keyword">else</span>
     :
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Test with if [], using -eq:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++))
<span class="hljs-keyword">do</span>
  <span class="hljs-keyword">if</span> [ $(( <span class="hljs-variable">$i</span>%<span class="hljs-number">2</span> )) -eq 0 ]; <span class="hljs-keyword">then</span>
     :
  <span class="hljs-keyword">else</span>
     :
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">exit</span> $?</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <div class="EXAMPLE">
        <a name="ASSOCARRTEST" id="ASSOCARRTEST"></a>
        <p>
          <b>Example A-60. Associative arrays vs. conventional arrays (execution
            times)</b>
        </p>
        <table border="0" bgcolor="#E0E0E0" width="100%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment">#  assoc-arr-test.sh</span>
<span class="hljs-comment">#  Benchmark test script to compare execution times of</span>
<span class="hljs-comment">#  numeric-indexed array vs. associative array.</span>
<span class="hljs-comment">#     Thank you, Erik Brandsberg.</span>

count=100000       <span class="hljs-comment"># May take a while for some of the tests below.</span>
<span class="hljs-built_in">declare</span> simple     <span class="hljs-comment"># Can change to 20000, if desired.</span>
<span class="hljs-built_in">declare</span> -a array1
<span class="hljs-built_in">declare</span> -A array2
<span class="hljs-built_in">declare</span> -a array3
<span class="hljs-built_in">declare</span> -A array4

<span class="hljs-built_in">echo</span> <span class="hljs-string">"===Assignment tests==="</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Assigning a simple variable:"</span>
<span class="hljs-comment"># References $i twice to equalize lookup times.</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++)); <span class="hljs-keyword">do</span>
        simple=<span class="hljs-variable">$i</span><span class="hljs-variable">$i</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"---"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Assigning a numeric index array entry:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++)); <span class="hljs-keyword">do</span>
        array1[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">$i</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"---"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Overwriting a numeric index array entry:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++)); <span class="hljs-keyword">do</span>
        array1[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">$i</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"---"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Linear reading of numeric index array:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++)); <span class="hljs-keyword">do</span>
        simple=array1[<span class="hljs-variable">$i</span>]
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"---"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Assigning an associative array entry:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++)); <span class="hljs-keyword">do</span>
        array2[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">$i</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"---"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Overwriting an associative array entry:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++)); <span class="hljs-keyword">do</span>
        array2[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">$i</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"---"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Linear reading an associative array entry:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++)); <span class="hljs-keyword">do</span>
        simple=array2[<span class="hljs-variable">$i</span>]
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"---"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Assigning a random number to a simple variable:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++)); <span class="hljs-keyword">do</span>
        simple=<span class="hljs-variable">$RANDOM</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"---"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Assign a sparse numeric index array entry randomly into 64k cells:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++)); <span class="hljs-keyword">do</span>
        array3[<span class="hljs-variable">$RANDOM</span>]=<span class="hljs-variable">$i</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"---"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Reading sparse numeric index array entry:"</span>
time <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${array3[@]}</span>"</span>i; <span class="hljs-keyword">do</span>
        simple=<span class="hljs-variable">$value</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"---"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Assigning a sparse associative array entry randomly into 64k cells:"</span>
time <span class="hljs-keyword">for</span> (( i=0; i&lt; <span class="hljs-variable">$count</span>; i++)); <span class="hljs-keyword">do</span>
        array4[<span class="hljs-variable">$RANDOM</span>]=<span class="hljs-variable">$i</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"---"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Reading sparse associative index array entry:"</span>
time <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${array4[@]}</span>"</span>; <span class="hljs-keyword">do</span>
        simple=<span class="hljs-variable">$value</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">exit</span> $?</pre>
            </td>
          </tr>
        </tbody></table>
      </div>
    </div>
    <div class="NAVFOOTER">
      <hr align="left" width="100%">
      <table summary="Footer navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
        <tbody><tr>
          <td width="33%" align="left" valign="top">
            <a href="biblio.html" accesskey="P">Prev</a>
          </td>
          <td width="34%" align="center" valign="top">
            <a href="index.html" accesskey="H">Home</a>
          </td>
          <td width="33%" align="right" valign="top">
            <a href="refcards.html" accesskey="N">Next</a>
          </td>
        </tr>
        <tr>
          <td width="33%" align="left" valign="top">Bibliography</td>
          <td width="34%" align="center" valign="top">&nbsp;</td>
          <td width="33%" align="right" valign="top">Reference Cards</td>
        </tr>
      </tbody></table>
    </div>
  

<button id="theme-toggle">Toggle theme</button></body></html>
