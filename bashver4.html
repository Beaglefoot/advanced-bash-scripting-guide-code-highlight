<!DOCTYPE html><html><head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.7.28">
  <title>Bash, version 4</title>
  <meta name="GENERATOR" content="Modular DocBook HTML Stylesheet Version 1.7">
  <link rel="HOME" title="Advanced Bash-Scripting Guide" href="index.html">
  <link rel="UP" title="Bash, versions 2, 3, and 4" href="bash2.html">
  <link rel="PREVIOUS" title="Bash, version 3" href="bashver3.html">
  <link rel="NEXT" title="Endnotes" href="endnotes.html">
<link rel="stylesheet" href="styles/custom.css"><link rel="stylesheet" href="styles/atom-one-dark.css"><script>
    document.addEventListener('DOMContentLoaded', () => {
      const manuallySetTheme = localStorage.getItem('bash-guide-theme');

      if (manuallySetTheme === 'dark') document.body.classList.add('dark-mode');
      else if (manuallySetTheme === 'light') document.body.classList.remove('dark-mode');
      else if (matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark-mode');
      }

      document.getElementById('theme-toggle').addEventListener(
        'click',
        () => {
          const isSet = document.body.classList.toggle('dark-mode');
          localStorage.setItem('bash-guide-theme', isSet ? 'dark' : 'light');
        }
      );
    });
  </script></head>
<body class="SECT1" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#840084" alink="#0000FF">
  <div class="NAVHEADER">
    <table summary="Header navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tbody><tr>
        <th colspan="3" align="center">Advanced Bash-Scripting Guide:</th>
      </tr>
      <tr>
        <td width="10%" align="left" valign="bottom"><a href="bashver3.html" accesskey="P">Prev</a></td>
        <td width="80%" align="center" valign="bottom">Chapter 37. Bash, versions 2, 3, and 4</td>
        <td width="10%" align="right" valign="bottom"><a href="endnotes.html" accesskey="N">Next</a></td>
      </tr>
    </tbody></table>
    <hr align="left" width="100%">
  </div>
  <div class="SECT1">
    <h1 class="SECT1"><a name="BASHVER4" id="BASHVER4"></a>37.3. Bash, version 4</h1>
    <p><a name="BASH4REF" id="BASH4REF"></a></p>
    <p>Chet Ramey announced Version 4 of Bash on the 20th of February, 2009. This release has a number of significant new features, as well as some important bugfixes.</p>
    <p>Among the new goodies:</p>
    <ul>
      <li>
        <p><a name="ASSOCARR" id="ASSOCARR"></a>Associative arrays. <a name="AEN21025" href="#FTN.AEN21025" id="AEN21025"><span class="footnote">[1]</span></a></p>
        <table class="SIDEBAR" border="1" cellpadding="5">
          <tbody><tr>
            <td>
              <div class="SIDEBAR">
                <a name="AEN21029" id="AEN21029"></a>
                <p>An <i class="FIRSTTERM">associative</i> array can be thought of as a set of two linked arrays -- one holding the <i class="FIRSTTERM">data</i>, and the other the <i class="FIRSTTERM">keys</i> that index the individual elements of the <i class="FIRSTTERM">data</i> array.</p>
              </div>
            </td>
          </tr>
        </tbody></table>
        <div class="EXAMPLE">
          <a name="FETCHADDRESS" id="FETCHADDRESS"></a>
          <p><b>Example 37-5. A simple address database</b></p>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash4</span>
<span class="hljs-comment"># fetch_address.sh</span>

<span class="hljs-built_in">declare</span> -A address
<span class="hljs-comment">#       -A option declares associative array.</span>

address[Charles]=<span class="hljs-string">"414 W. 10th Ave., Baltimore, MD 21236"</span>
address[John]=<span class="hljs-string">"202 E. 3rd St., New York, NY 10009"</span>
address[Wilma]=<span class="hljs-string">"1854 Vermont Ave, Los Angeles, CA 90023"</span>


<span class="hljs-built_in">echo</span> <span class="hljs-string">"Charles's address is <span class="hljs-variable">${address[Charles]}</span>."</span>
<span class="hljs-comment"># Charles's address is 414 W. 10th Ave., Baltimore, MD 21236.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Wilma's address is <span class="hljs-variable">${address[Wilma]}</span>."</span>
<span class="hljs-comment"># Wilma's address is 1854 Vermont Ave, Los Angeles, CA 90023.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"John's address is <span class="hljs-variable">${address[John]}</span>."</span>
<span class="hljs-comment"># John's address is 202 E. 3rd St., New York, NY 10009.</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${!address[*]}</span>"</span>   <span class="hljs-comment"># The array indices ...</span>
<span class="hljs-comment"># Charles John Wilma</span></pre>
              </td>
            </tr>
          </tbody></table>
        </div>
        <div class="EXAMPLE">
          <a name="FETCHADDRESS2" id="FETCHADDRESS2"></a>
          <p><b>Example 37-6. A somewhat more elaborate address database</b></p>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash4</span>
<span class="hljs-comment"># fetch_address-2.sh</span>
<span class="hljs-comment"># A more elaborate version of fetch_address.sh.</span>

SUCCESS=0
E_DB=99    <span class="hljs-comment"># Error code for missing entry.</span>

<span class="hljs-built_in">declare</span> -A address
<span class="hljs-comment">#       -A option declares associative array.</span>


<span class="hljs-function"><span class="hljs-title">store_address</span></span> ()
{
  address[<span class="hljs-variable">$1</span>]=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>
  <span class="hljs-built_in">return</span> $?
}


<span class="hljs-function"><span class="hljs-title">fetch_address</span></span> ()
{
  <span class="hljs-keyword">if</span> [[ -z <span class="hljs-string">"<span class="hljs-variable">${address[$1]}</span>"</span> ]]
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>'s address is not in database."</span>
    <span class="hljs-built_in">return</span> <span class="hljs-variable">$E_DB</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>'s address is <span class="hljs-variable">${address[$1]}</span>."</span>
  <span class="hljs-built_in">return</span> $?
}


store_address <span class="hljs-string">"Lucas Fayne"</span> <span class="hljs-string">"414 W. 13th Ave., Baltimore, MD 21236"</span>
store_address <span class="hljs-string">"Arvid Boyce"</span> <span class="hljs-string">"202 E. 3rd St., New York, NY 10009"</span>
store_address <span class="hljs-string">"Velma Winston"</span> <span class="hljs-string">"1854 Vermont Ave, Los Angeles, CA 90023"</span>
<span class="hljs-comment">#  Exercise:</span>
<span class="hljs-comment">#  Rewrite the above store_address calls to read data from a file,</span>
<span class="hljs-comment">#+ then assign field 1 to name, field 2 to address in the array.</span>
<span class="hljs-comment">#  Each line in the file would have a format corresponding to the above.</span>
<span class="hljs-comment">#  Use a while-read loop to read from file, sed or awk to parse the fields.</span>

fetch_address <span class="hljs-string">"Lucas Fayne"</span>
<span class="hljs-comment"># Lucas Fayne's address is 414 W. 13th Ave., Baltimore, MD 21236.</span>
fetch_address <span class="hljs-string">"Velma Winston"</span>
<span class="hljs-comment"># Velma Winston's address is 1854 Vermont Ave, Los Angeles, CA 90023.</span>
fetch_address <span class="hljs-string">"Arvid Boyce"</span>
<span class="hljs-comment"># Arvid Boyce's address is 202 E. 3rd St., New York, NY 10009.</span>
fetch_address <span class="hljs-string">"Bozo Bozeman"</span>
<span class="hljs-comment"># Bozo Bozeman's address is not in database.</span>

<span class="hljs-built_in">exit</span> $?   <span class="hljs-comment"># In this case, exit code = 99, since that is function return.</span></pre>
              </td>
            </tr>
          </tbody></table>
        </div>
        <p>See <a href="contributed-scripts.html#SAMORSE">Example A-53</a> for an interesting usage of an <i class="FIRSTTERM">associative array</i>.</p>
        <div class="CAUTION">
          <table class="CAUTION" width="90%" border="0">
            <tbody><tr>
              <td width="25" align="center" valign="top"><img src="images/caution.gif" hspace="5" alt="Caution"></td>
              <td align="left" valign="top">
                <p>Elements of the <i class="FIRSTTERM">index</i> array may include embedded <a href="special-chars.html#WHITESPACEREF">space characters</a>, or even leading and/or trailing space characters. However, index array elements containing <em>only</em> <i class="FIRSTTERM">whitespace</i> are <em>not</em> permitted.</p>
                <table border="0" bgcolor="#E0E0E0" width="90%">
                  <tbody><tr>
                    <td>
                      <pre class="PROGRAMLISTING hljs">address[   ]=<span class="hljs-string">"Blank"</span>   <span class="hljs-comment"># Error!</span></pre>
                    </td>
                  </tr>
                </tbody></table>
              </td>
            </tr>
          </tbody></table>
        </div>
      </li>
      <li>
        <p><a name="NCTERM" id="NCTERM"></a>Enhancements to the <a href="testbranch.html#CASEESAC1">case</a> construct: the <tt class="REPLACEABLE"><i>;;&amp;</i></tt> and <tt class="REPLACEABLE"><i>;&amp;</i></tt> terminators.</p>
        <div class="EXAMPLE">
          <a name="CASE4" id="CASE4"></a>
          <p><b>Example 37-7. Testing characters</b></p>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash4</span>

<span class="hljs-function"><span class="hljs-title">test_char</span></span> ()
{
  <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-keyword">in</span>
    [[:<span class="hljs-built_in">print</span>:]] )  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span> is a printable character."</span>;;&amp;       <span class="hljs-comment"># |</span>
    <span class="hljs-comment"># The ;;&amp; terminator continues to the next pattern test.      |</span>
    [[:alnum:]] )  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span> is an alpha/numeric character."</span>;;&amp;  <span class="hljs-comment"># v</span>
    [[:alpha:]] )  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span> is an alphabetic character."</span>;;&amp;     <span class="hljs-comment"># v</span>
    [[:lower:]] )  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span> is a lowercase alphabetic character."</span>;;&amp;
    [[:digit:]] )  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span> is an numeric character."</span>;&amp;         <span class="hljs-comment"># |</span>
    <span class="hljs-comment"># The ;&amp; terminator executes the next statement ...         # |</span>
    %%%@@@@@    )  <span class="hljs-built_in">echo</span> <span class="hljs-string">"********************************"</span>;;    <span class="hljs-comment"># v</span>
<span class="hljs-comment">#   ^^^^^^^^  ... even with a dummy pattern.</span>
  <span class="hljs-keyword">esac</span>
}

<span class="hljs-built_in">echo</span>

test_char 3
<span class="hljs-comment"># 3 is a printable character.</span>
<span class="hljs-comment"># 3 is an alpha/numeric character.</span>
<span class="hljs-comment"># 3 is an numeric character.</span>
<span class="hljs-comment"># ********************************</span>
<span class="hljs-built_in">echo</span>

test_char m
<span class="hljs-comment"># m is a printable character.</span>
<span class="hljs-comment"># m is an alpha/numeric character.</span>
<span class="hljs-comment"># m is an alphabetic character.</span>
<span class="hljs-comment"># m is a lowercase alphabetic character.</span>
<span class="hljs-built_in">echo</span>

test_char /
<span class="hljs-comment"># / is a printable character.</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># The ;;&amp; terminator can save complex if/then conditions.</span>
<span class="hljs-comment"># The ;&amp; is somewhat less useful.</span></pre>
              </td>
            </tr>
          </tbody></table>
        </div>
      </li>
      <li>
        <p><a name="COPROCREF" id="COPROCREF"></a>The new <b class="COMMAND">coproc</b> builtin enables two parallel <a href="special-chars.html#PROCESSREF">processes</a> to communicate and interact. As Chet Ramey states in the <a href="biblio.html#BASHFAQ">Bash FAQ</a> <a name="AEN21068" href="#FTN.AEN21068" id="AEN21068"><span class="footnote">[2]</span></a> , ver. 4.01:</p><a name="AEN21070" id="AEN21070"></a>
        <blockquote class="BLOCKQUOTE">
          <p class="LITERALLAYOUT">&nbsp;&nbsp;&nbsp;&nbsp;There&nbsp;is&nbsp;a&nbsp;new&nbsp;'coproc'&nbsp;reserved&nbsp;word&nbsp;that&nbsp;specifies&nbsp;a&nbsp;coprocess:<br>
          &nbsp;&nbsp;&nbsp;&nbsp;an&nbsp;asynchronous&nbsp;command&nbsp;run&nbsp;with&nbsp;two&nbsp;pipes&nbsp;connected&nbsp;to&nbsp;the&nbsp;creating<br>
          &nbsp;&nbsp;&nbsp;&nbsp;shell.&nbsp;Coprocs&nbsp;can&nbsp;be&nbsp;named.&nbsp;The&nbsp;input&nbsp;and&nbsp;output&nbsp;file&nbsp;descriptors<br>
          &nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;the&nbsp;PID&nbsp;of&nbsp;the&nbsp;coprocess&nbsp;are&nbsp;available&nbsp;to&nbsp;the&nbsp;calling&nbsp;shell&nbsp;in<br>
          &nbsp;&nbsp;&nbsp;&nbsp;variables&nbsp;with&nbsp;coproc-specific&nbsp;names.<br>
          <br>
          &nbsp;&nbsp;&nbsp;&nbsp;George&nbsp;Dimitriu&nbsp;explains,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;"...&nbsp;coproc&nbsp;...&nbsp;is&nbsp;a&nbsp;feature&nbsp;used&nbsp;in&nbsp;Bash&nbsp;process&nbsp;substitution,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;now&nbsp;is&nbsp;made&nbsp;publicly&nbsp;available."<br>
          &nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;means&nbsp;it&nbsp;can&nbsp;be&nbsp;explicitly&nbsp;invoked&nbsp;in&nbsp;a&nbsp;script,&nbsp;rather&nbsp;than<br>
          &nbsp;&nbsp;&nbsp;&nbsp;just&nbsp;being&nbsp;a&nbsp;behind-the-scenes&nbsp;mechanism&nbsp;used&nbsp;by&nbsp;Bash.<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
        </blockquote>
        <p>Coprocesses use <i class="FIRSTTERM">file descriptors</i>. <a href="io-redirection.html#FDREF2">File descriptors enable processes and pipes to communicate</a>.</p>
        <table border="0" bgcolor="#E0E0E0" width="90%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash4</span>
<span class="hljs-comment"># A coprocess communicates with a while-read loop.</span>


coproc { cat mx_data.txt; sleep 2; }
<span class="hljs-comment">#                         ^^^^^^^</span>
<span class="hljs-comment"># Try running this without "sleep 2" and see what happens.</span>

<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> -u <span class="hljs-variable">${COPROC[0]}</span> line    <span class="hljs-comment">#  ${COPROC[0]} is the</span>
<span class="hljs-keyword">do</span>                                 <span class="hljs-comment">#+ file descriptor of the coprocess.</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> | sed -e <span class="hljs-string">'s/line/NOT-ORIGINAL-TEXT/'</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">kill</span> <span class="hljs-variable">$COPROC_PID</span>                   <span class="hljs-comment">#  No longer need the coprocess,</span>
                                   <span class="hljs-comment">#+ so kill its PID.</span></pre>
            </td>
          </tr>
        </tbody></table>
        <p>But, be careful!</p>
        <table border="0" bgcolor="#E0E0E0" width="90%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash4</span>

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span>
a=aaa
b=bbb
c=ccc

coproc <span class="hljs-built_in">echo</span> <span class="hljs-string">"one two three"</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> -u <span class="hljs-variable">${COPROC[0]}</span> a b c;  <span class="hljs-comment">#  Note that this loop</span>
<span class="hljs-keyword">do</span>                                 <span class="hljs-comment">#+ runs in a subshell.</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Inside while-read loop: "</span>;
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"a = <span class="hljs-variable">$a</span>"</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"b = <span class="hljs-variable">$b</span>"</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"c = <span class="hljs-variable">$c</span>"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"coproc file descriptor: <span class="hljs-variable">${COPROC[0]}</span>"</span>
<span class="hljs-keyword">done</span> 

<span class="hljs-comment"># a = one</span>
<span class="hljs-comment"># b = two</span>
<span class="hljs-comment"># c = three</span>
<span class="hljs-comment"># So far, so good, but ...</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"-----------------"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Outside while-read loop: "</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"a = <span class="hljs-variable">$a</span>"</span>  <span class="hljs-comment"># a =</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"b = <span class="hljs-variable">$b</span>"</span>  <span class="hljs-comment"># b =</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"c = <span class="hljs-variable">$c</span>"</span>  <span class="hljs-comment"># c =</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"coproc file descriptor: <span class="hljs-variable">${COPROC[0]}</span>"</span>
<span class="hljs-built_in">echo</span>
<span class="hljs-comment">#  The coproc is still running, but ...</span>
<span class="hljs-comment">#+ it still doesn't enable the parent process</span>
<span class="hljs-comment">#+ to "inherit" variables from the child process, the while-read loop.</span>

<span class="hljs-comment">#  Compare this to the "badread.sh" script.</span></pre>
            </td>
          </tr>
        </tbody></table>
        <div class="CAUTION">
          <table class="CAUTION" width="90%" border="0">
            <tbody><tr>
              <td width="25" align="center" valign="top"><img src="images/caution.gif" hspace="5" alt="Caution"></td>
              <td align="left" valign="top">
                <p>The coprocess is <i class="FIRSTTERM">asynchronous</i>, and this might cause a problem. It may terminate before another process has finished communicating with it.</p>
                <table border="0" bgcolor="#E0E0E0" width="90%">
                  <tbody><tr>
                    <td>
                      <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash4</span>

coproc cpname { <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {0..10}; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"index = <span class="hljs-variable">$i</span>"</span>; <span class="hljs-keyword">done</span>; }
<span class="hljs-comment">#      ^^^^^^ This is a *named* coprocess.</span>
<span class="hljs-built_in">read</span> -u <span class="hljs-variable">${cpname[0]}</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$REPLY</span>         <span class="hljs-comment">#  index = 0</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${COPROC[0]}</span>   <span class="hljs-comment">#+ No output ... the coprocess timed out</span>
<span class="hljs-comment">#  after the first loop iteration.</span>



<span class="hljs-comment"># However, George Dimitriu has a partial fix.</span>

coproc cpname { <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {0..10}; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"index = <span class="hljs-variable">$i</span>"</span>; <span class="hljs-keyword">done</span>; sleep 1;
<span class="hljs-built_in">echo</span> hi &gt; myo; cat - &gt;&gt; myo; }
<span class="hljs-comment">#       ^^^^^ This is a *named* coprocess.</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"I am main"</span>$<span class="hljs-string">'\04'</span> &gt;&amp;<span class="hljs-variable">${cpname[1]}</span>
myfd=<span class="hljs-variable">${cpname[0]}</span>
<span class="hljs-built_in">echo</span> myfd=<span class="hljs-variable">$myfd</span>

<span class="hljs-comment">### while read -u $myfd</span>
<span class="hljs-comment">### do</span>
<span class="hljs-comment">###   echo $REPLY;</span>
<span class="hljs-comment">### done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-variable">$cpname_PID</span>

<span class="hljs-comment">#  Run this with and without the commented-out while-loop, and it is</span>
<span class="hljs-comment">#+ apparent that each process, the executing shell and the coprocess,</span>
<span class="hljs-comment">#+ waits for the other to finish writing in its own write-enabled pipe.</span></pre>
                    </td>
                  </tr>
                </tbody></table>
              </td>
            </tr>
          </tbody></table>
        </div>
      </li>
      <li>
        <p><a name="MAPFILEREF" id="MAPFILEREF"></a>The new <b class="COMMAND">mapfile</b> builtin makes it possible to load an array with the contents of a text file without using a loop or <a href="arrays.html#ARRAYINITCS">command substitution</a>.</p>
        <table border="0" bgcolor="#E0E0E0" width="90%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash4</span>

<span class="hljs-built_in">mapfile</span> Arr1 &lt; <span class="hljs-variable">$0</span>
<span class="hljs-comment"># Same result as     Arr1=( $(cat $0) )</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${Arr1[@]}</span>"</span>  <span class="hljs-comment"># Copies this entire script out to stdout.</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"--"</span>; <span class="hljs-built_in">echo</span>

<span class="hljs-comment"># But, not the same as   read -a   !!!</span>
<span class="hljs-built_in">read</span> -a Arr2 &lt; <span class="hljs-variable">$0</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${Arr2[@]}</span>"</span>  <span class="hljs-comment"># Reads only first line of script into the array.</span>

<span class="hljs-built_in">exit</span></pre>
            </td>
          </tr>
        </tbody></table>
      </li>
      <li>
        <p>The <a href="internal.html#READREF">read</a> builtin got a minor facelift. The <tt class="OPTION">-t</tt> <a href="internal.html#READTIMED">timeout</a> option now accepts (decimal) fractional values <a name="AEN21096" href="#FTN.AEN21096" id="AEN21096"><span class="footnote">[3]</span></a> and the <tt class="OPTION">-i</tt> option permits preloading the edit buffer. <a name="AEN21101" href="#FTN.AEN21101" id="AEN21101"><span class="footnote">[4]</span></a> Unfortunately, these enhancements are still a work in progress and not (yet) usable in scripts.</p>
      </li>
      <li>
        <p><a name="CASEMODPARAMSUB" id="CASEMODPARAMSUB"></a> <a href="parameter-substitution.html#PARAMSUBREF">Parameter substitution</a> gets <i class="FIRSTTERM">case-modification</i> operators.</p>
        <table border="0" bgcolor="#E0E0E0" width="90%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash4</span>

var=veryMixedUpVariable
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${var}</span>            <span class="hljs-comment"># veryMixedUpVariable</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${var^}</span>           <span class="hljs-comment"># VeryMixedUpVariable</span>
<span class="hljs-comment">#         *              First char --&gt; uppercase.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${var^^}</span>          <span class="hljs-comment"># VERYMIXEDUPVARIABLE</span>
<span class="hljs-comment">#         **             All chars  --&gt; uppercase.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${var,}</span>           <span class="hljs-comment"># veryMixedUpVariable</span>
<span class="hljs-comment">#         *              First char --&gt; lowercase.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${var,,}</span>          <span class="hljs-comment"># verymixedupvariable</span>
<span class="hljs-comment">#         **             All chars  --&gt; lowercase.</span></pre>
            </td>
          </tr>
        </tbody></table>
      </li>
      <li>
        <p><a name="DECLARECASEMOD" id="DECLARECASEMOD"></a></p>
        <p>The <a href="declareref.html">declare</a> builtin now accepts the <tt class="OPTION">-l</tt> <i class="FIRSTTERM">lowercase</i> and <tt class="OPTION">-c</tt> <i class="FIRSTTERM">capitalize</i> options.</p>
        <table border="0" bgcolor="#E0E0E0" width="90%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash4</span>

<span class="hljs-built_in">declare</span> -l var1            <span class="hljs-comment"># Will change to lowercase</span>
var1=MixedCaseVARIABLE
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$var1</span>"</span>               <span class="hljs-comment"># mixedcasevariable</span>
<span class="hljs-comment"># Same effect as             echo $var1 | tr A-Z a-z</span>

<span class="hljs-built_in">declare</span> -c var2            <span class="hljs-comment"># Changes only initial char to uppercase.</span>
var2=originally_lowercase
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$var2</span>"</span>               <span class="hljs-comment"># Originally_lowercase</span>
<span class="hljs-comment"># NOT the same effect as     echo $var2 | tr a-z A-Z</span></pre>
            </td>
          </tr>
        </tbody></table>
      </li>
      <li>
        <p><a name="BRACEEXPREF4" id="BRACEEXPREF4"></a> <a href="special-chars.html#BRACEEXPREF">Brace expansion</a> has more options.</p>
        <p><i class="FIRSTTERM">Increment/decrement</i>, specified in the final term within braces.</p>
        <table border="0" bgcolor="#E0E0E0" width="90%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash4</span>

<span class="hljs-built_in">echo</span> {40..60..2}
<span class="hljs-comment"># 40 42 44 46 48 50 52 54 56 58 60</span>
<span class="hljs-comment"># All the even numbers, between 40 and 60.</span>

<span class="hljs-built_in">echo</span> {60..40..2}
<span class="hljs-comment"># 60 58 56 54 52 50 48 46 44 42 40</span>
<span class="hljs-comment"># All the even numbers, between 40 and 60, counting backwards.</span>
<span class="hljs-comment"># In effect, a decrement.</span>
<span class="hljs-built_in">echo</span> {60..40..-2}
<span class="hljs-comment"># The same output. The minus sign is not necessary.</span>

<span class="hljs-comment"># But, what about letters and symbols?</span>
<span class="hljs-built_in">echo</span> {X..d}
<span class="hljs-comment"># X Y Z [  ] ^ _ ` a b c d</span>
<span class="hljs-comment"># Does not echo the \ which escapes a space.</span></pre>
            </td>
          </tr>
        </tbody></table>
        <p><i class="FIRSTTERM">Zero-padding</i>, specified in the first term within braces, prefixes each term in the output with the <em>same number</em> of zeroes.</p>
        <table border="1" bgcolor="#E0E0E0" width="90%" class="no-border">
          <tbody><tr>
            <td>
              <pre class="SCREEN hljs"><span class="hljs-meta">bash4$</span><span class="bash"> <span class="hljs-built_in">echo</span> {010..15}</span>
010 011 012 013 014 015
<span class="hljs-meta">

bash4$</span><span class="bash"> <span class="hljs-built_in">echo</span> {000..10}</span>
000 001 002 003 004 005 006 007 008 009 010
      </pre>
            </td>
          </tr>
        </tbody></table>
      </li>
      <li>
        <p><a name="SUBSTREXTREF4" id="SUBSTREXTREF4"></a></p>
        <p><a href="bashver4.html#SUBSTREXTREF4"><i class="FIRSTTERM">Substring extraction</i> on <i class="FIRSTTERM">positional parameters</i></a> now starts with <a href="othertypesv.html#SCRNAMEPARAM">$0</a> as the <i class="FIRSTTERM">zero-index</i>. (This corrects an inconsistency in the treatment of positional parameters.)</p>
        <table border="0" bgcolor="#E0E0E0" width="90%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># show-params.bash</span>
<span class="hljs-comment"># Requires version 4+ of Bash.</span>

<span class="hljs-comment"># Invoke this scripts with at least one positional parameter.</span>

E_BADPARAMS=99

<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage <span class="hljs-variable">$0</span> param1 ..."</span>
  <span class="hljs-built_in">exit</span> <span class="hljs-variable">$E_BADPARAMS</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-variable">${@:0}</span>

<span class="hljs-comment"># bash3 show-params.bash4 one two three</span>
<span class="hljs-comment"># one two three</span>

<span class="hljs-comment"># bash4 show-params.bash4 one two three</span>
<span class="hljs-comment"># show-params.bash4 one two three</span>

<span class="hljs-comment"># $0                $1  $2  $3</span></pre>
            </td>
          </tr>
        </tbody></table>
      </li>
      <li>
        <p><a name="GLOBSTARREF" id="GLOBSTARREF"></a>The new <span class="TOKEN">**</span> <a href="globbingref.html">globbing</a> operator matches filenames and directories <a href="localvar.html#RECURSIONREF0">recursively</a>.</p>
        <table border="0" bgcolor="#E0E0E0" width="90%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash4</span>
<span class="hljs-comment"># filelist.bash4</span>

<span class="hljs-built_in">shopt</span> -s globstar  <span class="hljs-comment"># Must enable globstar, otherwise ** doesn't work.</span>
                   <span class="hljs-comment"># The globstar shell option is new to version 4 of Bash.</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Using *"</span>; <span class="hljs-built_in">echo</span>
<span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> *
<span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$filename</span>"</span>
<span class="hljs-keyword">done</span>   <span class="hljs-comment"># Lists only files in current directory ($PWD).</span>

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"--------------"</span>; <span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Using **"</span>
<span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> **
<span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$filename</span>"</span>
<span class="hljs-keyword">done</span>   <span class="hljs-comment"># Lists complete file tree, recursively.</span>

<span class="hljs-built_in">exit</span>

Using *

allmyfiles
filelist.bash4

--------------

Using **

allmyfiles
allmyfiles/file.index.txt
allmyfiles/my_music
allmyfiles/my_music/me-singing-60s-folksongs.ogg
allmyfiles/my_music/me-singing-opera.ogg
allmyfiles/my_music/piano-lesson.1.ogg
allmyfiles/my_pictures
allmyfiles/my_pictures/at-beach-with-Jade.png
allmyfiles/my_pictures/picnic-with-Melissa.png
filelist.bash4</pre>
            </td>
          </tr>
        </tbody></table>
      </li>
      <li>
        <p>The new <a href="internalvariables.html#BASHPIDREF">$BASHPID</a> internal variable.</p>
      </li>
      <li>
        <p><a name="CNFH" id="CNFH"></a></p>
        <p>There is a new <a href="internal.html#BUILTINREF">builtin</a> error-handling function named <b class="COMMAND">command_not_found_handle</b>.</p>
        <table border="0" bgcolor="#E0E0E0" width="90%">
          <tbody><tr>
            <td>
              <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash4</span>

<span class="hljs-function"><span class="hljs-title">command_not_found_handle</span></span> ()
{ <span class="hljs-comment"># Accepts implicit parameters.</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"The following command is not valid: \""</span><span class="hljs-variable">$1</span>\"<span class="hljs-string">""</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"With the following argument(s): \""</span><span class="hljs-variable">$2</span>\"<span class="hljs-string">" \""</span><span class="hljs-variable">$3</span>\"<span class="hljs-string">""</span>   <span class="hljs-comment"># $4, $5 ...</span>
} <span class="hljs-comment"># $1, $2, etc. are not explicitly passed to the function.</span>

bad_command arg1 arg2

<span class="hljs-comment"># The following command is not valid: "bad_command"</span>
<span class="hljs-comment"># With the following argument(s): "arg1" "arg2"</span></pre>
            </td>
          </tr>
        </tbody></table>
      </li>
    </ul>
    <table class="SIDEBAR" border="1" cellpadding="5">
      <tbody><tr>
        <td>
          <div class="SIDEBAR">
            <a name="AEN21170" id="AEN21170"></a>
            <p><em>Editorial comment</em></p>
            <p>Associative arrays? Coprocesses? Whatever happened to the lean and mean Bash we have come to know and love? Could it be suffering from (horrors!) <span class="QUOTE">"feature creep"</span>? Or perhaps even Korn shell envy?</p>
            <p><em>Note to Chet Ramey:</em> Please add only <em>essential</em> features in future Bash releases -- perhaps <i class="FIRSTTERM">for-each</i> loops and support for multi-dimensional arrays. <a name="AEN21179" href="#FTN.AEN21179" id="AEN21179"><span class="footnote">[5]</span></a> Most Bash users won't need, won't use, and likely won't greatly appreciate complex <span class="QUOTE">"features"</span> like built-in debuggers, Perl interfaces, and bolt-on rocket boosters.</p>
          </div>
        </td>
      </tr>
    </tbody></table>
    <div class="SECT2">
      <h2 class="SECT2"><a name="AEN21183" id="AEN21183"></a>37.3.1. Bash, version 4.1</h2>
      <p><a name="BASH41" id="BASH41"></a>Version 4.1 of Bash, released in May, 2010, was primarily a bugfix update.</p>
      <ul>
        <li>
          <p>The <a href="internal.html#PRINTFREF">printf</a> command now accepts a <tt class="OPTION">-v</tt> option for setting <a href="arrays.html#ARRAYREF">array</a> indices.</p>
        </li>
        <li>
          <p>Within <a href="testconstructs.html#DBLBRACKETS">double brackets</a>, the <b class="COMMAND">&gt;</b> and <b class="COMMAND">&lt;</b> string comparison operators now conform to the <a href="localization.html#LOCALEREF">locale</a>. Since the locale setting may affect the sorting order of string expressions, this has side-effects on comparison tests within <em>[[ ... ]]</em> expressions.</p>
        </li>
        <li>
          <p>The <a href="internal.html#READREF">read</a> builtin now takes a <tt class="OPTION">-N</tt> option (<i class="FIRSTTERM">read -N chars</i>), which causes the <i class="FIRSTTERM">read</i> to terminate after <i class="FIRSTTERM">chars</i> characters.</p>
          <div class="EXAMPLE">
            <a name="READN" id="READN"></a>
            <p><b>Example 37-8. Reading N characters</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># Requires Bash version -ge 4.1 ...</span>

num_chars=61

<span class="hljs-built_in">read</span> -N <span class="hljs-variable">$num_chars</span> var &lt; <span class="hljs-variable">$0</span>   <span class="hljs-comment"># Read first 61 characters of script!</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$var</span>"</span>
<span class="hljs-built_in">exit</span>

<span class="hljs-comment">####### Output of Script #######</span>

<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment"># Requires Bash version -ge 4.1 ...</span>

num_chars=61</pre>
                </td>
              </tr>
            </tbody></table>
          </div>
        </li>
        <li>
          <p><a href="here-docs.html#HEREDOCREF">Here documents</a> embedded in <a href="varassignment.html#COMMANDSUBREF0"><tt class="USERINPUT"><b>$( ... )</b></tt> command substitution</a> constructs may terminate with a simple <b class="COMMAND">)</b>.</p>
          <div class="EXAMPLE">
            <a name="HERECOMMSUB" id="HERECOMMSUB"></a>
            <p><b>Example 37-9. Using a <i class="FIRSTTERM">here document</i> to set a variable</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># here-commsub.sh</span>
<span class="hljs-comment"># Requires Bash version -ge 4.1 ...</span>

multi_line_var=$( cat &lt;&lt;ENDxxx
------------------------------
This is line 1 of the variable
This is line 2 of the variable
This is line 3 of the variable
------------------------------
ENDxxx)

<span class="hljs-comment">#  Rather than what Bash 4.0 requires:</span>
<span class="hljs-comment">#+ that the terminating limit string and</span>
<span class="hljs-comment">#+ the terminating close-parenthesis be on separate lines.</span>

<span class="hljs-comment"># ENDxxx</span>
<span class="hljs-comment"># )</span>


<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$multi_line_var</span>"</span>

<span class="hljs-comment">#  Bash still emits a warning, though.</span>
<span class="hljs-comment">#  warning: here-document at line 10 delimited</span>
<span class="hljs-comment">#+ by end-of-file (wanted `ENDxxx')</span></pre>
                </td>
              </tr>
            </tbody></table>
          </div>
        </li>
      </ul>
    </div>
    <div class="SECT2">
      <h2 class="SECT2"><a name="AEN21220" id="AEN21220"></a>37.3.2. Bash, version 4.2</h2>
      <p><a name="BASH42" id="BASH42"></a>Version 4.2 of Bash, released in February, 2011, contains a number of new features and enhancements, in addition to bugfixes.</p>
      <ul>
        <li>
          <p>Bash now supports the the <tt class="REPLACEABLE"><i>\u</i></tt> and <tt class="REPLACEABLE"><i>\U</i></tt> <i class="FIRSTTERM">Unicode</i> escape.</p>
          <p><a name="UNICODEREF" id="UNICODEREF"></a></p>
          <table class="SIDEBAR" border="1" cellpadding="5">
            <tbody><tr>
              <td>
                <div class="SIDEBAR">
                  <a name="AEN21232" id="AEN21232"></a>
                  <p>Unicode is a cross-platform standard for encoding into numerical values letters and graphic symbols. This permits representing and displaying characters in foreign alphabets and unusual fonts.</p>
                </div>
              </td>
            </tr>
          </tbody></table>
          <p><a name="UNICODEREF2" id="UNICODEREF2"></a></p>
          <table border="0" bgcolor="#E0E0E0" width="90%">
            <tbody><tr>
              <td>
                <pre class="PROGRAMLISTING hljs"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">'\u2630'</span>   <span class="hljs-comment"># Horizontal triple bar character.</span>
<span class="hljs-comment"># Equivalent to the more roundabout:</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\xE2\x98\xB0"</span>
                   <span class="hljs-comment"># Recognized by earlier Bash versions.</span>

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">'\u220F'</span>   <span class="hljs-comment"># PI (Greek letter and mathematical symbol)</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">'\u0416'</span>   <span class="hljs-comment"># Capital "ZHE" (Cyrillic letter)</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">'\u2708'</span>   <span class="hljs-comment"># Airplane (Dingbat font) symbol</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">'\u2622'</span>   <span class="hljs-comment"># Radioactivity trefoil</span>

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"The amplifier circuit requires a 100 \u2126 pull-up resistor."</span>


unicode_var=<span class="hljs-string">'\u2640'</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-variable">$unicode_var</span>      <span class="hljs-comment"># Female symbol</span>
<span class="hljs-built_in">printf</span> <span class="hljs-string">"<span class="hljs-variable">$unicode_var</span> \n"</span>  <span class="hljs-comment"># Female symbol, with newline</span>


<span class="hljs-comment">#  And for something a bit more elaborate . . .</span>

<span class="hljs-comment">#  We can store Unicode symbols in an associative array,</span>
<span class="hljs-comment">#+ then retrieve them by name.</span>
<span class="hljs-comment">#  Run this in a gnome-terminal or a terminal with a large, bold font</span>
<span class="hljs-comment">#+ for better legibility.</span>

<span class="hljs-built_in">declare</span> -A symbol  <span class="hljs-comment"># Associative array.</span>

symbol[script_E]=<span class="hljs-string">'\u2130'</span>
symbol[script_F]=<span class="hljs-string">'\u2131'</span>
symbol[script_J]=<span class="hljs-string">'\u2110'</span>
symbol[script_M]=<span class="hljs-string">'\u2133'</span>
symbol[Rx]=<span class="hljs-string">'\u211E'</span>
symbol[TEL]=<span class="hljs-string">'\u2121'</span>
symbol[FAX]=<span class="hljs-string">'\u213B'</span>
symbol[care_of]=<span class="hljs-string">'\u2105'</span>
symbol[account]=<span class="hljs-string">'\u2100'</span>
symbol[trademark]=<span class="hljs-string">'\u2122'</span>


<span class="hljs-built_in">echo</span> -ne <span class="hljs-string">"<span class="hljs-variable">${symbol[script_E]}</span>   "</span>
<span class="hljs-built_in">echo</span> -ne <span class="hljs-string">"<span class="hljs-variable">${symbol[script_F]}</span>   "</span>
<span class="hljs-built_in">echo</span> -ne <span class="hljs-string">"<span class="hljs-variable">${symbol[script_J]}</span>   "</span>
<span class="hljs-built_in">echo</span> -ne <span class="hljs-string">"<span class="hljs-variable">${symbol[script_M]}</span>   "</span>
<span class="hljs-built_in">echo</span> -ne <span class="hljs-string">"<span class="hljs-variable">${symbol[Rx]}</span>   "</span>
<span class="hljs-built_in">echo</span> -ne <span class="hljs-string">"<span class="hljs-variable">${symbol[TEL]}</span>   "</span>
<span class="hljs-built_in">echo</span> -ne <span class="hljs-string">"<span class="hljs-variable">${symbol[FAX]}</span>   "</span>
<span class="hljs-built_in">echo</span> -ne <span class="hljs-string">"<span class="hljs-variable">${symbol[care_of]}</span>   "</span>
<span class="hljs-built_in">echo</span> -ne <span class="hljs-string">"<span class="hljs-variable">${symbol[account]}</span>   "</span>
<span class="hljs-built_in">echo</span> -ne <span class="hljs-string">"<span class="hljs-variable">${symbol[trademark]}</span>   "</span>
<span class="hljs-built_in">echo</span></pre>
              </td>
            </tr>
          </tbody></table>
          <div class="NOTE">
            <table class="NOTE" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/note.gif" hspace="5" alt="Note"></td>
                <td align="left" valign="top">
                  <p>The above example uses the <a href="escapingsection.html#STRQ"><b class="COMMAND">$' ... '</b></a> <i class="FIRSTTERM">string-expansion</i> construct.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
        </li>
        <li>
          <p><a name="LASTPIPEREF" id="LASTPIPEREF"></a></p>
          <p>When the <tt class="REPLACEABLE"><i>lastpipe</i></tt> shell option is set, the last command in a <a href="special-chars.html#PIPEREF">pipe</a> <em>doesn't run in a subshell</em>.</p>
          <div class="EXAMPLE">
            <a name="LASTPIPEOPT" id="LASTPIPEOPT"></a>
            <p><b>Example 37-10. Piping input to a <a href="internal.html#READREF">read</a></b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># lastpipe-option.sh</span>

line=<span class="hljs-string">''</span>                   <span class="hljs-comment"># Null value.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"\$line = "</span><span class="hljs-variable">$line</span><span class="hljs-string">""</span>   <span class="hljs-comment"># $line =</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">shopt</span> -s lastpipe         <span class="hljs-comment"># Error on Bash version -lt 4.2.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Exit status of attempting to set \"lastpipe\" option is $?"</span>
<span class="hljs-comment">#     1 if Bash version -lt 4.2, 0 otherwise.</span>

<span class="hljs-built_in">echo</span>

head -1 <span class="hljs-variable">$0</span> | <span class="hljs-built_in">read</span> line    <span class="hljs-comment"># Pipe the first line of the script to read.</span>
<span class="hljs-comment">#            ^^^^^^^^^      Not in a subshell!!!</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"\$line = "</span><span class="hljs-variable">$line</span><span class="hljs-string">""</span>
<span class="hljs-comment"># Older Bash releases       $line =</span>
<span class="hljs-comment"># Bash version 4.2          $line = #!/bin/bash</span></pre>
                </td>
              </tr>
            </tbody></table>
          </div>
          <p>This option offers possible <span class="QUOTE">"fixups"</span> for these example scripts: <a href="gotchas.html#BADREAD">Example 34-3</a> and <a href="internal.html#READPIPE">Example 15-8</a>.</p>
        </li>
        <li>
          <p>Negative <a href="arrays.html#ARRAYREF">array</a> indices permit counting backwards from the end of an array.</p>
          <div class="EXAMPLE">
            <a name="NEGARRAY" id="NEGARRAY"></a>
            <p><b>Example 37-11. Negative array indices</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># neg-array.sh</span>
<span class="hljs-comment"># Requires Bash, version -ge 4.2.</span>

array=( zero one two three four five )   <span class="hljs-comment"># Six-element array.</span>
<span class="hljs-comment">#         0    1   2    3    4    5</span>
<span class="hljs-comment">#        -6   -5  -4   -3   -2   -1</span>

<span class="hljs-comment"># Negative array indices now permitted.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${array[-1]}</span>   <span class="hljs-comment"># five</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${array[-2]}</span>   <span class="hljs-comment"># four</span>
<span class="hljs-comment"># ...</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${array[-6]}</span>   <span class="hljs-comment"># zero</span>
<span class="hljs-comment"># Negative array indices count backward from the last element+1.</span>

<span class="hljs-comment"># But, you cannot index past the beginning of the array.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${array[-7]}</span>   <span class="hljs-comment"># array: bad array subscript</span>


<span class="hljs-comment"># So, what is this new feature good for?</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"The last element in the array is "</span><span class="hljs-variable">${array[-1]}</span><span class="hljs-string">""</span>
<span class="hljs-comment"># Which is quite a bit more straightforward than:</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"The last element in the array is "</span><span class="hljs-variable">${array[${#array[*]}</span>-1]}<span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># And ...</span>

index=0
<span class="hljs-built_in">let</span> <span class="hljs-string">"neg_element_count = 0 - <span class="hljs-variable">${#array[*]}</span>"</span>
<span class="hljs-comment"># Number of elements, converted to a negative number.</span>

<span class="hljs-keyword">while</span> [ <span class="hljs-variable">$index</span> -gt <span class="hljs-variable">$neg_element_count</span> ]; <span class="hljs-keyword">do</span>
  ((index--)); <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">${array[index]}</span> "</span>
<span class="hljs-keyword">done</span>  <span class="hljs-comment"># Lists the elements in the array, backwards.</span>
      <span class="hljs-comment"># We have just simulated the "tac" command on this array.</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-comment"># See also neg-offset.sh.</span></pre>
                </td>
              </tr>
            </tbody></table>
          </div>
        </li>
        <li>
          <p><a href="string-manipulation.html#SUBSTREXTR01">Substring extraction</a> uses a negative <i class="FIRSTTERM">length</i> parameter to specify an offset from the <i class="FIRSTTERM">end</i> of the target string.</p>
          <div class="EXAMPLE">
            <a name="NEGOFFSET" id="NEGOFFSET"></a>
            <p><b>Example 37-12. Negative parameter in string-extraction construct</b></p>
            <table border="0" bgcolor="#E0E0E0" width="90%">
              <tbody><tr>
                <td>
                  <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># Bash, version -ge 4.2</span>
<span class="hljs-comment"># Negative length-index in substring extraction.</span>
<span class="hljs-comment"># Important: It changes the interpretation of this construct!</span>

stringZ=abcABC123ABCabc

<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ}</span>                              <span class="hljs-comment"># abcABC123ABCabc</span>
<span class="hljs-comment">#                   Position within string:    0123456789.....</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ:2:3}</span>                          <span class="hljs-comment">#   cAB</span>
<span class="hljs-comment">#  Count 2 chars forward from string beginning, and extract 3 chars.</span>
<span class="hljs-comment">#  ${string:position:length}</span>

<span class="hljs-comment">#  So far, nothing new, but now ...</span>

                                             <span class="hljs-comment"># abcABC123ABCabc</span>
<span class="hljs-comment">#                   Position within string:    0123....6543210</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${stringZ:3:-6}</span>                         <span class="hljs-comment">#    ABC123</span>
<span class="hljs-comment">#                ^</span>
<span class="hljs-comment">#  Index 3 chars forward from beginning and 6 chars backward from end,</span>
<span class="hljs-comment">#+ and extract everything in between.</span>
<span class="hljs-comment">#  ${string:offset-from-front:offset-from-end}</span>
<span class="hljs-comment">#  When the "length" parameter is negative, </span>
<span class="hljs-comment">#+ it serves as an offset-from-end parameter.</span>

<span class="hljs-comment">#  See also neg-array.sh.</span></pre>
                </td>
              </tr>
            </tbody></table>
          </div>
        </li>
      </ul>
    </div>
  </div>
  <h3 class="FOOTNOTES">Notes</h3>
  <table border="0" class="FOOTNOTES" width="100%">
    <tbody><tr>
      <td align="left" valign="top" width="5%"><a name="FTN.AEN21025" href="bashver4.html#AEN21025" id="FTN.AEN21025"><span class="footnote">[1]</span></a></td>
      <td align="left" valign="top" width="95%">
        <p>To be more specific, Bash 4+ has <em>limited</em> support for associative arrays. It's a bare-bones implementation, and it lacks the much of the functionality of such arrays in other programming languages. Note, however, that <a href="optimizations.html#ASSOCARRTST">associative arrays in Bash seem to execute faster and more efficiently than numerically-indexed arrays</a>.</p>
      </td>
    </tr>
    <tr>
      <td align="left" valign="top" width="5%"><a name="FTN.AEN21068" href="bashver4.html#AEN21068" id="FTN.AEN21068"><span class="footnote">[2]</span></a></td>
      <td align="left" valign="top" width="95%">
        <p>Copyright 1995-2009 by Chester Ramey.</p>
      </td>
    </tr>
    <tr>
      <td align="left" valign="top" width="5%"><a name="FTN.AEN21096" href="bashver4.html#AEN21096" id="FTN.AEN21096"><span class="footnote">[3]</span></a></td>
      <td align="left" valign="top" width="95%">
        <p>This only works with <a href="special-chars.html#PIPEREF">pipes</a> and certain other <i class="FIRSTTERM">special</i> files.</p>
      </td>
    </tr>
    <tr>
      <td align="left" valign="top" width="5%"><a name="FTN.AEN21101" href="bashver4.html#AEN21101" id="FTN.AEN21101"><span class="footnote">[4]</span></a></td>
      <td align="left" valign="top" width="95%">
        <p>But only in conjunction with <a href="internal.html#READLINEREF">readline</a>, i.e., from the command-line.</p>
      </td>
    </tr>
    <tr>
      <td align="left" valign="top" width="5%"><a name="FTN.AEN21179" href="bashver4.html#AEN21179" id="FTN.AEN21179"><span class="footnote">[5]</span></a></td>
      <td align="left" valign="top" width="95%">
        <p>And while you're at it, consider fixing the notorious <a href="internal.html#PIPEREADREF0">piped read</a> problem.</p>
      </td>
    </tr>
  </tbody></table>
  <div class="NAVFOOTER">
    <hr align="left" width="100%">
    <table summary="Footer navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tbody><tr>
        <td width="33%" align="left" valign="top"><a href="bashver3.html" accesskey="P">Prev</a></td>
        <td width="34%" align="center" valign="top"><a href="index.html" accesskey="H">Home</a></td>
        <td width="33%" align="right" valign="top"><a href="endnotes.html" accesskey="N">Next</a></td>
      </tr>
      <tr>
        <td width="33%" align="left" valign="top">Bash, version 3</td>
        <td width="34%" align="center" valign="top"><a href="bash2.html" accesskey="U">Up</a></td>
        <td width="33%" align="right" valign="top">Endnotes</td>
      </tr>
    </tbody></table>
  </div>


<button id="theme-toggle">Toggle theme</button></body></html>
