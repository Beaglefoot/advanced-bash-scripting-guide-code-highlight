<!DOCTYPE html><html><head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.7.28">
  <title>Process Substitution</title>
  <meta name="GENERATOR" content="Modular DocBook HTML Stylesheet Version 1.7">
  <link rel="HOME" title="Advanced Bash-Scripting Guide" href="index.html">
  <link rel="UP" title="Advanced Topics" href="part5.html">
  <link rel="PREVIOUS" title="Restricted Shells" href="restricted-sh.html">
  <link rel="NEXT" title="Functions" href="functions.html">
<link rel="stylesheet" href="styles/custom.css"><link rel="stylesheet" href="styles/atom-one-dark.css"></head>
<body class="CHAPTER" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#840084" alink="#0000FF">
  <div class="NAVHEADER">
    <table summary="Header navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tbody><tr>
        <th colspan="3" align="center">Advanced Bash-Scripting Guide:</th>
      </tr>
      <tr>
        <td width="10%" align="left" valign="bottom"><a href="restricted-sh.html" accesskey="P">Prev</a></td>
        <td width="80%" align="center" valign="bottom"></td>
        <td width="10%" align="right" valign="bottom"><a href="functions.html" accesskey="N">Next</a></td>
      </tr>
    </tbody></table>
    <hr align="left" width="100%">
  </div>
  <div class="CHAPTER">
    <h1><a name="PROCESS-SUB" id="PROCESS-SUB"></a>Chapter 23. Process Substitution</h1>
    <p><a name="PROCESSSUBREF" id="PROCESSSUBREF"></a><a href="special-chars.html#PIPEREF">Piping</a> the <tt class="FILENAME">stdout</tt> of a command into the <tt class="FILENAME">stdin</tt> of another is a powerful technique. But, what if you need to pipe the <tt class="FILENAME">stdout</tt> of <em>multiple</em> commands? This is where <tt class="REPLACEABLE"><i>process substitution</i></tt> comes in.</p>
    <p><i class="FIRSTTERM">Process substitution</i> feeds the output of a <a href="special-chars.html#PROCESSREF">process</a> (or processes) into the <tt class="FILENAME">stdin</tt> of another process.</p>
    <div class="VARIABLELIST">
      <p><b><a name="COMMANDSPARENS1" id="COMMANDSPARENS1"></a>Template</b></p>
      <dl>
        <dt>Command list enclosed within parentheses</dt>
        <dd>
          <p><b class="COMMAND">&gt;(command_list)</b></p>
          <p><b class="COMMAND">&lt;(command_list)</b></p>
          <p>Process substitution uses <tt class="FILENAME">/dev/fd/&lt;n&gt;</tt> files to send the results of the process(es) within parentheses to another process. <a name="AEN18244" href="#FTN.AEN18244" id="AEN18244"><span class="footnote">[1]</span></a></p>
          <div class="CAUTION">
            <table class="CAUTION" width="90%" border="0">
              <tbody><tr>
                <td width="25" align="center" valign="top"><img src="images/caution.gif" hspace="5" alt="Caution"></td>
                <td align="left" valign="top">
                  <p>There is <em>no</em> space between the the <span class="QUOTE">"&lt;"</span> or <span class="QUOTE">"&gt;"</span> and the parentheses. Space there would give an error message.</p>
                </td>
              </tr>
            </tbody></table>
          </div>
        </dd>
      </dl>
    </div>
    <table border="1" bgcolor="#E0E0E0" width="100%" class="no-border">
      <tbody><tr>
        <td>
          <pre class="SCREEN hljs"><span class="hljs-meta">bash$</span><span class="bash"> <span class="hljs-built_in">echo</span> &gt;(<span class="hljs-literal">true</span>)</span>
/dev/fd/63
<span class="hljs-meta">
bash$</span><span class="bash"> <span class="hljs-built_in">echo</span> &lt;(<span class="hljs-literal">true</span>)</span>
/dev/fd/63
<span class="hljs-meta">
bash$</span><span class="bash"> <span class="hljs-built_in">echo</span> &gt;(<span class="hljs-literal">true</span>) &lt;(<span class="hljs-literal">true</span>)</span>
/dev/fd/63 /dev/fd/62
<span class="hljs-meta">


bash$</span><span class="bash"> wc &lt;(cat /usr/share/dict/linux.words)</span>
 483523  483523 4992010 /dev/fd/63
<span class="hljs-meta">
bash$</span><span class="bash"> grep script /usr/share/dict/linux.words | wc</span>
    262     262    3601
<span class="hljs-meta">
bash$</span><span class="bash"> wc &lt;(grep script /usr/share/dict/linux.words)</span>
    262     262    3601 /dev/fd/63
              </pre>
        </td>
      </tr>
    </tbody></table>
    <div class="NOTE">
      <table class="NOTE" width="100%" border="0">
        <tbody><tr>
          <td width="25" align="center" valign="top"><img src="images/note.gif" hspace="5" alt="Note"></td>
          <td align="left" valign="top">
            <p>Bash creates a pipe with two <a href="io-redirection.html#FDREF">file descriptors</a>, <tt class="FILENAME">--fIn</tt> and <tt class="FILENAME">fOut--</tt>. The <tt class="FILENAME">stdin</tt> of <a href="internal.html#TRUEREF">true</a> connects to <tt class="FILENAME">fOut</tt> (dup2(fOut, 0)), then Bash passes a <tt class="FILENAME">/dev/fd/fIn</tt> argument to <b class="COMMAND">echo</b>. On systems lacking <tt class="FILENAME">/dev/fd/&lt;n&gt;</tt> files, Bash may use temporary files. (Thanks, S.C.)</p>
          </td>
        </tr>
      </tbody></table>
    </div>
    <p>Process substitution can compare the output of two different commands, or even the output of different options to the same command.</p>
    <table border="1" bgcolor="#E0E0E0" width="100%" class="no-border">
      <tbody><tr>
        <td>
          <pre class="SCREEN hljs"><span class="hljs-meta">bash$</span><span class="bash"> comm &lt;(ls -l) &lt;(ls -al)</span>
total 12
-rw-rw-r--    1 bozo bozo       78 Mar 10 12:58 File0
-rw-rw-r--    1 bozo bozo       42 Mar 10 12:58 File2
-rw-rw-r--    1 bozo bozo      103 Mar 10 12:58 t2.sh
        total 20
        drwxrwxrwx    2 bozo bozo     4096 Mar 10 18:10 .
        drwx------   72 bozo bozo     4096 Mar 10 17:58 ..
        -rw-rw-r--    1 bozo bozo       78 Mar 10 12:58 File0
        -rw-rw-r--    1 bozo bozo       42 Mar 10 12:58 File2
        -rw-rw-r--    1 bozo bozo      103 Mar 10 12:58 t2.sh</pre>
        </td>
      </tr>
    </tbody></table>
    <p><a name="PCC2DIR" id="PCC2DIR"></a></p>
    <p>Process substitution can compare the contents of two directories -- to see which filenames are in one, but not the other.</p>
    <table border="0" bgcolor="#E0E0E0" width="100%">
      <tbody><tr>
        <td>
          <pre class="PROGRAMLISTING hljs">diff &lt;(ls <span class="hljs-variable">$first_directory</span>) &lt;(ls <span class="hljs-variable">$second_directory</span>)</pre>
        </td>
      </tr>
    </tbody></table>
    <p>Some other usages and uses of process substitution:</p>
    <p><a name="PSFDSTDIN" id="PSFDSTDIN"></a></p>
    <table border="0" bgcolor="#E0E0E0" width="100%">
      <tbody><tr>
        <td>
          <pre class="PROGRAMLISTING hljs"><span class="hljs-built_in">read</span> -a list &lt; &lt;( od -Ad -w24 -t u2 /dev/urandom )
<span class="hljs-comment">#  Read a list of random numbers from /dev/urandom,</span>
<span class="hljs-comment">#+ process with "od"</span>
<span class="hljs-comment">#+ and feed into stdin of "read" . . .</span>

<span class="hljs-comment">#  From "insertion-sort.bash" example script.</span>
<span class="hljs-comment">#  Courtesy of JuanJo Ciarlante.</span></pre>
        </td>
      </tr>
    </tbody></table>
    <p><a name="NETCATEXAMPLE" id="NETCATEXAMPLE"></a></p>
    <table border="0" bgcolor="#E0E0E0" width="100%">
      <tbody><tr>
        <td>
          <pre class="PROGRAMLISTING hljs">PORT=6881   <span class="hljs-comment"># bittorrent</span>

<span class="hljs-comment"># Scan the port to make sure nothing nefarious is going on.</span>
netcat -l <span class="hljs-variable">$PORT</span> | tee&gt;(md5sum -&gt;mydata-orig.md5) |
gzip | tee&gt;(md5sum - | sed <span class="hljs-string">'s/-$/mydata.lz2/'</span>&gt;mydata-gz.md5)&gt;mydata.gz

<span class="hljs-comment"># Check the decompression:</span>
  gzip -d&lt;mydata.gz | md5sum -c mydata-orig.md5)
<span class="hljs-comment"># The MD5sum of the original checks stdin and detects compression issues.</span>

<span class="hljs-comment">#  Bill Davidsen contributed this example</span>
<span class="hljs-comment">#+ (with light edits by the ABS Guide author).</span></pre>
        </td>
      </tr>
    </tbody></table>
    <table border="0" bgcolor="#E0E0E0" width="100%">
      <tbody><tr>
        <td>
          <pre class="PROGRAMLISTING hljs">cat &lt;(ls -l)
<span class="hljs-comment"># Same as     ls -l | cat</span>

sort -k 9 &lt;(ls -l /bin) &lt;(ls -l /usr/bin) &lt;(ls -l /usr/X11R6/bin)
<span class="hljs-comment"># Lists all the files in the 3 main 'bin' directories, and sorts by filename.</span>
<span class="hljs-comment"># Note that three (count 'em) distinct commands are fed to 'sort'.</span>

 
diff &lt;(command1) &lt;(command2)    <span class="hljs-comment"># Gives difference in command output.</span>

tar cf &gt;(bzip2 -c &gt; file.tar.bz2) <span class="hljs-variable">$directory_name</span>
<span class="hljs-comment"># Calls "tar cf /dev/fd/?? $directory_name", and "bzip2 -c &gt; file.tar.bz2".</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Because of the /dev/fd/&lt;n&gt; system feature,</span>
<span class="hljs-comment"># the pipe between both commands does not need to be named.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># This can be emulated.</span>
<span class="hljs-comment">#</span>
bzip2 -c &lt; pipe &gt; file.tar.bz2&amp;
tar cf pipe <span class="hljs-variable">$directory_name</span>
rm pipe
<span class="hljs-comment">#        or</span>
<span class="hljs-built_in">exec</span> 3&gt;&amp;1
tar cf /dev/fd/4 <span class="hljs-variable">$directory_name</span> 4&gt;&amp;1 &gt;&amp;3 3&gt;&amp;- | bzip2 -c &gt; file.tar.bz2 3&gt;&amp;-
<span class="hljs-built_in">exec</span> 3&gt;&amp;-


<span class="hljs-comment"># Thanks, Stephane Chazelas</span></pre>
        </td>
      </tr>
    </tbody></table>
    <p><a name="GOODREAD0" id="GOODREAD0"></a>Here is a method of circumventing the problem of an <a href="gotchas.html#BADREAD0"><i class="FIRSTTERM">echo</i> piped to a <i class="FIRSTTERM">while-read loop</i></a> running in a subshell.</p>
    <div class="EXAMPLE">
      <a name="WRPS" id="WRPS"></a>
      <p><b>Example 23-1. Code block redirection without forking</b></p>
      <table border="0" bgcolor="#E0E0E0" width="100%">
        <tbody><tr>
          <td>
            <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># wr-ps.bash: while-read loop with process substitution.</span>

<span class="hljs-comment"># This example contributed by Tomas Pospisek.</span>
<span class="hljs-comment"># (Heavily edited by the ABS Guide author.)</span>

<span class="hljs-built_in">echo</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"random input"</span> | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> i
<span class="hljs-keyword">do</span>
  global=3D<span class="hljs-string">": Not available outside the loop."</span>
  <span class="hljs-comment"># ... because it runs in a subshell.</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"\$global (from outside the subprocess) = <span class="hljs-variable">$global</span>"</span>
<span class="hljs-comment"># $global (from outside the subprocess) =</span>

<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"--"</span>; <span class="hljs-built_in">echo</span>

<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> i
<span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span>
  global=3D<span class="hljs-string">": Available outside the loop."</span>
  <span class="hljs-comment"># ... because it does NOT run in a subshell.</span>
<span class="hljs-keyword">done</span> &lt; &lt;( <span class="hljs-built_in">echo</span> <span class="hljs-string">"random input"</span> )
<span class="hljs-comment">#    ^ ^</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"\$global (using process substitution) = <span class="hljs-variable">$global</span>"</span>
<span class="hljs-comment"># Random input</span>
<span class="hljs-comment"># $global (using process substitution) = 3D: Available outside the loop.</span>


<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"##########"</span>; <span class="hljs-built_in">echo</span>



<span class="hljs-comment"># And likewise . . .</span>

<span class="hljs-built_in">declare</span> -a inloop
index=0
cat <span class="hljs-variable">$0</span> | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line
<span class="hljs-keyword">do</span>
  inloop[<span class="hljs-variable">$index</span>]=<span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>
  ((index++))
  <span class="hljs-comment"># It runs in a subshell, so ...</span>
<span class="hljs-keyword">done</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"OUTPUT = "</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${inloop[*]}</span>           <span class="hljs-comment"># ... nothing echoes.</span>


<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"--"</span>; <span class="hljs-built_in">echo</span>


<span class="hljs-built_in">declare</span> -a outloop
index=0
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line
<span class="hljs-keyword">do</span>
  outloop[<span class="hljs-variable">$index</span>]=<span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>
  ((index++))
  <span class="hljs-comment"># It does NOT run in a subshell, so ...</span>
<span class="hljs-keyword">done</span> &lt; &lt;( cat <span class="hljs-variable">$0</span> )
<span class="hljs-built_in">echo</span> <span class="hljs-string">"OUTPUT = "</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${outloop[*]}</span>          <span class="hljs-comment"># ... the entire script echoes.</span>

<span class="hljs-built_in">exit</span> $?</pre>
          </td>
        </tr>
      </tbody></table>
    </div>
    <p><a name="PSUBPIPING" id="PSUBPIPING"></a>This is a similar example.</p>
    <div class="EXAMPLE">
      <a name="PSUBP" id="PSUBP"></a>
      <p><b>Example 23-2. Redirecting the output of <i class="FIRSTTERM">process substitution</i> into a loop.</b></p>
      <table border="0" bgcolor="#E0E0E0" width="100%">
        <tbody><tr>
          <td>
            <pre class="PROGRAMLISTING hljs"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># psub.bash</span>

<span class="hljs-comment"># As inspired by Diego Molina (thanks!).</span>

<span class="hljs-built_in">declare</span> -a array0
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span>
<span class="hljs-keyword">do</span>
  array0[<span class="hljs-variable">${#array0[@]}</span>]=<span class="hljs-string">"<span class="hljs-variable">$REPLY</span>"</span>
<span class="hljs-keyword">done</span> &lt; &lt;( sed -e <span class="hljs-string">'s/bash/CRASH-BANG!/'</span> <span class="hljs-variable">$0</span> | grep bin | awk <span class="hljs-string">'{print $1}'</span> )
<span class="hljs-comment">#  Sets the default 'read' variable, $REPLY, by process substitution,</span>
<span class="hljs-comment">#+ then copies it into an array.</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${array0[@]}</span>"</span>

<span class="hljs-built_in">exit</span> $?

<span class="hljs-comment"># ====================================== #</span>

bash psub.bash

<span class="hljs-comment">#!/bin/CRASH-BANG! done #!/bin/CRASH-BANG!</span></pre>
          </td>
        </tr>
      </tbody></table>
    </div>
    <p>A reader sent in the following interesting example of process substitution.</p>
    <table border="0" bgcolor="#E0E0E0" width="100%">
      <tbody><tr>
        <td>
          <pre class="PROGRAMLISTING hljs"><span class="hljs-comment"># Script fragment taken from SuSE distribution:</span>

<span class="hljs-comment"># --------------------------------------------------------------#</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span>  des what mask iface; <span class="hljs-keyword">do</span>
<span class="hljs-comment"># Some commands ...</span>
<span class="hljs-keyword">done</span> &lt; &lt;(route -n)  
<span class="hljs-comment">#    ^ ^  First &lt; is redirection, second is process substitution.</span>

<span class="hljs-comment"># To test it, let's make it do something.</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span>  des what mask iface; <span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$des</span> <span class="hljs-variable">$what</span> <span class="hljs-variable">$mask</span> <span class="hljs-variable">$iface</span>
<span class="hljs-keyword">done</span> &lt; &lt;(route -n)  

<span class="hljs-comment"># Output:</span>
<span class="hljs-comment"># Kernel IP routing table</span>
<span class="hljs-comment"># Destination Gateway Genmask Flags Metric Ref Use Iface</span>
<span class="hljs-comment"># 127.0.0.0 0.0.0.0 255.0.0.0 U 0 0 0 lo</span>
<span class="hljs-comment"># --------------------------------------------------------------#</span>

<span class="hljs-comment">#  As Stephane Chazelas points out,</span>
<span class="hljs-comment">#+ an easier-to-understand equivalent is:</span>
route -n |
  <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> des what mask iface; <span class="hljs-keyword">do</span>   <span class="hljs-comment"># Variables set from output of pipe.</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$des</span> <span class="hljs-variable">$what</span> <span class="hljs-variable">$mask</span> <span class="hljs-variable">$iface</span>
  <span class="hljs-keyword">done</span>  <span class="hljs-comment">#  This yields the same output as above.</span>
        <span class="hljs-comment">#  However, as Ulrich Gayer points out . . .</span>
        <span class="hljs-comment">#+ this simplified equivalent uses a subshell for the while loop,</span>
        <span class="hljs-comment">#+ and therefore the variables disappear when the pipe terminates.</span>
        
<span class="hljs-comment"># --------------------------------------------------------------#</span>
        
<span class="hljs-comment">#  However, Filip Moritz comments that there is a subtle difference</span>
<span class="hljs-comment">#+ between the above two examples, as the following shows.</span>

(
route -n | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> x; <span class="hljs-keyword">do</span> ((y++)); <span class="hljs-keyword">done</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$y</span> <span class="hljs-comment"># $y is still unset</span>

<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> x; <span class="hljs-keyword">do</span> ((y++)); <span class="hljs-keyword">done</span> &lt; &lt;(route -n)
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$y</span> <span class="hljs-comment"># $y has the number of lines of output of route -n</span>
)

More generally spoken
(
: | x=x
<span class="hljs-comment"># seems to start a subshell like</span>
: | ( x=x )
<span class="hljs-comment"># while</span>
x=x &lt; &lt;(:)
<span class="hljs-comment"># does not</span>
)

<span class="hljs-comment"># This is useful, when parsing csv and the like.</span>
<span class="hljs-comment"># That is, in effect, what the original SuSE code fragment does.</span></pre>
        </td>
      </tr>
    </tbody></table>
  </div>
  <h3 class="FOOTNOTES">Notes</h3>
  <table border="0" class="FOOTNOTES" width="100%">
    <tbody><tr>
      <td align="left" valign="top" width="5%"><a name="FTN.AEN18244" href="process-sub.html#AEN18244" id="FTN.AEN18244"><span class="footnote">[1]</span></a></td>
      <td align="left" valign="top" width="95%">
        <p>This has the same effect as a <a href="extmisc.html#NAMEDPIPEREF">named pipe</a> (temp file), and, in fact, named pipes were at one time used in process substitution.</p>
      </td>
    </tr>
  </tbody></table>
  <div class="NAVFOOTER">
    <hr align="left" width="100%">
    <table summary="Footer navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
      <tbody><tr>
        <td width="33%" align="left" valign="top"><a href="restricted-sh.html" accesskey="P">Prev</a></td>
        <td width="34%" align="center" valign="top"><a href="index.html" accesskey="H">Home</a></td>
        <td width="33%" align="right" valign="top"><a href="functions.html" accesskey="N">Next</a></td>
      </tr>
      <tr>
        <td width="33%" align="left" valign="top">Restricted Shells</td>
        <td width="34%" align="center" valign="top"><a href="part5.html" accesskey="U">Up</a></td>
        <td width="33%" align="right" valign="top">Functions</td>
      </tr>
    </tbody></table>
  </div>


</body></html>
